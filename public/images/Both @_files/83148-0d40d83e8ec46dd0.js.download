"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[83148],{883148:function(e,t,n){n.d(t,{Z:function(){return es}});var s=n(824246),i=n(827378),r=n(412937),o=n(722030),a=n(416534),l=n(834770),c=n(60042),d=n.n(c),u=n(935925),m=n(592284),p=n(789018),h=n(132821),g=n(133877),x=n(298784),v=n.n(x),f=n(138944),C=n(444832),j=n(713222),S=n(795115),b=n(456552),y=n(514240),w=n(46610),I=n(489812),T=n(759276),k=n(857025),A=n(102785),E=n(583469);let renderCleanHTMLString=e=>{let t=e.replace(/&nbsp;/g," ").replace(/<br\s*\/?>/gi,"\n").replace(/<p>/gi,"").replace(/<\/p>/gi,"\n").replace(/<strong>(.*?)<\/strong>/gi,"$1").replace(/<u>(.*?)<\/u>/gi,"$1").replace(/<span[^>]*>(.*?)<\/span>/gi,"$1").replace(/<[^>]+>/g,"").trim();return t?(0,s.jsx)(T.xv,{children:t}):(0,s.jsx)(w.$,{markdownString:e})},OptionButton=e=>{let{isRadioButton:t,isSelected:n}=e;return(0,s.jsx)("i",{className:(0,f.default)("w-4 h-4 border bg-neutral-50 flex justify-center items-center",{"rounded-sm":!t,"rounded-full":t,"border-neutral-300":!n,"border-primary-500":n}),children:n&&(t?(0,s.jsx)("i",{className:"w-2.5 h-2.5 border-[1px] rounded-full bg-primary-500"}):(0,s.jsx)(j.J,{icon:"check",size:"sm"}))})};var SectionItems_MultipleChoiceItem=e=>{var t,n,r;let{course:l,item:c,courseProgress:d,sectionIndex:u,readOnly:m=!1,isAudit:h=!1}=e,[g,x]=(0,i.useState)([]),[j,R]=(0,i.useState)(!1),[N,P]=(0,i.useState)(!1),[F,M]=(0,i.useState)(""),[B,z]=(0,i.useState)(""),[L,D]=(0,i.useState)(!1),[q,U]=(0,i.useState)(null),[V,_]=(0,i.useState)(null!==(r=null===(n=d.courseAnswer)||void 0===n?void 0:null===(t=n[c.id])||void 0===t?void 0:t.attemptNumber)&&void 0!==r?r:0),W=(0,y.B)(e=>e.addToMultipleChoiceCompleteness),H=c.contents.choices?c.contents.choices.filter(e=>e.isCorrect).map(e=>e.answer):[];(0,i.useEffect)(()=>{if(d.courseAnswer){let n=d.courseAnswer[c.id];if(n){var e,t;n.isComplete&&W(c.id),D(null!==(e=n.isComplete)&&void 0!==e&&e);let s=(null!==(t=c.contents.choices)&&void 0!==t?t:[]).map((e,t)=>n.contents.includes(e.id)?t:-1).filter(e=>-1!==e);x(s),h&&void 0!==n.isCorrect&&U(n.isCorrect)}}},[d,c.contents.choices,c.id,W,h]);let handleToggleChoice=e=>{if(h||L)return;if(c.contents.singleSelect)return x([e]);let t=v().cloneDeep(g);v().includes(t,e)?v().pull(t,e):t.push(e),x(t)},{mutate:$,isLoading:O}=(0,b.useMutation)(e=>p.Z.labeling.checkCourseV2Answer(l._id,{courseProgressId:d._id,sectionIndex:u,itemId:c.id,selectedAnswerIds:e}),{onSuccess:e=>{R(!1),P(!1),_(e.attemptNumber),e.noCorrectAnswerRequired?(R(!0),D(!1),W(c.id)):e.isCorrect||e.isComplete?(U(e.isCorrect),D(!0),R(!0),M(e.explanation),W(c.id)):(U(e.isCorrect),D(e.isComplete),P(!0),z(e.hint))},onError:()=>{S.c.track("Multiple Choice - Failed to retrieve answer")}});return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"text-sm",children:(0,s.jsx)(w.$,{markdownString:c.contents.question||""})}),(0,s.jsx)(I.kC,{justify:"end",pb:"1",children:(0,s.jsxs)(T.xv,{size:"1",color:!c.contents.maxAttempts||+c.contents.maxAttempts-V!=0||!1!==q||c.contents.hideAnswerFeedback||c.contents.noCorrectAnswerRequired?"neutral":"error",children:["Attempts remaining:"," ",c.contents.maxAttempts&&!c.contents.noCorrectAnswerRequired?+c.contents.maxAttempts-V:"Unlimited"]})}),(0,s.jsx)("div",{className:"grid grid-cols-[1fr_1fr] gap-2",children:v().map(c.contents.choices,(e,t)=>{let n=v().includes(g,t);return(0,s.jsxs)("div",{className:(0,f.default)(["border-solid border rounded-lg mb-4",L||h?"":"hover:bg-neutral-100 transition-colors bg-neutral-0",L?"":"cursor-pointer","flex justify-between items-center font-medium",{"border-neutral-300":!n,"border-primary-500":n}]),onClick:()=>handleToggleChoice(t),children:[(0,s.jsxs)(I.kC,{p:"4",gap:"2",children:[c.contents.labelOptions&&(0,s.jsx)(I.kC,{align:"center",justify:"center",children:(0,s.jsx)(T.xv,{size:"2",children:"".concat(String.fromCharCode(65+t),")")})}),(0,s.jsx)(w.$,{markdownString:e.answer||""})]}),(0,s.jsx)("div",{className:"mr-4",children:(0,s.jsx)(OptionButton,{isRadioButton:c.contents.singleSelect,isSelected:n})})]},t)})}),(!L&&!m||c.contents.noCorrectAnswerRequired)&&(0,s.jsx)("div",{className:"w-full px-6 pb-6 flex justify-center",children:(0,s.jsx)(a.zx,{disabled:0===g.length,className:"w-60",size:"lg",fullWidth:!0,variant:"primary",onClick:()=>$(g.map(e=>c.contents.choices[e].id)),children:"Submit Answer"})}),O&&(0,s.jsx)("div",{children:(0,s.jsx)(o.$,{className:"flex justify-center",size:"sm"})}),!c.contents.hideAnswerFeedback&&!c.contents.noCorrectAnswerRequired&&(0,s.jsxs)(s.Fragment,{children:[q&&(0,s.jsx)(C.j,{className:"mb-4 bg-success-100",title:"This is correct",subtitle:F?(0,s.jsx)(T.xv,{size:"2",color:"neutral",children:(0,s.jsxs)(I.kC,{gap:"1",align:"center",children:[(0,s.jsx)(k.J,{icon:E.tq6,label:"info"}),"Explanation: ",F]})}):void 0,variant:"success"}),!1===q&&(0,s.jsx)(C.j,{className:"mb-4 bg-danger-100",title:"This is incorrect".concat(L||c.contents.maxAttempts?"":". You need to answer the question correctly to proceed. Please try again."),subtitle:(0,s.jsxs)(s.Fragment,{children:[N&&B?(0,s.jsx)(T.xv,{size:"2",color:"neutral",children:(0,s.jsxs)(I.kC,{gap:"1",align:"center",children:[(0,s.jsx)(k.J,{icon:E.X8G,label:"info"}),"Hint: ",B]})}):void 0,j&&F?(0,s.jsx)(T.xv,{size:"2",color:"neutral",children:(0,s.jsxs)(I.kC,{gap:"1",align:"center",children:[(0,s.jsx)(k.J,{icon:E.tq6,label:"info"}),"Explanation: ",F]})}):void 0]}),variant:"danger",background:"transparent",backgroundVariant:"transparent"})]}),(c.contents.hideAnswerFeedback||c.contents.noCorrectAnswerRequired)&&(j||N)&&(0,s.jsx)(C.j,{className:"mb-4 bg-neutral-100",title:"We have received your response. ".concat(c.contents.hideAnswerFeedback?"Please note that the correct answer for this question is hidden in order to ensure fair assessments.":""," ").concat(c.contents.noCorrectAnswerRequired?"This question doesn't have any correct answers & isn't graded.":""),background:"transparent",backgroundVariant:"transparent",variant:"neutral"}),h&&null!=q&&(0,s.jsx)(A.fC,{size:"1",color:q?"success":"error",className:"mb-2",children:(0,s.jsxs)(I.kC,{direction:"column",gap:"2",children:[(0,s.jsxs)(I.kC,{gap:"2",align:"center",children:[(0,s.jsx)(A.JO,{children:(0,s.jsx)(k.J,{icon:q?E.fV7:E.eHv,label:"info"})}),(0,s.jsx)(A.xv,{children:(0,s.jsx)("strong",{children:q?"Correct":"Incorrect"})})]}),H.length>0&&(0,s.jsxs)(I.kC,{direction:"column",gap:"2",children:[(0,s.jsx)(T.xv,{children:"Correct answers: "}),(0,s.jsx)("ul",{className:"ml-8 list-disc list-outside",children:H.map((e,t)=>(0,s.jsx)("li",{className:"leading-tight mb-2",children:(0,s.jsx)("span",{children:renderCleanHTMLString(e)})},t))})]})]})})]})},R=n(692975),N=n(776845),SectionItems_VideoItem=e=>{let{item:t}=e,n=(0,i.useRef)(null),[r,o]=(0,i.useState)(0),a=(0,i.useRef)(0),{videoCompleteness:l,addVideoCompleteness:c}=(0,y.B)(e=>({videoCompleteness:e.videoCompleteness,addVideoCompleteness:e.addVideoCompleteness})),d=t.contents.allowSkimming||l.has(t.id);return(0,i.useEffect)(()=>{var e;let t=null===(e=n.current)||void 0===e?void 0:e.getInternalPlayer();if(!t||d)return;let handleTimeUpdate=()=>{t.currentTime>r+1&&(t.currentTime=a.current)};return t.addEventListener("timeupdate",handleTimeUpdate),()=>t.removeEventListener("timeupdate",handleTimeUpdate)},[r,d]),(0,s.jsx)("div",{className:"p-6",children:t.contents.videoUrl&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"rounded-lg overflow-hidden w-full",children:(0,s.jsx)(R.Z,{ref:n,controls:!0,width:"100%",url:t.contents.videoUrl,onEnded:()=>{c(t.id)},onProgress:e=>{let t=e.playedSeconds;if(!d&&t>r+1){var s;null===(s=n.current)||void 0===s||s.seekTo(a.current,"seconds");return}a.current=t,o(Math.max(t,r))},onSeek:e=>{if(!d&&e>r){var t;null===(t=n.current)||void 0===t||t.seekTo(a.current,"seconds")}},progressInterval:100,config:{file:{attributes:{crossOrigin:"true"}}}})}),t.contents.videoCaption&&(0,s.jsx)(N.ZT.Subtitle3,{className:"mt-2 text-center",children:t.contents.videoCaption})]})})},P=n(242095),F=n(312993),M=n(599789),SectionItems_BenchmarkItem=e=>{var t;let{item:n,user:r,setIsBenchmarkFinished:a}=e,[l,c]=(0,i.useState)(void 0),[d,u]=(0,i.useState)(!1),[m,h]=(0,i.useState)(null),[g,x]=(0,i.useState)(!1),[f,C]=(0,i.useState)(!0),[j,S]=(0,i.useState)([]),[y,w]=(0,i.useState)([]),[I,T]=(0,i.useState)(void 0),[k,A]=(0,i.useState)(void 0),E=n.contents.benchmarkId,{refetch:R}=(0,b.useQuery)("loadScenarioAndPreviousAttempts",async()=>{var e;let t,n;let s=r.id,i=await (0,P.fetchApi)("/training/training_attempts/".concat(E,"/").concat(s),{parseAndHandle:!0}),o={},a=(null==i?void 0:i.trainingAttempts)?null===(e=v().last(i.trainingAttempts))||void 0===e?void 0:e._id:void 0;if(a){let e=await (0,P.fetchApi)("/training/view/".concat(a),{parseAndHandle:!0});n=e.trainingScenario,o=e.submissionResponse,t=e.leaderboard,S(i.trainingAttempts)}else{let e=await (0,P.fetchApi)("/training/begin/".concat(E),{parseAndHandle:!0});n=e.trainingScenario,t=e.leaderboard,a=e.trainingAttempt;let i=await (0,P.fetchApi)("/training/training_attempts/".concat(E,"/").concat(s),{parseAndHandle:!0});S(i.trainingAttempts)}let l=await (0,P.fetchApi)("/config/".concat(n.project),{parseAndHandle:!0});return T(l),c(n),A(o),w(t),C(!1),{trainingScenario:n,scenarioProjectConfig:l,submissionResponse:o,scenarioLeaderboard:t}},{enabled:!1,staleTime:3e5,cacheTime:6e5}),{refetch:N}=(0,b.useQuery)("checkScenarioStatus",async()=>{if(E){x(!0);let e=await p.Z.labeling.getTrainingScenarioStatus(E);u(e.isTutorial?e.foundAttempt:e.passedBar),a(e.isTutorial?e.foundAttempt:e.passedBar),h(e.throttleTimeMs),x(!1)}},{enabled:!1,staleTime:3e5,cacheTime:6e5});return((0,i.useEffect)(()=>{N(),R()},[N,R,n]),m)?null:(0,s.jsx)("div",{className:"my-4",children:d?(0,s.jsx)("div",{className:"flex items-center justify-center h-40 scenario-box",children:(0,s.jsx)("p",{children:"You finished this practice task! Continue to the next section"})}):f?(0,s.jsx)("div",{className:"flex items-center justify-center h-40 scenario-box",children:(0,s.jsx)(o.$,{size:"lg"})}):(0,s.jsx)("div",{className:"flex justify-center flex-wrap xl:flex-nowrap h-full",children:l&&I&&(0,s.jsx)(F.Z,{hideBackButton:!0,simpleFeedbackModalClosing:!0,trainingAttempt:null===(t=v().last(j))||void 0===t?void 0:t._id,trainingScenario:l,isCorpUser:r.isCorporateUser||!1,name:l,submissionResponse:k,toggleShowingFeedback:()=>{},leaderboard:y,config:I,query:{trainingId:l.id},overrideAnswerKeyCooldown:!1,user:r,serverRendered:!1,projectConfig:I,onFeedbackCloseLoading:g,courseVersion:M.CourseVersion.V2,hideHeader:!0})})})},B=n(339389),SectionItems_TextResponseItem=e=>{var t,n,r,l,c,d,u,m;let{course:h,item:g,courseProgress:x,sectionIndex:f,readOnly:C=!1,isAudit:j=!1,onTextChange:T,onMouseLeave:R,onDragAndDrop:N}=e,[P,F]=(0,i.useState)(null!==(u=null==x?void 0:null===(n=x.courseAnswer)||void 0===n?void 0:null===(t=n[g.id])||void 0===t?void 0:t.contents)&&void 0!==u?u:""),[M,z]=(0,i.useState)(null!==(m=null==x?void 0:null===(l=x.courseAnswer)||void 0===l?void 0:null===(r=l[g.id])||void 0===r?void 0:r.contents)&&void 0!==m?m:""),[L,D]=(0,i.useState)(null),[q,U]=(0,i.useState)(null),V=g.contents.minCharacters&&P.length<g.contents.minCharacters||g.contents.maxCharacters&&P.length>g.contents.maxCharacters,{textResponseCompleteness:_,addTextResponseCompleteness:W}=(0,y.B)(e=>({textResponseCompleteness:e.textResponseCompleteness,addTextResponseCompleteness:e.addTextResponseCompleteness})),H=null==h?void 0:null===(c=h.sections)||void 0===c?void 0:c[f];(0,i.useEffect)(()=>{if(x.courseAnswer){let e=x.courseAnswer[g.id];e&&(e.isComplete&&W(g.id),j&&(void 0!==e.score&&D(e.score),e.gptExplanation&&U(e.gptExplanation)))}},[x,g.id,W,j,g.contents.mandatory]);let{mutate:$,isLoading:O}=(0,b.useMutation)(e=>p.Z.labeling.recordCourseV2TextResponse(h._id,{courseProgressId:x._id,sectionIndex:f,itemId:g.id,textResponseValue:e}),{onSuccess:e=>{z(P),e.isComplete&&W(g.id),e&&(U(e.explanation),D(e.score))},onError:()=>{S.c.track("Text Response - Failed to retrieve response")}});return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"text-sm pb-4",children:(0,s.jsx)(w.$,{markdownString:g.contents.question||""})}),(0,s.jsx)("div",{className:"text-sm text-gray-600 text-right",children:g.contents.minCharacters&&g.contents.maxCharacters?"".concat(g.contents.minCharacters," min char | ").concat(g.contents.maxCharacters," max char"):g.contents.minCharacters?"".concat(g.contents.minCharacters," min char"):g.contents.maxCharacters?"".concat(g.contents.maxCharacters," max char"):null}),(0,s.jsx)("div",{className:"sp__1"}),(0,s.jsx)(B.K,{placeholder:"Type answer here...",value:P,onChange:e=>{F(e.target.value),T(g.id,e.target.value)},onMouseLeave:()=>R(g.id),onDrop:e=>{N(e.dataTransfer.getData("text/plain"))},disabled:j}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"text-sm text-gray-600 text-left",children:(null==g?void 0:null===(d=g.contents)||void 0===d?void 0:d.mandatory)&&"Must answer correctly to proceed"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 text-right",children:["Char count: ",P.length]})]}),(0,s.jsx)("div",{className:"w-full px-6 pb-6 flex justify-center",children:(0,s.jsx)(a.zx,{disabled:j||C||V||O||!(null==H?void 0:H.isPractice)&&P===M||(null==H?void 0:H.isPractice)&&_.has(g.id)&&P===M,className:"w-60",size:"lg",fullWidth:!0,variant:"primary",onClick:()=>$(P),children:(null==H?void 0:H.isPractice)?(""!==M||_.has(g.id))&&P===M?_.has(g.id)?"Answered":"Retry":"Submit Answer":P===M&&""!==M?"Answered":"Submit Answer"})}),O&&(0,s.jsx)("div",{children:(0,s.jsx)(o.$,{className:"flex justify-center",size:"sm"})}),(j||(null==H?void 0:H.isPractice))&&(!v().isNil(L)||!v().isNil(q))&&(0,s.jsx)(A.fC,{size:"1",color:"info",className:"mb-2",children:(0,s.jsxs)(I.kC,{direction:"column",gap:"2",children:[null!==L&&(0,s.jsxs)(I.kC,{gap:"2",align:"center",children:[(0,s.jsx)(A.JO,{children:(0,s.jsx)(k.J,{icon:E.DBf,label:"info"})}),(0,s.jsxs)(A.xv,{children:[(0,s.jsx)("strong",{children:"Score:"})," ",L]})]}),null!=q&&(0,s.jsxs)(A.xv,{children:[(0,s.jsx)("strong",{children:"AI Feedback:"})," ",q]})]})})]})},z=n(594977),L=n(293902);let D=i.lazy(()=>Promise.all([n.e(68143),n.e(11642),n.e(82178),n.e(16732),n.e(53362),n.e(33548),n.e(80389),n.e(19010),n.e(79913),n.e(13959),n.e(90321),n.e(54402),n.e(36407),n.e(53830),n.e(51505),n.e(29582),n.e(74470),n.e(49529),n.e(35045),n.e(63778),n.e(82746),n.e(94087),n.e(8960),n.e(92222),n.e(22826),n.e(63791),n.e(57381),n.e(10961),n.e(42279),n.e(23387),n.e(33956),n.e(23698),n.e(64769),n.e(87734),n.e(42419),n.e(16693),n.e(62279),n.e(33703),n.e(19804)]).then(n.bind(n,986153))),TaskItemComponent=e=>{var t;let{item:n}=e,{data:r,isLoading:a}=(0,L.PzI)(null!==(t=n.contents.taskId)&&void 0!==t?t:"");return(0,s.jsx)("div",{className:"scaleui scale-theme scale-tailwind",children:!a&&r?(0,s.jsxs)(i.Suspense,{fallback:(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)(o.$,{size:"md",className:"m-4"})}),children:[r.params&&r.responses&&(0,s.jsx)(D,{params:r.params,responses:r.responses,reviewLevel:r.reviewLevel,chatTaskFeatureConfig:r.chatTaskFeatureConfig,readOnly:!0}),r.error&&(0,s.jsx)(T.xv,{color:"error",children:"Error loading task"})]}):(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)(o.$,{size:"md",className:"m-4"})})})};var SectionItems_TaskItem=e=>(0,s.jsx)(z.aH,{client:L.Ehq,children:(0,s.jsx)(TaskItemComponent,{...e})});let q=i.lazy(()=>Promise.all([n.e(63832),n.e(42132),n.e(36147),n.e(13208),n.e(12874),n.e(38444),n.e(64790),n.e(30284),n.e(46181),n.e(48480)]).then(n.bind(n,291693)).then(e=>({default:e.ChatPreviewApp}))),ChatV2ItemComponent=e=>{var t;let{item:n}=e,{data:r,isLoading:a}=(0,L.r4r)(null!==(t=n.contents.chatV2TaskId)&&void 0!==t?t:"");return(0,s.jsx)("div",{className:"scaleui scale-theme scale-tailwind",children:!a&&r?(0,s.jsxs)(i.Suspense,{fallback:(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)(o.$,{size:"md",className:"m-4"})}),children:[r.params&&r.response&&(0,s.jsx)(q,{params:r.params,response:r.response,showOutline:!1},n.contents.chatV2TaskId),r.error&&(0,s.jsx)(T.xv,{color:"error",children:"Error loading task"})]}):(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)(o.$,{size:"md",className:"m-4"})})})};var SectionItems_ChatV2Item=e=>(0,s.jsx)(z.aH,{client:L.Ehq,children:(0,s.jsx)(ChatV2ItemComponent,{...e})}),U=n(167469);let V=i.lazy(()=>Promise.all([n.e(68143),n.e(11642),n.e(82178),n.e(16732),n.e(53362),n.e(33548),n.e(80389),n.e(19010),n.e(79913),n.e(13959),n.e(90321),n.e(54402),n.e(36407),n.e(53830),n.e(51505),n.e(29582),n.e(74470),n.e(49529),n.e(35045),n.e(63778),n.e(82746),n.e(94087),n.e(8960),n.e(92222),n.e(22826),n.e(63791),n.e(57381),n.e(10961),n.e(42279),n.e(23387),n.e(33956),n.e(23698),n.e(64769),n.e(87734),n.e(42419),n.e(16693),n.e(62279),n.e(33703),n.e(19804)]).then(n.bind(n,986153))),_=i.lazy(()=>Promise.all([n.e(63832),n.e(42132),n.e(36147),n.e(13208),n.e(12874),n.e(38444),n.e(64790),n.e(30284),n.e(46181),n.e(48480)]).then(n.bind(n,291693)).then(e=>({default:e.ChatPreviewApp}))),TaskAttemptItemComponent=e=>{var t;let{item:n}=e,{data:i,isLoading:r}=(0,L.dSc)(null!==(t=n.contents.attemptId)&&void 0!==t?t:"");return r?(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)(o.$,{size:"md",className:"m-4"})}):!i||"error"in i||!n.contents.attemptId?(0,s.jsx)("div",{children:"Task Attempt not found"}):i.taskType===U.TaskType.Chat?chatv1Item(i):chatv2Item({attemptId:n.contents.attemptId,taskAttempt:i})},chatv2Item=e=>e.taskAttempt.params&&e.taskAttempt.response?(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)(o.$,{size:"md",className:"m-4"})}),children:(0,s.jsx)(_,{params:e.taskAttempt.params,response:e.taskAttempt.response,showOutline:!1},e.attemptId)}):(0,s.jsx)(T.xv,{color:"error",children:"Error loading task"}),chatv1Item=e=>e.params&&e.responses?(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)(o.$,{size:"md",className:"m-4"})}),children:(0,s.jsx)(V,{params:e.params,responses:e.responses,reviewLevel:e.reviewLevel,chatTaskFeatureConfig:e.chatTaskFeatureConfig,readOnly:!0})}):(0,s.jsx)(T.xv,{color:"error",children:"Error loading task"});var SectionItems_TaskAttemptItem=e=>(0,s.jsx)(z.aH,{client:L.Ehq,children:(0,s.jsx)(TaskAttemptItemComponent,{...e})}),W=n(720227),H=n(307097),$=n(837553),O=n(835913),Z=n(359183),G=n(767106);let CourseSectionFooterV2=e=>{let{canAlwaysContinue:t,courseSectionItems:n}=e,[r,o]=(0,i.useState)(t),{multipleChoiceCompleteness:a,videoCompleteness:l,textResponseCompleteness:c,audioResponseCompleteness:d,navigationSectionWindowBegin:u}=(0,y.B)(e=>({multipleChoiceCompleteness:e.multipleChoiceCompleteness,videoCompleteness:e.videoCompleteness,textResponseCompleteness:e.textResponseCompleteness,audioResponseCompleteness:e.audioResponseCompleteness,navigationSectionWindowBegin:e.navigationSectionWindowBegin})),p=e.course.sections.length===e.sectionIndex+1,h=e.sectionIndex>0,[g,x]=(0,i.useState)("");(0,i.useEffect)(()=>{x("");let e=!0;for(let t of n){if(t.type===m.E5.MultipleChoice&&!a.has(t.id)){e=!1,x("Please complete all questions before continuing");break}if(t.type===m.E5.Video&&!l.has(t.id)){e=!1,x("Please complete the video before continuing");break}if(t.type===m.E5.TextResponse&&!c.has(t.id)){e=!1,x("Please complete the text response before continuing");break}if(t.type===m.E5.AudioResponse&&!d.has(t.id)){e=!1,x("Please complete the audio response before continuing");break}}o(e||t)},[a,l,c,d,t,n]);let v=e.continueButtonTooltipMessage||g||"Continue to next section";return(0,s.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 py-3 px-4 flex bg-neutral-0 border-t border-neutral-200 w-auto justify-end",children:[(0,s.jsx)("div",{className:"flex items-center justify-center w-2/3",children:(0,s.jsx)(CourseProgressDots,{currentSectionIndex:e.sectionIndex,totalSections:e.course.sections.length,navigationSectionWindowBegin:u})}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(Z.z,{variant:"outline",color:"neutral",className:(0,f.default)("flex-grow",!h&&"opacity-50"),onClick:e.handlePrevious,disabled:!h,children:"Previous"}),(0,s.jsx)(G.u,{content:v,children:(0,s.jsx)(Z.z,{className:"flex-grow",onClick:async()=>{o(!1),await e.handleContinue()},disabled:!r,children:p?"Finish":"Continue"})})]})]})},CourseProgressDots=e=>{let{currentSectionIndex:t,totalSections:n,navigationSectionWindowBegin:i}=e,r=0,o=n-1;n>5&&(r=i,o=i+5-1);let a=i>0,l=i+5<n,c=Array.from({length:o-r+1},(e,t)=>t+r);return(0,s.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,s.jsx)("div",{className:"flex items-center space-x-2",children:c.map(e=>(0,s.jsx)("div",{className:(0,f.default)("rounded-full transition-all duration-300",e===t?"bg-neutral-800":"bg-neutral-300",a&&e===r?"w-1 h-1":l&&e===o?"w-1 h-1":"w-2 h-2")},e))}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(T.xv,{size:"2",weight:"medium",className:"text-neutral-12",children:[t+1," / ",n]})})]})};var Q=n(136845),J=n(609102),K=n(587880),X=n(642830),Y=n(352991);async function parseScaleCdsUrl(e){if(!e.startsWith("scale-cds:"))return e;try{let t=await (0,Y.ZP)(null,"internal/contentUnderstanding/fileFetch",{method:"POST",body:{url:e}});if(t&&t.url)return t.url;return X.Z.error("Response missing expected url property:",{response:t}),e}catch(t){return X.Z.error("Error fetching refreshed URL:",{error:t}),e}}var ee=n(165218),et=n.n(ee);let en=et()(()=>Promise.all([n.e(29736),n.e(31654)]).then(n.bind(n,331654)),{loadableGenerated:{webpack:()=>[331654]},ssr:!1}),formatTime=e=>"".concat(Math.floor(e/60),":").concat(Math.floor(e%60).toString().padStart(2,"0"),".").concat(Math.floor(e%1*100).toString().padStart(2,"0")),AudioControlButton=e=>{let{icon:t,onClick:n,disabled:i=!1,label:r,tooltip:o}=e;return(0,s.jsxs)(J.fC,{children:[(0,s.jsx)(J.xz,{children:(0,s.jsx)(Z.z,{radius:"full",onClick:n,disabled:i,color:"accent",children:(0,s.jsx)(k.J,{size:"sm",label:r,icon:t})})}),(0,s.jsx)(J.VY,{size:"1",side:"top",children:(0,s.jsx)(T.xv,{children:o})})]})},AudioProgressBar=e=>{let{currentTime:t,duration:n,onTimeChange:r}=e,o=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(o.current){let e=t/n*100;o.current.style.backgroundSize="".concat(e,"% 100%")}},[t,n]),(0,s.jsxs)(I.kC,{direction:"column",width:"100%",children:[(0,s.jsx)("input",{ref:o,type:"range",value:t,min:0,max:n,step:.005,onChange:e=>{let t=parseFloat(e.target.value);r(t)},onInput:e=>{let t=parseFloat(e.target.value);r(t)},className:"w-full h-2 mb-2 rounded-full",style:{backgroundImage:"linear-gradient(rgb(var(--primary)), rgb(var(--primary)))",backgroundSize:"0% 100%",backgroundRepeat:"no-repeat",cursor:"pointer"}}),(0,s.jsxs)(I.kC,{width:"100%",justify:"between",children:[(0,s.jsx)(T.xv,{size:"1",children:formatTime(t)}),(0,s.jsx)(T.xv,{size:"1",children:formatTime(n)})]})]})},AudioPlayerComponent=e=>{let{audioSrc:t,onRerecord:n,disableRerecord:r=!1}=e,{audioRef:o,currentTime:a,duration:l,isPlaying:c,togglePlayPause:d,setTime:u}=function(e){let t=(0,i.useRef)(null),[n,s]=(0,i.useState)(0),[r,o]=(0,i.useState)(!1),[a,l]=(0,i.useState)(0);return(0,i.useEffect)(()=>{if(!t.current)return;let loadMetadata=async()=>{let n=await parseScaleCdsUrl(e);t.current&&(t.current.src=n,t.current.load());let s=await fetch(n),i=await s.blob(),r=window.AudioContext||window.webkitAudioContext;if(r){let e=new r,t=await i.arrayBuffer();e.decodeAudioData(t,e=>{l(e.duration)})}};loadMetadata()},[e]),(0,i.useEffect)(()=>{let e=t.current;if(!e)return;let n={loadedmetadata:()=>{isFinite(e.duration)&&e.duration>0&&l(e.duration)},durationchange:()=>{isFinite(e.duration)&&e.duration>0&&l(e.duration)},timeupdate:()=>s(e.currentTime),play:()=>o(!0),pause:()=>o(!1),ended:()=>{o(!1),s(a)}};return Object.entries(n).forEach(t=>{let[n,s]=t;e.addEventListener(n,s)}),()=>{Object.entries(n).forEach(t=>{let[n,s]=t;e.removeEventListener(n,s)})}},[e,a]),{audioRef:t,currentTime:n,duration:a,isPlaying:r,togglePlayPause:()=>{t.current&&(r?t.current.pause():(t.current.ended&&(t.current.currentTime=0),t.current.play().catch(e=>{X.Z.error("Audio playback failed:",{error:e})})))},setTime:e=>{t.current&&(t.current.currentTime=e,s(e))}}}(t);return(0,s.jsxs)(I.kC,{width:"100%",gap:"2",justify:"between",align:"center",pr:"2",children:[(0,s.jsx)("audio",{ref:o,preload:"auto",autoPlay:!1,controls:!1}),(0,s.jsx)(AudioControlButton,{icon:E.mHK,onClick:n,disabled:r,label:"rerecord-button",tooltip:"Rerecord"}),(0,s.jsx)(AudioControlButton,{icon:c?E.XQY:E.zc,onClick:d,label:"play-pause-button",tooltip:c?"Pause":"Play"}),(0,s.jsx)(AudioProgressBar,{currentTime:a,duration:l,onTimeChange:u})]})};var SectionItems_AudioResponseItem=e=>{var t,n,r;let{course:o,item:l,courseProgress:c,sectionIndex:d,readOnly:u=!1,isAudit:m=!1}=e,p=null!==(r=null==c?void 0:null===(n=c.courseAnswer)||void 0===n?void 0:null===(t=n[l.id])||void 0===t?void 0:t.contents)&&void 0!==r?r:"",{audioResponseCompleteness:h,addAudioResponseCompleteness:g}=(0,y.B)(e=>({audioResponseCompleteness:e.audioResponseCompleteness,addAudioResponseCompleteness:e.addAudioResponseCompleteness})),x=h.has(l.id),[v,f]=(0,i.useState)(null),[C,j]=(0,i.useState)(x||!!p),[T,k]=(0,i.useState)(!1),A=v||p;(0,i.useEffect)(()=>{p&&(g(l.id),j(!0))},[p,x,g,l.id]);let E=(0,i.useCallback)(e=>{f(e),k(!1),j(!1)},[]);(0,i.useEffect)(()=>()=>{v&&URL.revokeObjectURL(v)},[v]);let{mutate:R,isLoading:N}=(0,b.useMutation)(async()=>{if(!v||!(null==o?void 0:o._id))throw Error("Missing required data for upload");let e=await fetch(v),t=await e.blob(),n=new FileReader,s=await new Promise((e,s)=>{n.onload=()=>{var t;let i=null===(t=n.result)||void 0===t?void 0:t.toString().split(",")[1];i?e(i):s(Error("Failed to convert audio to base64"))},n.onerror=()=>s(n.error),n.readAsDataURL(t)});return(0,K.recordCourseV2AudioResponse)(o._id,{courseProgressId:c._id,sectionIndex:d,itemId:l.id,audioData:s,fileType:t.type||"audio/webm"})},{onSuccess:e=>{j(!0),g(l.id),S.c.track("Audio Response - Successfully uploaded")},onError:e=>{S.c.track("Audio Response - Failed to upload"),j(!1)}}),P=(0,i.useCallback)(()=>{R()},[R]),F=(0,i.useCallback)(()=>{j(!1),k(!0),v&&(URL.revokeObjectURL(v),f(null))},[v]),M=m||u,B=!M&&!N&&!C&&null!==v;return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"text-sm pb-4",children:(0,s.jsx)(w.$,{markdownString:l.contents.question||""})}),!T&&A&&(0,s.jsx)("div",{className:"mt-4 mb-4",children:(0,s.jsx)(AudioPlayerComponent,{audioSrc:A,onRerecord:F,disableRerecord:M||N})}),(0,s.jsx)(I.kC,{direction:"column",pt:"2",align:"center",gap:"2",width:"100%",children:(T||!A)&&(0,s.jsx)(en,{onRecordingComplete:E,isDisabled:M,isUploading:N,isUploaded:C})}),(0,s.jsx)(I.kC,{width:"100%",justify:"center",px:"6",pb:"6",children:(0,s.jsx)(a.zx,{onClick:P,disabled:!B,color:"primary",className:"w-60",fullWidth:!0,size:"lg",children:N?"Uploading...":C?"Submitted":"Submit Recording"})})]})};let CourseV2SectionTitle=e=>{let{title:t,projectId:n}=e,{language:i,setLanguage:o}=(0,y.B)(e=>({language:e.language,setLanguage:e.setLanguage})),a=(0,$.ZP)("course-translations",{projectId:n},!1);return a?(0,s.jsxs)("div",{className:"flex flex-row justify-between items-center p-4 border-b border-neutral-200",children:[(0,s.jsx)("strong",{className:"text-base flex justify-start items-center",children:t}),(0,s.jsx)(r.S,{label:"",selectedOptionId:i,setSelected:e=>{o(e)},labelIcon:"language",options:[{id:"EN-US",name:"English"},{id:"ES",name:"Spanish (espa\xf1ol)"},{id:"KO",name:"Korean (한국인)"},{id:"JA",name:"Japanese (日本語)"},{id:"PT-PT",name:"Portuguese (portugu\xeas)"},{id:"AR",name:"Arabic (عربي)"},{id:"RU",name:"Russian (русский)"},{id:"ZH",name:"Chinese (中文)"}],variant:"default"})]}):(0,s.jsx)("div",{className:"p-4 border-b border-neutral-200",children:(0,s.jsx)("strong",{className:"text-base flex justify-start items-center",children:t})})},CourseSectionBenchmarkFooter=e=>{let{canAlwaysContinue:t,isBenchmarkFinished:n}=e,r=(0,g.X)(e=>e.canSubmitCourseBenchmark),c=(0,g.X)(e=>e.handleSubmitCourseBenchmark),[m,x]=(0,i.useState)(n||t),[v,f]=(0,i.useState)(!1),[C,j]=(0,i.useState)(!1);(0,i.useEffect)(()=>{j(!1)},[e.sectionIndex]),(0,i.useEffect)(()=>{x(n)},[n]);let[S,b]=(0,i.useState)(r),y=e.course.sections.length===e.sectionIndex+1,w=e.sectionIndex>0;(0,i.useEffect)(()=>{b(r)},[r]);let[I,T]=(0,i.useState)(!1),checkScenarioStatus=async()=>{try{let t=await p.Z.labeling.getTrainingScenarioStatus(e.benchmarkId);await p.Z.labeling.submitBenchmarkAccuracyV2(e.courseProgress._id,{benchmarkAccuracy:t.scenarioAccuracy,benchmarkSectionItemId:e.courseSectionItems[0].id,benchmarkId:e.benchmarkId}),(t.isTutorial?t.foundAttempt:t.passedBar)?(x(!0),j(!0)):x(!1)}catch(e){}},handleSubmit=async()=>{try{f(!0),c&&await c(h.a5.Submit),await checkScenarioStatus(),f(!1)}catch(e){}},k=d()("fixed right-2 box-border bg-primary-50 p-4 rounded-md","border-2 border-primary-100 hover:border-primary-400","z-[400]",{"w-[300px]":v,"w-[200px]":C});return(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 py-3 px-4 flex justify-between bg-neutral-0 border-t border-neutral-200",children:[v&&(0,s.jsx)("div",{className:k,style:{bottom:"5rem"},children:(0,s.jsxs)("div",{className:"text-primary-400 flex flex-col gap-1",children:[(0,s.jsx)("div",{className:"flex flex-row items-center justify-between",children:(0,s.jsxs)("div",{className:"flex flex-row gap-4 items-center",children:[(0,s.jsx)(o.$,{size:"sm"}),(0,s.jsx)("p",{className:"text-sm font-medium text-primary-400",children:"Submitting Practice Task"})]})}),(0,s.jsx)("p",{className:"text-xs font-light",children:"Please wait while we validate and submit your practice task"})]})}),C&&(0,s.jsx)("div",{className:k,style:{bottom:"5rem"},children:(0,s.jsx)("div",{className:"text-primary-400 flex flex-col gap-1",children:(0,s.jsx)("div",{className:"flex flex-row items-center justify-between",children:(0,s.jsx)("div",{className:"flex flex-row gap-4 items-center",children:(0,s.jsx)("p",{className:"text-sm font-medium text-primary-400",children:"Practice Task Succeeded!"})})})})}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(u.Z,{onClick:()=>T(!0)}),(0,s.jsx)(H.c,{open:I,onClose:()=>T(!1)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(a.zx,{size:"lg",variant:"neutral",onClick:e.handlePrevious,disabled:!w,children:"Back"}),(0,s.jsx)(l.u,{delayDuration:0,text:e.continueButtonTooltipMessage||"",side:"top",target:(0,s.jsx)("span",{children:m?(0,s.jsx)(a.zx,{size:"lg",variant:"primary",onClick:async()=>{await e.handleContinue()},children:y?"Finish":"Continue"}):(0,s.jsx)(a.zx,{size:"lg",variant:"primary",onClick:async()=>{b(!1),await handleSubmit(),b(!0)},disabled:!S,children:"Submit"})})})]})]})})},CourseSectionFooter=e=>{let{canAlwaysContinue:t,courseSectionItems:n}=e,[r,o]=(0,i.useState)(t),{multipleChoiceCompleteness:c,videoCompleteness:d,textResponseCompleteness:p,audioResponseCompleteness:h}=(0,y.B)(e=>({multipleChoiceCompleteness:e.multipleChoiceCompleteness,videoCompleteness:e.videoCompleteness,textResponseCompleteness:e.textResponseCompleteness,audioResponseCompleteness:e.audioResponseCompleteness})),g=e.course.sections.length===e.sectionIndex+1,x=e.sectionIndex>0,[v,f]=(0,i.useState)("");(0,i.useEffect)(()=>{f("");let e=!0;for(let t of n){if(t.type===m.E5.MultipleChoice&&!c.has(t.id)){e=!1,f("Please complete all questions before continuing");break}if(t.type===m.E5.Video&&!d.has(t.id)){e=!1,f("Please complete the video before continuing");break}if(t.type===m.E5.TextResponse&&!p.has(t.id)){e=!1,f("Please complete the text response before continuing");break}if(t.type===m.E5.AudioResponse&&!h.has(t.id)){e=!1,f("Please complete the audio response before continuing");break}}o(e||t)},[c,d,p,h,t,n]);let[C,j]=(0,i.useState)(!1);return(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 py-3 px-4 flex justify-between bg-neutral-0 border-t border-neutral-200",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(u.Z,{onClick:()=>j(!0)}),(0,s.jsx)(H.c,{open:C,onClose:()=>j(!1)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(a.zx,{size:"lg",variant:"neutral",onClick:e.handlePrevious,disabled:!x,children:"Back"}),(0,s.jsx)(l.u,{delayDuration:0,text:e.continueButtonTooltipMessage||v||"",side:"top",target:(0,s.jsx)("span",{children:(0,s.jsx)(a.zx,{size:"lg",variant:"primary",onClick:async()=>{o(!1),await e.handleContinue()},disabled:!r,children:g?"Finish":"Continue"})})})]})]})})};var es=(0,O.ZP)(e=>{var t,n;let[r,o]=(0,i.useState)(!1),{handleCopy:a,handlePaste:l,handlePresenceEvent:c}=e,d=(0,Q.B)(e=>e.setUseTipTapEditor),u=(0,$.ZP)("allow-course-tiptap",{courseId:e.courseId},!1)&&e.course.useTipTap;(0,i.useEffect)(()=>{u&&d(!0)},[u,d]),(0,i.useEffect)(()=>{window.scrollTo(0,0)},[e.sectionIndex]);let p=(0,i.useRef)(null);(0,i.useEffect)(()=>{p.current&&p.current.scrollIntoView({behavior:"smooth"})}),(0,i.useEffect)(()=>{let handleCopyEvent=e=>{var t;let n=null===(t=window.getSelection())||void 0===t?void 0:t.toString();n&&a&&a(n)},handlePasteEvent=e=>{e.clipboardData&&l&&l(e.clipboardData.getData("text/plain"))};return document.addEventListener("copy",handleCopyEvent),document.addEventListener("paste",handlePasteEvent),c&&(document.addEventListener("mouseenter",c),document.addEventListener("mouseleave",c),document.addEventListener("visibilitychange",c)),()=>{document.removeEventListener("copy",handleCopyEvent),document.removeEventListener("paste",handlePasteEvent),c&&(document.removeEventListener("mouseenter",c),document.removeEventListener("mouseleave",c),document.removeEventListener("visibilitychange",c))}},[a,l,c]);let h=1===e.courseSectionItems.length&&e.courseSectionItems[0].type===m.E5.Benchmark;if(h){let n=e.courseSectionItems[0];return(0,s.jsxs)("div",{id:"section-0-item-".concat(n.id,"}"),className:"pb-20",children:[(0,s.jsx)(CourseV2SectionTitle,{title:e.title,projectId:null!==(t=e.course.project)&&void 0!==t?t:""}),(0,s.jsx)("div",{children:(0,s.jsx)(SectionItems_BenchmarkItem,{item:n,user:e.user,setIsBenchmarkFinished:o})}),!e.hideFooter&&(0,s.jsx)(CourseSectionBenchmarkFooter,{...e,isBenchmarkFinished:r,benchmarkId:n.contents.benchmarkId})]},e.courseSectionItems[0].id)}return(0,s.jsx)("div",{className:(0,W.m)(!e.hideFooter&&"pb-20"),children:(0,s.jsx)("div",{className:(0,W.m)("mx-auto border-solid border border-neutral-200 rounded-lg mb-4 bg-utility-white",!e.isMarketplace&&"max-w-screen-lg"),children:(0,s.jsxs)("div",{children:[(0,s.jsx)(CourseV2SectionTitle,{title:e.title,projectId:null!==(n=e.course.project)&&void 0!==n?n:""}),e.courseSectionItems.map((t,n)=>(0,s.jsx)("div",{ref:e.scrollToSectionItemIndex&&n===e.scrollToSectionItemIndex?p:null,id:"section-".concat(n,"-item-").concat(t.id),className:(0,W.m)("p-4",e.highlightSectionItemIndex===n&&"border-2 rounded-md"),style:e.highlightSectionItemIndex===n?{borderColor:"#6B46C1"}:void 0,children:function(e,t,n,i,r,o,a,l,c){switch(t.type){case m.E5.RichText:return(0,s.jsx)(w.Z,{item:t});case m.E5.MultipleChoice:return(0,s.jsx)(SectionItems_MultipleChoiceItem,{item:t,sectionIndex:i,courseProgress:n,course:e,readOnly:r,isAudit:o});case m.E5.Video:return(0,s.jsx)(SectionItems_VideoItem,{item:t});case m.E5.TextResponse:return(0,s.jsx)(SectionItems_TextResponseItem,{item:t,sectionIndex:i,courseProgress:n,course:e,readOnly:r,isAudit:o,onTextChange:null!=a?a:()=>{},onMouseLeave:null!=l?l:()=>{},onDragAndDrop:null!=c?c:()=>{}});case m.E5.AudioResponse:return(0,s.jsx)(SectionItems_AudioResponseItem,{item:t,sectionIndex:i,courseProgress:n,course:e,readOnly:r,isAudit:o});case m.E5.Task:return(0,s.jsx)(SectionItems_TaskItem,{item:t});case m.E5.ChatV2:return(0,s.jsx)(SectionItems_ChatV2Item,{item:t});case m.E5.TaskAttempt:return(0,s.jsx)(SectionItems_TaskAttemptItem,{item:t});default:return(0,s.jsx)("div",{children:"Section Type Not Implemented"})}}(e.course,t,e.courseProgress,e.sectionIndex,e.readOnly,e.isAudit,e.handleTextChange,e.handleMouseLeave,e.handleDragAndDrop)},"".concat(t.id,"-").concat(n))),!e.hideFooter&&e.useV2Footer?(0,s.jsx)(CourseSectionFooterV2,{...e}):!e.hideFooter&&(0,s.jsx)(CourseSectionFooter,{...e})]})})})})},46610:function(e,t,n){n.d(t,{$:function(){return RenderedMarkdownComponent}});var s=n(824246);n(827378);var i=n(216228),r=n(136845),o=n(955737),a=n(60042),l=n.n(a);function RenderedMarkdownComponent(e){let{markdownString:t}=e,{useTipTapEditor:n}=(0,r.B)(e=>({useTipTapEditor:e.useTipTapEditor}));if(!t)return null;let a=t.replace(/\$\$([\s\S]+?)\$\$|\$(\S(?:[^$\n]*\S)?)\$/g,(e,t,n)=>{try{return i.Z.renderToString(t||n,{displayMode:!!t,throwOnError:!1})}catch(e){return t||n}});if(n){let e=a.replace(/(<span[^>]*style="[^"]*text-align:\s*right;[^"]*"[^>]*>)([\s\S]*?)<\/span>/g,(e,t,n)=>t+n.replace(/<img ([^>]*)>/g,'<img $1 style="display: block; margin-left: auto; margin-right: 0;">')+"</span>").replace(/(<span[^>]*style="[^"]*text-align:\s*center;[^"]*"[^>]*>)([\s\S]*?)<\/span>/g,(e,t,n)=>t+n.replace(/<img ([^>]*)>/g,'<img $1 style="display: block; margin-left: auto; margin-right: auto;">')+"</span>");return(0,s.jsx)(o.Ao,{content:e})}return(0,s.jsx)("div",{className:"ql-editor container bg-inherit",dangerouslySetInnerHTML:{__html:a}})}t.Z=e=>{let{item:t}=e,{useTipTapEditor:n}=(0,r.B)(e=>({useTipTapEditor:e.useTipTapEditor}));return(0,s.jsx)("div",{className:l()("p-6",n?"":"ql-editor"),children:(0,s.jsx)(RenderedMarkdownComponent,{markdownString:t.contents.body||""})})}},514240:function(e,t,n){n.d(t,{B:function(){return o}});var s=n(236125),i=n(488789);let r={multipleChoiceCompleteness:new Set,videoCompleteness:new Set,textResponseCompleteness:new Set,audioResponseCompleteness:new Set,language:"EN-US",navigationSectionWindowBegin:0,mlCheatingDetectionEnabled:!1,cheatingDetectionLlmArtifactsEnabled:!0,cheatingDetectionLlmArtifacts:i.t.join(",")},o=(0,s.Ue)(e=>({...r,setMultipleChoiceCompleteness:t=>{e(()=>({multipleChoiceCompleteness:t}))},addToMultipleChoiceCompleteness:t=>{e(e=>{let n=new Set(e.multipleChoiceCompleteness);return n.add(t),{multipleChoiceCompleteness:n}})},addVideoCompleteness:t=>{e(e=>{let n=new Set(e.videoCompleteness);return n.add(t),{videoCompleteness:n}})},addTextResponseCompleteness:t=>{e(e=>{let n=new Set(e.textResponseCompleteness);return n.add(t),{textResponseCompleteness:n}})},addAudioResponseCompleteness:t=>{e(e=>{let n=new Set(e.audioResponseCompleteness);return n.add(t),{audioResponseCompleteness:n}})},setLanguage:t=>{e(()=>({language:t}))},setNavigationSectionWindowBegin:t=>{e(()=>({navigationSectionWindowBegin:t}))},setMLCheatingDetectionEnabled:t=>{e(()=>({mlCheatingDetectionEnabled:t}))},setCheatingDetectionLlmArtifactsEnabled:t=>{e(()=>({cheatingDetectionLlmArtifactsEnabled:t}))},setCheatingDetectionLlmArtifacts:t=>{e(()=>({cheatingDetectionLlmArtifacts:t}))}}))},133877:function(e,t,n){n.d(t,{X:function(){return m},x:function(){return i}});var s,i,r=n(298784),o=n.n(r),a=n(236125),l=n(527467),c=n(854358),d=n(553999);(s=i||(i={})).SUCCESS="success",s.ERROR="error",s.INFO="info";let doesFieldHaveInstructions=e=>{let{fieldId:t,stepIndex:n,tutorialResponse:s,candidateId:i}=e,r=s.responses[n];if(r.type===c.InteractionStepType.TextCollection){let e=r.fieldInstructions[t];return!!e}if(r.type===c.InteractionStepType.TextCollectionPerResponse&&i){let e=r.candidates[i].fieldInstructions[t];return!!e}if(r.type===c.InteractionStepType.ModelResponseSelector&&("likertValueRaw"===t||"selectedIndex"===t||"justification"===t)){let e=r.stepInstructions[t];return!!e}if(r.type===c.InteractionStepType.QualityMeasurement){var o;let e=null==r?void 0:null===(o=r.fieldInstructions)||void 0===o?void 0:o[t];return!!e}return!1},getTutorialMessageForField=e=>{let{fieldId:t,stepIndex:n,tutorialResponse:s,candidateId:i}=e,r=s.responses[n];if(r.type===c.InteractionStepType.TextCollection){let e=r.fieldInstructions[t];return e.message.messageString}if(r.type===c.InteractionStepType.TextCollectionPerResponse&&i){let e=r.candidates[i].fieldInstructions[t];return e.message.messageString}if(r.type===c.InteractionStepType.ModelResponseSelector&&("likertValueRaw"===t||"selectedIndex"===t||"justification"===t)){let e=r.stepInstructions[t];return(null==e?void 0:e.message.messageString)||""}if(r.type===c.InteractionStepType.QualityMeasurement){var o;let e=null==r?void 0:null===(o=r.fieldInstructions)||void 0===o?void 0:o[t];return(null==e?void 0:e.message.messageString)||""}return""},getTutorialHighlightForField=e=>{let{fieldId:t,stepIndex:n,tutorialResponse:s,candidateId:i}=e,r=s.responses[n];if(r.type===c.InteractionStepType.TextCollection){let{highlight:e}=r.fieldInstructions[t];if(e)return{highlightStrings:e.highlightStrings}}else if(r.type===c.InteractionStepType.TextCollectionPerResponse&&i){let e=r.candidates[i].fieldInstructions[t];if(e&&e.highlight)return{highlightStrings:e.highlight.highlightStrings}}else if(r.type===c.InteractionStepType.ModelResponseSelector&&("likertValueRaw"===t||"selectedIndex"===t||"justification"===t)){let e=r.stepInstructions[t];if(e&&e.highlight)return{highlightStrings:e.highlight.highlightStrings}}else if(r.type===c.InteractionStepType.QualityMeasurement){var o;let e=null==r?void 0:null===(o=r.fieldInstructions)||void 0===o?void 0:o[t];if(e&&e.highlight)return{highlightStrings:e.highlight.highlightStrings}}},getTutorialMessageTypeForField=e=>{var t,n;let s,i,r,{fieldId:a,stepIndex:l,response:d,candidateId:u,expectedResponse:m,tutorialResponse:p}=e,h=p.responses[l],g=null!==(n=null===(t=m.responses[l].graderConfig)||void 0===t?void 0:t.gradedFields)&&void 0!==n?n:void 0;try{if(h.type===c.InteractionStepType.TextCollection)s=h.fieldInstructions[a],i="context.response.annotations.".concat(a,".response[0]"),r=m.responses[l].context.response.annotations[a].response[0];else if(h.type===c.InteractionStepType.TextCollectionPerResponse&&u)s=h.candidates[u].fieldInstructions[a],i='context.annotations.["'.concat(u,'"].annotations.').concat(a,".response[0]"),r=m.responses[l].context.annotations[u].annotations[a].response[0];else if(h.type===c.InteractionStepType.ModelResponseSelector&&("likertValueRaw"===a||"selectedIndex"===a))s=h.stepInstructions[a],i="context.".concat(a),r=m.responses[l].context[a];else{if(h.type!==c.InteractionStepType.QualityMeasurement)return"info";s=h.fieldInstructions[a],i="context.response.annotations.".concat(a,".response[0]"),r=m.responses[l].context.response.annotations[a].response[0]}}catch(e){return"info"}if(s&&s.message.isInfo)return"info";try{let e=o().get(g,i);if(e&&e.isGraded&&e.validAnswers&&e.validAnswers.length>0&&e.validAnswers.includes(d))return"success";return o().isEqual(d,r)?"success":"error"}catch(e){return"info"}},getTutorialResponseForFieldWrapper=e=>{let{fieldId:t,stepIndex:n,response:s,candidateId:i,expectedResponse:r,tutorialResponse:o}=e;if((o||r)&&o&&doesFieldHaveInstructions({fieldId:t,stepIndex:n,tutorialResponse:o,candidateId:i}))try{let e=getTutorialMessageForField({fieldId:t,stepIndex:n,tutorialResponse:o,candidateId:i}),a=getTutorialMessageTypeForField({fieldId:t,stepIndex:n,response:s,candidateId:i,expectedResponse:r,tutorialResponse:o}),l=getTutorialHighlightForField({fieldId:t,stepIndex:n,tutorialResponse:o,candidateId:i});return{message:e,messageType:a,highlight:l}}catch(e){}return null},u={tutorialResponse:void 0,expectedResponse:void 0,tutorialMode:d.BenchmarkTutorialMode.Course,highlightStrings:void 0,highlightActive:!1,highlightFieldId:void 0,highlightType:void 0,canSubmitScenario:!1,acknowledgedTutorialFields:{},canSubmitCourseBenchmark:!1,handleSubmitCourseBenchmark:void 0},m=(0,a.Ue)()((0,l.mW)((e,t)=>({...u,setTutorialResponse:t=>{e({tutorialResponse:t},!1,"setTutorialResponse")},setExpectedResponse:t=>{e({expectedResponse:t},!1,"setExpectedResponse")},getTutorialResponseForField:(e,n,s,i)=>{let{tutorialResponse:r,expectedResponse:o}=t();return getTutorialResponseForFieldWrapper({fieldId:e,stepIndex:n,response:s,candidateId:i,tutorialResponse:r,expectedResponse:o})},setHighlightStrings:t=>{e({highlightStrings:t},!1,"setHighlightStrings")},setHighlightActive:t=>{e({highlightActive:t},!1,"setHighlightActive")},setHighlightFieldId:t=>{e({highlightFieldId:t},!1,"setHighlightFieldId")},setHighlightType:t=>{e({highlightType:t},!1,"setHighlightType")},setTutorialMode:t=>{e({tutorialMode:t},!1,"setTutorialMode")},setCanSubmitScenario:t=>{e({canSubmitScenario:t},!1,"setCanSubmitScenario")},setAcknowledgedTutorialFields:t=>{e({acknowledgedTutorialFields:t},!1,"setAcknowledgedTutorialFields")},setCanSubmitCourseBenchmark:t=>{e({canSubmitCourseBenchmark:t},!1,"setCanSubmitCourseBenchmark")},setHandleSubmitCourseBenchmark:t=>{e({handleSubmitCourseBenchmark:t},!1,"setHandleSubmitCourseBenchmark")}}),{name:"tutorial-store"}))},136845:function(e,t,n){n.d(t,{B:function(){return c}});var s=n(236125),i=n(592284),r=n(428907),o=n(167469),a=n(488789);(0,r.enableMapSet)();let l={viewingSectionItemId:"",viewingSectionId:"",viewingCourseId:"",courseSection:void 0,courseSections:[],courseTitle:"",courseUniqueName:"",courseDescription:"",courseDuration:0,modifiedSectionItemIds:new Set,courseMinimumReviewLevel:o.ReviewLevel.Attempt,isCollapsed:!0,coursePassingGradeThreshhold:void 0,isSaved:!0,showFinalGrade:!1,isPublic:!1,isTimed:!1,grantedTagsUponCompletion:[],grantedTagsUponPass:[],grantedTagsUponFail:[],allowFreeTextGrading:!1,questionWeights:{},useCustomQuestionWeights:!1,mlCheatingDetectionEnabled:!1,useTipTapEditor:!1,cheatingDetectionLlmArtifactsEnabled:!0,cheatingDetectionLlmArtifacts:a.t.join(",")},c=(0,s.Ue)((e,t)=>({...l,setViewingSectionItemId:t=>{e(()=>({viewingSectionItemId:t,isCollapsed:""===t}))},setViewingCourseId:t=>{e(()=>({viewingCourseId:t}))},setViewingSectionId:t=>{e(()=>({viewingSectionId:t}))},getCourseSection:e=>{let n=t();return n.courseSections.find(t=>t.id===e)},setCourseSections:n=>{e(()=>({courseSections:n})),t().initializeWeights()},setCourseSectionTitle:(t,n)=>{e(e=>({courseSections:e.courseSections.map(e=>e.id===t?{...e,title:n}:e)}))},setCourseSectionEstimatedTime:(t,n)=>{e(e=>({courseSections:e.courseSections.map(e=>e.id===t?{...e,estimatedTime:n}:e)}))},setCourseSectionItems:(t,n)=>{t&&e(e=>({courseSections:e.courseSections.map(e=>e.id===t?{...e,courseSectionItems:n}:e)}))},getSectionItem:(e,n)=>{let s=t(),i=s.courseSections.find(t=>t.id===e);if(i){let e=i.courseSectionItems.find(e=>e.id===n);return e}},setSectionItemContentProperty:(t,n,s,o)=>{t&&n&&(e(e=>(0,r.produce)(e,e=>{let r=e.courseSections.find(e=>e.id===t);if(r){let t=r.courseSectionItems.find(e=>e.id===n);if(t&&(t.contents[s]=o,e.modifiedSectionItemIds.add(n),"enableFreeTextGrader"===s&&t.type===i.E5.TextResponse||"skipGrading"===s&&t.type===i.E5.MultipleChoice)){let t=e.courseSections.reduce((e,t)=>{let n=t.courseSectionItems.filter(e=>{var t,n,s;let r=e.type===i.E5.TextResponse&&(null===(t=e.contents)||void 0===t?void 0:t.enableFreeTextGrader)===!0&&(null===(n=e.contents)||void 0===n?void 0:n.skipGrading)!==!0,o=e.type===i.E5.MultipleChoice&&(null===(s=e.contents)||void 0===s?void 0:s.skipGrading)!==!0;return r||o});return[...e,...n]},[]);if(!e.useCustomQuestionWeights){let n=Math.round(100/t.length*100)/100,s={};t.forEach(e=>{s[e.id]=n});let i=t[t.length-1];if(i){let e=t.length-1*n;s[i.id]=Math.round((100-e)*100)/100}e.questionWeights=s}}}})),e(e=>({...e})))},setCourseTitle:t=>{e(()=>({courseTitle:t}))},setCourseUniqueName:t=>{e(()=>({courseUniqueName:t}))},setCourseDescription:t=>{e(()=>({courseDescription:t}))},setCourseDuration:t=>{e(()=>({courseDuration:t}))},setModifiedSectionItemIds:t=>{e(()=>({modifiedSectionItemIds:t}))},setCourseMinimumReviewLevel:t=>{e(()=>({courseMinimumReviewLevel:t}))},setIsCollapsed:t=>{e(()=>({isCollapsed:t}))},setCoursePassingGradeThreshhold:t=>{e(()=>({coursePassingGradeThreshhold:t}))},setShowFinalGrade:t=>{e(()=>({showFinalGrade:t}))},setIsPublic:t=>{e(()=>({isPublic:t}))},setIsTimed:t=>{e(()=>({isTimed:t}))},setGrantedTagsUponCompletion:t=>{e(()=>({grantedTagsUponCompletion:t}))},setGrantedTagsUponPass:t=>{e(()=>({grantedTagsUponPass:t}))},setGrantedTagsUponFail:t=>{e(()=>({grantedTagsUponFail:t}))},setAllowFreeTextGrading:t=>{e(()=>({allowFreeTextGrading:t}))},setUseCustomQuestionWeights:t=>{e(()=>({useCustomQuestionWeights:t}))},setQuestionWeights:t=>{e({questionWeights:t})},updateQuestionWeight:(t,n)=>{e(e=>({questionWeights:{...e.questionWeights,[t]:n}}))},calculateTotalWeight:()=>{let e=t(),n=Object.values(e.questionWeights).reduce((e,t)=>e+(t||0),0);return Math.round(100*n)/100},getQuestionWeight:e=>{let n=t();return n.questionWeights[e]||0},resetWeightsToDefault:()=>{let n=t(),s=n.courseSections.reduce((e,t)=>{let n=t.courseSectionItems.filter(e=>{var t,n,s;let r=e.type===i.E5.TextResponse&&(null===(t=e.contents)||void 0===t?void 0:t.enableFreeTextGrader)===!0&&(null===(n=e.contents)||void 0===n?void 0:n.skipGrading)!==!0,o=e.type===i.E5.MultipleChoice&&(null===(s=e.contents)||void 0===s?void 0:s.skipGrading)!==!0;return r||o});return[...e,...n]},[]);if(0===s.length){e({questionWeights:{}});return}let r=t().calculateDefaultWeights(s);e({questionWeights:r})},calculateDefaultWeights:e=>{if(0===e.length)return{};let t=Math.round(100/e.length*100)/100,n={};return e.forEach((s,i)=>{i===e.length-1?n[s.id]=Math.round((100-t*(e.length-1))*100)/100:n[s.id]=t}),n},initializeWeights:()=>{let n=t(),s=n.courseSections.reduce((e,t)=>{let n=t.courseSectionItems.filter(e=>{var t,n,s;let r=e.type===i.E5.TextResponse&&(null===(t=e.contents)||void 0===t?void 0:t.enableFreeTextGrader)===!0&&(null===(n=e.contents)||void 0===n?void 0:n.skipGrading)!==!0,o=e.type===i.E5.MultipleChoice&&(null===(s=e.contents)||void 0===s?void 0:s.skipGrading)!==!0;return r||o});return[...e,...n]},[]),r={},o=!1;if(s.forEach(e=>{void 0!==e.weight&&"number"==typeof e.weight&&(r[e.id]=e.weight,o=!0)}),n.useCustomQuestionWeights&&o){e({questionWeights:r});return}let a=t().calculateDefaultWeights(s);e({questionWeights:a})},setMLCheatingDetectionEnabled:t=>{e(()=>({mlCheatingDetectionEnabled:t}))},setUseTipTapEditor:t=>{e(()=>({useTipTapEditor:t}))},setCheatingDetectionLlmArtifactsEnabled:t=>{e(()=>({cheatingDetectionLlmArtifactsEnabled:t}))},setCheatingDetectionLlmArtifacts:t=>{e(()=>({cheatingDetectionLlmArtifacts:t}))}}))},955737:function(e,t,n){n.d(t,{Ao:function(){return CourseMarkdownPreview},Qe:function(){return RichTextSectionItem},hR:function(){return RichTextSectionEditor}});var s=n(824246),i=n(99562),r=n(320280),o=n(924364),a=n(136845),l=n(589764),c=n(874271),d=n(28590),u=n(321906),m=n(489812),p=n(102785),h=n(857025),g=n(759276),x=n(583469),v=n(46610),f=n(352991),C=n(827378),j=n(986910);let detectBase64Images=e=>{let t;let n=/<img[^>]*src="data:image\/([^;]+);base64,([^"]+)"[^>]*>/g,s=[];for(;null!==(t=n.exec(e));)s.push(t);return s},base64ToBlob=(e,t)=>{let n=atob(e),s=Array(n.length);for(let e=0;e<n.length;e++)s[e]=n.charCodeAt(e);let i=new Uint8Array(s);return new Blob([i],{type:t})},uploadBase64ImageToS3=async(e,t,n)=>{let s=base64ToBlob(e,t),i="".concat(Date.now(),"_").concat(Math.random().toString(36).substring(7),".").concat(t.split("/")[1]),r="uploads/".concat(n),{url:o,fields:a}=await (0,f.ZP)(null,"corp-api/upload_static_asset_to_s3",{method:"POST",body:{folderName:r,fileName:i,contentType:t,overwrite:!0}}),l=new FormData;for(let[e,t]of Object.entries(a))l.append(e,t);l.append("file",s,i),await fetch(o,{method:"POST",body:l});let c="https://static.remotasks.com/".concat(r,"/").concat(i);return c},processBase64Images=async(e,t)=>{let n=detectBase64Images(e);if(0===n.length)return e;let i=e;for(let e of n){let[n,r,o]=e,a="image/".concat(r);try{let e=await uploadBase64ImageToS3(o,a,t),s=n.replace("data:".concat(a,";base64,").concat(o),e);i=i.replace(n,s)}catch(e){(0,j.Am)((0,s.jsx)("div",{className:"scaleui scale-tailwind scale-theme",children:(0,s.jsxs)("div",{children:["Cannot upload image: ",e]})}),{type:"error",autoClose:3e3,position:"top-right"})}}return i},CourseMarkdownPreview=e=>{let{content:t}=e;return(0,s.jsx)(u.SV,{fallback:(0,s.jsx)(ErrorPlaceholderComponent,{content:t}),children:(0,s.jsx)("div",{style:{width:"100%"},children:(0,s.jsx)(d.u3,{className:"min-h-fit",content:t,enableHtml:!0,enableMath:!0,isCoursePreview:!0,children:(0,s.jsx)(d.MB,{})})})})},RichTextSectionItem=e=>{var t,n;let{sectionItem:i}=e,{viewingSectionId:r,viewingSectionItemId:o,getSectionItem:l,setSectionItemContentProperty:c}=(0,a.B)(e=>({viewingSectionId:e.viewingSectionId,viewingSectionItemId:e.viewingSectionItemId,getSectionItem:e.getSectionItem,setSectionItemContentProperty:e.setSectionItemContentProperty})),d=l(r,i.id);return o===d.id?(0,s.jsx)(RichTextSectionEditor,{onChange:e=>c(r,i.id,"body",e),value:(null===(t=d.contents)||void 0===t?void 0:t.body)||""},i.id):(0,s.jsx)(v.$,{markdownString:null===(n=d.contents)||void 0===n?void 0:n.body})},RichTextSectionEditor=e=>{let{key:t,onChange:n,value:i,minHeight:m="300px"}=e,p=S({minHeight:m}),{viewingCourseId:h,useTipTapEditor:g}=(0,a.B)(e=>({viewingCourseId:e.viewingCourseId,useTipTapEditor:e.useTipTapEditor})),x=(0,C.useCallback)(async e=>{let t=detectBase64Images(e);if(t.length>0)try{let t=await processBase64Images(e,h||"");n(t)}catch(t){n(e)}else n(e)},[n,h]);return g?(0,s.jsx)(u.SV,{fallback:(0,s.jsx)(ErrorPlaceholderComponent,{content:i}),children:(0,s.jsx)("div",{className:p.editorWrapper,children:(0,s.jsx)(c.C,{enableMath:!0,enableCourseTools:!0,enableHtml:!0,children:(0,s.jsxs)(d.Nf,{children:[(0,s.jsx)(l.Z,{enableMath:!0,enableCourseTools:!0}),(0,s.jsx)(d.ML,{content:i,onContentChange:x})]})})})}):(0,s.jsx)(r.LD,{onChange:x,value:o.ZP.render(i||""),className:p.editorWrapper,options:{uploadImgBase:"uploads/".concat(h)},enableGrammarChecking:!0},t)},S=(0,i.ZL)(()=>({editorWrapper:e=>{let{minHeight:t}=e;return{maxHeight:"none",width:"100%",height:"100%","& .ql-editor":{minHeight:t,height:"auto",backgroundColor:"white"},"& .quill":{height:"100%",display:"flex",flexDirection:"column"},"& .ql-container":{minHeight:t,flex:1,overflow:"auto"},"& .ql-container.ql-disabled":{border:"none !important"}}}})),ErrorPlaceholderComponent=e=>{let{content:t}=e;return(0,s.jsx)(m.kC,{p:"4",width:"100%",children:(0,s.jsxs)(p.fC,{color:"warning",style:{width:"100%"},children:[(0,s.jsx)(p.JO,{children:(0,s.jsx)(h.J,{icon:x.eHv,label:"info"})}),(0,s.jsxs)(m.kC,{direction:"column",gap:"2",children:[(0,s.jsx)(p.xv,{weight:"bold",children:"Error rendering content"}),(0,s.jsx)(g.EK,{children:t.replace(/\n/g,"\\n")})]})]})})}}}]);