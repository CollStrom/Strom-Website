"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[84101],{53355:function(e,t,n){n.d(t,{Cf:function(){return markInputRule},DK:function(){return NodeView},DS:function(){return textInputRule},EG:function(){return isNodeSelection},Jo:function(){return getMarkAttributes},K9:function(){return markPasteRule},ML:function(){return Editor},N2:function(){return findChildren},NB:function(){return Node},Nl:function(){return getExtensionField},Ov:function(){return escapeForRegEx},P1:function(){return mergeAttributes},QC:function(){return getChangedRanges},Rw:function(){return y},S0:function(){return wrappingInputRule},Ss:function(){return nodePasteRule},VK:function(){return InputRule},XP:function(){return combineTransactionSteps},b5:function(){return findChildrenInRange},bR:function(){return isNodeEmpty},d1:function(){return getHTMLFromFragment},hj:function(){return Extension},jo:function(){return getNodeType},m7:function(){return getRenderedAttributes},nU:function(){return callOrReturn},pr:function(){return posToDOMRect},qv:function(){return findParentNodeClosestToPos},tI:function(){return getMarksBetween},u9:function(){return getAttributes},vc:function(){return Mark},x2:function(){return nodeInputRule},xh:function(){return isTextSelection},zK:function(){return textblockTypeInputRule}});var r=n(616711),i=n(353553),o=n(436927),s=n(102396),a=n(8465),l=n(555089),d=n(71680);function createChainableState(e){let{state:t,transaction:n}=e,{selection:r}=n,{doc:i}=n,{storedMarks:o}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,o=n.storedMarks,n}}}let CommandManager=class CommandManager{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands:e,editor:t,state:n}=this,{view:r}=t,{tr:i}=n,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,(...e)=>{let n=t(...e)(o);return i.getMeta("preventDispatch")||this.hasCustomState||r.dispatch(i),n}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){let{rawCommands:n,editor:r,state:i}=this,{view:o}=r,s=[],a=!!e,l=e||i.tr,d={...Object.fromEntries(Object.entries(n).map(([e,n])=>[e,(...e)=>{let r=this.buildProps(l,t),i=n(...e)(r);return s.push(i),d}])),run:()=>(a||!t||l.getMeta("preventDispatch")||this.hasCustomState||o.dispatch(l),s.every(e=>!0===e))};return d}createCan(e){let{rawCommands:t,state:n}=this,r=e||n.tr,i=this.buildProps(r,!1),o=Object.fromEntries(Object.entries(t).map(([e,t])=>[e,(...e)=>t(...e)({...i,dispatch:void 0})]));return{...o,chain:()=>this.createChain(r,!1)}}buildProps(e,t=!0){let{rawCommands:n,editor:r,state:i}=this,{view:o}=r,s={tr:e,editor:r,view:o,state:createChainableState({state:i,transaction:e}),dispatch:t?()=>void 0:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([e,t])=>[e,(...e)=>t(...e)(s)]))}};return s}};let EventEmitter=class EventEmitter{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){let n=this.callbacks[e];return n&&n.forEach(e=>e.apply(this,t)),this}off(e,t){let n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter(e=>e!==t):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}};function getExtensionField(e,t,n){if(void 0===e.config[t]&&e.parent)return getExtensionField(e.parent,t,n);if("function"==typeof e.config[t]){let r=e.config[t].bind({...n,parent:e.parent?getExtensionField(e.parent,t,n):null});return r}return e.config[t]}function splitExtensions(e){let t=e.filter(e=>"extension"===e.type),n=e.filter(e=>"node"===e.type),r=e.filter(e=>"mark"===e.type);return{baseExtensions:t,nodeExtensions:n,markExtensions:r}}function getAttributesFromExtensions(e){let t=[],{nodeExtensions:n,markExtensions:r}=splitExtensions(e),i=[...n,...r],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach(e=>{let n={name:e.name,options:e.options,storage:e.storage,extensions:i},r=getExtensionField(e,"addGlobalAttributes",n);if(!r)return;let s=r();s.forEach(e=>{e.types.forEach(n=>{Object.entries(e.attributes).forEach(([e,r])=>{t.push({type:n,name:e,attribute:{...o,...r}})})})})}),i.forEach(e=>{let n={name:e.name,options:e.options,storage:e.storage},r=getExtensionField(e,"addAttributes",n);if(!r)return;let i=r();Object.entries(i).forEach(([n,r])=>{let i={...o,...r};"function"==typeof(null==i?void 0:i.default)&&(i.default=i.default()),(null==i?void 0:i.isRequired)&&(null==i?void 0:i.default)===void 0&&delete i.default,t.push({type:e.name,name:n,attribute:i})})}),t}function getNodeType(e,t){if("string"==typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function mergeAttributes(...e){return e.filter(e=>!!e).reduce((e,t)=>{let n={...e};return Object.entries(t).forEach(([e,t])=>{let r=n[e];if(!r){n[e]=t;return}if("class"===e){let r=t?t.split(" "):[],i=n[e]?n[e].split(" "):[],o=r.filter(e=>!i.includes(e));n[e]=[...i,...o].join(" ")}else if("style"===e){let r=t?t.split(";").map(e=>e.trim()).filter(Boolean):[],i=n[e]?n[e].split(";").map(e=>e.trim()).filter(Boolean):[],o=new Map;i.forEach(e=>{let[t,n]=e.split(":").map(e=>e.trim());o.set(t,n)}),r.forEach(e=>{let[t,n]=e.split(":").map(e=>e.trim());o.set(t,n)}),n[e]=Array.from(o.entries()).map(([e,t])=>`${e}: ${t}`).join("; ")}else n[e]=t}),n},{})}function getRenderedAttributes(e,t){return t.filter(e=>e.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(e.attrs)||{}:{[t.name]:e.attrs[t.name]}).reduce((e,t)=>mergeAttributes(e,t),{})}function isFunction(e){return"function"==typeof e}function callOrReturn(e,t,...n){return isFunction(e)?t?e.bind(t)(...n):e(...n):e}function injectExtensionAttributesToParseRule(e,t){return"style"in e?e:{...e,getAttrs:n=>{let r=e.getAttrs?e.getAttrs(n):e.attrs;if(!1===r)return!1;let i=t.reduce((e,t)=>{var r;let i=t.attribute.parseHTML?t.attribute.parseHTML(n):"string"!=typeof(r=n.getAttribute(t.name))?r:r.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(r):"true"===r||"false"!==r&&r;return null==i?e:{...e,[t.name]:i}},{});return{...r,...i}}}}function cleanUpSchemaItem(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>!("attrs"===e&&function(e={}){return 0===Object.keys(e).length&&e.constructor===Object}(t))&&null!=t))}function getSchemaTypeByName(e,t){return t.nodes[e]||t.marks[e]||null}function isExtensionRulesEnabled(e,t){return Array.isArray(t)?t.some(t=>{let n="string"==typeof t?t:t.name;return n===e.name}):t}let getTextContentFromNodes=(e,t=500)=>{let n="",r=e.parentOffset;return e.parent.nodesBetween(Math.max(0,r-t),r,(e,t,i,o)=>{var s,a;let l=(null===(a=(s=e.type.spec).toText)||void 0===a?void 0:a.call(s,{node:e,pos:t,parent:i,index:o}))||e.textContent||"%leaf%";n+=e.isAtom&&!e.isText?l:l.slice(0,Math.max(0,r-t))}),n};function isRegExp(e){return"[object RegExp]"===Object.prototype.toString.call(e)}let InputRule=class InputRule{constructor(e){this.find=e.find,this.handler=e.handler}};let inputRuleMatcherHandler=(e,t)=>{if(isRegExp(t))return t.exec(e);let n=t(e);if(!n)return null;let r=[n.text];return r.index=n.index,r.input=e,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function run$1(e){var t;let{editor:n,from:r,to:i,text:o,rules:s,plugin:a}=e,{view:l}=n;if(l.composing)return!1;let d=l.state.doc.resolve(r);if(d.parent.type.spec.code||(null===(t=d.nodeBefore||d.nodeAfter)||void 0===t?void 0:t.marks.find(e=>e.type.spec.code)))return!1;let c=!1,u=getTextContentFromNodes(d)+o;return s.forEach(e=>{if(c)return;let t=inputRuleMatcherHandler(u,e.find);if(!t)return;let s=l.state.tr,d=createChainableState({state:l.state,transaction:s}),p={from:r-(t[0].length-o.length),to:i},{commands:h,chain:m,can:f}=new CommandManager({editor:n,state:d}),g=e.handler({state:d,range:p,match:t,commands:h,chain:m,can:f});null!==g&&s.steps.length&&(s.setMeta(a,{transform:s,from:r,to:i,text:o}),l.dispatch(s),c=!0)}),c}let PasteRule=class PasteRule{constructor(e){this.find=e.find,this.handler=e.handler}};let pasteRuleMatcherHandler=(e,t,n)=>{if(isRegExp(t))return[...e.matchAll(t)];let r=t(e,n);return r?r.map(t=>{let n=[t.text];return n.index=t.index,n.input=e,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(t.replaceWith)),n}):[]},createClipboardPasteEvent=e=>{var t;let n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return null===(t=n.clipboardData)||void 0===t||t.setData("text/html",e),n};let ExtensionManager=class ExtensionManager{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=ExtensionManager.resolve(e),this.schema=function(e,t){var n;let r=getAttributesFromExtensions(e),{nodeExtensions:i,markExtensions:o}=splitExtensions(e),a=null===(n=i.find(e=>getExtensionField(e,"topNode")))||void 0===n?void 0:n.name,l=Object.fromEntries(i.map(n=>{let i=r.filter(e=>e.type===n.name),o={name:n.name,options:n.options,storage:n.storage,editor:t},s=e.reduce((e,t)=>{let r=getExtensionField(t,"extendNodeSchema",o);return{...e,...r?r(n):{}}},{}),a=cleanUpSchemaItem({...s,content:callOrReturn(getExtensionField(n,"content",o)),marks:callOrReturn(getExtensionField(n,"marks",o)),group:callOrReturn(getExtensionField(n,"group",o)),inline:callOrReturn(getExtensionField(n,"inline",o)),atom:callOrReturn(getExtensionField(n,"atom",o)),selectable:callOrReturn(getExtensionField(n,"selectable",o)),draggable:callOrReturn(getExtensionField(n,"draggable",o)),code:callOrReturn(getExtensionField(n,"code",o)),whitespace:callOrReturn(getExtensionField(n,"whitespace",o)),defining:callOrReturn(getExtensionField(n,"defining",o)),isolating:callOrReturn(getExtensionField(n,"isolating",o)),attrs:Object.fromEntries(i.map(e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]}))}),l=callOrReturn(getExtensionField(n,"parseHTML",o));l&&(a.parseDOM=l.map(e=>injectExtensionAttributesToParseRule(e,i)));let d=getExtensionField(n,"renderHTML",o);d&&(a.toDOM=e=>d({node:e,HTMLAttributes:getRenderedAttributes(e,i)}));let c=getExtensionField(n,"renderText",o);return c&&(a.toText=c),[n.name,a]})),d=Object.fromEntries(o.map(n=>{let i=r.filter(e=>e.type===n.name),o={name:n.name,options:n.options,storage:n.storage,editor:t},s=e.reduce((e,t)=>{let r=getExtensionField(t,"extendMarkSchema",o);return{...e,...r?r(n):{}}},{}),a=cleanUpSchemaItem({...s,inclusive:callOrReturn(getExtensionField(n,"inclusive",o)),excludes:callOrReturn(getExtensionField(n,"excludes",o)),group:callOrReturn(getExtensionField(n,"group",o)),spanning:callOrReturn(getExtensionField(n,"spanning",o)),code:callOrReturn(getExtensionField(n,"code",o)),attrs:Object.fromEntries(i.map(e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]}))}),l=callOrReturn(getExtensionField(n,"parseHTML",o));l&&(a.parseDOM=l.map(e=>injectExtensionAttributesToParseRule(e,i)));let d=getExtensionField(n,"renderHTML",o);return d&&(a.toDOM=e=>d({mark:e,HTMLAttributes:getRenderedAttributes(e,i)})),[n.name,a]}));return new s.V_({topNode:a,nodes:l,marks:d})}(this.extensions,t),this.setupExtensions()}static resolve(e){let t=ExtensionManager.sort(ExtensionManager.flatten(e)),n=function(e){let t=e.filter((t,n)=>e.indexOf(t)!==n);return Array.from(new Set(t))}(t.map(e=>e.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(e=>`'${e}'`).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map(e=>{let t={name:e.name,options:e.options,storage:e.storage},n=getExtensionField(e,"addExtensions",t);return n?[e,...this.flatten(n())]:e}).flat(10)}static sort(e){return e.sort((e,t)=>{let n=getExtensionField(e,"priority")||100,r=getExtensionField(t,"priority")||100;return n>r?-1:n<r?1:0})}get commands(){return this.extensions.reduce((e,t)=>{let n={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:getSchemaTypeByName(t.name,this.schema)},r=getExtensionField(t,"addCommands",n);return r?{...e,...r()}:e},{})}get plugins(){let{editor:e}=this,t=ExtensionManager.sort([...this.extensions].reverse()),n=[],i=[],s=t.map(t=>{let r={name:t.name,options:t.options,storage:t.storage,editor:e,type:getSchemaTypeByName(t.name,this.schema)},s=[],a=getExtensionField(t,"addKeyboardShortcuts",r),l={};if("mark"===t.type&&getExtensionField(t,"exitable",r)&&(l.ArrowRight=()=>Mark.handleExit({editor:e,mark:t})),a){let t=Object.fromEntries(Object.entries(a()).map(([t,n])=>[t,()=>n({editor:e})]));l={...l,...t}}let d=(0,o.h)(l);s.push(d);let c=getExtensionField(t,"addInputRules",r);isExtensionRulesEnabled(t,e.options.enableInputRules)&&c&&n.push(...c());let u=getExtensionField(t,"addPasteRules",r);isExtensionRulesEnabled(t,e.options.enablePasteRules)&&u&&i.push(...u());let p=getExtensionField(t,"addProseMirrorPlugins",r);if(p){let e=p();s.push(...e)}return s}).flat();return[function(e){let{editor:t,rules:n}=e,i=new r.Sy({state:{init:()=>null,apply(e,r){let o=e.getMeta(i);if(o)return o;let s=e.getMeta("applyInputRules");return s&&setTimeout(()=>{let{from:e,text:r}=s,o=e+r.length;run$1({editor:t,from:e,to:o,text:r,rules:n,plugin:i})}),e.selectionSet||e.docChanged?null:r}},props:{handleTextInput:(e,r,o,s)=>run$1({editor:t,from:r,to:o,text:s,rules:n,plugin:i}),handleDOMEvents:{compositionend:e=>(setTimeout(()=>{let{$cursor:r}=e.state.selection;r&&run$1({editor:t,from:r.pos,to:r.pos,text:"",rules:n,plugin:i})}),!1)},handleKeyDown(e,r){if("Enter"!==r.key)return!1;let{$cursor:o}=e.state.selection;return!!o&&run$1({editor:t,from:o.pos,to:o.pos,text:"\n",rules:n,plugin:i})}},isInputRules:!0});return i}({editor:e,rules:n}),...function(e){let{editor:t,rules:n}=e,i=null,o=!1,s=!1,a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,l="undefined"!=typeof DragEvent?new DragEvent("drop"):null,processEvent=({state:e,from:n,to:r,rule:i,pasteEvt:o})=>{let s=e.tr,d=createChainableState({state:e,transaction:s}),c=function(e){let{editor:t,state:n,from:r,to:i,rule:o,pasteEvent:s,dropEvent:a}=e,{commands:l,chain:d,can:c}=new CommandManager({editor:t,state:n}),u=[];n.doc.nodesBetween(r,i,(e,t)=>{if(!e.isTextblock||e.type.spec.code)return;let p=Math.max(r,t),h=Math.min(i,t+e.content.size),m=e.textBetween(p-t,h-t,void 0,"￼"),f=pasteRuleMatcherHandler(m,o.find,s);f.forEach(e=>{if(void 0===e.index)return;let t=p+e.index+1,r=t+e[0].length,i={from:n.tr.mapping.map(t),to:n.tr.mapping.map(r)},h=o.handler({state:n,range:i,match:e,commands:l,chain:d,can:c,pasteEvent:s,dropEvent:a});u.push(h)})});let p=u.every(e=>null!==e);return p}({editor:t,state:d,from:Math.max(n-1,0),to:r.b-1,rule:i,pasteEvent:o,dropEvent:l});if(c&&s.steps.length)return l="undefined"!=typeof DragEvent?new DragEvent("drop"):null,a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,s},d=n.map(e=>new r.Sy({view(e){let handleDragstart=t=>{var n;i=(null===(n=e.dom.parentElement)||void 0===n?void 0:n.contains(t.target))?e.dom.parentElement:null};return window.addEventListener("dragstart",handleDragstart),{destroy(){window.removeEventListener("dragstart",handleDragstart)}}},props:{handleDOMEvents:{drop:(e,t)=>(s=i===e.dom.parentElement,l=t,!1),paste:(e,t)=>{var n;let r=null===(n=t.clipboardData)||void 0===n?void 0:n.getData("text/html");return a=t,o=!!(null==r?void 0:r.includes("data-pm-slice")),!1}}},appendTransaction:(t,n,r)=>{let i=t[0],l="paste"===i.getMeta("uiEvent")&&!o,d="drop"===i.getMeta("uiEvent")&&!s,c=i.getMeta("applyPasteRules"),u=!!c;if(!l&&!d&&!u)return;if(u){let{from:t,text:n}=c,i=t+n.length,o=createClipboardPasteEvent(n);return processEvent({rule:e,state:r,from:t,to:{b:i},pasteEvt:o})}let p=n.doc.content.findDiffStart(r.doc.content),h=n.doc.content.findDiffEnd(r.doc.content);if("number"==typeof p&&h&&p!==h.b)return processEvent({rule:e,state:r,from:p,to:h,pasteEvt:a})}}));return d}({editor:e,rules:i}),...s]}get attributes(){return getAttributesFromExtensions(this.extensions)}get nodeViews(){let{editor:e}=this,{nodeExtensions:t}=splitExtensions(this.extensions);return Object.fromEntries(t.filter(e=>!!getExtensionField(e,"addNodeView")).map(t=>{let n=this.attributes.filter(e=>e.type===t.name),r={name:t.name,options:t.options,storage:t.storage,editor:e,type:getNodeType(t.name,this.schema)},i=getExtensionField(t,"addNodeView",r);return i?[t.name,(r,o,s,a,l)=>{let d=getRenderedAttributes(r,n);return i()({node:r,view:o,getPos:s,decorations:a,innerDecorations:l,editor:e,extension:t,HTMLAttributes:d})}]:[]}))}setupExtensions(){this.extensions.forEach(e=>{var t;this.editor.extensionStorage[e.name]=e.storage;let n={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:getSchemaTypeByName(e.name,this.schema)};if("mark"===e.type){let r=null===(t=callOrReturn(getExtensionField(e,"keepOnSplit",n)))||void 0===t||t;r&&this.splittableMarks.push(e.name)}let r=getExtensionField(e,"onBeforeCreate",n),i=getExtensionField(e,"onCreate",n),o=getExtensionField(e,"onUpdate",n),s=getExtensionField(e,"onSelectionUpdate",n),a=getExtensionField(e,"onTransaction",n),l=getExtensionField(e,"onFocus",n),d=getExtensionField(e,"onBlur",n),c=getExtensionField(e,"onDestroy",n);r&&this.editor.on("beforeCreate",r),i&&this.editor.on("create",i),o&&this.editor.on("update",o),s&&this.editor.on("selectionUpdate",s),a&&this.editor.on("transaction",a),l&&this.editor.on("focus",l),d&&this.editor.on("blur",d),c&&this.editor.on("destroy",c)})}};function isPlainObject(e){return"Object"===Object.prototype.toString.call(e).slice(8,-1)&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function mergeDeep(e,t){let n={...e};return isPlainObject(e)&&isPlainObject(t)&&Object.keys(t).forEach(r=>{isPlainObject(t[r])&&isPlainObject(e[r])?n[r]=mergeDeep(e[r],t[r]):n[r]=t[r]}),n}let Extension=class Extension{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Extension(e)}configure(e={}){let t=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){let t=new Extension({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=callOrReturn(getExtensionField(t,"addOptions",{name:t.name})),t.storage=callOrReturn(getExtensionField(t,"addStorage",{name:t.name,options:t.options})),t}};function getTextBetween(e,t,n){let{from:r,to:i}=t,{blockSeparator:o="\n\n",textSerializers:s={}}=n||{},a="";return e.nodesBetween(r,i,(e,n,l,d)=>{var c;e.isBlock&&n>r&&(a+=o);let u=null==s?void 0:s[e.type.name];if(u)return l&&(a+=u({node:e,pos:n,parent:l,index:d,range:t})),!1;e.isText&&(a+=null===(c=null==e?void 0:e.text)||void 0===c?void 0:c.slice(Math.max(r,n)-n,i-n))}),a}function getTextSerializersFromSchema(e){return Object.fromEntries(Object.entries(e.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}let c=Extension.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor:e}=this,{state:t,schema:n}=e,{doc:r,selection:i}=t,{ranges:o}=i,s=Math.min(...o.map(e=>e.$from.pos)),a=Math.max(...o.map(e=>e.$to.pos)),l=getTextSerializersFromSchema(n);return getTextBetween(r,{from:s,to:a},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}});function objectIncludes(e,t,n={strict:!0}){let r=Object.keys(t);return!r.length||r.every(r=>n.strict?t[r]===e[r]:isRegExp(t[r])?t[r].test(e[r]):t[r]===e[r])}function findMarkInSet(e,t,n={}){return e.find(e=>e.type===t&&objectIncludes(e.attrs,n))}function getMarkRange(e,t,n={}){if(!e||!t)return;let r=e.parent.childAfter(e.parentOffset);if(e.parentOffset===r.offset&&0!==r.offset&&(r=e.parent.childBefore(e.parentOffset)),!r.node)return;let i=findMarkInSet([...r.node.marks],t,n);if(!i)return;let o=r.index,s=e.start()+r.offset,a=o+1,l=s+r.node.nodeSize;for(findMarkInSet([...r.node.marks],t,n);o>0&&i.isInSet(e.parent.child(o-1).marks);)o-=1,s-=e.parent.child(o).nodeSize;for(;a<e.parent.childCount&&function(e,t,n={}){return!!findMarkInSet(e,t,n)}([...e.parent.child(a).marks],t,n);)l+=e.parent.child(a).nodeSize,a+=1;return{from:s,to:l}}function getMarkType(e,t){if("string"==typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}function isTextSelection(e){return e instanceof r.Bs}function minMax(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function resolveFocusPosition(e,t=null){if(!t)return null;let n=r.Y1.atStart(e),i=r.Y1.atEnd(e);if("start"===t||!0===t)return n;if("end"===t)return i;let o=n.from,s=i.to;return"all"===t?r.Bs.create(e,minMax(0,o,s),minMax(e.content.size,o,s)):r.Bs.create(e,minMax(t,o,s),minMax(t,o,s))}function isiOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}let removeWhitespaces=e=>{let t=e.childNodes;for(let n=t.length-1;n>=0;n-=1){let r=t[n];3===r.nodeType&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?e.removeChild(r):1===r.nodeType&&removeWhitespaces(r)}return e};function elementFromString(e){let t=`<body>${e}</body>`,n=new window.DOMParser().parseFromString(t,"text/html").body;return removeWhitespaces(n)}function createNodeFromContent(e,t,n){n={slice:!0,parseOptions:{},...n};let r="object"==typeof e&&null!==e,i="string"==typeof e;if(r)try{let r=Array.isArray(e)&&e.length>0;if(r)return s.HY.fromArray(e.map(e=>t.nodeFromJSON(e)));let i=t.nodeFromJSON(e);return n.errorOnInvalidContent&&i.check(),i}catch(r){if(n.errorOnInvalidContent)throw Error("[tiptap error]: Invalid JSON content",{cause:r});return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",r),createNodeFromContent("",t,n)}if(i){if(n.errorOnInvalidContent){let r=!1,i="",o=new s.V_({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:e=>(r=!0,i="string"==typeof e?e:e.outerHTML,null)}]}})});if(n.slice?s.aw.fromSchema(o).parseSlice(elementFromString(e),n.parseOptions):s.aw.fromSchema(o).parse(elementFromString(e),n.parseOptions),n.errorOnInvalidContent&&r)throw Error("[tiptap error]: Invalid HTML content",{cause:Error(`Invalid element found: ${i}`)})}let r=s.aw.fromSchema(t);return n.slice?r.parseSlice(elementFromString(e),n.parseOptions).content:r.parse(elementFromString(e),n.parseOptions)}return createNodeFromContent("",t,n)}let isFragment=e=>!("type"in e);function isMacOS(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}function isNodeActive(e,t,n={}){let{from:r,to:i,empty:o}=e.selection,s=t?getNodeType(t,e.schema):null,a=[];e.doc.nodesBetween(r,i,(e,t)=>{if(e.isText)return;let n=Math.max(r,t),o=Math.min(i,t+e.nodeSize);a.push({node:e,from:n,to:o})});let l=i-r,d=a.filter(e=>!s||s.name===e.node.type.name).filter(e=>objectIncludes(e.node.attrs,n,{strict:!1}));if(o)return!!d.length;let c=d.reduce((e,t)=>e+t.to-t.from,0);return c>=l}function getSchemaTypeNameByName(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function deleteProps(e,t){let n="string"==typeof t?[t]:t;return Object.keys(e).reduce((t,r)=>(n.includes(r)||(t[r]=e[r]),t),{})}function createDocument(e,t,n={},r={}){return createNodeFromContent(e,t,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}function getMarkAttributes(e,t){let n=getMarkType(t,e.schema),{from:r,to:i,empty:o}=e.selection,s=[];o?(e.storedMarks&&s.push(...e.storedMarks),s.push(...e.selection.$head.marks())):e.doc.nodesBetween(r,i,e=>{s.push(...e.marks)});let a=s.find(e=>e.type.name===n.name);return a?{...a.attrs}:{}}function combineTransactionSteps(e,t){let n=new a.wx(e);return t.forEach(e=>{e.steps.forEach(e=>{n.step(e)})}),n}function findChildren(e,t){let n=[];return e.descendants((e,r)=>{t(e)&&n.push({node:e,pos:r})}),n}function findChildrenInRange(e,t,n){let r=[];return e.nodesBetween(t.from,t.to,(e,t)=>{n(e)&&r.push({node:e,pos:t})}),r}function findParentNodeClosestToPos(e,t){for(let n=e.depth;n>0;n-=1){let r=e.node(n);if(t(r))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:r}}}function findParentNode(e){return t=>findParentNodeClosestToPos(t.$from,e)}function getHTMLFromFragment(e,t){let n=s.PW.fromSchema(t).serializeFragment(e),r=document.implementation.createHTMLDocument(),i=r.createElement("div");return i.appendChild(n),i.innerHTML}function getAttributes(e,t){let n=getSchemaTypeNameByName("string"==typeof t?t:t.name,e.schema);return"node"===n?function(e,t){let n=getNodeType(t,e.schema),{from:r,to:i}=e.selection,o=[];e.doc.nodesBetween(r,i,e=>{o.push(e)});let s=o.reverse().find(e=>e.type.name===n.name);return s?{...s.attrs}:{}}(e,t):"mark"===n?getMarkAttributes(e,t):{}}function getChangedRanges(e){let{mapping:t,steps:n}=e,r=[];return t.maps.forEach((e,i)=>{let o=[];if(e.ranges.length)e.forEach((e,t)=>{o.push({from:e,to:t})});else{let{from:e,to:t}=n[i];if(void 0===e||void 0===t)return;o.push({from:e,to:t})}o.forEach(({from:e,to:n})=>{let o=t.slice(i).map(e,-1),s=t.slice(i).map(n),a=t.invert().map(o,-1),l=t.invert().map(s);r.push({oldRange:{from:a,to:l},newRange:{from:o,to:s}})})}),function(e){let t=function(e,t=JSON.stringify){let n={};return e.filter(e=>{let r=t(e);return!Object.prototype.hasOwnProperty.call(n,r)&&(n[r]=!0)})}(e);return 1===t.length?t:t.filter((e,n)=>{let r=t.filter((e,t)=>t!==n);return!r.some(t=>e.oldRange.from>=t.oldRange.from&&e.oldRange.to<=t.oldRange.to&&e.newRange.from>=t.newRange.from&&e.newRange.to<=t.newRange.to)})}(r)}function getMarksBetween(e,t,n){let r=[];return e===t?n.resolve(e).marks().forEach(t=>{let i=n.resolve(e),o=getMarkRange(i,t.type);o&&r.push({mark:t,...o})}):n.nodesBetween(e,t,(e,t)=>{e&&(null==e?void 0:e.nodeSize)!==void 0&&r.push(...e.marks.map(n=>({from:t,to:t+e.nodeSize,mark:n})))}),r}function getSplittedAttributes(e,t,n){return Object.fromEntries(Object.entries(n).filter(([n])=>{let r=e.find(e=>e.type===t&&e.name===n);return!!r&&r.attribute.keepOnSplit}))}function isMarkActive(e,t,n={}){let{empty:r,ranges:i}=e.selection,o=t?getMarkType(t,e.schema):null;if(r)return!!(e.storedMarks||e.selection.$from.marks()).filter(e=>!o||o.name===e.type.name).find(e=>objectIncludes(e.attrs,n,{strict:!1}));let s=0,a=[];if(i.forEach(({$from:t,$to:n})=>{let r=t.pos,i=n.pos;e.doc.nodesBetween(r,i,(e,t)=>{if(!e.isText&&!e.marks.length)return;let n=Math.max(r,t),o=Math.min(i,t+e.nodeSize);s+=o-n,a.push(...e.marks.map(e=>({mark:e,from:n,to:o})))})}),0===s)return!1;let l=a.filter(e=>!o||o.name===e.mark.type.name).filter(e=>objectIncludes(e.mark.attrs,n,{strict:!1})).reduce((e,t)=>e+t.to-t.from,0),d=a.filter(e=>!o||e.mark.type!==o&&e.mark.type.excludes(o)).reduce((e,t)=>e+t.to-t.from,0);return(l>0?l+d:l)>=s}function isList(e,t){let{nodeExtensions:n}=splitExtensions(t),r=n.find(t=>t.name===e);if(!r)return!1;let i={name:r.name,options:r.options,storage:r.storage},o=callOrReturn(getExtensionField(r,"group",i));return"string"==typeof o&&o.split(" ").includes("list")}function isNodeEmpty(e,{checkChildren:t=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if("hardBreak"===e.type.name)return!0;if(e.isText)return/^\s*$/m.test(null!==(r=e.text)&&void 0!==r?r:"")}if(e.isText)return!e.text;if(e.isAtom||e.isLeaf)return!1;if(0===e.content.childCount)return!0;if(t){let r=!0;return e.content.forEach(e=>{!1!==r&&(isNodeEmpty(e,{ignoreWhitespace:n,checkChildren:t})||(r=!1))}),r}return!1}function isNodeSelection(e){return e instanceof r.qv}function posToDOMRect(e,t,n){let r=e.state.doc.content.size,i=minMax(t,0,r),o=minMax(n,0,r),s=e.coordsAtPos(i),a=e.coordsAtPos(o,-1),l=Math.min(s.top,a.top),d=Math.max(s.bottom,a.bottom),c=Math.min(s.left,a.left),u=Math.max(s.right,a.right),p={top:l,bottom:d,left:c,right:u,width:u-c,height:d-l,x:c,y:l};return{...p,toJSON:()=>p}}function ensureMarks(e,t){let n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){let r=n.filter(e=>null==t?void 0:t.includes(e.type.name));e.tr.ensureMarks(r)}}let joinListBackwards=(e,t)=>{let n=findParentNode(e=>e.type===t)(e.selection);if(!n)return!0;let r=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===r)return!0;let i=e.doc.nodeAt(r),o=n.node.type===(null==i?void 0:i.type)&&(0,a.Mn)(e.doc,n.pos);return!o||(e.join(n.pos),!0)},joinListForwards=(e,t)=>{let n=findParentNode(e=>e.type===t)(e.selection);if(!n)return!0;let r=e.doc.resolve(n.start).after(n.depth);if(void 0===r)return!0;let i=e.doc.nodeAt(r),o=n.node.type===(null==i?void 0:i.type)&&(0,a.Mn)(e.doc,r);return!o||(e.join(r),!0)};var u=Object.freeze({__proto__:null,blur:()=>({editor:e,view:t})=>(requestAnimationFrame(()=>{var n;e.isDestroyed||(t.dom.blur(),null===(n=null==window?void 0:window.getSelection())||void 0===n||n.removeAllRanges())}),!0),clearContent:(e=!1)=>({commands:t})=>t.setContent("",e),clearNodes:()=>({state:e,tr:t,dispatch:n})=>{let{selection:r}=t,{ranges:i}=r;return!n||(i.forEach(({$from:n,$to:r})=>{e.doc.nodesBetween(n.pos,r.pos,(e,n)=>{if(e.type.isText)return;let{doc:r,mapping:i}=t,o=r.resolve(i.map(n)),s=r.resolve(i.map(n+e.nodeSize)),l=o.blockRange(s);if(!l)return;let d=(0,a.k9)(l);if(e.type.isTextblock){let{defaultType:e}=o.parent.contentMatchAt(o.index());t.setNodeMarkup(l.start,e)}(d||0===d)&&t.lift(l,d)})}),!0)},command:e=>t=>e(t),createParagraphNear:()=>({state:e,dispatch:t})=>(0,l.mD)(e,t),cut:(e,t)=>({editor:n,tr:i})=>{let{state:o}=n,s=o.doc.slice(e.from,e.to);i.deleteRange(e.from,e.to);let a=i.mapping.map(t);return i.insert(a,s.content),i.setSelection(new r.Bs(i.doc.resolve(a-1))),!0},deleteCurrentNode:()=>({tr:e,dispatch:t})=>{let{selection:n}=e,r=n.$anchor.node();if(r.content.size>0)return!1;let i=e.selection.$anchor;for(let n=i.depth;n>0;n-=1){let o=i.node(n);if(o.type===r.type){if(t){let t=i.before(n),r=i.after(n);e.delete(t,r).scrollIntoView()}return!0}}return!1},deleteNode:e=>({tr:t,state:n,dispatch:r})=>{let i=getNodeType(e,n.schema),o=t.selection.$anchor;for(let e=o.depth;e>0;e-=1){let n=o.node(e);if(n.type===i){if(r){let n=o.before(e),r=o.after(e);t.delete(n,r).scrollIntoView()}return!0}}return!1},deleteRange:e=>({tr:t,dispatch:n})=>{let{from:r,to:i}=e;return n&&t.delete(r,i),!0},deleteSelection:()=>({state:e,dispatch:t})=>(0,l.NE)(e,t),enter:()=>({commands:e})=>e.keyboardShortcut("Enter"),exitCode:()=>({state:e,dispatch:t})=>(0,l.uo)(e,t),extendMarkRange:(e,t={})=>({tr:n,state:i,dispatch:o})=>{let s=getMarkType(e,i.schema),{doc:a,selection:l}=n,{$from:d,from:c,to:u}=l;if(o){let e=getMarkRange(d,s,t);if(e&&e.from<=c&&e.to>=u){let t=r.Bs.create(a,e.from,e.to);n.setSelection(t)}}return!0},first:e=>t=>{let n="function"==typeof e?e(t):e;for(let e=0;e<n.length;e+=1)if(n[e](t))return!0;return!1},focus:(e=null,t={})=>({editor:n,view:r,tr:i,dispatch:o})=>{t={scrollIntoView:!0,...t};let delayedFocus=()=>{isiOS()&&r.dom.focus(),requestAnimationFrame(()=>{!n.isDestroyed&&(r.focus(),(null==t?void 0:t.scrollIntoView)&&n.commands.scrollIntoView())})};if(r.hasFocus()&&null===e||!1===e)return!0;if(o&&null===e&&!isTextSelection(n.state.selection))return delayedFocus(),!0;let s=resolveFocusPosition(i.doc,e)||n.state.selection,a=n.state.selection.eq(s);return o&&(a||i.setSelection(s),a&&i.storedMarks&&i.setStoredMarks(i.storedMarks),delayedFocus()),!0},forEach:(e,t)=>n=>e.every((e,r)=>t(e,{...n,index:r})),insertContent:(e,t)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),insertContentAt:(e,t,n)=>({tr:i,dispatch:o,editor:s})=>{var l;if(o){let o,d;n={parseOptions:{},updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};try{o=createNodeFromContent(t,s.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions},errorOnInvalidContent:null!==(l=n.errorOnInvalidContent)&&void 0!==l?l:s.options.enableContentCheck})}catch(e){return s.emit("contentError",{editor:s,error:e,disableCollaboration:()=>{console.error("[tiptap error]: Unable to disable collaboration at this point in time")}}),!1}let{from:c,to:u}="number"==typeof e?{from:e,to:e}:{from:e.from,to:e.to},p=!0,h=!0,m=isFragment(o)?o:[o];if(m.forEach(e=>{e.check(),p=!!p&&e.isText&&0===e.marks.length,h=!!h&&e.isBlock}),c===u&&h){let{parent:e}=i.doc.resolve(c),t=e.isTextblock&&!e.type.spec.code&&!e.childCount;t&&(c-=1,u+=1)}p?(d=Array.isArray(t)?t.map(e=>e.text||"").join(""):"object"==typeof t&&t&&t.text?t.text:t,i.insertText(d,c,u)):(d=o,i.replaceWith(c,u,d)),n.updateSelection&&function(e,t,n){let i=e.steps.length-1;if(i<t)return;let o=e.steps[i];if(!(o instanceof a.Pu||o instanceof a.FC))return;let s=e.mapping.maps[i],l=0;s.forEach((e,t,n,r)=>{0===l&&(l=r)}),e.setSelection(r.Y1.near(e.doc.resolve(l),-1))}(i,i.steps.length-1,0),n.applyInputRules&&i.setMeta("applyInputRules",{from:c,text:d}),n.applyPasteRules&&i.setMeta("applyPasteRules",{from:c,text:d})}return!0},joinBackward:()=>({state:e,dispatch:t})=>(0,l.al)(e,t),joinDown:()=>({state:e,dispatch:t})=>(0,l.Ig)(e,t),joinForward:()=>({state:e,dispatch:t})=>(0,l.Y_)(e,t),joinItemBackward:()=>({state:e,dispatch:t,tr:n})=>{try{let r=(0,a.GJ)(e.doc,e.selection.$from.pos,-1);if(null==r)return!1;return n.join(r,2),t&&t(n),!0}catch(e){return!1}},joinItemForward:()=>({state:e,dispatch:t,tr:n})=>{try{let r=(0,a.GJ)(e.doc,e.selection.$from.pos,1);if(null==r)return!1;return n.join(r,2),t&&t(n),!0}catch(e){return!1}},joinTextblockBackward:()=>({state:e,dispatch:t})=>(0,l.rr)(e,t),joinTextblockForward:()=>({state:e,dispatch:t})=>(0,l.cR)(e,t),joinUp:()=>({state:e,dispatch:t})=>(0,l.MI)(e,t),keyboardShortcut:e=>({editor:t,view:n,tr:r,dispatch:i})=>{let o=(function(e){let t,n,r,i;let o=e.split(/-(?!$)/),s=o[o.length-1];"Space"===s&&(s=" ");for(let e=0;e<o.length-1;e+=1){let s=o[e];if(/^(cmd|meta|m)$/i.test(s))i=!0;else if(/^a(lt)?$/i.test(s))t=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else if(/^s(hift)?$/i.test(s))r=!0;else if(/^mod$/i.test(s))isiOS()||isMacOS()?i=!0:n=!0;else throw Error(`Unrecognized modifier name: ${s}`)}return t&&(s=`Alt-${s}`),n&&(s=`Ctrl-${s}`),i&&(s=`Meta-${s}`),r&&(s=`Shift-${s}`),s})(e).split(/-(?!$)/),s=o.find(e=>!["Alt","Ctrl","Meta","Shift"].includes(e)),a=new KeyboardEvent("keydown",{key:"Space"===s?" ":s,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction(()=>{n.someProp("handleKeyDown",e=>e(n,a))});return null==l||l.steps.forEach(e=>{let t=e.map(r.mapping);t&&i&&r.maybeStep(t)}),!0},lift:(e,t={})=>({state:n,dispatch:r})=>{let i=getNodeType(e,n.schema),o=isNodeActive(n,i,t);return!!o&&(0,l.xb)(n,r)},liftEmptyBlock:()=>({state:e,dispatch:t})=>(0,l.X0)(e,t),liftListItem:e=>({state:t,dispatch:n})=>{let r=getNodeType(e,t.schema);return(0,d.IB)(r)(t,n)},newlineInCode:()=>({state:e,dispatch:t})=>(0,l.QK)(e,t),resetAttributes:(e,t)=>({tr:n,state:r,dispatch:i})=>{let o=null,s=null,a=getSchemaTypeNameByName("string"==typeof e?e:e.name,r.schema);return!!a&&("node"===a&&(o=getNodeType(e,r.schema)),"mark"===a&&(s=getMarkType(e,r.schema)),i&&n.selection.ranges.forEach(e=>{r.doc.nodesBetween(e.$from.pos,e.$to.pos,(e,r)=>{o&&o===e.type&&n.setNodeMarkup(r,void 0,deleteProps(e.attrs,t)),s&&e.marks.length&&e.marks.forEach(i=>{s===i.type&&n.addMark(r,r+e.nodeSize,s.create(deleteProps(i.attrs,t)))})})}),!0)},scrollIntoView:()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),selectAll:()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size}),selectNodeBackward:()=>({state:e,dispatch:t})=>(0,l._M)(e,t),selectNodeForward:()=>({state:e,dispatch:t})=>(0,l.o)(e,t),selectParentNode:()=>({state:e,dispatch:t})=>(0,l.N0)(e,t),selectTextblockEnd:()=>({state:e,dispatch:t})=>(0,l.nw)(e,t),selectTextblockStart:()=>({state:e,dispatch:t})=>(0,l.U9)(e,t),setContent:(e,t=!1,n={},r={})=>({editor:i,tr:o,dispatch:s,commands:a})=>{var l,d;let{doc:c}=o;if("full"!==n.preserveWhitespace){let a=createDocument(e,i.schema,n,{errorOnInvalidContent:null!==(l=r.errorOnInvalidContent)&&void 0!==l?l:i.options.enableContentCheck});return s&&o.replaceWith(0,c.content.size,a).setMeta("preventUpdate",!t),!0}return s&&o.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:c.content.size},e,{parseOptions:n,errorOnInvalidContent:null!==(d=r.errorOnInvalidContent)&&void 0!==d?d:i.options.enableContentCheck})},setMark:(e,t={})=>({tr:n,state:r,dispatch:i})=>{let{selection:o}=n,{empty:s,ranges:a}=o,l=getMarkType(e,r.schema);if(i){if(s){let e=getMarkAttributes(r,l);n.addStoredMark(l.create({...e,...t}))}else a.forEach(e=>{let i=e.$from.pos,o=e.$to.pos;r.doc.nodesBetween(i,o,(e,r)=>{let s=Math.max(r,i),a=Math.min(r+e.nodeSize,o),d=e.marks.find(e=>e.type===l);d?e.marks.forEach(e=>{l===e.type&&n.addMark(s,a,l.create({...e.attrs,...t}))}):n.addMark(s,a,l.create(t))})})}return function(e,t,n){var r;let{selection:i}=t,o=null;if(isTextSelection(i)&&(o=i.$cursor),o){let t=null!==(r=e.storedMarks)&&void 0!==r?r:o.marks();return!!n.isInSet(t)||!t.some(e=>e.type.excludes(n))}let{ranges:s}=i;return s.some(({$from:t,$to:r})=>{let i=0===t.depth&&e.doc.inlineContent&&e.doc.type.allowsMarkType(n);return e.doc.nodesBetween(t.pos,r.pos,(e,t,r)=>{if(i)return!1;if(e.isInline){let t=!r||r.type.allowsMarkType(n),o=!!n.isInSet(e.marks)||!e.marks.some(e=>e.type.excludes(n));i=t&&o}return!i}),i})}(r,n,l)},setMeta:(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),setNode:(e,t={})=>({state:n,dispatch:r,chain:i})=>{let o=getNodeType(e,n.schema);return o.isTextblock?i().command(({commands:e})=>{let r=(0,l.uJ)(o,t)(n);return!!r||e.clearNodes()}).command(({state:e})=>(0,l.uJ)(o,t)(e,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection:e=>({tr:t,dispatch:n})=>{if(n){let{doc:n}=t,i=minMax(e,0,n.content.size),o=r.qv.create(n,i);t.setSelection(o)}return!0},setTextSelection:e=>({tr:t,dispatch:n})=>{if(n){let{doc:n}=t,{from:i,to:o}="number"==typeof e?{from:e,to:e}:e,s=r.Bs.atStart(n).from,a=r.Bs.atEnd(n).to,l=minMax(i,s,a),d=minMax(o,s,a),c=r.Bs.create(n,l,d);t.setSelection(c)}return!0},sinkListItem:e=>({state:t,dispatch:n})=>{let r=getNodeType(e,t.schema);return(0,d.bw)(r)(t,n)},splitBlock:({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:i,editor:o})=>{let{selection:s,doc:l}=t,{$from:d,$to:c}=s,u=o.extensionManager.attributes,p=getSplittedAttributes(u,d.node().type.name,d.node().attrs);if(s instanceof r.qv&&s.node.isBlock)return!!(d.parentOffset&&(0,a.Ax)(l,d.pos))&&(i&&(e&&ensureMarks(n,o.extensionManager.splittableMarks),t.split(d.pos).scrollIntoView()),!0);if(!d.parent.isBlock)return!1;let h=c.parentOffset===c.parent.content.size,m=0===d.depth?void 0:function(e){for(let t=0;t<e.edgeCount;t+=1){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(d.node(-1).contentMatchAt(d.indexAfter(-1))),f=h&&m?[{type:m,attrs:p}]:void 0,g=(0,a.Ax)(t.doc,t.mapping.map(d.pos),1,f);if(!f&&!g&&(0,a.Ax)(t.doc,t.mapping.map(d.pos),1,m?[{type:m}]:void 0)&&(g=!0,f=m?[{type:m,attrs:p}]:void 0),i){if(g&&(s instanceof r.Bs&&t.deleteSelection(),t.split(t.mapping.map(d.pos),1,f),m&&!h&&!d.parentOffset&&d.parent.type!==m)){let e=t.mapping.map(d.before()),n=t.doc.resolve(e);d.node(-1).canReplaceWith(n.index(),n.index()+1,m)&&t.setNodeMarkup(t.mapping.map(d.before()),m)}e&&ensureMarks(n,o.extensionManager.splittableMarks),t.scrollIntoView()}return g},splitListItem:(e,t={})=>({tr:n,state:i,dispatch:o,editor:l})=>{var d;let c=getNodeType(e,i.schema),{$from:u,$to:p}=i.selection,h=i.selection.node;if(h&&h.isBlock||u.depth<2||!u.sameParent(p))return!1;let m=u.node(-1);if(m.type!==c)return!1;let f=l.extensionManager.attributes;if(0===u.parent.content.size&&u.node(-1).childCount===u.indexAfter(-1)){if(2===u.depth||u.node(-3).type!==c||u.index(-2)!==u.node(-2).childCount-1)return!1;if(o){let e=s.HY.empty,i=u.index(-1)?1:u.index(-2)?2:3;for(let t=u.depth-i;t>=u.depth-3;t-=1)e=s.HY.from(u.node(t).copy(e));let o=u.indexAfter(-1)<u.node(-2).childCount?1:u.indexAfter(-2)<u.node(-3).childCount?2:3,a={...getSplittedAttributes(f,u.node().type.name,u.node().attrs),...t},l=(null===(d=c.contentMatch.defaultType)||void 0===d?void 0:d.createAndFill(a))||void 0;e=e.append(s.HY.from(c.createAndFill(null,l)||void 0));let p=u.before(u.depth-(i-1));n.replace(p,u.after(-o),new s.p2(e,4-i,0));let h=-1;n.doc.nodesBetween(p,n.doc.content.size,(e,t)=>{if(h>-1)return!1;e.isTextblock&&0===e.content.size&&(h=t+1)}),h>-1&&n.setSelection(r.Bs.near(n.doc.resolve(h))),n.scrollIntoView()}return!0}let g=p.pos===u.end()?m.contentMatchAt(0).defaultType:null,y={...getSplittedAttributes(f,m.type.name,m.attrs),...t},v={...getSplittedAttributes(f,u.node().type.name,u.node().attrs),...t};if(n.delete(u.pos,p.pos),!(0,a.Ax)(n.doc,u.pos,2))return!1;if(o){let{selection:e,storedMarks:t}=i,{splittableMarks:r}=l.extensionManager,s=t||e.$to.parentOffset&&e.$from.marks();if(n.split(u.pos,2,g?[{type:c,attrs:y},{type:g,attrs:v}]:[{type:c,attrs:y}]).scrollIntoView(),!s||!o)return!0;let a=s.filter(e=>r.includes(e.type.name));n.ensureMarks(a)}return!0},toggleList:(e,t,n,r={})=>({editor:i,tr:o,state:s,dispatch:a,chain:l,commands:d,can:c})=>{let{extensions:u,splittableMarks:p}=i.extensionManager,h=getNodeType(e,s.schema),m=getNodeType(t,s.schema),{selection:f,storedMarks:g}=s,{$from:y,$to:v}=f,x=y.blockRange(v),b=g||f.$to.parentOffset&&f.$from.marks();if(!x)return!1;let k=findParentNode(e=>isList(e.type.name,u))(f);if(x.depth>=1&&k&&x.depth-k.depth<=1){if(k.node.type===h)return d.liftListItem(m);if(isList(k.node.type.name,u)&&h.validContent(k.node.content)&&a)return l().command(()=>(o.setNodeMarkup(k.pos,h),!0)).command(()=>joinListBackwards(o,h)).command(()=>joinListForwards(o,h)).run()}return n&&b&&a?l().command(()=>{let e=c().wrapInList(h,r),t=b.filter(e=>p.includes(e.type.name));return o.ensureMarks(t),!!e||d.clearNodes()}).wrapInList(h,r).command(()=>joinListBackwards(o,h)).command(()=>joinListForwards(o,h)).run():l().command(()=>{let e=c().wrapInList(h,r);return!!e||d.clearNodes()}).wrapInList(h,r).command(()=>joinListBackwards(o,h)).command(()=>joinListForwards(o,h)).run()},toggleMark:(e,t={},n={})=>({state:r,commands:i})=>{let{extendEmptyMarkRange:o=!1}=n,s=getMarkType(e,r.schema),a=isMarkActive(r,s,t);return a?i.unsetMark(s,{extendEmptyMarkRange:o}):i.setMark(s,t)},toggleNode:(e,t,n={})=>({state:r,commands:i})=>{let o;let s=getNodeType(e,r.schema),a=getNodeType(t,r.schema),l=isNodeActive(r,s,n);return(r.selection.$anchor.sameParent(r.selection.$head)&&(o=r.selection.$anchor.parent.attrs),l)?i.setNode(a,o):i.setNode(s,{...o,...n})},toggleWrap:(e,t={})=>({state:n,commands:r})=>{let i=getNodeType(e,n.schema),o=isNodeActive(n,i,t);return o?r.lift(i):r.wrapIn(i,t)},undoInputRule:()=>({state:e,dispatch:t})=>{let n=e.plugins;for(let r=0;r<n.length;r+=1){let i;let o=n[r];if(o.spec.isInputRules&&(i=o.getState(e))){if(t){let t=e.tr,n=i.transform;for(let e=n.steps.length-1;e>=0;e-=1)t.step(n.steps[e].invert(n.docs[e]));if(i.text){let n=t.doc.resolve(i.from).marks();t.replaceWith(i.from,i.to,e.schema.text(i.text,n))}else t.delete(i.from,i.to)}return!0}}return!1},unsetAllMarks:()=>({tr:e,dispatch:t})=>{let{selection:n}=e,{empty:r,ranges:i}=n;return!!r||(t&&i.forEach(t=>{e.removeMark(t.$from.pos,t.$to.pos)}),!0)},unsetMark:(e,t={})=>({tr:n,state:r,dispatch:i})=>{var o;let{extendEmptyMarkRange:s=!1}=t,{selection:a}=n,l=getMarkType(e,r.schema),{$from:d,empty:c,ranges:u}=a;if(!i)return!0;if(c&&s){let{from:e,to:t}=a,r=null===(o=d.marks().find(e=>e.type===l))||void 0===o?void 0:o.attrs,i=getMarkRange(d,l,r);i&&(e=i.from,t=i.to),n.removeMark(e,t,l)}else u.forEach(e=>{n.removeMark(e.$from.pos,e.$to.pos,l)});return n.removeStoredMark(l),!0},updateAttributes:(e,t={})=>({tr:n,state:r,dispatch:i})=>{let o=null,s=null,a=getSchemaTypeNameByName("string"==typeof e?e:e.name,r.schema);return!!a&&("node"===a&&(o=getNodeType(e,r.schema)),"mark"===a&&(s=getMarkType(e,r.schema)),i&&n.selection.ranges.forEach(e=>{let i=e.$from.pos,a=e.$to.pos;r.doc.nodesBetween(i,a,(e,r)=>{o&&o===e.type&&n.setNodeMarkup(r,void 0,{...e.attrs,...t}),s&&e.marks.length&&e.marks.forEach(o=>{if(s===o.type){let l=Math.max(r,i),d=Math.min(r+e.nodeSize,a);n.addMark(l,d,s.create({...o.attrs,...t}))}})})}),!0)},wrapIn:(e,t={})=>({state:n,dispatch:r})=>{let i=getNodeType(e,n.schema);return(0,l.ym)(i,t)(n,r)},wrapInList:(e,t={})=>({state:n,dispatch:r})=>{let i=getNodeType(e,n.schema);return(0,d.KI)(i,t)(n,r)}});let p=Extension.create({name:"commands",addCommands:()=>({...u})}),h=Extension.create({name:"editable",addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("editable"),props:{editable:()=>this.editor.options.editable}})]}}),m=Extension.create({name:"focusEvents",addProseMirrorPlugins(){let{editor:e}=this;return[new r.Sy({key:new r.H$("focusEvents"),props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;let r=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1},blur:(t,n)=>{e.isFocused=!1;let r=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1}}}})]}}),f=Extension.create({name:"keymap",addKeyboardShortcuts(){let handleBackspace=()=>this.editor.commands.first(({commands:e})=>[()=>e.undoInputRule(),()=>e.command(({tr:t})=>{let{selection:n,doc:i}=t,{empty:o,$anchor:s}=n,{pos:a,parent:l}=s,d=s.parent.isTextblock&&a>0?t.doc.resolve(a-1):s,c=d.parent.type.spec.isolating,u=s.pos-s.parentOffset,p=c&&1===d.parent.childCount?u===s.pos:r.Y1.atStart(i).from===a;return!!o&&!!l.type.isTextblock&&!l.textContent.length&&!!p&&(!p||"paragraph"!==s.parent.type.name)&&e.clearNodes()}),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()]),handleDelete=()=>this.editor.commands.first(({commands:e})=>[()=>e.deleteSelection(),()=>e.deleteCurrentNode(),()=>e.joinForward(),()=>e.selectNodeForward()]),e={Enter:()=>this.editor.commands.first(({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:handleBackspace,"Mod-Backspace":handleBackspace,"Shift-Backspace":handleBackspace,Delete:handleDelete,"Mod-Delete":handleDelete,"Mod-a":()=>this.editor.commands.selectAll()},t={...e},n={...e,"Ctrl-h":handleBackspace,"Alt-Backspace":handleBackspace,"Ctrl-d":handleDelete,"Ctrl-Alt-Backspace":handleDelete,"Alt-Delete":handleDelete,"Alt-d":handleDelete,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return isiOS()||isMacOS()?n:t},addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("clearDocument"),appendTransaction:(e,t,n)=>{let i=e.some(e=>e.docChanged)&&!t.doc.eq(n.doc),o=e.some(e=>e.getMeta("preventClearDocument"));if(!i||o)return;let{empty:s,from:a,to:l}=t.selection,d=r.Y1.atStart(t.doc).from,c=r.Y1.atEnd(t.doc).to;if(s||!(a===d&&l===c))return;let u=isNodeEmpty(n.doc);if(!u)return;let p=n.tr,h=createChainableState({state:n,transaction:p}),{commands:m}=new CommandManager({editor:this.editor,state:h});if(m.clearNodes(),p.steps.length)return p}})]}}),g=Extension.create({name:"tabindex",addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});var y=Object.freeze({__proto__:null,ClipboardTextSerializer:c,Commands:p,Editable:h,FocusEvents:m,Keymap:f,Tabindex:g});let NodePos=class NodePos{get name(){return this.node.type.name}constructor(e,t,n=!1,r=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=t,this.currentNode=r}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return null!==(e=this.actualDepth)&&void 0!==e?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,n=this.to;if(this.isBlock){if(0===this.content.size){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:t,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(0===this.depth)return null;let e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new NodePos(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new NodePos(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new NodePos(e,this.editor)}get children(){let e=[];return this.node.content.forEach((t,n)=>{let r=t.isBlock&&!t.isTextblock,i=this.pos+n+1,o=this.resolvedPos.doc.resolve(i);if(!r&&o.depth<=this.depth)return;let s=new NodePos(o,this.editor,r,r?t:null);r&&(s.actualDepth=this.depth+1),e.push(new NodePos(o,this.editor,r,r?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){let e=this.children;return e[e.length-1]||null}closest(e,t={}){let n=null,r=this.parent;for(;r&&!n;){if(r.node.type.name===e){if(Object.keys(t).length>0){let e=r.node.attrs,n=Object.keys(t);for(let r=0;r<n.length;r+=1){let i=n[r];if(e[i]!==t[i])break}}else n=r}r=r.parent}return n}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},n=!1){let r=[];if(!this.children||0===this.children.length)return r;let i=Object.keys(t);return this.children.forEach(o=>{if(!n||!(r.length>0)){if(o.node.type.name===e){let e=i.every(e=>t[e]===o.node.attrs[e]);e&&r.push(o)}n&&r.length>0||(r=r.concat(o.querySelectorAll(e,t,n)))}}),r}setAttribute(e){let t=this.editor.state.selection;this.editor.chain().setTextSelection(this.from).updateAttributes(this.node.type.name,e).setTextSelection(t.from).run()}};let DropPlugin=e=>new r.Sy({key:new r.H$("tiptapDrop"),props:{handleDrop:(t,n,r,i)=>{e(n,r,i)}}}),PastePlugin=e=>new r.Sy({key:new r.H$("tiptapPaste"),props:{handlePaste:(t,n,r)=>{e(n,r)}}}),v=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;let Editor=class Editor extends EventEmitter{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:e})=>{throw e},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.options.onPaste&&this.registerPlugin(PastePlugin(this.options.onPaste)),this.options.onDrop&&this.registerPlugin(DropPlugin(this.options.onDrop)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=function(e,t,n){let r=document.querySelector(`style[data-tiptap-style${n?`-${n}`:""}]`);if(null!==r)return r;let i=document.createElement("style");return t&&i.setAttribute("nonce",t),i.setAttribute(`data-tiptap-style${n?`-${n}`:""}`,""),i.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(i),i}(v,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){let n=isFunction(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],r=this.state.reconfigure({plugins:n});this.view.updateState(r)}unregisterPlugin(e){if(this.isDestroyed)return;let t="string"==typeof e?`${e}$`:e.key,n=this.state.reconfigure({plugins:this.state.plugins.filter(e=>!e.key.startsWith(t))});this.view.updateState(n)}createExtensionManager(){var e,t;let n=this.options.enableCoreExtensions?[h,c.configure({blockSeparator:null===(t=null===(e=this.options.coreExtensionOptions)||void 0===e?void 0:e.clipboardTextSerializer)||void 0===t?void 0:t.blockSeparator}),p,m,f,g].filter(e=>"object"!=typeof this.options.enableCoreExtensions||!1!==this.options.enableCoreExtensions[e.name]):[],r=[...n,...this.options.extensions].filter(e=>["extension","node","mark"].includes(null==e?void 0:e.type));this.extensionManager=new ExtensionManager(r,this)}createCommandManager(){this.commandManager=new CommandManager({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){let e;try{e=createDocument(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(t){if(!(t instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(t.message))throw t;this.emit("contentError",{editor:this,error:t,disableCollaboration:()=>{this.options.extensions=this.options.extensions.filter(e=>"collaboration"!==e.name),this.createExtensionManager()}}),e=createDocument(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}let t=resolveFocusPosition(e,this.options.autofocus);this.view=new i.tk(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:r.yy.create({doc:e,selection:t||void 0})});let n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews(),this.prependClass();let o=this.view.dom;o.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;let t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(e=>{var t;return null===(t=this.capturedTransaction)||void 0===t?void 0:t.step(e)});return}let t=this.state.apply(e),n=!this.state.selection.eq(t.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),n&&this.emit("selectionUpdate",{editor:this,transaction:e});let r=e.getMeta("focus"),i=e.getMeta("blur");r&&this.emit("focus",{editor:this,event:r.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!e.docChanged||e.getMeta("preventUpdate")||this.emit("update",{editor:this,transaction:e})}getAttributes(e){return getAttributes(this.state,e)}isActive(e,t){let n="string"==typeof e?e:null,r="string"==typeof e?t:e;return function(e,t,n={}){if(!t)return isNodeActive(e,null,n)||isMarkActive(e,null,n);let r=getSchemaTypeNameByName(t,e.schema);return"node"===r?isNodeActive(e,t,n):"mark"===r&&isMarkActive(e,t,n)}(this.state,n,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return getHTMLFromFragment(this.state.doc.content,this.schema)}getText(e){let{blockSeparator:t="\n\n",textSerializers:n={}}=e||{};return function(e,t){let n={from:0,to:e.content.size};return getTextBetween(e,n,t)}(this.state.doc,{blockSeparator:t,textSerializers:{...getTextSerializersFromSchema(this.schema),...n}})}get isEmpty(){return isNodeEmpty(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(null===(e=this.view)||void 0===e?void 0:e.docView)}$node(e,t){var n;return(null===(n=this.$doc)||void 0===n?void 0:n.querySelector(e,t))||null}$nodes(e,t){var n;return(null===(n=this.$doc)||void 0===n?void 0:n.querySelectorAll(e,t))||null}$pos(e){let t=this.state.doc.resolve(e);return new NodePos(t,this)}get $doc(){return this.$pos(0)}};function markInputRule(e){return new InputRule({find:e.find,handler:({state:t,range:n,match:r})=>{let i=callOrReturn(e.getAttributes,void 0,r);if(!1===i||null===i)return null;let{tr:o}=t,s=r[r.length-1],a=r[0];if(s){let r=a.search(/\S/),l=n.from+a.indexOf(s),d=l+s.length,c=getMarksBetween(n.from,n.to,t.doc).filter(t=>{let n=t.mark.type.excluded;return n.find(n=>n===e.type&&n!==t.mark.type)}).filter(e=>e.to>l);if(c.length)return null;d<n.to&&o.delete(d,n.to),l>n.from&&o.delete(n.from+r,l);let u=n.from+r+s.length;o.addMark(n.from+r,u,e.type.create(i||{})),o.removeStoredMark(e.type)}}})}function nodeInputRule(e){return new InputRule({find:e.find,handler:({state:t,range:n,match:r})=>{let i=callOrReturn(e.getAttributes,void 0,r)||{},{tr:o}=t,s=n.from,a=n.to,l=e.type.create(i);if(r[1]){let e=r[0].lastIndexOf(r[1]),t=s+e;t>a?t=a:a=t+r[1].length;let n=r[0][r[0].length-1];o.insertText(n,s+r[0].length-1),o.replaceWith(t,a,l)}else if(r[0]){let t=e.type.isInline?s:s-1;o.insert(t,e.type.create(i)).delete(o.mapping.map(s),o.mapping.map(a))}o.scrollIntoView()}})}function textblockTypeInputRule(e){return new InputRule({find:e.find,handler:({state:t,range:n,match:r})=>{let i=t.doc.resolve(n.from),o=callOrReturn(e.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,o)}})}function textInputRule(e){return new InputRule({find:e.find,handler:({state:t,range:n,match:r})=>{let i=e.replace,o=n.from,s=n.to;if(r[1]){let e=r[0].lastIndexOf(r[1]);i+=r[0].slice(e+r[1].length),o+=e;let t=o-s;t>0&&(i=r[0].slice(e-t,e)+i,o=s)}t.tr.insertText(i,o,s)}})}function wrappingInputRule(e){return new InputRule({find:e.find,handler:({state:t,range:n,match:r,chain:i})=>{let o=callOrReturn(e.getAttributes,void 0,r)||{},s=t.tr.delete(n.from,n.to),l=s.doc.resolve(n.from),d=l.blockRange(),c=d&&(0,a.nd)(d,e.type,o);if(!c)return null;if(s.wrap(d,c),e.keepMarks&&e.editor){let{selection:n,storedMarks:r}=t,{splittableMarks:i}=e.editor.extensionManager,o=r||n.$to.parentOffset&&n.$from.marks();if(o){let e=o.filter(e=>i.includes(e.type.name));s.ensureMarks(e)}}if(e.keepAttributes){let t="bulletList"===e.type.name||"orderedList"===e.type.name?"listItem":"taskList";i().updateAttributes(t,o).run()}let u=s.doc.resolve(n.from-1).nodeBefore;u&&u.type===e.type&&(0,a.Mn)(s.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(r,u))&&s.join(n.from-1)}})}let Mark=class Mark{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Mark(e)}configure(e={}){let t=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){let t=new Mark(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=callOrReturn(getExtensionField(t,"addOptions",{name:t.name})),t.storage=callOrReturn(getExtensionField(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){let{tr:n}=e.state,r=e.state.selection.$from,i=r.pos===r.end();if(i){let i=r.marks(),o=!!i.find(e=>(null==e?void 0:e.type.name)===t.name);if(!o)return!1;let s=i.find(e=>(null==e?void 0:e.type.name)===t.name);return s&&n.removeStoredMark(s),n.insertText(" ",r.pos),e.view.dispatch(n),!0}return!1}};let Node=class Node{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Node(e)}configure(e={}){let t=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){let t=new Node(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=callOrReturn(getExtensionField(t,"addOptions",{name:t.name})),t.storage=callOrReturn(getExtensionField(t,"addStorage",{name:t.name,options:t.options})),t}};let NodeView=class NodeView{constructor(e,t,n){this.isDragging=!1,this.component=e,this.editor=t.editor,this.options={stopEvent:null,ignoreMutation:null,...n},this.extension=t.extension,this.node=t.node,this.decorations=t.decorations,this.innerDecorations=t.innerDecorations,this.view=t.view,this.HTMLAttributes=t.HTMLAttributes,this.getPos=t.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var t,n,i,o,s,a,l;let{view:d}=this.editor,c=e.target,u=3===c.nodeType?null===(t=c.parentElement)||void 0===t?void 0:t.closest("[data-drag-handle]"):c.closest("[data-drag-handle]");if(!this.dom||(null===(n=this.contentDOM)||void 0===n?void 0:n.contains(c))||!u)return;let p=0,h=0;if(this.dom!==u){let t=this.dom.getBoundingClientRect(),n=u.getBoundingClientRect(),r=null!==(i=e.offsetX)&&void 0!==i?i:null===(o=e.nativeEvent)||void 0===o?void 0:o.offsetX,l=null!==(s=e.offsetY)&&void 0!==s?s:null===(a=e.nativeEvent)||void 0===a?void 0:a.offsetY;p=n.x-t.x+r,h=n.y-t.y+l}null===(l=e.dataTransfer)||void 0===l||l.setDragImage(this.dom,p,h);let m=this.getPos();if("number"!=typeof m)return;let f=r.qv.create(d.state.doc,m),g=d.state.tr.setSelection(f);d.dispatch(g)}stopEvent(e){var t;if(!this.dom)return!1;if("function"==typeof this.options.stopEvent)return this.options.stopEvent({event:e});let n=e.target,i=this.dom.contains(n)&&!(null===(t=this.contentDOM)||void 0===t?void 0:t.contains(n));if(!i)return!1;let o=e.type.startsWith("drag"),s="drop"===e.type,a=["INPUT","BUTTON","SELECT","TEXTAREA"].includes(n.tagName)||n.isContentEditable;if(a&&!s&&!o)return!0;let{isEditable:l}=this.editor,{isDragging:d}=this,c=!!this.node.type.spec.draggable,u=r.qv.isSelectable(this.node),p="copy"===e.type,h="paste"===e.type,m="cut"===e.type,f="mousedown"===e.type;if(!c&&u&&o&&e.preventDefault(),c&&o&&!d)return e.preventDefault(),!1;if(c&&l&&!d&&f){let e=n.closest("[data-drag-handle]"),t=e&&(this.dom===e||this.dom.contains(e));t&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!d&&!s&&!p&&!h&&!m&&(!f||!u)}ignoreMutation(e){if(!this.dom||!this.contentDOM)return!0;if("function"==typeof this.options.ignoreMutation)return this.options.ignoreMutation({mutation:e});if(this.node.isLeaf||this.node.isAtom)return!0;if("selection"===e.type)return!1;if(this.dom.contains(e.target)&&"childList"===e.type&&(isiOS()||"Android"===navigator.platform||/android/i.test(navigator.userAgent))&&this.editor.isFocused){let t=[...Array.from(e.addedNodes),...Array.from(e.removedNodes)];if(t.every(e=>e.isContentEditable))return!1}return this.contentDOM===e.target&&"attributes"===e.type||!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:t})=>{let n=this.getPos();return"number"==typeof n&&(t.setNodeMarkup(n,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){let e=this.getPos();if("number"!=typeof e)return;let t=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:t})}};function markPasteRule(e){return new PasteRule({find:e.find,handler:({state:t,range:n,match:r,pasteEvent:i})=>{let o=callOrReturn(e.getAttributes,void 0,r,i);if(!1===o||null===o)return null;let{tr:s}=t,a=r[r.length-1],l=r[0],d=n.to;if(a){let r=l.search(/\S/),i=n.from+l.indexOf(a),c=i+a.length,u=getMarksBetween(n.from,n.to,t.doc).filter(t=>{let n=t.mark.type.excluded;return n.find(n=>n===e.type&&n!==t.mark.type)}).filter(e=>e.to>i);if(u.length)return null;c<n.to&&s.delete(c,n.to),i>n.from&&s.delete(n.from+r,i),d=n.from+r+a.length,s.addMark(n.from+r,d,e.type.create(o||{})),s.removeStoredMark(e.type)}}})}function escapeForRegEx(e){return e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function nodePasteRule(e){return new PasteRule({find:e.find,handler({match:t,chain:n,range:r,pasteEvent:i}){let o=callOrReturn(e.getAttributes,void 0,t,i),s=callOrReturn(e.getContent,void 0,o);if(!1===o||null===o)return null;let a={type:e.type.name,attrs:o};s&&(a.content=s),t.input&&n().deleteRange(r).insertContentAt(r.from,a)}})}}}]);