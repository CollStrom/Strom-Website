"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14524],{923376:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ANNOTATION_PATH_PUBLIC_PROPERTIES=void 0;var o,i=(o=r(298784))&&o.__esModule?o:{default:o};let n=["scene","numFrames","props","version"];t.ANNOTATION_PATH_PUBLIC_PROPERTIES=n,t.default=class{toJSON(){return i.default.pick(this,this._publicProperties)}isStatic(e){return void 0!==this.props.static[e]}isPerFrame(e){return void 0!==this.props.perFrame[e]}getProp(e,t,r){if(this.isStatic(e))return this.getStaticProp(e);if(this.isPerFrame(e))return this.getPropAtFrame(e,t,r);if(void 0!==r)return r;throw Error(`Path does not have property: ${e}`)}getPropAtFrame(e,t,r){if(!this.isPerFrame(e))throw Error(`GPAF property is not per-frame: ${e}`);return void 0===this.props.perFrame[e][t]&&void 0!==r?r:this.props.perFrame[e][t]}getStaticProp(e){if(!this.isStatic(e))throw Error(`GSP property is not static: ${e}`);return this.props.static[e]}getEntireProp(e){return this.isStatic(e)?this.getStaticProp(e):this.isPerFrame(e)?this.props.perFrame[e]:void 0}setPropAtFrame(e,t,r){if(!this.isPerFrame(e))throw Error(`SPAF property is not per-frame: ${e}`);let o=this.props.perFrame[e][t];return this.props.perFrame[e][t]=r,o}setStaticProp(e,t){if(!this.isStatic(e))throw Error(`SSP property is not static: ${e}`);let r=this.props.static[e];return this.props.static[e]=t,r}setEntirePerFrameProp(e,t){if(!this.isPerFrame(e))throw Error(`SEPFP property is not per-frame: ${e}`);let r=this.props.perFrame[e];return this.props.perFrame[e]=t,r}makeStatic(e,t){let r;return this.isPerFrame(e)&&(r=this.props.perFrame[e],delete this.props.perFrame[e]),this.props.static[e]=t,r}makePerFrame(e,t){let r;return this.isStatic(e)&&(r=this.props.static[e],delete this.props.static[e]),this.props.perFrame[e]=Array(this.numFrames),this.props.perFrame[e].fill(t),r}deleteAtFrame(e){for(let t of Object.keys(this.props.perFrame))delete this.props.perFrame[t][e]}deleteAllProps(){this.props={static:{},perFrame:{}}}setEntireProps(e){this.props=e}setNumFrames(e){this.numFrames=e}deleteStaticProp(e){delete this.props.static[e]}deleteEntirePerFrameProp(e){delete this.props.perFrame[e]}hasProp(e,t){let r=t??this.isStatic(e);if(r){let t=this.getStaticProp(e);return null!=t}return!!this.isPerFrame(e)}hasPropAtFrame(e,t){if(!this.isPerFrame(e))return!1;let r=this.getPropAtFrame(e,t);return null!=r}hasStaticProp(e){if(!this.isStatic(e))return!1;let t=this.getStaticProp(e);return null!=t}constructor(e,t=n){i.default.defaults(this,i.default.pick(e,t),{version:-1,props:{static:{},perFrame:{}}}),this._publicProperties=t}}},914524:function(e,t,r){t.rm=function({perAnnotationErrors:e,nextAnnotations:t,previousAnnotations:r,baseAnnotations:o}){if(!r)return e;let i=e;return r.forEach(e=>{let r=a.getAnnotationId(e),u=t.find(e=>a.getAnnotationId(e)===r),s=o?.find(e=>a.getAnnotationId(e)===r);u?i=s?updatePerAnnotationErrors({perAnnotationErrors:i,taskAnnotation:s,auditAnnotation:u}):addLabelsToPerAnnotationErrors({perAnnotationErrors:i,auditAnnotation:u}):(i=i.filter(e=>e.annotationId!==r||"missing"!==e.errorType),s&&i.push({annotationId:r,severity:n.ErrorSeverityLevel.Critical,errorType:"extraneous",comment:"",isFixed:!0,taskLabel:s?.label,taskBox:getBox2D(s)}))}),i},t.e0=addLabelsToPerAnnotationErrors,t.wo=function(e,t,r){let o=e.filter(e=>!(t.has(e.annotationId)&&e.frameNum===r)),i=e.map(e=>e.annotationId);return t.forEach(e=>{i.includes(e)||o.push({annotationId:e,severity:n.ErrorSeverityLevel.Critical,errorType:"extraneous",comment:"",isFixed:!0,frameNum:r})}),o},t.E4=function(e,t,r,o){if(t.length!==r.length||r.length!==o.length)throw Error("Invalid lengths for audit annotations, task annotations, and frameNums");let i=e;for(let e=0;e<o.length;e++)i=updatePerAnnotationErrors({perAnnotationErrors:i,auditAnnotation:t[e],taskAnnotation:r[e],frameNum:o[e]});return i},t.IG=getBox2D,t.VA=function(e,t,r){let o=function(e,t){if(e===p.TaskType.SegmentAnnotation){let e=u.default.get(t,"labelMapping",{});return u.default.flatMap(u.default.values(e),e=>u.default.isArray(e)?u.default.map(e,e=>m.getLabelId(e.index)):e.numPixels?[m.getLabelId(e.index)]:[])}if([...d.twoDSingleFrameTypes,p.TaskType.DocumentTranscription,p.TaskType.DocumentModel].includes(e)){let e=u.default.get(t,"annotations",[]);return u.default.map(e,e=>a.getAnnotationId(e))}if(t?.annotationPaths){let e=t.annotationPaths??[];return u.default.map(e,e=>a.getAnnotationId(e))}return[]}(e,r),i=t.map(e=>e.annotationId),n=t.filter(e=>!e.ignored).map(e=>e.annotationId),s=u.default.uniq([...o,...i]).length,l=u.default.uniq(i).length,f=u.default.uniq([...o,...n]).length,c=u.default.uniq(n).length,y=t.filter(e=>e.disputeStatus),h=u.default.uniq(y.filter(e=>"no_dispute"!==e.disputeStatus).map(e=>e.annotationId)).length;return{numAnnotations:s,numErrors:l,numDisputes:u.default.isEmpty(y)?void 0:h,numNonIgnoredAnnotations:f,numNonIgnoredErrors:c}},t._I=function(e,t,r,o){let i=e.filter(e=>!e.parent),n=t.filter(e=>!e.parent),a=findMissingErrorsInAnnotations(i,n,r,o),s=function(e,t,r,o){let i=u.default.map(findMissingErrorsInAnnotations(t,e,o,r),e=>({...e,errorType:"extraneous"}));return i}(i,n,r,o),l=function(e,t,r,o){let i=u.default.compact(u.default.intersection(u.default.map(e,"uuid"),u.default.map(t,"uuid"))),n=u.default.keyBy(e,"uuid"),a=u.default.keyBy(t,"uuid"),s=u.default.compact(u.default.intersection(u.default.map(r,"id"),u.default.map(o,"id"))),l=u.default.keyBy(r,"id"),d=u.default.keyBy(o,"id"),p=u.default.reduce(i,(e,t)=>updatePerAnnotationErrors({perAnnotationErrors:e,auditAnnotation:a[t],taskAnnotation:n[t]}),[]),m=u.default.reduce(s,(e,t)=>updatePerAnnotationErrors({perAnnotationErrors:e,auditAnnotation:{uuid:d[t].id,attributes:d[t].attributes??{},label:d[t].label},taskAnnotation:{uuid:l[t].id,attributes:l[t].attributes??{},label:l[t].label}}),[]);return p.concat(m)}(i,n,r,o);return u.default.concat(a,s,l)},t.Wv=function(e={},t={}){let r=u.default.uniq([...u.default.keys(e),...u.default.keys(t)]),o=r.filter(r=>!u.default.isEqual(e[r],t[r]));return o.map(e=>({annotationId:"global",errorType:"attribute",attribute:e,severity:n.ErrorSeverityLevel.Default,comment:"",isFixed:!0}))};var o,i=r(308408),n=r(952328),a=r(808704),u=(o=r(298784))&&o.__esModule?o:{default:o},s=r(750364),l=r(230046),d=r(599789),p=r(167469),m=r(516812);function updatePerAnnotationErrors({perAnnotationErrors:e,auditAnnotation:t,taskAnnotation:r,frameNum:o}){let[i,d]=u.default.partition(e,e=>e.annotationId===a.getAnnotationId(t)),p=function(e,t,r){let o=[...function(e,t){if(!e.geometry||e.geometry!==t.geometry)return[];let r=l.getConverterForGeometry(e.geometry);return r.labelerFormsEqual(e,t)?[]:[{annotationId:a.getAnnotationId(t),errorType:"geometry",severity:n.ErrorSeverityLevel.Default,comment:""}]}(e,t),...t.label===e.label?[]:[{annotationId:a.getAnnotationId(t),errorType:"class",severity:n.ErrorSeverityLevel.Default,comment:""}],...function(e,t){let r=u.default.uniq([...u.default.keys(e.attributes),...u.default.keys(t.attributes)]),o=r.filter(r=>!u.default.isEqual(u.default.get(e.attributes,r),u.default.get(t.attributes,r)));return o.map(e=>({annotationId:a.getAnnotationId(t),errorType:"attribute",attribute:e,severity:n.ErrorSeverityLevel.Default,comment:""}))}(e,t)];return o.map(o=>({...o,isFixed:!0,auditLabel:e.label,taskLabel:t.label,frameNum:r?.frameNum,auditBox:getBox2D(e),taskBox:getBox2D(t)}))}(t,r,{frameNum:o});u.default.isNil(o)||p.forEach(e=>e.frameNum=o);let m=s.mergeFixedErrors(i,p,{frameNum:o});return[...d,...m]}function addLabelsToPerAnnotationErrors({perAnnotationErrors:e,auditAnnotation:t,taskAnnotation:r}){let[o,i]=u.default.partition(e,e=>e.annotationId===a.getAnnotationId(t));return[...i,...o.map(e=>({...e,isFixed:!0,auditLabel:t.label,taskLabel:r?.label,auditBox:getBox2D(t),taskBox:getBox2D(r)}))]}let f=["width","height","left","top"],c=["rotation"];function getBox2D(e){if(!e)return;let t=function(e){if(!e.geometry)return e;let t=l.getConverterForGeometry(e.geometry);return t.toApiFormat(e)}(e);if(t.geometry===i.AnnotationGeometry.Box&&f.every(e=>u.default.isNumber(u.default.get(t,e))))return u.default.pick(t,[...f,...c])}function findMissingErrorsInAnnotations(e,t,r,o){let i=u.default.map(u.default.differenceBy(t,e,"uuid"),e=>{let t={annotationId:e.uuid||"",severity:n.ErrorSeverityLevel.Critical,errorType:"missing",comment:"",isFixed:!0,auditLabel:e.label,auditBox:getBox2D(e)};return t}),a=r&&o?u.default.concat(u.default.map(u.default.differenceBy(o,r,"id"),e=>{let t={annotationId:e.id||"",severity:n.ErrorSeverityLevel.Critical,errorType:"missing",comment:"",isFixed:!0,auditLabel:e.label};return t})):[];return i.concat(a)}},750364:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getLastWorkerResponse=function(e,t){if(e&&!e.is_customer_fix)return e;let r=(t??[]).filter(e=>!e.is_customer_fix);if(r.length)return n.default.last(r)},t.isDuplicateError=isDuplicateError,t.mergeFixedErrors=function(e,t,r){let o=t.filter(t=>!e.some(e=>isDuplicateError(t,e))),i=e.filter(e=>e.frameNum!==r?.frameNum||!function(e,t){let r=!t.some(t=>isDuplicateError(e,t));return!!e.isFixed&&r}(e,t));return i.concat(o)},t.auditPerAnnotationCustomers=t.auditPerAnnotationTaskTypes=t.auditGridModeTaskTypes=void 0;var o=r(599789),i=r(167469),n=_interopRequireDefault(r(298784)),a=_interopRequireDefault(r(210918));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let u=[i.TaskType.Categorization];t.auditGridModeTaskTypes=u;let s=[...o.twoDTypes,i.TaskType.DocumentTranscription,i.TaskType.LidarTopdown];t.auditPerAnnotationTaskTypes=s;let l=[a.default.Pegasus,a.default.Comet,"5d13f585be01b2049e255001"];function isDuplicateError(e,t){return e.annotationId===t.annotationId&&e.errorType===t.errorType&&e.attribute===t.attribute&&e.frameNum===t.frameNum}t.auditPerAnnotationCustomers=l},983736:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.BoxConverter=void 0;var o,i=(o=r(298784))&&o.__esModule?o:{default:o},n=r(60271),a=r(308408);t.BoxConverter={toLabelerFormat(e,t=!1){let r={...i.default.omit(e,["left","top"]),x:e.left,y:e.top};return t&&(r.geometry=a.AnnotationGeometry.Box,delete r.type),delete r.vertices,r},toApiFormat(e,t=!1,r){if(!e)return null;let o=!!r?.geometries?.box?.integer_pixels,u={...i.default.omit(e,["x","y","height","width"]),left:o?Math.round(e.x):e.x,top:o?Math.round(e.y):e.y,height:o?Math.round(e.height):e.height,width:o?Math.round(e.width):e.width};return t&&(u.type=a.AnnotationGeometry.Box,delete u.geometry),i.default.isNil(u.rotation)||(u.vertices=n.getRotatedVertices({height:u.height,width:u.width,rotation:u.rotation,center:{x:u.left+u.width/2,y:u.top+u.height/2},returnMidpoints:!1})),u},toPerFrameFormat(e,t){let r=!!t?.geometries?.box?.integer_pixels;return{left:e.map(e=>e&&(r?Math.round(e.x):e.x)),top:e.map(e=>e&&(r?Math.round(e.y):e.y)),width:e.map(e=>e&&(r?Math.round(e.width):e.width)),height:e.map(e=>e&&(r?Math.round(e.height):e.height)),rotation:e.map(e=>e&&(e.rotation||0))}},fromPerFrameFormat:(e,t)=>i.default.isNil(e.left[t])||i.default.isNil(e.top[t])||i.default.isNil(e.width[t])||i.default.isNil(e.height[t])?{}:{x:e.left[t],y:e.top[t],width:e.width[t],height:e.height[t],...i.default.isNil(e.rotation[t])?{}:{rotation:e.rotation[t]}},labelerFormsEqual(e,t){let r=Math.round(e.x)===Math.round(t.x)&&Math.round(e.y)===Math.round(t.y)&&Math.round(e.width)===Math.round(t.width)&&Math.round(e.height)===Math.round(t.height);return(e.rotation||t.rotation)&&(r=r&&Math.round(e.rotation??1/0)===Math.round(t.rotation??1/0)),r}}},28202:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.annotationsToCuboids=function(e){return e.map(e=>e.geometry&&e.geometry===n.AnnotationGeometry.Ellipse?{...a.EllipseConverter.toLabelerFormat(e),uuid:e.uuid||i.default.v4()}:e.geometry&&e.geometry!==n.AnnotationGeometry.Cuboid?{...e,uuid:e.uuid||i.default.v4()}:u.toLabelerFormat(e))},t.CuboidConverter=void 0;var o=_interopRequireDefault(r(298784)),i=_interopRequireDefault(r(711719)),n=r(308408),a=r(479935);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let makeEdge=(e,t,r)=>({type:"edge",x1:e.x,y1:e.y,x2:t.x,y2:t.y,description:r}),u={toLabelerFormat(e,t){let r;let vertex=t=>{let r=e.vertices.filter(e=>e.description===t);return r.length>0?r[0]:null},i=vertex(n.CuboidVertexDesc.FaceTopLeft),a=vertex(n.CuboidVertexDesc.FaceBottomRight),[u,s]=[i.x,i.y],[l,d]=[a.x,a.y],p=vertex(n.CuboidVertexDesc.SideTopCorner),m=vertex(n.CuboidVertexDesc.SideBottomCorner);if(p&&m){let e=p.x,[t,o]=[p.y,m.y];r={ex:e,ey1:t,ey2:o}}let f={...o.default.omit(e,["edges","extra","pts2d","pts3d"]),face:{x1:u,y1:s,x2:l,y2:d},edge:r};return t&&(f.geometry=n.AnnotationGeometry.Cuboid,delete f.type),f},toApiFormat(e,t){if(!e||!e.face)return null;let r=e.label,o=e.attributes,{x1:i,y1:a,x2:u,y2:s}=e.face;[i,u]=[Math.min(i,u),Math.max(i,u)],[a,s]=[Math.min(a,s),Math.max(a,s)];let l={type:"vertex",x:i,y:a,description:n.CuboidVertexDesc.FaceTopLeft},d={type:"vertex",x:i,y:s,description:n.CuboidVertexDesc.FaceBottomLeft},p={type:"vertex",x:u,y:a,description:n.CuboidVertexDesc.FaceTopRight},m={type:"vertex",x:u,y:s,description:n.CuboidVertexDesc.FaceBottomRight},f=[l,d,p,m],c=[makeEdge(l,p,n.CuboidEdgeDesc.FaceTop),makeEdge(p,m,n.CuboidEdgeDesc.FaceRight),makeEdge(m,d,n.CuboidEdgeDesc.FaceBottom),makeEdge(d,l,n.CuboidEdgeDesc.FaceLeft)],y=c,h=[];if(e.edge){let{ex:t,ey1:r,ey2:o}=e.edge;[r,o]=[Math.min(r,o),Math.max(r,o)];let a={type:"vertex",x:t,y:r,description:n.CuboidVertexDesc.SideTopCorner},s={type:"vertex",x:t,y:o,description:n.CuboidVertexDesc.SideBottomCorner},c=(i+u)/2;h=t<c?[makeEdge(l,a,n.CuboidEdgeDesc.SideTop),makeEdge(a,s,n.CuboidEdgeDesc.SideBack),makeEdge(s,d,n.CuboidEdgeDesc.SideBottom),makeEdge(d,l)]:[makeEdge(p,a,n.CuboidEdgeDesc.SideTop),makeEdge(a,s,n.CuboidEdgeDesc.SideBack),makeEdge(s,m,n.CuboidEdgeDesc.SideBottom),makeEdge(m,p)],f=f.concat([a,s]),y=y.concat(h.slice(0,3))}let g={...e.is_base_annotation?{is_base_annotation:!0}:{},geometry:n.AnnotationGeometry.Cuboid,label:r,attributes:o,vertices:f,edges:y,uuid:e.uuid,extra:{face:c,side:h},metadata:e.metadata,...e.scenarioParams?{scenarioParams:e.scenarioParams}:{}};return t&&(g.type=n.AnnotationGeometry.Cuboid,delete g.geometry),g},toPerFrameFormat(e){let t=e.map(e=>e&&this.toApiFormat(e));return{vertices:t.map(e=>e&&e.vertices),edges:t.map(e=>e?.edges?e.edges:null)}},fromPerFrameFormat(e,t){if(!e.vertices[t]||!e.edges[t])return{};let r={vertices:e.vertices[t],edges:e.edges[t]},o=this.toLabelerFormat(r);return{face:o.face,edge:o.edge}},labelerFormsEqual:(e,t)=>!0};t.CuboidConverter=u},479935:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.EllipseConverter=void 0;var o,i=(o=r(298784))&&o.__esModule?o:{default:o},n=r(60271),a=r(308408);let u={toLabelerFormat(e,t){let r=e.vertices.map(e=>[e.x,e.y]),o=[(r[0][0]+r[2][0])/2,(r[0][1]+r[2][1])/2],n=r.map(e=>[e[0]-o[0],e[1]-o[1]]),u=Math.atan2(n[1][1],n[1][0]),s=[Math.cos(u),1*Math.sin(u)],l=[-1*Math.sin(u),Math.cos(u)],d=n.map(e=>{let t=s[0]*e[0]+s[1]*e[1],r=l[0]*e[0]+l[1]*e[1];return[t,r]}),p={...i.default.omit(e,["vertices"]),center:o,rotation:u,width:d[1][0]-d[3][0],height:d[2][1]-d[0][1]};return t&&(p.geometry=a.AnnotationGeometry.Ellipse,delete p.type),p},toApiFormat(e,t){if(!e)return null;let r=n.getRotatedVertices({height:e.height,width:e.width,rotation:e.rotation,center:{x:e.center[0],y:e.center[1]},returnMidpoints:!0}),o={...i.default.omit(e,["center","rotation","width","height"]),vertices:r};return t&&(o.type=a.AnnotationGeometry.Ellipse,delete o.geometry),o},toPerFrameFormat(e){let t=e.map(e=>e&&u.toApiFormat(e));return{vertices:t.map(e=>e&&e.vertices)}},fromPerFrameFormat(e,t){if(!e.vertices[t])return{};let r={vertices:e.vertices[t]},o=this.toLabelerFormat(r);return{center:o.center,rotation:o.rotation,width:o.width,height:o.height}},labelerFormsEqual:(e,t)=>Math.round(e.width)===Math.round(t.width)&&Math.round(e.rotation)===Math.round(t.rotation)&&Math.round(e.height)===Math.round(t.height)&&i.default.isEqualWith(e.center,t.center,(e,t)=>Math.round(e.x)===Math.round(t.y))};t.EllipseConverter=u},176665:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.LineConverter=void 0;var o=r(308408),i=r(60271);t.LineConverter={toLabelerFormat(e,t){let r={...e};return t&&(r.geometry=o.AnnotationGeometry.Line,delete r.type),r},toApiFormat(e,t){if(!e)return null;let r={...e};return t&&(r.type=o.AnnotationGeometry.Line,delete r.geometry),r},toPerFrameFormat:e=>({vertices:e.map(e=>e&&e.vertices)}),fromPerFrameFormat:(e,t)=>e.vertices[t]?{vertices:e.vertices[t]}:{},labelerFormsEqual:(e,t)=>i.orderedPointArraysEqual(e.vertices,t.vertices)}},752696:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.PointConverter=void 0;var o,i=(o=r(298784))&&o.__esModule?o:{default:o},n=r(308408);t.PointConverter={toLabelerFormat(e,t){let r={...e};return t&&(r.geometry=n.AnnotationGeometry.Point,delete r.type),r},toApiFormat(e,t){if(!e)return null;let r={...e};return t&&(r.type=n.AnnotationGeometry.Point,delete r.geometry),r},toPerFrameFormat:e=>({x:e.map(e=>e&&e.x),y:e.map(e=>e&&e.y)}),fromPerFrameFormat:(e,t)=>i.default.isNil(e.x[t])||i.default.isNil(e.y[t])?{}:{x:e.x[t],y:e.y[t]},labelerFormsEqual:(e,t)=>Math.round(e.x)===Math.round(t.x)&&Math.round(e.y)===Math.round(t.y)}},413487:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.PolygonConverter=void 0;var o=r(308408),i=r(60271);t.PolygonConverter={toLabelerFormat(e,t){let r={...e};return t&&(r.geometry=o.AnnotationGeometry.Polygon,delete r.type),r},toApiFormat(e,t){if(!e)return null;let r={...e};return t&&(r.type=o.AnnotationGeometry.Polygon,delete r.geometry),r},toPerFrameFormat(e){let t=!1,r=e.map(e=>e?.multiple_polygon_vertices?(t=!0,e?.multiple_polygon_vertices):null);return{vertices:e.map(e=>e&&e.vertices),...t?{multiple_polygon_vertices:r}:{}}},fromPerFrameFormat(e,t){let r;return e.vertices[t]?(e.multiple_polygon_vertices?.[t]&&(r=e.multiple_polygon_vertices[t]),{vertices:e.vertices[t],...r?{multiple_polygon_vertices:r}:{}}):{}},labelerFormsEqual:(e,t)=>i.orderedPointArraysEqual(e.vertices,t.vertices)}},95930:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.expandGroups=function(e,t){let r=o.default.groupBy(e,t),n=[];return o.default.each(o.default.keys(r),e=>{let a=r[e][0];n.push(a),r[e].length>1&&o.default.each(r[e].slice(1),r=>{let o=i.default.v4(),a={...r,parent:e,[t]:o};n.push(a)})}),n},t.combineGroups=function(e,t=!1){let r=o.default.map(e,r=>{if(r.parent){let i=o.default.find(e,e=>e.uuid===r.parent),n=t?r.uuid:i.uuid,a=t?{parent:r.parent}:{},u=o.default.map(r.frames,(e,t)=>{if(!e)return null;let r=o.default.get(i,["frames",t,"attributes"]);return{uuid:n,vertices:e.vertices,attributes:r,geometry:e.geometry}});return{uuid:n,label:i.label,attributes:i.attributes,...r.geometry?{geometry:r.geometry}:{},...r.type?{type:r.type}:{},...r.vertices?{vertices:r.vertices}:{},...r.frames?{frames:u}:{},...r.is_base_annotation?{is_base_annotation:!0}:{},...r.scenarioParams?{scenarioParams:r.scenarioParams}:{},...a}}return r});return r},t.getGroup=t.isFragment=void 0;var o=_interopRequireDefault(r(298784)),i=_interopRequireDefault(r(711719));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}t.isFragment=e=>!!e.parent,t.getGroup=(e,t)=>{let r=o.default.find(t,t=>t.uuid===e);if(!r||!r.parent)return r;let i=o.default.find(t,e=>e.uuid===r.parent);return i||r}},230046:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getConverterForGeometry=getConverterForGeometry,t.convertAnnotations=function(e,t){let r=e.map(e=>{let r=getConverterForGeometry(e.type||t);return r.toLabelerFormat(e,!0)});return d.expandGroups(r,"uuid")},t.convertVideoAnnotations=function(e,t){return p.responseToLabelerFormat(e,t)};var o=r(308408),i=r(752696),n=r(176665),a=r(983736),u=r(479935),s=r(28202),l=r(413487),d=r(95930),p=r(783710),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};o.get||o.set?Object.defineProperty(t,r,o):t[r]=e[r]}}return t.default=e,t}(r(95930));Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))});let f={[o.AnnotationGeometry.Point]:i.PointConverter,[o.AnnotationGeometry.Line]:n.LineConverter,[o.AnnotationGeometry.Box]:a.BoxConverter,[o.AnnotationGeometry.Ellipse]:u.EllipseConverter,[o.AnnotationGeometry.Cuboid]:s.CuboidConverter,[o.AnnotationGeometry.Polygon]:l.PolygonConverter,[o.AnnotationGeometry.ExtremalPoints]:void 0,[o.AnnotationGeometry.LidarCuboid]:void 0,[o.AnnotationGeometry.LidarPoint]:void 0};function getConverterForGeometry(e){let t=f[e];if(void 0===t)throw Error(`No converter found for type: ${e}`);return t}},516812:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getLabelId=getLabelId,t.updatePerLabelErrors=function(e,t,r,o,u=!1){let s=n.default.groupBy(e,"annotationId"),l=new Map;for(let e of iterLabelInstances(t)){let t=getLabelId(e.index);l.set(t,e)}let d=new Map;for(let e of iterLabelInstances(r)){let t=getLabelId(e.index);d.set(t,e)}let p=new Map;for(let e of iterLabelInstances(o??{})){let t=getLabelId(e.index);p.set(t,e)}let m=n.default.uniq([...l.keys(),...d.keys()]);return n.default.flatMap(n.default.uniq(m),e=>{let t=s[e]??[],r=l.get(e),m=d.get(e),f=p.get(e),c=wasLabelUntouched(r,f,o);return function(e,t,r,o,u){if(o)return e;let s=function(e,t,r){let o=[...e?.numPixels&&!t?.numPixels||e&&!t?[{annotationId:getLabelId(e.index),errorType:r?"missing":"geometry",severity:i.ErrorSeverityLevel.Critical,comment:""}]:[],...!e?.numPixels&&t?.numPixels?[{annotationId:getLabelId(t.index),errorType:r?"extraneous":"geometry",severity:i.ErrorSeverityLevel.Critical,comment:""}]:[],...e?.numPixels&&t?.numPixels&&e.numPixels!==t.numPixels?[{annotationId:getLabelId(e.index),errorType:"geometry",severity:i.ErrorSeverityLevel.Default,comment:""}]:[],...function(e,t){if(!e||!t)return[];let r=n.default.uniq([...n.default.keys(e.attributes),...n.default.keys(t.attributes)]),o=r.filter(r=>!n.default.isEqual(e.attributes?.[r],t.attributes?.[r]));return o.map(t=>({annotationId:getLabelId(e.index),errorType:"attribute",attribute:t,severity:i.ErrorSeverityLevel.Default,comment:""}))}(e,t)];return o.map(r=>({...r,isFixed:!0,auditLabel:e?.label,taskLabel:t?.label}))}(t,r,u);return a.mergeFixedErrors(e,s)}(t,r,m,c,u)})};var o,i=r(952328),n=(o=r(298784))&&o.__esModule?o:{default:o},a=r(750364);function getLabelId(e){return`label-${e}`}let wasLabelUntouched=(e,t,r)=>{if(n.default.isNil(r))return!0;if(e?.numPixels!==t?.numPixels)return!1;let o=n.default.uniq([...n.default.keys(e?.attributes),...n.default.keys(t?.attributes)]),i=o.filter(r=>!n.default.isEqual(e?.attributes?.[r],t?.attributes?.[r]));return!(i.length>0)};function*iterLabelInstances(e){for(let[t,r]of Object.entries(e))if(n.default.isArray(r))for(let e of r)yield{...e,label:t};else yield{...r,label:t}}},783710:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAnnotationFromAnnotationPath=function(e,t,r){let o=e.find(e=>t===s.getAnnotationId(e));if(!o)return;let i=o.frames[r];if(i)return i},t.default=t.responseToLabelerFormat=t.submissionToResponseFormat=t.labelerToSubmissionFormat=t.VIDEO_ANNOTATION_PATH_PUBLIC_PROPERTIES=void 0;var o=_interopRequireDefault(r(298784)),i=_interopRequireDefault(r(711719)),n=_interopRequireDefault(r(923376)),a=r(308408),u=r(230046),s=r(808704);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let l=["scene","annotationId","numFrames","type","props","version","scenarioParams"];t.VIDEO_ANNOTATION_PATH_PUBLIC_PROPERTIES=l,t.labelerToSubmissionFormat=(e,t,r,i)=>{let n=new Set(o.default.map(r,"uuid")),a=o.default.filter(r,e=>!e.parent||e.parent&&n.has(e.parent)),s=u.combineGroups(a),l=s.map(r=>{let o=i||t.attachments.length,n=r.geometry,a=u.getConverterForGeometry(n);return{scene:e,numFrames:o,annotationId:r.uuid,type:r.geometry,props:{static:{label:r.label,is_base_annotation:r.is_base_annotation,...r.corruption?{corruption:r.corruption}:{}},perFrame:{attributes:r.attributes,...a.toPerFrameFormat(r.frames,t)}},...r.scenarioParams?{scenarioParams:r.scenarioParams}:{}}});return l};let submissionToResponseFormat=async(e,t,r)=>{let i=o.default.map(t.paths,e=>{var t;return t=VideoAnnotationPath.fromJSON(e),o.default.map(o.default.range(t.numFrames),e=>(function(e,t){let r=VideoAnnotationPath.fromJSON(e);if(!r.existsAtFrame(t))return;let o={uuid:r.annotationId,type:r.type,attributes:r.getProp("attributes",t),label:void 0,is_base_annotation:void 0,corruption:void 0};if(r.type===a.AnnotationGeometry.Cuboid)o.edges=r.getProp("edges",t),o.vertices=r.getProp("vertices",t);else if(r.type===a.AnnotationGeometry.Polygon||r.type===a.AnnotationGeometry.Line||r.type===a.AnnotationGeometry.Ellipse){if(o.vertices=r.getProp("vertices",t),r.isPerFrame("multiple_polygon_vertices")){let e=r.getProp("multiple_polygon_vertices",t);e&&(o.multiple_polygon_vertices=e)}}else r.type===a.AnnotationGeometry.Point?(o.x=r.getProp("x",t),o.y=r.getProp("y",t)):(o.top=r.getProp("top",t),o.left=r.getProp("left",t),o.height=r.getProp("height",t),o.width=r.getProp("width",t),e.props.perFrame.rotation?.[t]&&(o.rotation=r.getProp("rotation",t)));try{o.is_base_annotation=r.getProp("is_base_annotation",t)}catch(e){if("Path does not have property: is_base_annotation"!==e.message)throw e}try{o.label=r.getProp("label",t)}catch(e){if("Path does not have property: label"!==e.message)throw e}let i=r.getProp("corruption",t,null);i&&(o.corruption=i);let n=r.scenarioParams;return n&&(o.scenarioParams=r.scenarioParams),o})(t,e))}),n=e.params.attachments?.length,u=o.default.max(i.map(e=>e.length));if(r&&n!==u){let t={subtaskNumFrames:n,annotationNumFrames:u,id:e._id};r.info("Response annotations snapshot",JSON.stringify(t))}let s=o.default.map(o.default.range(0,Math.max(n??0,u??0)),e=>{let t=[];for(let r of i)r[e]&&t.push(r[e]);return{annotations:t}});return s};t.submissionToResponseFormat=submissionToResponseFormat,t.responseToLabelerFormat=(e,t)=>{let r={},o=[];return e.forEach(({annotations:e},n)=>{let a=new Set;e.forEach(e=>{let s;let{label:l,type:d,scenarioParams:p,corruption:m}=e,f=e.uuid;a.has(f)&&(s=f,f=i.default.v4()),a.add(f);let c=d||t,y=u.getConverterForGeometry(c);f in r||(r[f]=o.length,o.push({uuid:f,label:l,frames:[],attributes:[],is_base_annotation:!!e.is_base_annotation,geometry:c,...s?{parent:s}:{},...p?{scenarioParams:p}:{},...m?{corruption:m}:{}}));let h=r[f];o[h].frames[n]={...y.toLabelerFormat(e),uuid:f,is_base_annotation:!!e.is_base_annotation,attributes:e.attributes,geometry:c,...s?{parent:s}:{}},o[h].attributes[n]=Object.assign({},e.attributes)})}),o};let VideoAnnotationPath=class VideoAnnotationPath extends n.default{static fromJSON(e){return new VideoAnnotationPath(e)}existsAtFrame(e){return this.type===a.AnnotationGeometry.Cuboid?o.default.every(["edges","vertices"].map(t=>this.hasPropAtFrame(t,e))):this.type===a.AnnotationGeometry.Point?o.default.every(["x","y"].map(t=>this.hasPropAtFrame(t,e))):this.type===a.AnnotationGeometry.Polygon||this.type===a.AnnotationGeometry.Line||this.type===a.AnnotationGeometry.Ellipse?o.default.every(["vertices"].map(t=>this.hasPropAtFrame(t,e))):o.default.every(["width","height","left","top"].map(t=>this.hasPropAtFrame(t,e)))}constructor(e){super(e,l)}};t.default=VideoAnnotationPath}}]);