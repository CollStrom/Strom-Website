(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42438],{635384:function(o,a,s){"use strict";let c,g;s.d(a,{u:function(){return Modal}});var k,A,x,P,w,F=s(824246),R=s(710019),D=s(827378),G=s.t(D,2),B=s(814782),W=s(955098),z=s(506463),V=s(672505),U=s(885443),K=s(262506),Y=s(948985),$=s(308061),X=s(433210),Z=s(851858),J=s(580318),ee=s(765238),et=s(230907),er=s(601076),en=s(455527),ei=s(534946),eo=s(741721),ea=((k=ea||{})[k.None=1]="None",k[k.InitialFocus=2]="InitialFocus",k[k.TabLock=4]="TabLock",k[k.FocusLock=8]="FocusLock",k[k.RestoreFocus=16]="RestoreFocus",k[k.All=30]="All",k);let es=Object.assign((0,W.yV)(function(o,a){let s=(0,D.useRef)(null),c=(0,z.T)(s,a),{initialFocus:g,containers:k,features:A=30,...x}=o;(0,Y.H)()||(A=1);let P=(0,et.i)(s);!function({ownerDocument:o},a){let s=(0,D.useRef)(null);(0,er.O)(null==o?void 0:o.defaultView,"focusout",o=>{a&&(s.current||(s.current=o.target))},!0),(0,ei.q)(()=>{a||((null==o?void 0:o.activeElement)===(null==o?void 0:o.body)&&(0,X.C5)(s.current),s.current=null)},[a]);let c=(0,D.useRef)(!1);(0,D.useEffect)(()=>(c.current=!1,()=>{c.current=!0,(0,en.Y)(()=>{c.current&&((0,X.C5)(s.current),s.current=null)})}),[])}({ownerDocument:P},!!(16&A));let w=function({ownerDocument:o,container:a,initialFocus:s},c){let g=(0,D.useRef)(null),k=(0,ee.t)();return(0,ei.q)(()=>{if(!c)return;let A=a.current;A&&(0,en.Y)(()=>{if(!k.current)return;let a=null==o?void 0:o.activeElement;if(null!=s&&s.current){if((null==s?void 0:s.current)===a){g.current=a;return}}else if(A.contains(a)){g.current=a;return}null!=s&&s.current?(0,X.C5)(s.current):(0,X.jA)(A,X.TO.First)===X.fE.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),g.current=null==o?void 0:o.activeElement})},[c]),g}({ownerDocument:P,container:s,initialFocus:g},!!(2&A));!function({ownerDocument:o,container:a,containers:s,previousActiveElement:c},g){let k=(0,ee.t)();(0,er.O)(null==o?void 0:o.defaultView,"focus",o=>{if(!g||!k.current)return;let A=new Set(null==s?void 0:s.current);A.add(a);let x=c.current;if(!x)return;let P=o.target;P&&P instanceof HTMLElement?j(A,P)?(c.current=P,(0,X.C5)(P)):(o.preventDefault(),o.stopPropagation(),(0,X.C5)(x)):(0,X.C5)(c.current)},!0)}({ownerDocument:P,container:s,containers:k,previousActiveElement:w},!!(8&A));let F=(0,J.l)(),R=(0,Z.z)(o=>{let a=s.current;a&&(0,B.E)(F.current,{[J.N.Forwards]:()=>{(0,X.jA)(a,X.TO.First,{skipElements:[o.relatedTarget]})},[J.N.Backwards]:()=>{(0,X.jA)(a,X.TO.Last,{skipElements:[o.relatedTarget]})}})}),G=(0,eo.G)(),V=(0,D.useRef)(!1);return D.createElement(D.Fragment,null,!!(4&A)&&D.createElement($._,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:R,features:$.A.Focusable}),(0,W.sY)({ourProps:{ref:c,onKeyDown(o){"Tab"==o.key&&(V.current=!0,G.requestAnimationFrame(()=>{V.current=!1}))},onBlur(o){let a=new Set(null==k?void 0:k.current);a.add(s);let c=o.relatedTarget;c instanceof HTMLElement&&"true"!==c.dataset.headlessuiFocusGuard&&(j(a,c)||(V.current?(0,X.jA)(s.current,(0,B.E)(F.current,{[J.N.Forwards]:()=>X.TO.Next,[J.N.Backwards]:()=>X.TO.Previous})|X.TO.WrapAround,{relativeTo:o.target}):o.target instanceof HTMLElement&&(0,X.C5)(o.target)))}},theirProps:x,defaultTag:"div",name:"FocusTrap"}),!!(4&A)&&D.createElement($._,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:R,features:$.A.Focusable}))}),{features:ea});function j(o,a){var s;for(let c of o)if(null!=(s=c.current)&&s.contains(a))return!0;return!1}var el=s(139069),eu=s(992641),ed=s(867881),ec=s(761182),ep=s(34945);let ef=(0,D.createContext)(()=>{});ef.displayName="StackContext";var eh=((A=eh||{})[A.Add=0]="Add",A[A.Remove=1]="Remove",A);function M({children:o,onUpdate:a,type:s,element:c,enabled:g}){let k=(0,D.useContext)(ef),A=(0,Z.z)((...o)=>{null==a||a(...o),k(...o)});return(0,ep.e)(()=>{let o=void 0===g||!0===g;return o&&A(0,s,c),()=>{o&&A(1,s,c)}},[A,s,c,g]),D.createElement(ef.Provider,{value:A},o)}var em=s(209477);let{useState:eg,useEffect:ey,useLayoutEffect:eb,useDebugValue:ev}=G;"undefined"!=typeof window&&void 0!==window.document&&window.document.createElement;let e_=G.useSyncExternalStore;var eT=s(515429),ek=s(681966);let eA=(x={PUSH(o,a){var s;let c=null!=(s=this.get(o))?s:{doc:o,count:0,d:(0,eT.k)(),meta:new Set};return c.count++,c.meta.add(a),this.set(o,c),this},POP(o,a){let s=this.get(o);return s&&(s.count--,s.meta.delete(a)),this},SCROLL_PREVENT({doc:o,d:a,meta:s}){let c,g;let k={doc:o,d:a,meta:function(o){let a={};for(let s of o)Object.assign(a,s(a));return a}(s)},A=[(0,ek.gn)()?{before(){c=window.pageYOffset},after({doc:o,d:a,meta:s}){function i(o){return s.containers.flatMap(o=>o()).some(a=>a.contains(o))}a.style(o.body,"marginTop",`-${c}px`),window.scrollTo(0,0);let g=null;a.addEventListener(o,"click",a=>{if(a.target instanceof HTMLElement)try{let s=a.target.closest("a");if(!s)return;let{hash:c}=new URL(s.href),k=o.querySelector(c);k&&!i(k)&&(g=k)}catch{}},!0),a.addEventListener(o,"touchmove",o=>{o.target instanceof HTMLElement&&!i(o.target)&&o.preventDefault()},{passive:!1}),a.add(()=>{window.scrollTo(0,window.pageYOffset+c),g&&g.isConnected&&(g.scrollIntoView({block:"nearest"}),g=null)})}}:{},{before({doc:o}){var a;let s=o.documentElement;g=(null!=(a=o.defaultView)?a:window).innerWidth-s.clientWidth},after({doc:o,d:a}){let s=o.documentElement,c=s.clientWidth-s.offsetWidth,k=g-c;a.style(s,"paddingRight",`${k}px`)}},{before({doc:o,d:a}){a.style(o.documentElement,"overflow","hidden")}}];A.forEach(({before:o})=>null==o?void 0:o(k)),A.forEach(({after:o})=>null==o?void 0:o(k))},SCROLL_ALLOW({d:o}){o.dispose()},TEARDOWN({doc:o}){this.delete(o)}},c=new Map,g=new Set,{getSnapshot:()=>c,subscribe:o=>(g.add(o),()=>g.delete(o)),dispatch(o,...a){let s=x[o].call(c,...a);s&&(c=s,g.forEach(o=>o()))}});eA.subscribe(()=>{let o=eA.getSnapshot(),a=new Map;for(let[s]of o)a.set(s,s.documentElement.style.overflow);for(let s of o.values()){let o="hidden"===a.get(s.doc),c=0!==s.count;(c&&!o||!c&&o)&&eA.dispatch(s.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",s),0===s.count&&eA.dispatch("TEARDOWN",s)}});let eS=new Map,ex=new Map;function use_inert_h(o,a=!0){(0,ep.e)(()=>{var s;if(!a)return;let c="function"==typeof o?o():o.current;if(!c)return;let g=null!=(s=ex.get(c))?s:0;return ex.set(c,g+1),0!==g||(eS.set(c,{"aria-hidden":c.getAttribute("aria-hidden"),inert:c.inert}),c.setAttribute("aria-hidden","true"),c.inert=!0),function(){var o;if(!c)return;let a=null!=(o=ex.get(c))?o:1;if(1===a?ex.delete(c):ex.set(c,a-1),1!==a)return;let s=eS.get(c);s&&(null===s["aria-hidden"]?c.removeAttribute("aria-hidden"):c.setAttribute("aria-hidden",s["aria-hidden"]),c.inert=s.inert,eS.delete(c))}},[o,a])}var eM=((P=eM||{})[P.Open=0]="Open",P[P.Closed=1]="Closed",P),eC=((w=eC||{})[w.SetTitleId=0]="SetTitleId",w);let eP={0:(o,a)=>o.titleId===a.id?o:{...o,titleId:a.id}},eL=(0,D.createContext)(null);function L(o){let a=(0,D.useContext)(eL);if(null===a){let a=Error(`<${o} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,L),a}return a}function Me(o,a){return(0,B.E)(a.type,eP,o,a)}eL.displayName="DialogContext";let eI=W.AN.RenderStrategy|W.AN.Static,eE=Object.assign((0,W.yV)(function(o,a){let s=(0,K.M)(),{id:c=`headlessui-dialog-${s}`,open:g,onClose:k,initialFocus:A,__demoMode:x=!1,...P}=o,[w,F]=(0,D.useState)(0),R=(0,ec.oJ)();void 0===g&&null!==R&&(g=(R&ec.ZM.Open)===ec.ZM.Open);let G=(0,D.useRef)(new Set),U=(0,D.useRef)(null),X=(0,z.T)(U,a),J=(0,D.useRef)(null),ee=(0,et.i)(U),en=o.hasOwnProperty("open")||null!==R,ei=o.hasOwnProperty("onClose");if(!en&&!ei)throw Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!en)throw Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!ei)throw Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if("boolean"!=typeof g)throw Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${g}`);if("function"!=typeof k)throw Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${k}`);let eo=g?0:1,[ea,ef]=(0,D.useReducer)(Me,{titleId:null,descriptionId:null,panelRef:(0,D.createRef)()}),eg=(0,Z.z)(()=>k(!1)),ey=(0,Z.z)(o=>ef({type:0,id:o})),eb=!!(0,Y.H)()&&!x&&0===eo,ev=w>1,eT=null!==(0,D.useContext)(eL),ek=ev?"parent":"leaf",eS=null!==R&&(R&ec.ZM.Closing)===ec.ZM.Closing,ex=!eT&&!eS&&eb;use_inert_h((0,D.useCallback)(()=>{var o,a;return null!=(a=Array.from(null!=(o=null==ee?void 0:ee.querySelectorAll("body > *"))?o:[]).find(o=>"headlessui-portal-root"!==o.id&&o.contains(J.current)&&o instanceof HTMLElement))?a:null},[J]),ex);let eM=!!ev||eb;use_inert_h((0,D.useCallback)(()=>{var o,a;return null!=(a=Array.from(null!=(o=null==ee?void 0:ee.querySelectorAll("[data-headlessui-portal]"))?o:[]).find(o=>o.contains(J.current)&&o instanceof HTMLElement))?a:null},[J]),eM);let eC=(0,Z.z)(()=>{var o,a;return[...Array.from(null!=(o=null==ee?void 0:ee.querySelectorAll("html > *, body > *, [data-headlessui-portal]"))?o:[]).filter(o=>!(o===document.body||o===document.head||!(o instanceof HTMLElement)||o.contains(J.current)||ea.panelRef.current&&o.contains(ea.panelRef.current))),null!=(a=ea.panelRef.current)?a:U.current]}),eP=!(!eb||ev);(0,em.O)(()=>eC(),eg,eP);let eE=!(ev||0!==eo);(0,er.O)(null==ee?void 0:ee.defaultView,"keydown",o=>{eE&&(o.defaultPrevented||o.key===V.R.Escape&&(o.preventDefault(),o.stopPropagation(),eg()))}),function(o,a,s=()=>[document.body]){var c;let g,k;c=o=>{var a;return{containers:[...null!=(a=o.containers)?a:[],s]}},g=e_(eA.subscribe,eA.getSnapshot,eA.getSnapshot),(k=o?g.get(o):void 0)&&k.count,(0,ep.e)(()=>{if(!(!o||!a))return eA.dispatch("PUSH",o,c),()=>eA.dispatch("POP",o,c)},[a,o])}(ee,!(eS||0!==eo||eT),eC),(0,D.useEffect)(()=>{if(0!==eo||!U.current)return;let o=new ResizeObserver(o=>{for(let a of o){let o=a.target.getBoundingClientRect();0===o.x&&0===o.y&&0===o.width&&0===o.height&&eg()}});return o.observe(U.current),()=>o.disconnect()},[eo,U,eg]);let[ew,eF]=(0,ed.f)(),eR=(0,D.useMemo)(()=>[{dialogState:eo,close:eg,setTitleId:ey},ea],[eo,ea,eg,ey]),eO=(0,D.useMemo)(()=>({open:0===eo}),[eo]),eD={ref:X,id:c,role:"dialog","aria-modal":0===eo||void 0,"aria-labelledby":ea.titleId,"aria-describedby":ew};return D.createElement(M,{type:"Dialog",enabled:0===eo,element:U,onUpdate:(0,Z.z)((o,a,s)=>{"Dialog"===a&&(0,B.E)(o,{[eh.Add](){G.current.add(s),F(o=>o+1)},[eh.Remove](){G.current.add(s),F(o=>o-1)}})})},D.createElement(eu.O,{force:!0},D.createElement(el.h,null,D.createElement(eL.Provider,{value:eR},D.createElement(el.h.Group,{target:U},D.createElement(eu.O,{force:!1},D.createElement(eF,{slot:eO,name:"Dialog.Description"},D.createElement(es,{initialFocus:A,containers:G,features:eb?(0,B.E)(ek,{parent:es.features.RestoreFocus,leaf:es.features.All&~es.features.FocusLock}):es.features.None},(0,W.sY)({ourProps:eD,theirProps:P,slot:eO,defaultTag:"div",features:eI,visible:0===eo,name:"Dialog"})))))))),D.createElement($._,{features:$.A.Hidden,ref:J}))}),{Backdrop:(0,W.yV)(function(o,a){let s=(0,K.M)(),{id:c=`headlessui-dialog-backdrop-${s}`,...g}=o,[{dialogState:k},A]=L("Dialog.Backdrop"),x=(0,z.T)(a);(0,D.useEffect)(()=>{if(null===A.panelRef.current)throw Error("A <Dialog.Backdrop /> component is being used, but a <Dialog.Panel /> component is missing.")},[A.panelRef]);let P=(0,D.useMemo)(()=>({open:0===k}),[k]);return D.createElement(eu.O,{force:!0},D.createElement(el.h,null,(0,W.sY)({ourProps:{ref:x,id:c,"aria-hidden":!0},theirProps:g,slot:P,defaultTag:"div",name:"Dialog.Backdrop"})))}),Panel:(0,W.yV)(function(o,a){let s=(0,K.M)(),{id:c=`headlessui-dialog-panel-${s}`,...g}=o,[{dialogState:k},A]=L("Dialog.Panel"),x=(0,z.T)(a,A.panelRef),P=(0,D.useMemo)(()=>({open:0===k}),[k]),w=(0,Z.z)(o=>{o.stopPropagation()});return(0,W.sY)({ourProps:{ref:x,id:c,onClick:w},theirProps:g,slot:P,defaultTag:"div",name:"Dialog.Panel"})}),Overlay:(0,W.yV)(function(o,a){let s=(0,K.M)(),{id:c=`headlessui-dialog-overlay-${s}`,...g}=o,[{dialogState:k,close:A}]=L("Dialog.Overlay"),x=(0,z.T)(a),P=(0,Z.z)(o=>{if(o.target===o.currentTarget){if((0,U.P)(o.currentTarget))return o.preventDefault();o.preventDefault(),o.stopPropagation(),A()}}),w=(0,D.useMemo)(()=>({open:0===k}),[k]);return(0,W.sY)({ourProps:{ref:x,id:c,"aria-hidden":!0,onClick:P},theirProps:g,slot:w,defaultTag:"div",name:"Dialog.Overlay"})}),Title:(0,W.yV)(function(o,a){let s=(0,K.M)(),{id:c=`headlessui-dialog-title-${s}`,...g}=o,[{dialogState:k,setTitleId:A}]=L("Dialog.Title"),x=(0,z.T)(a);(0,D.useEffect)(()=>(A(c),()=>A(null)),[c,A]);let P=(0,D.useMemo)(()=>({open:0===k}),[k]);return(0,W.sY)({ourProps:{ref:x,id:c},theirProps:g,slot:P,defaultTag:"h2",name:"Dialog.Title"})}),Description:ed.d});var ew=s(720227),eF=s(776845),eR=s(713222);let eO={theme:"scale-theme",isStrictClose:!1},Modal=({open:o,onClose:a,children:s,actions:c,className:g,innerClassName:k,innerPanelClassName:A,PanelComponent:x="div",title:P,theme:w=eO.theme,hideTitle:G,isStrictClose:B=eO.isStrictClose})=>{let W=(0,D.useCallback)(()=>{if(!B&&a)return a()},[B,a]);return(0,F.jsx)(R.u,{appear:!0,show:o,as:D.Fragment,children:(0,F.jsxs)(eE,{as:"div",onClose:W,className:(0,ew.m)("scaleui relative z-modal",w,g),children:[(0,F.jsx)(R.u.Child,{as:D.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-50",leave:"ease-in duration-200",leaveFrom:"opacity-50",leaveTo:"opacity-0",children:(0,F.jsx)("div",{className:(0,ew.m)("fixed inset-0","federal-theme"===w?"bg-neutral-50":"bg-neutral-1000")})}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsx)(R.u.Child,{as:D.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,F.jsxs)(eE.Panel,{as:x,className:(0,ew.m)("min-w-[400px] max-w-full max-h-full text-left align-middle transition-all transform rounded-lg shadow-xl bg-neutral-0 flex flex-col flex-nowrap overflow-hidden",k),children:[!G&&(0,F.jsxs)("div",{className:"flex items-center justify-between w-full px-4 py-2 border-b border-neutral-200 shrink-0 gap-2",children:[P?(0,F.jsx)(eE.Title,{as:D.Fragment,children:(0,F.jsx)(eF.ZT.Subtitle2,{children:P})}):null,a&&(0,F.jsx)(eR.J,{rounded:!0,icon:"times",onClick:a,className:"ml-auto"})]}),(0,F.jsx)("div",{className:(0,ew.m)("p-4 text-neutral-700 bg-neutral-0 overflow-y-auto flex-grow",A),children:s}),c?(0,F.jsx)("div",{className:"px-4 py-2 border-t border-neutral-200 shrink-0",children:c}):null]})})})]})})}},19161:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getAllChoices=getAllChoices,a.getAllChoiceDescendants=function getAllChoiceDescendants(o,a=g.default.identity,s=!1){if(!o)return[];let c=[];for(let g of o)k.isNestedLabelChoice(g)&&(!s||a(g))?c=c.concat(getAllChoiceDescendants(g.subchoices)):a(g)&&c.push(k.getLabelChoiceValue(g));return c},a.getFirstLeafLabel=function getFirstLeafLabel(o){if(o)for(let a of o){if(!k.isNestedLabelChoice(a))return k.getLabelChoiceValue(a);{let o=getFirstLeafLabel(a.subchoices);if(o)return o}}},a.trimAllLabelNames=function trimAllLabelNames(o){return o.forEach((a,s)=>{k.isNestedLabelChoice(a)?(a.choice=a.choice.trim(),trimAllLabelNames(a.subchoices)):"string"==typeof a?o[s]=a.trim():g.default.isNil(a)||(a.choice=a.choice.trim())}),o},a.hasSubchoices=a.displayChoice=a.stringifyChoice=a.getChoice=a.generateChildToParentChoiceMapping=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(335855);function getAllChoices(o,a=!1){if(!o)return[];let s=[];for(let c of o)k.isNestedLabelChoice(c)?(a&&s.push(c),s.push(...getAllChoices(c.subchoices,a))):s.push(c);return s}let generateChildToParentChoiceMapping=(o,a)=>{let s=new Map;return o&&o.forEach(o=>{if(s.set(o,a),k.isNestedLabelChoice(o)){let a=generateChildToParentChoiceMapping(o.subchoices,o);for(let[o,c]of a.entries())s.set(o,c)}}),s};a.generateChildToParentChoiceMapping=generateChildToParentChoiceMapping,a.getChoice=(o,a,s)=>{if(!g.default.isNil(a))return getAllChoices(o,!0).find(o=>s?g.default.isEqual(a,o):a===stringifyChoice(o))};let stringifyChoice=o=>g.default.isNil(o)?"":g.default.isString(o)?o:o.choice;a.stringifyChoice=stringifyChoice,a.displayChoice=o=>g.default.isNil(o)?"":g.default.isString(o)?o:o.display??o.choice,a.hasSubchoices=o=>!(g.default.isNil(o)||g.default.isString(o))&&!!o.subchoices},320716:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"CameraModel",{enumerable:!0,get:function(){return k.CameraModel}}),a.getProjectionFunction=function(o,{skipDistortion:a=!1}={}){let s=o.imageHeight*(o.scale_factor||1),g=o.imageWidth*(o.scale_factor||1);switch(o.camera_model){case k.CameraModel.ModEquiFish:case k.CameraModel.ModKannala:case k.CameraModel.BrownConrady:case k.CameraModel.Fisheye:case k.CameraModel.Omnidirectional:case k.CameraModel.Ftheta:case k.CameraModel.FisheyeRadialCustom:case void 0:case null:{let x=function(o){let a=new c.Matrix4;if(o.useKitti&&o.kittiNormalizedCoordinates)a.copy(w);else{let s=o.useKitti?w:createCameraToProjection(o.fx,o.fy,o.cx,o.cy,o.skew||0),c=createWorldToCamera(o.position,o.heading);a.multiplyMatrices(s,c)}return a}(o),P=!o.useKitti,F=createWorldToCamera(o.position,o.heading),R=createCameraToProjection(o.fx,o.fy,o.cx,o.cy,o.skew||0),D={};return(w,G=1)=>{let B,W,z;let V=new c.Vector4(w.x,w.y,w.z,1),U=new c.Vector4(w.x,w.y,w.z,1);o.camera_model===k.CameraModel.Omnidirectional&&o.xi?(V.applyMatrix4(F),V.setW(0),V.normalize(),V.z+=o.xi,V.setW(1),V.applyMatrix4(R)):V.applyMatrix4(x),U.applyMatrix4(F);let K=170>A.distance(w,o.position),Y=V.w>0;if(!Y)return{distortPosition:null,preDistortPosition:null,distortGood:!1,visible:!1,projectionValid:Y,withinRange:!1};V.multiplyScalar(G/V.w);let $=s*G,X=g*G,Z=V.clone();if(a)B=null,W=Y&&visibilityCheck(Z,X,$),z=!1;else{try{B=P?distortPoint(V,o):Z.clone(),W=Y&&visibilityCheck(B,X,$),z=P?distortPointIsGood(V,o,D):W}catch(a){B=P?distortPoint(V,o):Z.clone(),W=Y&&visibilityCheck(B,X,$),z=P?distortPointIsGood(V,o,D):W}o.scale_factor&&(B.multiplyScalar(1/o.scale_factor),Z.multiplyScalar(1/o.scale_factor))}return{distortPosition:B,preDistortPosition:Z,projectionValid:Y,distortGood:z,visible:W,withinRange:K}}}case k.CameraModel.Cylindrical:{let a=createWorldToCamera(o.position,o.heading);return(k,x=1,P=!1)=>{let w=new c.Vector4(k.x,k.y,k.z,1);w.applyMatrix4(a);let F=170>A.distance(k,o.position),R=Math.atan2(w.x,w.z),D=Math.hypot(w.x,w.z),G=R*o.fx+o.cx,B=w.y/D*o.fy+o.cy,W=new c.Vector4(G,B,0,1);W.multiplyScalar(x);let z=s*x,V=g*x,U=visibilityCheck(W,V,z);o.scale_factor&&W.multiplyScalar(1/o.scale_factor);let K=!0;return P&&(K=w.z>-6),{distortPosition:W,preDistortPosition:W,projectionValid:K,distortGood:K,visible:U,withinRange:F}}}case k.CameraModel.Equirectangular:{let a=createWorldToCamera(o.position,o.heading);return(k,x=1)=>{let P=new c.Vector4(k.x,k.y,k.z,1);P.applyMatrix4(a);let w=170>A.distance(k,o.position),F=Math.hypot(P.x,P.z),R=Math.atan2(P.z,P.x),D=Math.acos(P.x/F),G=R*o.fx+o.cx,B=D*o.fy+o.cy,W=new c.Vector4(G,B,0,1);W.multiplyScalar(x);let z=s*x,V=g*x,U=visibilityCheck(W,V,z);return o.scale_factor&&W.multiplyScalar(1/o.scale_factor),{distortPosition:W,preDistortPosition:W,projectionValid:!0,distortGood:!0,visible:U,withinRange:w}}}default:throw Error(`Unknown model ${o.camera_model}`)}},a.createWorldToCamera=createWorldToCamera,a.createCameraToProjection=createCameraToProjection,a.KITTIProjectionMatrix=a.CAMERA_MODELS_TO_PARAMS=void 0;var c=function(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}(s(814412)),g=_interopRequireDefault(s(844955)),k=s(167469),A=s(141862),x=_interopRequireDefault(s(298784));function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}let P=Object.freeze({[k.CameraModel.BrownConrady]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","k4","k5","k6","p1","p2","lx","ly","rSqThresh"]},[k.CameraModel.ModEquiFish]:{required:["fx","fy","cx","cy"],optional:["skew","k2","k3","k4"]},[k.CameraModel.ModKannala]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","k4"]},[k.CameraModel.Fisheye]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","k4"]},[k.CameraModel.Cylindrical]:{required:["fx","fy","cx","cy"],optional:["skew"]},[k.CameraModel.Equirectangular]:{required:["fx","fy","cx","cy"],optional:[]},[k.CameraModel.Omnidirectional]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","p1","p2","lx","ly","xi"]},[k.CameraModel.Ftheta]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","k4","k5"]},[k.CameraModel.FisheyeRadialCustom]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","k4","k5","k6","p1","p2","dcx","dcy"]}});a.CAMERA_MODELS_TO_PARAMS=P;let w=new c.Matrix4;function visibilityCheck(o,a,s){return o.y>=0&&o.y<s&&o.x>=0&&o.x<a}function createWorldToCamera(o,a){let s=new c.Vector3(o.x,o.y,o.z),g=new c.Quaternion(a.x,a.y,a.z,a.w),k=new c.Matrix4,A=new c.Matrix4,x=new c.Matrix4;return g.invert(),s.multiplyScalar(-1),k.makeTranslation(s.x,s.y,s.z),A.makeRotationFromQuaternion(g),x.multiplyMatrices(A,k),x}function createCameraToProjection(o,a,s,g,k){let A=new c.Matrix4;return A.set(o,k,s,0,0,a,g,0,0,0,0,0,0,0,1,0),A}function getPolynomialValue(o,...a){let s=0,c=1;for(let g of a)s+=g*c,c*=o;return s}function distortPoint(o,a){switch(a.camera_model){case k.CameraModel.ModEquiFish:return function(o,a){var s,g,k,A,x;let[P,w]=(s=o.x,g=o.y,k=o.w,A=a.cx,x=a.cy,[(s/k-A)/a.fx,(g/k-x)/a.fy]),[F,R,D]=[a.k2||0,a.k3||0,a.k4||0],G=Math.sqrt(P*P+w*w),B=Math.atan(G),W=G<1e-5?1:B/G,z=B*B*(F+B*(R+B*D))+1,V=new c.Vector4(0,0,o.z,o.w);return V.x=a.fx*W*P*z+a.cx,V.y=a.fy*W*w*z+a.cy,V.x*=V.w,V.y*=V.w,V}(o,a);case k.CameraModel.ModKannala:return function(o,a){var s,g,k,A,x;let[P,w]=(s=o.x,g=o.y,k=o.w,A=a.cx,x=a.cy,[(s/k-A)/a.fx,(g/k-x)/a.fy]),[F,R,D,G]=[a.k1||0,a.k2||0,a.k3||0,a.k4||0],B=Math.sqrt(P*P+w*w),W=Math.atan(B),z=Math.atan(W),V=z*z,U=B>1e-5?Math.tan(z*(1+V*(F+V*(R+V*(D+G*V)))))/B:1,K=new c.Vector4(0,0,o.z,o.w);return K.x=a.fx*P*U+a.cx,K.y=a.fy*w*U+a.cy,K.x*=K.w,K.y*=K.w,K}(o,a);case k.CameraModel.Fisheye:return function(o,a){var s,g,k,A,x;let[P,w]=(s=o.x,g=o.y,k=o.w,A=a.cx,x=a.cy,[(s/k-A)/a.fx,(g/k-x)/a.fy]),[F,R,D,G]=[a.k1||0,a.k2||0,a.k3||0,a.k4||0],B=Math.sqrt(P*P+w*w),W=Math.atan(B),z=B<1e-5?1:W/B,V=W*W,U=V*(F+V*(R+V*(D+V*G)))+1,K=new c.Vector4(0,0,o.z,o.w);return K.x=a.fx*z*P*U+a.cx,K.y=a.fy*z*w*U+a.cy,K.x*=K.w,K.y*=K.w,K}(o,a);case k.CameraModel.Ftheta:return function(o,a){var s,g,k,A,x;let[P,w]=(s=o.x,g=o.y,k=o.w,A=a.cx,x=a.cy,[(s/k-A)/a.fx,(g/k-x)/a.fy]),[F,R,D,G,B]=[a.k1||0,a.k2||0,a.k3||0,a.k4||0,a.k5||0],W=Math.sqrt(P*P+w*w),z=Math.atan(W),V=W<1e-5?1:1/W,U=getPolynomialValue(z,0,F,R,D,G,B),K=new c.Vector4(0,0,o.z,o.w);return K.x=a.fx*V*P*U+a.cx,K.y=a.fy*V*w*U+a.cy,K.x*=K.w,K.y*=K.w,K}(o,a);case k.CameraModel.FisheyeRadialCustom:return function(o,a){var s,g,k,A,x;let[P,w,F,R,D,G]=[a.k1||0,a.k2||0,a.k3||0,a.k4||0,a.k5||0,a.k6||0],[B,W]=[a.p1||0,a.p2||0],[z,V]=[a.dcx||0,a.dcy||0],[U,K]=(s=o.x,g=o.y,k=o.w,A=a.cx,x=a.cy,[(s/k-A)/a.fx,(g/k-x)/a.fy]),Y=U-z,$=K-V,X=Y*Y+$*$,Z=Math.sqrt(X),J=Math.atan(Z),ee=Z<1e-5?1:1/Z,et=ee;et*=getPolynomialValue(J,0,1,P,w,F,R,D,G),et*=getPolynomialValue(X*et*et,1,B,W);let er=(a.fx*(Y*et+z)+a.cx)*o.w,en=(a.fy*($*et+V)+a.cy)*o.w,ei=new c.Vector4(er,en,o.z,et<0?-1:o.w);return ei}(o,a);case k.CameraModel.BrownConrady:case k.CameraModel.Omnidirectional:case void 0:case null:return function(o,a){var s,g,k,A,x;let[P,w]=(s=o.x,g=o.y,k=o.w,A=a.cx,x=a.cy,[(s/k-A)/a.fx,(g/k-x)/a.fy]),F=P*P+w*w,[R,D,G,B,W,z,V,U,K,Y]=[a.k1||0,a.k2||0,a.k3||0,a.k4||0,a.k5||0,a.k6||0,a.p1||0,a.p2||0,a.lx||0,a.ly||0];P+=K,w+=Y;let $=(1+F*(R+F*(D+F*G)))/(1+F*(B+F*(W+F*z))),X=new c.Vector4(0,0,o.z,o.w);return X.x=a.cx+a.fx*(P*$+V*(F+2*P*P)+2*U*P*w),X.y=a.cy+a.fy*(w*$+U*(F+2*w*w)+2*V*P*w),X.x*=X.w,X.y*=X.w,X}(o,a);default:throw Error(`Unknown model ${a.camera_model}`)}}a.KITTIProjectionMatrix=w,w.set(609.695409,180.384202,0,.999945389,-721.421597,7.64479802,0,124365378e-12,-1.25125855,-719.651474,0,.010451303,-123.041806,-101.016688,384.38148,-.269386912),w.transpose();let nonZero=o=>Math.abs(o)>1e-4;function distortPointIsGood(o,a,s){var c,A,P,w,F;let[R,D]=(c=o.x,A=o.y,P=o.w,w=a.cx,F=a.cy,[(c/P-w)/a.fx,(A/P-F)/a.fy]);switch(a.camera_model){case k.CameraModel.ModEquiFish:{s.thetaThresh||(s.thetaThresh=function(o){let[a,s,c]=[o.k2||0,o.k3||0,o.k4||0],k=g.default.allRoots([5*c,4*s,3*a,0,1]),A=k.filter(o=>o>0);return A.sort((o,a)=>o-a),A[0]||1/0}(a));let o=Math.sqrt(R*R+D*D),c=Math.atan(o);return c<s.thetaThresh}case k.CameraModel.ModKannala:{s.thetaThresh||(s.thetaThresh=Math.PI/2);let o=Math.sqrt(R*R+D*D),a=Math.atan(o);return a<s.thetaThresh}case k.CameraModel.Fisheye:{s.thetaSqThresh||(s.thetaSqThresh=function(o){let[a,s,c,k]=[o.k1||0,o.k2||0,o.k3||0,o.k4||0],A=g.default.allRoots([9*k,7*c,5*s,3*a,1]),x=A.filter(o=>o>0);return x.sort((o,a)=>o-a),x[0]||1/0}(a));let o=Math.sqrt(R*R+D*D),c=Math.atan(o);return c*c<s.thetaSqThresh}case k.CameraModel.FisheyeRadialCustom:return o.w>0;case k.CameraModel.BrownConrady:case k.CameraModel.Omnidirectional:case k.CameraModel.Ftheta:case void 0:case null:return s.rSqThresh||(s.rSqThresh=function(o){if("rSqThresh"in o&&!x.default.isNil(o.rSqThresh))return o.rSqThresh;let[a,s,c,k,A,P]=[o.k1,o.k2,o.k3,o.k4,o.k5,o.k6].map(o=>o||0);if(nonZero(k)||nonZero(A)||nonZero(P))return 1/0;let w=g.default.allRoots([7*c,5*s,3*a,1]),F=w.filter(o=>o>0);return F.sort((o,a)=>o-a),F[0]||1/0}(a)),R*R+D*D<s.rSqThresh;default:throw Error(`Unknown model ${a.camera_model}`)}}},844162:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a._getOriginalTcFieldId=function(o){let a=o.split(A.FIELD_ID_DELIMITER);return 2===a.length?a[1]:o},a.default=void 0;var c,g=s(167469),k=s(991984),A=s(227267),x=s(513254),P=s(963494),w=s(222357),F=s(896135),R=(c=s(298784))&&c.__esModule?c:{default:c};let isProcessSupervisionAnnotations=(o,a)=>o&&"processsupervision"===o.chatGraderAnnotationType||a&&"processsupervision"===a.chatGraderAnnotationType,_shouldGradeModelResponseField=(o,a,s,c,g)=>{let{responseIndex:k,stepParams:A}=o,{responseIndex:x,stepParams:P}=a,{stepIndicesToGradeOnly:w}=s||void 0;return!!(void 0===k||void 0===x||k!==x||void 0===w||w.includes(k))&&!!("model-response-selector"!==c||"model-response-selector"!==g||(R.default.isNil(A)||R.default.isNil(A?.params)||!A.params.skip_selection)&&(R.default.isNil(P)||R.default.isNil(P?.params)||!P.params.skip_selection))},_shouldGraderTextCollectionField=({chatTaskAnnotationMetadata:o,fieldIdsToGradeOnly:a,stepIndicesToGradeOnly:s,textCollectionPerResponseCandidateIndexToGradeOnly:c})=>{let{originalFieldId:g,candidateIndex:k,responseIndex:A}=o;return void 0===a||void 0===g||!!(a.includes(g)&&(void 0===s||void 0===A||s.includes(A)))&&(void 0===c||void 0===k||c.includes(k))},D=Object.freeze({chatTextCollection:{taskTypes:[g.TaskType.Chat],title:"chat text collection",graderFn:k.gradePerFrame((o,a,s,c)=>({textCollection:isProcessSupervisionAnnotations(o,a)?{correctWork:0,totalWork:0}:k.gradeIfNotMissing((o,a)=>"textcollection"===o.chatGraderAnnotationType&&"textcollection"===a.chatGraderAnnotationType&&_shouldGraderTextCollectionField({chatTaskAnnotationMetadata:o.chatTaskAnnotationMetadata,fieldIdsToGradeOnly:c?.fieldIdsToGradeOnly,stepIndicesToGradeOnly:c?.stepIndicesToGradeOnly,textCollectionPerResponseCandidateIndexToGradeOnly:c?.textCollectionPerResponseCandidateIndexToGradeOnly})?x.gradeByMatchingResult(x.singleGraderFn,c)(o,a):{correctWork:0,totalWork:0},o,a)}))},chatTextCollectionCategoryDistance:{taskTypes:[g.TaskType.Chat],title:"chat text collection - category distance",graderFn:k.gradePerFrame((o,a,s,c)=>({categoryDistance:isProcessSupervisionAnnotations(o,a)?{correctWork:0,totalWork:0}:k.gradeIfNotMissing((o,a)=>"textcollection"===o.chatGraderAnnotationType&&"textcollection"===a.chatGraderAnnotationType&&[P.TextCollectionFieldType.Category,P.TextCollectionFieldType.Number,P.TextCollectionFieldType.Autocomplete].includes(a.type)&&_shouldGraderTextCollectionField({chatTaskAnnotationMetadata:o.chatTaskAnnotationMetadata,fieldIdsToGradeOnly:c?.fieldIdsToGradeOnly,stepIndicesToGradeOnly:c?.stepIndicesToGradeOnly,textCollectionPerResponseCandidateIndexToGradeOnly:c?.textCollectionPerResponseCandidateIndexToGradeOnly})?{correctWork:R.default.sum(o.response.map(o=>o.result===w.GraderResult.Correct?1:o.result===w.GraderResult.Incorrect?a.type===P.TextCollectionFieldType.Category?x.getCategoryScoreByDistance(o.expected,o.given,c):x.getCategoryScoreByDistance([o.expected],[o.given],c):0)),totalWork:a.response.length}:{correctWork:0,totalWork:0},o,a)}))},chatModelResponseSelector:{taskTypes:[g.TaskType.Chat],title:"model response selector",graderFn:k.gradePerFrame((o,a,s,c)=>({modelResponseSelector:isProcessSupervisionAnnotations(o,a)?{correctWork:0,totalWork:0}:k.gradeIfNotMissing((o,a)=>{if(!_shouldGradeModelResponseField(o.chatTaskAnnotationMetadata,a.chatTaskAnnotationMetadata,c,o.chatGraderAnnotationType,a.chatGraderAnnotationType)||"model-response-selector"!==o.chatGraderAnnotationType||"model-response-selector"!==a.chatGraderAnnotationType)return{correctWork:0,totalWork:0};if(c?.useLikert){let s=c.steps||[1],g=Math.abs(o.likertValueRaw-a.likertValueRaw),k=g<s.length?s[g]:0;return{correctWork:k,totalWork:1}}return{correctWork:o.selectedId===a.selectedId?1:0,totalWork:1}},o,a)}))},chatNerLabels:{taskTypes:[g.TaskType.Chat],title:"chat ner labels",graderFn:F.gradePerFrameForAnnotations((o,a,s)=>({nerLabels:isProcessSupervisionAnnotations(o,a)?{correctWork:0,totalWork:0}:k.gradeIfNotMissing((o,a)=>a?.chatGraderAnnotationType==="namedentityrecognition"?F.nerLabelsGrader(o,a).nerLabels:{correctWork:0,totalWork:0},o,a)}))},chatProcessSupervision:{taskTypes:[g.TaskType.Chat],title:"chat process supervision",graderFn:F.gradePerFrameForAnnotations((o,a,s)=>({processSupervisionLabels:a?.chatGraderAnnotationType==="processsupervision"&&o?.chatGraderAnnotationType==="processsupervision"?o.rating===a.rating?{correctWork:1,totalWork:1}:{correctWork:0,totalWork:1}:{correctWork:0,totalWork:0}}))},chatModelResponseRanking:{taskTypes:[g.TaskType.Chat],title:"chat model response ranking",graderFn:F.gradePerFrameForAnnotations((o,a,s,c)=>({modelResponseRankingLabels:isProcessSupervisionAnnotations(o,a)?{correctWork:0,totalWork:0}:k.gradeIfNotMissing((o,a)=>{if(!_shouldGradeModelResponseField(o.chatTaskAnnotationMetadata,a.chatTaskAnnotationMetadata,c,o.chatGraderAnnotationType,a.chatGraderAnnotationType))return{correctWork:0,totalWork:0};if("model-response-ranking"===a.chatGraderAnnotationType&&"model-response-ranking"===o.chatGraderAnnotationType&&o.rankings.length===a?.rankings.length){let s=0,c=0;for(let g=0;g<o.rankings.length;g++){let k=o.rankings[g];for(let o of k)R.default.includes(a.rankings[g],o)&&(s+=1),c+=1}let g=s/c;return{correctWork:g,totalWork:1}}return{correctWork:0,totalWork:0}},o,a)}))}});a.default=D},227267:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.FIELD_ID_DELIMITER=void 0,a.FIELD_ID_DELIMITER="___FIELD_ID_DELIMITER___"},763081:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.chatV2Graders=void 0;var c,g=s(167469),k=s(894815),A=s(991984),x=(c=s(298784))&&c.__esModule?c:{default:c},P=s(513254),w=s(963494);let simpleChatV2Grader=(o,a,s,c,g,k)=>{let P=shouldGrade(o,a,c,k)?A.gradeIfNotMissing((o,a)=>{let{response:s}=o,{response:c}=a,g=x.default.isEqual(s,c)?1:0;return{correctWork:g,totalWork:1}},o,a):{correctWork:0,totalWork:0};return{simpleChatLiteGrader:P}},shouldGrade=(o,a,s,c)=>shouldGradeFieldAnnotation(o,s,c)&&shouldGradeFieldAnnotation(a,s,c),shouldGradeFieldAnnotation=(o,a,s)=>{if(void 0===o||a?.whitelistedFields===void 0)return!0;let{turnId:c,stepId:g,responseId:k,fieldId:A,responseIndex:P}=o.fieldMatcher;return!!x.default.some(a.whitelistedFields,o=>(void 0===o.turnId||o.turnId===c)&&(void 0===o.stepId||o.stepId===g)&&(void 0===o.fieldId||o.fieldId===A)&&(void 0===o.responseId||o.responseId===k)&&(void 0===o.responseIndex||o.responseIndex===P))},chatV2DistanceGrader=(o,a,s,c,g,k)=>{let x=shouldGrade(o,a,c,k)?A.gradeIfNotMissing((o,a)=>{let{response:s}=o,{response:g}=a;if(Array.isArray(s))return{correctWork:0,totalWork:0};{let o,a;o="boolean"==typeof s?s.toString():s,a="boolean"==typeof g?g.toString():g;let k=P.getCategoryScoreByDistance([o],[a],c);return{correctWork:k,totalWork:1}}},o,a):{correctWork:0,totalWork:0};return{chatLiteDistanceGrader:x}},chatV2FreeTextGrader=(o,a,s,c,g,k)=>{let P=shouldGrade(o,a,c,k)?A.gradeIfNotMissing((o,a)=>{let{response:s}=o,{response:g}=a;return Array.isArray(s)?{correctWork:0,totalWork:0}:x.default.isString(s)&&x.default.isString(g)?A.gradeFreeText(s,g,c?.comparisonMethod||A.TextComparisonMethod.NormalizedLevenshtein):{correctWork:0,totalWork:0}},o,a):{correctWork:0,totalWork:0};return{ChatV2FreeTextGrader:P}},F={maxAcceptableDistance:3,decayFunction:P.DecayFunction.Linear},R=Object.freeze({genericChatLiteGrader:{taskTypes:[g.TaskType.ChatExperimental,g.TaskType.ChatV2],title:"Generic ChatV2 grader",description:"Opinionated grader which grades annotations with annotation type specific graders",graderFn:A.gradePerFrame((o,a,s,c,g,R)=>{let D=shouldGrade(o,a,c,R);if(!D)return{genericChatLiteGrader:{correctWork:0,totalWork:0}};if(a){let g=c?.perFieldGraderParams??[],A=g.find(o=>{let{turnId:s,stepId:c,fieldId:g}=a.fieldMatcher,{matcher:k}=o;return(void 0===k.turnId||k.turnId===s)&&(void 0===k.stepId||k.stepId===c)&&(void 0===k.fieldId||k.fieldId===g)});if(A){let c;let{graderType:g,graderParams:x}=A;if(g===k.ChatV2GraderType.ChatV2CategoryDistanceGrader&&(c=chatV2DistanceGrader(o,a,s,x)),g===k.ChatV2GraderType.ChatV2FreeTextGrader&&(c=chatV2FreeTextGrader(o,a,s,x)),g===k.ChatV2GraderType.ChatV2SimpleGrader&&(c=simpleChatV2Grader(o,a,s,x)),void 0!==c)return{genericChatLiteGrader:{correctWork:c[g].correctWork,totalWork:c[g].totalWork}}}}let G=A.gradeIfNotMissing((o,a)=>{let s=0,c=0,{response:g}=o,{response:R}=a,D=a.textCollectionField?.type;if(D===w.TextCollectionFieldType.Text&&x.default.isString(g)&&x.default.isString(R))({correctWork:s,totalWork:c}=A.gradeFreeText(g,R,A.TextComparisonMethod.NormalizedLevenshtein));else if((D===w.TextCollectionFieldType.Number||a.fieldMatcher.fieldId===k.PREFERENCE_LIKERT_FIELD_ID)&&x.default.isNumber(g)&&x.default.isNumber(R))s=P.getCategoryScoreByDistance([g],[R],F),c=1;else{let o=x.default.isEqual(g,R);return{correctWork:o?1:0,totalWork:1}}return{correctWork:s,totalWork:c}},o,a);return{genericChatLiteGrader:G}})},simpleChatLiteGrader:{taskTypes:[g.TaskType.ChatExperimental,g.TaskType.ChatV2],title:"Simple ChatV2 grader",description:"Grade annotations by exact match",graderFn:A.gradePerFrame(simpleChatV2Grader)},chatLiteDistanceGrader:{taskTypes:[g.TaskType.ChatExperimental,g.TaskType.ChatV2],title:"ChatV2 distance grader",description:"Grade annotations by distance",graderFn:A.gradePerFrame(chatV2DistanceGrader)},ChatV2FreeTextGrader:{taskTypes:[g.TaskType.ChatExperimental,g.TaskType.ChatV2],title:"ChatV2 free text (levenshtein) distance grader",description:"Grade free text annotations by levenshtein distance or configurable grading method",graderFn:A.gradePerFrame(chatV2FreeTextGrader)}});a.chatV2Graders=R,a.default=R},894815:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.ChatV2GraderType=a.PREFERENCE_LIKERT_FIELD_ID=a._PREFERENCE_LIKERT_FIELD_ID=a.INTERNAL_FIELD_ID_PREFIX=void 0;let g="__internal__";a.INTERNAL_FIELD_ID_PREFIX=g;let k="preferenceLikert";a._PREFERENCE_LIKERT_FIELD_ID=k;let A=`${g}${k}`;a.PREFERENCE_LIKERT_FIELD_ID=A,a.ChatV2GraderType=s,(c=s||(a.ChatV2GraderType=s={})).ChatV2SimpleGrader="simpleChatLiteGrader",c.ChatV2CategoryDistanceGrader="chatLiteDistanceGrader",c.ChatV2FreeTextGrader="chatLiteFreeTextGrader"},327999:function(o,a,s){"use strict";a.wX=extractCodenamesFromText,a.PU=function extractCodenamesFromObject(o,a,s=[]){if(!o||"object"!=typeof o)return[];let c=[];if(Array.isArray(o))for(let g of o)if("string"==typeof g){let o=a?a(g):g;c.push(...extractCodenamesFromText(o,s))}else"object"==typeof g&&null!==g&&c.push(...extractCodenamesFromObject(g,a,s));else for(let g in o)if(Object.prototype.hasOwnProperty.call(o,g)){let k=o[g];if("string"==typeof k){let o=a?a(k):k;c.push(...extractCodenamesFromText(o,s))}else"object"==typeof k&&null!==k&&c.push(...extractCodenamesFromObject(k,a,s))}return[...new Set(c)]},a.Xd=function(o,a){let s=extractCodenamesFromText(o,a);return s.length>0};var c=s(202466);function extractCodenamesFromText(o,a=[]){return o?c.extractWordsFromText(o,a):[]}},863986:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.autoflagParamsValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({useAutoflag:g.default.boolean().required(),modelName:g.default.string().required().allow(""),linterName:g.default.string().required().allow(""),allowAutoApprove:g.default.boolean().optional(),allowAutoSBQ:g.default.boolean().optional()});a.autoflagParamsValidator=k},721879:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.predictionsParamsValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({modelName:g.default.string().required(),extra:g.default.object().optional()}),A=g.default.array().items(k),x=g.default.object(),P=g.default.object().keys({usePrelabeling:g.default.boolean().required(),models:A.required()}),w=g.default.object().keys({useAutoflag:g.default.boolean().required(),models:A.required(),modelLinters:x.required()}),F=g.default.object().keys({useAttributePrelabeling:g.default.boolean().required(),models:A.required()}),R=g.default.object().keys({usePredictions:g.default.boolean().required(),prelabelingParams:P.optional(),autoflagParams:w.optional(),attributePrelabelingParams:F.optional()});a.predictionsParamsValidator=R},320522:function(o,a){"use strict";var s,c,g,k,A,x,P,w;Object.defineProperty(a,"__esModule",{value:!0}),a.RoutingConditionName=a.ConfidenceModelLaunchEndpoint=a.ConfidenceModelRoutingOption=a.RunAfterOption=void 0,a.RunAfterOption=s,(A=s||(a.RunAfterOption=s={})).TaskCreation="Task Creation",A.Attempt="Attempt",A.L0="L0",A.L1="L1",A.L10="L10",A.L11="L11",a.ConfidenceModelRoutingOption=c,(x=c||(a.ConfidenceModelRoutingOption=c={})).None="None",x.Attempt="Attempt",x.L0="L0",x.L1="L1",x.L10="L10",x.L11="L11",x.L12="L12",x.Complete="Complete",a.ConfidenceModelLaunchEndpoint=g,(P=g||(a.ConfidenceModelLaunchEndpoint=g={})).GooseTaggingOldUIModelName="goose-task-risk-gtin-tagging-async-service",P.GooseTaggingNewUIModelName="goose-gtin-tagging-flag-async-service",P.GooseTaggingNewUILLMModelName="goose-gtin-tagging-qa-async-service",P.WoodpeckerModelName="woodpecker-task-confidence-async-service",a.RoutingConditionName=k,(w=k||(a.RoutingConditionName=k={})).GooseNoMatch="goose-task-response-no-match",w.GooseMatch="goose-task-response-match"},628784:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.standardPipelineConfidenceModelParamsValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c},k=s(320522);let A=g.default.object().keys({enabled:g.default.boolean().required(),confidenceModels:g.default.array().required().items(g.default.object().keys({rolloutPercentage:g.default.number().min(0).max(1).required(),runAfter:g.default.string().required().valid(...Object.values(k.RunAfterOption)),confidenceThresholds:g.default.array().required().items(g.default.object().keys({modelName:g.default.string().required().valid(...Object.values(k.ConfidenceModelLaunchEndpoint)),minConfidence:g.default.number().min(0).max(1).required(),maxConfidence:g.default.number().min(0).max(1).required(),action:g.default.string().required(),condition:g.default.string().optional().valid(...Object.values(k.RoutingConditionName))}).required())}))}).custom(function(o){return o.confidenceModels.forEach(o=>{let a=[];o.modelRoutes.forEach(o=>{if(o.minConfidence>o.maxConfidence)throw Error("Cannot have min confidence greater than max.");a.push([o.minConfidence,o.maxConfidence])}),a.sort((o,a)=>o[0]-a[0]);for(let o=1;o<a.length;o++)if(a[o][0]<a[o-1][1])throw Error("Cannot have overlapping confidence thresholds.")}),o},"Custom validation of confidence thresholds.");a.standardPipelineConfidenceModelParamsValidator=A},532512:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.JsonSchemaWidget=void 0,a.JsonSchemaWidget=s,(c=s||(a.JsonSchemaWidget=s={})).WorkerTag="WorkerTag",c.Code="Code"},912515:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ActionBatchesSchema=void 0;var c=s(599789);let g={type:"object",properties:{enabled:{type:"boolean",description:"If true, user will be able to select this Sampling Strategy. If false, they can't select it.",default:!1},sampleSizeFn:{type:"string",title:"Sample Size Function",description:`Used to calculate the available sample size options that the user can select.
      
 ### Example
      
 _Fixed_ provides the user with a list of hardcoded options such as [10, 25, 50, etc.] as long as the options are smaller than the size of the Action Batch`,enum:Object.values(c.ActionBatchSampleSizeFunction),default:c.ActionBatchSampleSizeFunction.Fixed},mustPass:{type:"boolean",description:`In order to Send to Customer, the user must pass at least one Speed Audit with a Sampling Strategy with _Must Pass_ turned on (True). If _Must Pass_ is turned off (False) for every Sampling Strategy, the user does not need to pass or perform any Speed Audits to Send to Customer.
      
 ### Example
      
 If both _Worst Autoflag_ and _Most Lint Errors_ have _Must Pass_ turned on, then the user must pass a Speed Audit using one of them to Send to Customer.`,default:!0},minPassSampleSize:{type:"number",title:"Minimum Passing Sample Size",minimum:0,multipleOf:1,description:`For the Speed Audit to pass, the user must Speed Audit at least this many Subtasks. Must be greater than 0.
      
 ### Example
      
 If Minimum Passing Sample Size is 25, then the user can only Send to Customer if they choose to Speed Audit 25 or more Subtasks.`,default:25},passRate:{type:"number",title:"Pass Rate",minimum:0,maximum:1,multipleOf:.1,description:`For the Speed Audit to pass, the percentage of Subtasks marked as _Pass_ must be equal or greater to this number. Must be between 0 (0%) and 1 (100%).
      
 ### Example
      
 0.5 means 50% of the Subtasks in the Speed Audit must be marked as _Pass_.`,default:.8}}},k={type:"object",description:`Choose which sampling strategies the user can select. Sampling strategies are used to choose which subtasks should be speed audited. For each sampling strategy, you should also choose its sample size, whether is Must Pass or not, passing sample size, and passing rate.
    

 Subtasks that haven't been Speed Audited before will be prioritized over Subtasks that have been Speed Audited. For example, if two Subtasks have an Autoflag score of 0.5, but one of them has been Speed Audited before in the same Action Batch, then the other Subtask will be Speed Audited.`,properties:{[c.ActionBatchSamplingStrategy.WorstAutoflag]:{...g,description:"Speed Audit Subtasks that have the worst autoflag score."},[c.ActionBatchSamplingStrategy.MostLintErrors]:{...g,description:"Speed Audit Subtasks that have the most lint errors."},[c.ActionBatchSamplingStrategy.Random]:{...g,description:"Speed Audit Subtasks randomly."}}};a.ActionBatchesSchema={$schema:"http://json-schema.org/draft-07/schema#",type:"object",description:"Action Batches are a way of performing actions with many Subtasks at once. Right now they allow you to send Subtasks and Tasks to the Customer, but in the future they'll have more features!",properties:{sendToCustomer:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",description:"The Send to Customer Corp tool is a multi-step process that involves creating an Action Batch, ensuring the Action Batch is good quality by performing actions like Speed Audit, and finally sending to the Customer.",properties:{submissionActions:{type:"object",description:"Before Sending to Customer, the user will be asked to ensure their Action Batch is good quality by using the available submission actions like speed audit.",properties:{canSkipActions:{type:"boolean",title:"Can Skip Submission Actions",description:"If true, user can skip all submission actions and send to customer. If false, user must complete other submission actions before sending to customer.",default:!1},speedAudit:{type:"object",description:"If enabled, the user will be able to Speed Audit a sample of the subtasks in their Action Batch. If mustPass is true, the Speed Audit must have a passing score (a certain % of subtasks should be _Good_).",properties:{enabled:{type:"boolean",description:"Whether or not the user will see Speed Audit.",default:!1},samplingStrategies:k}},linters:{type:"array",description:"Name of the linters defined in Response linter config that should be used to verify the Action Batch before sending to Customer.",items:{type:"string"}}}}}}}}},982585:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ArchieraterConfigJsonSchema=a.ArchieraterConfigSchema=void 0;var c=s(689510),g=s(167469),k=s(204864);let A=c.z.object({reviewLevel:c.z.preprocess(o=>"string"!=typeof o||isNaN(parseInt(o))?o:Number(o),c.z.nativeEnum(g.ReviewLevel)).optional(),numConsensusAttempts:c.z.number().positive().optional(),archieClaimTime:c.z.number().positive().default(120),linearTicket:c.z.string().optional(),useVersion2:c.z.boolean().default(!0),enabled:c.z.boolean().default(!1),shouldPrefill:c.z.boolean().default(!1)});a.ArchieraterConfigSchema=A;let x={type:["object","null"],$schema:"http://json-schema.org/draft-07/schema#",properties:{reviewLevel:{widget:"Select",type:["string","number","null"],enum:k.enumValues(g.ReviewLevel),description:"Review level at which ArchieRater will submit attempts or prefill at."},numConsensusAttempts:{type:"number",description:"Number of attempts ArchieRater will submit for a consensus tasks if the hook is enabled.",default:3},archieClaimTime:{type:"number",description:"Number of minutes ArchieRater will claim for a task.",default:120},linearTicket:{type:"string",description:"Linear ticket tracking the ML request.",default:""},useVersion2:{type:"boolean",description:"Whether to use version 2 of the ArchieRater (always recommended).",default:!0},enabled:{type:"boolean",description:"Whether ArchieRater is enabled.",default:!1},shouldPrefill:{type:"boolean",description:"Whether ArchieRater should prefill the task.",default:!1}}};a.ArchieraterConfigJsonSchema=x},793810:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.CorpSchema=void 0;var c=s(912515);let g={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{actionBatches:c.ActionBatchesSchema}};a.CorpSchema=g},18908:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.parseCustomerAuditConfigSchemaFromConfig=a.CustomerAuditConfigSchema=void 0;var c=s(167469);let g={type:["object","null"],$schema:"http://json-schema.org/draft-07/schema#",properties:{customGradingKind:{type:"string",enum:Object.values(c.CustomGradingKind),description:"Grading specification to use for Customer Audits",default:c.CustomGradingKind.Scale},enableFixlessAudits:{type:"boolean",description:"Enable fixless audits",default:!1},disableStandardAudits:{type:"boolean",description:"Disable standard audits",default:!1},disableFeedbackItemStateUpdates:{type:"boolean",description:"Disable permissions for Contributors to update the Feedback Item state.",default:!1},customGradingKinds:{type:"array",widget:"GenericList",items:{type:"string",widget:"Select",enum:Object.values(c.CustomGradingKind)},title:"Custom Grading Kinds",description:"Array of gradings specification to use for Customer Audits",default:void 0}}};a.CustomerAuditConfigSchema=g,a.parseCustomerAuditConfigSchemaFromConfig=o=>{if(null==o)return;let{customGradingKind:a=c.CustomGradingKind.Scale,enableFixlessAudits:s,disableStandardAudits:g,disableFeedbackItemStateUpdates:k,customGradingKinds:A=[c.CustomGradingKind.Scale]}=o;if(!c.isCustomGradingKind(a))throw Error(`Invalid customGradingKind: ${a}`);if(!Array.isArray(A)||!A.every(c.isCustomGradingKind))throw Error(`Invalid customGradingKinds: ${A}`);return{customGradingKind:a,enableFixlessAudits:!!s,disableStandardAudits:!!g,disableFeedbackItemStateUpdates:!!k,customGradingKinds:A}}},241494:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.DeliveryHooksConfigSchema=a.SingleDeliveryHookConfigSchema=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(200571);let A={type:"object",$schema:"http://json-schema.org/draft-07/schema#",properties:{hookName:{type:"string",widget:"Select",enum:Object.values(k.DeliveryHookName)}}};a.SingleDeliveryHookConfigSchema=A,a.DeliveryHooksConfigSchema={type:"object",$schema:"http://json-schema.org/draft-07/schema#",properties:{DeliveryHooks:{type:"array",widget:"GenericList",items:A,default:void 0},RecipientEmails:{type:"array",widget:"GenericList",items:{type:"string"},default:void 0,validate:{validator:o=>g.default.isArray(o)&&g.default.every(o,o=>g.default.isString(o)&&o.includes("@")),message:"Expected list of recipient emails"}}}}},425784:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.LidarLiteConfigSchema=a.LidarLiteSettingsSchema=void 0;var c=s(532512);let g={type:["object","null"],$schema:"http://json-schema.org/draft-07/schema#",properties:{featureFlags:{type:"array",widget:"GenericList",items:{type:"string",title:"Feature flag name"},description:"List of unleash feature flags"},plugins:{type:"string",mongooseFormat:"json",format:"json",widget:c.JsonSchemaWidget.Code,description:'Plugins must be an object of the form { "setting.name.one": valueOne, "other.setting.name.two": valueTwo }. Refer to LidarLite config documentation for more details on each plugin.'}},required:["featureFlags","plugins"]};a.LidarLiteSettingsSchema=g,a.LidarLiteConfigSchema={type:["object","null"],$schema:"http://json-schema.org/draft-07/schema#",properties:{generalSettings:g,attemptSettings:g,reviewSettings:g,auditSettings:g,loadOnlyCameras:{type:"boolean",description:"Load only camera data for the scene",default:!1}},required:["generalSettings","attemptSettings","reviewSettings","auditSettings"]}},328885:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.LidarProcessingConfigSchema=void 0;var c=s(307903);let g={type:["object","null"],$schema:"http://json-schema.org/draft-07/schema#",properties:{outputFormat:{type:"string",enum:["bs4","bs5"],description:"Output scene format",default:"bs5"},shouldSplitSensorsByDeviceId:{type:"boolean",description:"Whether to split scene into multiple sensors by device id. Do not set for lidarsegmentation tasks",default:!1},shouldSupportClassic:{type:"boolean",description:"Whether to convert scene to per-frame output to support classic tooling. Turn off if your project only uses LidarLite",default:!0},shouldSkipOutlierProcessing:{type:"boolean",description:"Skip outlier point computation for LidarLite. Outlier processing normally requires +50% additional memory and +33% additional runtime. Non lidarsegmentation scenes without a predominance of outlier points can/should avoid",default:!0},shouldRunGroundMeshProcessing:{type:"boolean",description:"Whether to generate the ground mesh image",default:!1},shouldRunMetadataProcessing:{type:"boolean",description:"Run advanced metadata processing (volume computation, clustering)",default:!0},processingQueue:{type:"string",enum:["small","medium","large"],description:"Queue to process lidar processing jobs in",default:"medium"},prelabelTextUsingLLM:c.PrelabelTextUsingLLMProcessingConfigSchema},required:["outputFormat","shouldSplitSensorsByDeviceId","shouldSupportClassic","shouldRunMetadataProcessing"]};a.LidarProcessingConfigSchema=g},283419:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.parsePointCompressionSchemaFromConfig=a.PointCompressionConfigSchema=void 0;let s={type:["object","null"],$schema:"http://json-schema.org/draft-07/schema#",description:"Configuration for bynary scene points compression.",properties:{precision:{type:"number",enum:Object.values([0,1,2,3]),description:"Precision to use for point compression use 3 for MM, 2 for CM, 1 for DM, 0 for M",default:3},enablePointCompression:{type:"boolean",description:"Enable point compression",default:!1},removeDuplicatePoints:{type:"boolean",description:"Remove duplicate points",default:!1}}};a.PointCompressionConfigSchema=s,a.parsePointCompressionSchemaFromConfig=o=>{if(null==o)return;let{precision:a,enablePointCompression:s,removeDuplicatePoints:c}=o;if(!(a>=0&&a<=3))throw Error(`Invalid precision: ${a}`);return{precision:a,enablePointCompression:!!s,removeDuplicatePoints:!!c}}},588759:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.PostProcessingConfigSchema=void 0;var c=s(167469);let g={type:["object","null"],$schema:"http://json-schema.org/draft-07/schema#",properties:{customPostProcessingKind:{type:"string",enum:Object.values(c.CustomPostProcessingKind),description:"Custom post-processing to perform in pipeline",default:void 0},shouldRunLegacyResponseConversion:{type:"boolean",description:"Multi-Stage only: Whether to legacy merge of responses",default:!1},generateLegacyCuboidResponse:{type:"boolean",description:"Whether to generate a legacy cuboid response",default:!1},generateLegacyLTDResponse:{type:"boolean",description:"Whether to generate a legacy LTD response",default:!1}}};a.PostProcessingConfigSchema=g},307903:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.PrelabelTextUsingLLMProcessingConfigSchema=void 0,a.PrelabelTextUsingLLMProcessingConfigSchema={type:["object","null"],$schema:"http://json-schema.org/draft-07/schema#",properties:{rateOfTaskToProcess:{type:"number",description:"Rate of task to process, 1 means 100% of tasks, 0.5 means 50% of tasks. This is used to control the rate of tasks to process when running Lidar Processing Pipeline. Based on random number generated by the pipeline",default:1,minimum:0,maximum:1},systemPrompt:{type:"string",description:"System prompt to use for the LLM",default:""},userPrompt:{type:"string",description:"User prompt to use for the LLM",default:""},useMessageHistory:{type:"boolean",description:"Whether to use the message history for the LLM",default:!0},model:{type:"string",enum:["openai/gpt-4o","openai/gpt-4-turbo","openai/gpt-4.1","openai/gpt-5","gemini/gemini-2.0-flash","gemini/gemini-2.5-flash","gemini/gemini-2.5-pro"],description:"Model to use for the LLM",default:"openai/gpt-4.1"},apiKeyVar:{type:["string","null"],description:'Api key variable name to use for the LLM, if not provided, the default api key will be used "team/AVCVEng/SensorFusionTask/openai-secret"',default:null},requestPerMinute:{type:"number",description:"Number of requests per minute to the LLM, should be based on api key rate limits",default:10},useVideo:{type:"boolean",description:"For models with support for videos, if false the video will be converted into a sequence of images",default:!1},useVideoSplitting:{type:"boolean",description:"Split the video into left and right halves for analysis",default:!1},videoSplitMode:{type:"string",enum:["left_only","right_only","compare_both"],description:"Choose which split to analyze: left half only, right half only, or compare both halves",default:"compare_both"},comparisonSystemPrompt:{type:"string",description:"System prompt for the comparison step when using compare_both mode",default:""},comparisonUserPrompt:{type:"string",description:'Custom user prompt for comparison in "compare_both" mode. Use template variables: %%ORIGINAL_USER_PROMPT%%, %%LEFT_ANALYSIS%%, %%RIGHT_ANALYSIS%%, %%ORIGINAL_SYSTEM_PROMPT%%. If empty, uses a default comparison prompt',default:""},comparisonVideoInput:{type:"string",enum:["left_video","right_video","no_video"],description:"Which video to send with the comparison prompt: left video, right video, or no video (text-only comparison)",default:"left_video"},cameraId:{type:["string","null"],description:"Camera id to use for the LLM",default:null},fps:{type:"number",description:'FPS to generate sequence of images from video (only is "useVideo" is false)',default:1},groupSize:{type:"number",description:'Number of images to group together per request (only is "useVideo" is false)',default:20},overlap:{type:"number",description:'Number of images to overlap between groups (only is "useVideo" is false)',default:0},examplesPrompt:{type:["string","null"],description:"Prompt to use as first request, with examples to follow and example image/video urls",default:null},examplesAssetsUrls:{type:["string","null"],description:'Image/video urls to use on example prompt request (only is "examplesPrompt" is provided)',default:null},examplesResponseSchema:{type:["string","null"],description:'Response schema to use on example prompt request (only is "examplesPrompt" is provided)',default:null}},required:["systemPrompt","userPrompt","useMessageHistory","model","apiKeyVar","requestPerMinute","useVideo","cameraId"]}},604658:function(o,a,s){"use strict";a.FL=a.GN=a.$7=a.Uq=a.iR=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c};let recursiveExtract=o=>"object"!=typeof o||null===o?o:o.leaf?o.value:g.default.mapValues(o,recursiveExtract);a.iR=recursiveExtract;let k=["if","then","else","allOf","oneOf","anyOf"];a.Uq=k;let A=[...k,"properties"];a.$7=A;let x=[...A,"items"];a.GN=x;let P=x.map(o=>o.toLowerCase());a.FL=P},200571:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.DeliveryHookName=void 0,a.DeliveryHookName=s,(c=s||(a.DeliveryHookName=s={})).DeliveryHookTemplate="delivery_hook_template",c.DolphinCodingDeliveryHook="dolphin_coding_delivery_hook",c.BeeLLMDeliveryHook="bee_llm_delivery_hook",c.CharmanderCodingDeliveryHook="charmander_coding_delivery_hook",c.AlpacaBrainstormingDeliveryHook="alpaca_brainstorming_delivery_hook",c.AlpacaBrainstormingLongParaphraseDeliveryHook="alpaca_brainstorming_long_paraphrase_delivery_hook",c.AlpacaGenericDeliveryHook="alpaca_generic_delivery_hook",c.AlpacaAspectDeliveryHook="alpaca_aspect_delivery_hook",c.AlpacaProductSummaryDeliveryHook="alpaca_product_summary_delivery_hook",c.NightingalePromptCreationDeliveryHook="nightingale_prompt_creation_delivery_hook",c.NightingalePromptLabelingDeliveryHook="nightingale_prompt_labeling_delivery_hook",c.NightingalePromptRankingDeliveryHook="nightingale_prompt_ranking_delivery_hook",c.NightingaleSxSRlhfDeliveryHook="nightingale-sxs-rlhf-delivery-hook",c.NightingaleReplicationSxSRlhfDeliveryHook="nightingale-replication-sxs-rlhf-delivery-hook",c.NightingaleMultimodalSftDeliveryHook="nightingale-multimodal-sft-delivery-hook",c.DolphinHenrykDeliveryHook="dolphin-henryk-delivery-hook",c.FlamingoSafetyResponseWritingDeliveryHook="flamingo-safety-response-writing-delivery-hook"},798451:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getBoundingBoxIoU=function(o,a){let s=getBoundingBoxIntersect(o,a);if(!s)return 0;let c=getBoundingBoxArea(s),g=getBoundingBoxArea(o),k=getBoundingBoxArea(a);return c/(g+k-c)},a.getBoundingBoxOverlap=function(o,a){let s=getBoundingBoxIntersect(o,a);if(!s)return 0;let c=getBoundingBoxArea(s),g=getBoundingBoxArea(o),k=getBoundingBoxArea(a);return 0===g||0===k?1:Math.max(c/g,c/k)},a.getBoundingBoxArea=getBoundingBoxArea,a.getBoundingBoxIntersect=getBoundingBoxIntersect,a.getBoundingBoxCenterPoint=function(o){return{x:o.left+o.width/2,y:o.top+o.height/2}},a.getBoundingBoxClosestPointToLeft=function(o,a){if(o.length>0){let s={x:o[0].left,y:o[0].top},c=g.distance(a,s);for(let k of o){let o=g.distance(a,{x:k.left,y:k.top}),A=g.distance(a,{x:k.left,y:k.top+k.height});o<c&&(s={x:k.left,y:k.top},c=o),A<c&&(s={x:k.left,y:k.top+k.height},c=A)}return s}return{x:0,y:0}},a.isBoundingBoxInMargin=function(o,a,s,c){return[a.top-o.top,a.left-o.left,o.top+o.height-(a.top+a.height),o.left+o.width-(a.left+a.width)].every(o=>o>=-s&&o<=c)},a.mergeBoundingBoxes=function(o,a){let s=Math.min(o.top,a.top),g=Math.min(o.left,a.left),k=Math.max(o.left+o.width,a.left+a.width),A=Math.max(o.top+o.height,a.top+a.height);return{type:c.GeometryType.BoundingBox,top:s,left:g,width:k-g,height:A-s}},a.expandBoundingBox=function(o,a){return{type:o.type,top:o.top-a,left:o.left-a,width:o.width+2*a,height:o.height+2*a}},a.isBoundingBoxFullyContained=function(o,a,s){return o.top-s-a.top<=0&&o.left-s-a.left<=0&&o.top+o.height+s-(a.top+a.height)>=0&&o.left+o.width+s-(a.left+a.width)>=0},a.scaleBoundingBox=function(o,a,s){let c=s.width/a.width,g=s.height/a.height;return{type:o.type,left:o.left*c,top:o.top*g,width:o.width*c,height:o.height*g}},a.ocrBoxToBoundingBox=function(o,a){return{type:c.GeometryType.BoundingBox,left:o.Left*a.width,top:o.Top*a.height,width:o.Width*a.width,height:o.Height*a.height}},a.boundingBoxToOcrBox=function(o,a){return{Left:o.left/a.width,Top:o.top/a.height,Width:o.width/a.width,Height:o.height/a.height}};var c=s(116615),g=s(141862);function getBoundingBoxArea(o){return o.width*o.height}function getBoundingBoxIntersect(o,a){let s=Math.max(o.left,a.left),g=Math.max(o.top,a.top),k=Math.min(o.left+o.width,a.left+a.width),A=Math.min(o.top+o.height,a.top+a.height),x=k-s,P=A-g;return x<=0||P<=0?null:{type:c.GeometryType.BoundingBox,top:g,left:s,width:x,height:P}}},525277:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.isLineSegmentIntersect=a.getPointPixels=a.getPointPercent=void 0,a.getPointPercent=(o,{offsetWidth:a,offsetHeight:s})=>({x:o.x/a,y:o.y/s}),a.getPointPixels=(o,{offsetWidth:a,offsetHeight:s})=>({x:o.x*a,y:o.y*s}),a.isLineSegmentIntersect=(o,a,s,c)=>ccw(o,s,c)!==ccw(a,s,c)&&ccw(o,a,s)!==ccw(o,a,c);let ccw=(o,a,s)=>(s.y-o.y)*(a.x-o.x)>(a.y-o.y)*(s.x-o.x)},247740:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getPolygonIoU=function(o,a){let s=getPolygonIntersect(o,a);if(!s)return 0;let c=getPolygonUnion(o,a);if(!c)return 0;let g=getPolygonArea(s),k=getPolygonArea(c);return 0===k?0:g/k},a.getPolygonOverlap=function(o,a){let s=getPolygonIntersect(o,a);if(!s)return 0;let c=getPolygonArea(s),g=getPolygonArea(o),k=getPolygonArea(o);return 0===g||0===k?1:Math.max(c/g,c/k)},a.getPolygonArea=getPolygonArea,a.isPolygonClockwise=isPolygonClockwise,a.resetPolygonClockwise=function(o){return isPolygonClockwise(o)?o:{type:o.type,vertices:[o.vertices[1],o.vertices[0],o.vertices[3],o.vertices[2]]}},a.getPolygonUnion=getPolygonUnion,a.getPolygonIntersect=getPolygonIntersect,a.getQuadrilateralCenterPoint=function(o){let a=0,s=0;for(let c of o)a+=c.x,s+=c.y;return{x:a/o.length,y:s/o.length}},a.getPolygonClosestPointToLeft=function(o,a){if(o.length>0){let s=x.default.flatten(o),c={x:s[0].x,y:s[0].y},g=k.distance(a,c);for(let o of s){let s=k.distance(a,o);s<g&&(c=o,g=s)}return c}return{x:0,y:0}},a.checkFastPolygonIntersect=function(o,a){for(let s=0;s<4;s++)for(let c=0;c<4;c++){let g=o.vertices[s],k=o.vertices[(s+1)%4],x=a.vertices[c],P=a.vertices[(c+1)%4];if(A.isLineSegmentIntersect(g,k,x,P))return!0}return isPointInQuadrilateral(o,a.vertices[0])||isPointInQuadrilateral(a,o.vertices[0])},a.isPolygonInMargin=function(o,a,s,c){let g=Math.min(s,c),d=(o,a)=>{let s=o.x-a.x,c=o.y-a.y;return Math.sqrt(s*s+c*c)};return[0,1,2,3].every(s=>d(o.vertices[s],a.vertices[s])<=g)},a.getLocationPolygon=function(o){return o.type===g.GeometryType.BoundingBox?{type:g.GeometryType.Polygon,vertices:[{x:o.left,y:o.top},{x:o.left+o.width,y:o.top},{x:o.left+o.width,y:o.top+o.height},{x:o.left,y:o.top+o.height}]}:o.type===g.GeometryType.Polygon?o:void P.assertNever(o)},a.ocrPolygonToPolygon=function(o,a){return{type:g.GeometryType.Polygon,vertices:(o??[]).map(o=>({x:o.X*a.width,y:o.Y*a.height}))}},a.scalePolygon=function(o,a,s){return{...o,vertices:o.vertices.map(o=>({x:o.x/a.width*s.width,y:o.y/a.height*s.height}))}},a.isPointInTriangle=a.isPointInQuadrilateral=void 0;var c=_interopRequireDefault(s(373291)),g=s(116615),k=s(141862),A=s(525277),x=_interopRequireDefault(s(298784)),P=s(810755);function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}function getPolygonArea(o){let a=0,s=o.vertices.length-1;for(let c=0;c<o.vertices.length;c++){let{x:g,y:k}=o.vertices[c],{x:A,y:x}=o.vertices[s];a+=(A+g)*(x-k),s=c}return Math.abs(a)/2}function isPolygonClockwise(o){let a=0,s=o.vertices.length-1;for(let c=0;c<o.vertices.length;c++){let{x:g,y:k}=o.vertices[c],{x:A,y:x}=o.vertices[s];a+=(A-g)*(x+k),s=c}return a>0}function getPolygonUnion(o,a){let s=c.default.union(toPolyBool(o),toPolyBool(a));return 1!==s.regions.length?null:fromPolyBool(s)}function getPolygonIntersect(o,a){let s=c.default.intersect(toPolyBool(o),toPolyBool(a));return 1!==s.regions.length?null:fromPolyBool(s)}function toPolyBool(o){return{regions:[o.vertices.map(o=>[x.default.round(o.x,5),x.default.round(o.y,5)])],inverted:!1}}function fromPolyBool(o){return{type:g.GeometryType.Polygon,vertices:o.regions[0].map(o=>({x:o[0],y:o[1]}))}}let isPointInQuadrilateral=(o,a)=>isPointInTriangle(o.vertices[0],o.vertices[1],o.vertices[2],a)||isPointInTriangle(o.vertices[2],o.vertices[3],o.vertices[0],a);a.isPointInQuadrilateral=isPointInQuadrilateral;let isPointInTriangle=(o,a,s,c)=>{let g=c.x-o.x,k=c.y-o.y,A=(a.x-o.x)*k-(a.y-o.y)*g>0;return(s.x-o.x)*k-(s.y-o.y)*g>0!==A&&(s.x-a.x)*(c.y-a.y)-(s.y-a.y)*(c.x-a.x)>0===A};a.isPointInTriangle=isPointInTriangle},248672:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.RedactMethod=void 0,a.RedactMethod=s,(c=s||(a.RedactMethod=s={})).Name="name",c.Email="email",c.Phone="phone",c.Text="text"},43356:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getDims=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(308408);let getPolygonDims=o=>{let a={},{vertices:s}=o;if(!s||0===s.length)return null;let c=s.reduce((o,a)=>({minX:Math.min(o.minX,a.x),maxX:Math.max(o.maxX,a.x),minY:Math.min(o.minY,a.y),maxY:Math.max(o.maxY,a.y)}),{minX:s[0].x,maxX:s[0].x,minY:s[0].y,maxY:s[0].y});return a.x=((c.minX+c.maxX)/2).toFixed(0),a.y=((c.minY+c.maxY)/2).toFixed(0),a.w=(c.maxX-c.minX).toFixed(0),a.h=(c.maxY-c.minY).toFixed(0),a},A={[k.AnnotationGeometry.Point]:o=>{let a={},{x:s,y:c}=o;return g.default.isNil(s)||g.default.isNil(c)?null:(a.x=s.toFixed(0),a.y=c.toFixed(0),a)},[k.AnnotationGeometry.Line]:o=>{let a=getPolygonDims(o),{vertices:s}=o;return s&&0!==s.length?(a.l=s.slice(1).reduce((o,a)=>({dist:o.dist+Math.sqrt((o.prevX-a.x)**2+(o.prevY-a.y)**2),prevX:a.x,prevY:a.y}),{dist:0,prevX:s[0].x,prevY:s[0].y}).dist.toFixed(0),a):null},[k.AnnotationGeometry.Box]:o=>{let a={},{x:s,y:c,width:k,height:A}=o;return g.default.isNil(s)||g.default.isNil(c)||g.default.isNil(k)||g.default.isNil(A)?null:(a.x=(s+k/2).toFixed(0),a.y=(c+A/2).toFixed(0),a.w=k.toFixed(0),a.h=A.toFixed(0),a)},[k.AnnotationGeometry.Ellipse]:o=>{let a={},{center:s,width:c,height:k}=o;return!s||g.default.isNil(c)||g.default.isNil(k)?null:(a.w=c.toFixed(0),a.h=k.toFixed(0),a.x=s[0].toFixed(0),a.y=s[1].toFixed(0),a)},[k.AnnotationGeometry.ExtremalPoints]:getPolygonDims,[k.AnnotationGeometry.Cuboid]:o=>{let a={},{face:s}=o;return s?(a.w=(s.x2-s.x1).toFixed(0),a.h=(s.y2-s.y1).toFixed(0),a.x=((s.x1+s.x2)/2).toFixed(0),a.y=((s.y1+s.y2)/2).toFixed(0),a):null},[k.AnnotationGeometry.Polygon]:getPolygonDims};a.getDims=A},60271:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.orderedPointArraysEqual=a.getRotatedVertices=a.resizeRotatedBox=void 0;let getWidthUnit=o=>[Math.cos(o),1*Math.sin(o)],getHeightUnit=o=>[-1*Math.sin(o),Math.cos(o)];a.resizeRotatedBox=({width:o,height:a,center:s,rotation:c,diff:g,sign:k})=>{let A,x;let P=g[0]*getWidthUnit(c)[0]+g[1]*getWidthUnit(c)[1],w=Math.abs(o+k[0]*P),F=g[0]*getHeightUnit(c)[0]+g[1]*getHeightUnit(c)[1],R=Math.abs(a+k[1]*F);0===k[0]?(A=k[1]*(R-a)/2*Math.sin(-c),x=k[1]*(R-a)/2*Math.cos(-c)):0===k[1]?(A=k[0]*(w-o)/2*Math.cos(c),x=k[0]*(w-o)/2*Math.sin(c)):(A=g[0]/2,x=g[1]/2);let D={x:s.x+A,y:s.y+x};return{center:D,width:w,height:R}},a.getRotatedVertices=({width:o,height:a,center:s,rotation:c,returnMidpoints:g})=>{let k=[Math.cos(c),-1*Math.sin(c)],A=[1*Math.sin(c),Math.cos(c)],x=(g?[{x:0,y:-1*a/2},{x:o/2,y:0},{x:0,y:a/2},{x:-1*o/2,y:0}]:[{x:-1*o/2,y:-1*a/2},{x:o/2,y:-1*a/2},{x:o/2,y:a/2},{x:-1*o/2,y:a/2}]).map(o=>{let a=k[0]*o.x+k[1]*o.y,c=A[0]*o.x+A[1]*o.y;return{x:a+s.x,y:c+s.y}});return x},a.orderedPointArraysEqual=(o,a)=>{if(o.length!==a.length)return!1;for(let s=0;s<o.length;s++){let c=o[s],g=a[s];if(Math.round(c.x)!==Math.round(g.x)||Math.round(c.y)!==Math.round(g.y))return!1}return!0}},318308:function(o,a,s){"use strict";a.Z=function(o,{workerFacing:a=!1,rapid:s=!1}={}){if(!o)return"All";let c=g.default.get(A,[o,a?"worker":"customer"]);return s&&o===k.TaskType.DataCollection&&(c="Project Setup Incomplete"),s&&o===k.TaskType.TextCollection&&(c=`${c} / Categorization`),c||a||(c=x[o]),c||g.default.startCase(o)};var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469);let A={[k.TaskType.Annotation]:{customer:"2D Box Annotation",worker:"Box Annotation"},[k.TaskType.AudioCollection]:{customer:"Audio Collection",worker:"Audio Collection"},[k.TaskType.AudioTranscription]:{customer:"Audio Transcription",worker:"Audio Transcription"},[k.TaskType.Categorization]:{customer:"Categorization",worker:"Categorization"},[k.TaskType.Comparison]:{customer:"Comparison",worker:"Comparison"},[k.TaskType.ContentModel]:{customer:"Content Model",worker:"Content Model"},[k.TaskType.CuboidAnnotation]:{customer:"3D Cuboid Annotation",worker:"Cuboid Annotation"},[k.TaskType.DataCollection]:{customer:"Data Collection",worker:"Data Collection"},[k.TaskType.DocumentCorrection]:{customer:"Document Correction",worker:"Document Correction"},[k.TaskType.DocumentTranscription]:{customer:"Document Transcription",worker:"Document Transcription"},[k.TaskType.DocumentModel]:{customer:"Document Model",worker:"Document Model"},[k.TaskType.ImageAnnotation]:{customer:"General Image Annotation",worker:"Image Annotation"},[k.TaskType.LidarAnnotation]:{customer:"Lidar Annotation",worker:"Lidar Annotation"},[k.TaskType.LidarSegmentation]:{customer:"Lidar Segmentation",worker:"Lidar Segmentation"},[k.TaskType.LineAnnotation]:{customer:"Line & Spline Annotation",worker:"Line Annotation"},[k.TaskType.NamedEntityRecognition]:{customer:"Named Entity Recognition",worker:"Text Highlighting"},[k.TaskType.PointAnnotation]:{customer:"Point Annotation",worker:"Point Annotation"},[k.TaskType.PolygonAnnotation]:{customer:"Polygon Annotation",worker:"Polygon Annotation"},[k.TaskType.SegmentAnnotation]:{customer:"2D Semantic Segmentation",worker:"Image Segmentation"},[k.TaskType.TextCollection]:{customer:"Text Collection",worker:"Text Collection"},[k.TaskType.Transcription]:{customer:"OCR Transcription",worker:"Transcription"},[k.TaskType.VideoAnnotation]:{customer:"General Video Annotation",worker:"Video Annotation"},[k.TaskType.VideoBoxAnnotation]:{customer:"Video Box Annotation",worker:"Video Box Annotation"},[k.TaskType.VideoCaptioning]:{customer:"Video Captioning",worker:"Video Captioning"},[k.TaskType.VideoCuboidAnnotation]:{customer:"Video Cuboid Annotation",worker:"Video Cuboid Annotation"},[k.TaskType.VideoPolygonAnnotation]:{customer:"Video Polygon Annotation",worker:"Video Polygon Annotation"},[k.TaskType.VideoPlaybackAnnotation]:{customer:"Video Playback Annotation",worker:"Video Playback Annotation"},[k.TaskType.GenericDataCollection]:{customer:"Generic Data Collection",worker:"Generic Data Collection"},[k.TaskType.MultiModalTranscription]:{customer:"Multimodal Transcription",worker:"Multimodal Transcription"},[k.TaskType.LidarLinking]:{customer:"Lidar 2D/3D Linking",worker:""},[k.TaskType.LidarStitching]:{customer:"Lidar Stitching",worker:""},[k.TaskType.LidarTopdown]:{customer:"Lidar Topdown",worker:""},[k.TaskType.FixAnnotation]:{customer:"Single Box Annotation",worker:"Classic - Single Box"},[k.TaskType.LaneAnnotation]:{customer:"Lane Annotation",worker:"Classic - Lanes"},[k.TaskType.PhoneCall]:{customer:"Phone Call",worker:"Classic - Phone Call"},[k.TaskType.Chat]:{customer:"Chat V1",worker:"Chat V1"},[k.TaskType.ChatExperimental]:{customer:"Chat V2",worker:"Chat V2"},[k.TaskType.ChatV2]:{customer:"Chat V2",worker:"Chat V2"},[k.TaskType.MultiChat]:{customer:"Multi-Chat",worker:"Multi-Chat"}},x={"semantic-segmentation":"Semantic Segmentation","sensor-fusion-cuboids":"Sensor Fusion Cuboids","sensor-fusion-segmentation":"Sensor Fusion Segmentation",audiospeech:"Audio Speech",boxannotation:"2D Box Annotation",imageannotation:"Image Annotation",imagecategorization:"Image Categorization",imagerecognition:"Image Recognition",otherannotation:"Other Annotation",sentimentanalysis:"Sentiment & Intent Analysis",textcategorization:"Text Categorization",textclassification:"Text Classification",utterancecollection:"Utterance Collection",lidartopdown:"Lidar Top-Down Annotation"}},950382:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.shiftAnnotation=function(o,a,s){if(o.type===g.AnnotationGeometry.Point)return{...o,x:o.x+a,y:o.y+s};{let c=o.vertices,g=c.map(o=>({...o,x:o.x+a,y:o.y+s}));return{...o,vertices:g}}},a.freezeAllSeamVertices=freezeAllSeamVertices,a.removeAllSeams=function(o){return o.map(o=>o.type===g.AnnotationGeometry.Line?{...o,vertices:o.vertices.map(o=>x.default.omit(o,"seamId"))}:o.type===g.AnnotationGeometry.Polygon?{...o,vertices:o.vertices.map(o=>x.default.omit(o,"seamId"))}:o)},a.unfreezeAnnotation=unfreezeAnnotation,a.lockLabelAndAttributesAnnotation=lockLabelAndAttributesAnnotation,a.unlockLabelAndAttributesAnnotation=unlockLabelAndAttributesAnnotation,a.onlyLockLabelAndAttributesCuboidAnnotationsBasedOnLabel=function(o){let a=A.BEE_LABELS_KEEP_LOCKED;return o.map(o=>a.includes(o.label??"")?lockLabelAndAttributesAnnotation(o):unlockLabelAndAttributesAnnotation(o))},a.lockLabelAndAttributesAnnotations=function(o){return o.map(lockLabelAndAttributesAnnotation)},a.unlockLabelAndAttributesAnnotations=function(o){return o.map(unlockLabelAndAttributesAnnotation)},a.transformDerivedToPolygonAnnotations=function(o){return o.map(transformDerivedToPolygonAnnotation)},a.transformDerivedToPolygonAnnotation=transformDerivedToPolygonAnnotation,a.unfreezeAnnotationsInsideAR=function(o){return o.map(o=>{let a=o.metadata,s=A.BEE_LABELS_KEEP_LOCKED;return a?.isOutsideAR||s.includes(o.label??"")?freezeAnnotation(o):freezeAllSeamVertices(unfreezeAnnotation(o))})},a.freezeFrontendPathAnnotation=function(o){return{...o,vertices:o.vertices.map((a,s)=>({...a,anchored:!0,...s<o.vertices.length-1||o.type===g.AnnotationGeometry.Polygon?{anchoredSegment:!0}:{}}))}},a.freezeAnnotation=freezeAnnotation,a.freezeAnnotations=function(o){return o.map(freezeAnnotation)},a.mapBeeInsideAnnotationsAsDeletable=function(o){return o.map(o=>isInsideAnnotationOrHasSeamId(o)&&!A.BEE_LABELS_KEEP_LOCKED.includes(o.label??"")?{...o,metadata:{...o.metadata,isUndeletable:!1}}:o)},a.isClockwiseOrder=function(o){if(o.length<2)throw Error("The input edge contains less than 2 vertices; directionality cannot be determined");let a=o;return samePoint(o[0],o[o.length-1],0)||(a=[...a,o[0]]),0>signedArea(a)},a.chooseInsideAnnotationFilter=function(o){let a=o.base_annotations?.options?.remove_bordering_annotations;return a?isAnnotationStrictlyInside:isInsideAnnotationOrHasSeamId},a.isInsideAnnotationOrHasSeamId=isInsideAnnotationOrHasSeamId,a.isAnnotationStrictlyOutside=function(o){let a=o.vertices?.some(o=>!!o.seamId);return isAnnotationOutsideAr(o)&&!a},a.isAnnotationStrictlyInside=isAnnotationStrictlyInside,a.isPreviousDerivedAnnotation=a.isAnnotationOutsideAr=a.isSameSegment=a.samePoint=a.signedArea=a.DEFAULT_EPSILON=void 0;var c,g=s(308408),k=s(492027),A=s(281652),x=(c=s(298784))&&c.__esModule?c:{default:c};a.DEFAULT_EPSILON=1e-4;let signedArea=o=>{let a=0;for(let s=0,c=1;s<o.length;s++,c++)c%=o.length,a+=o[s].x*o[c].y-o[c].x*o[s].y;return a};a.signedArea=signedArea;let samePoint=(o,a,s)=>Math.abs(o.x-a.x)+Math.abs(o.y-a.y)+Math.abs((o.worldZ??0)-(a.worldZ??0))<=(s??1e-4)/2;function freezeAllSeamVertices(o){if(o.type===g.AnnotationGeometry.Point);else if(o.type===g.AnnotationGeometry.Line)return{...o,vertices:o.vertices.map(o=>({...o,anchored:!!o.seamId}))};else if(o.type===g.AnnotationGeometry.Polygon)return{...o,vertices:x.default.map(o.vertices,(o,a,s)=>{let c=0===a?s.length-1:a-1,g=s[c];return{...o,anchored:!!o.seamId||!!g.seamId,anchoredSegment:!!o.seamId}})};return o}function unfreezeAnnotation(o){return o.type===g.AnnotationGeometry.Point?o:{...o,vertices:o.vertices.map((a,s)=>({...a,anchored:!1,...s<o.vertices.length-1?{anchoredSegment:!1}:{}}))}}function lockLabelAndAttributesAnnotation(o){let a={...o.metadata,lockLabelAndAttributes:!0},s={...o,metadata:a};return s}function unlockLabelAndAttributesAnnotation(o){let a={...o.metadata,lockLabelAndAttributes:!1},s={...o,metadata:a};return s}function transformDerivedToPolygonAnnotation(o){let a={...o.metadata};if(delete a.derivedMetadata,o.type===g.AnnotationGeometry.Point)return{...o,metadata:a};let s=o.vertices.map(o=>{let a={...o};return delete a.layer1VertexId,delete a.layer2VertexId,a});return{...o,vertices:s,metadata:a}}function freezeAnnotation(o){return o.type===g.AnnotationGeometry.Point?(o.anchored=!0,o):{...o,vertices:o.vertices.map((a,s)=>({...a,anchored:!0,...s<o.vertices.length-1||o.type===g.AnnotationGeometry.Polygon?{anchoredSegment:!0}:{}}))}}a.samePoint=samePoint,a.isSameSegment=(o,a,s)=>{if(o.length!==a.length)return!1;let c=x.default.range(o.length).every(c=>{let g=o[c],k=a[c];return samePoint(g,k,s)}),g=x.default.range(o.length).every(c=>{let g=o[c],k=a[a.length-1-c];return samePoint(g,k,s)});return c||g};let isAnnotationOutsideAr=o=>o.metadata&&o.metadata.isOutsideAR;function isInsideAnnotationOrHasSeamId(o){let a=o.vertices?.some(o=>!!o.seamId);return!isAnnotationOutsideAr(o)||a||k.isDerivedAnnotation(o)}function isAnnotationStrictlyInside(o){return!isAnnotationOutsideAr(o)||k.isDerivedAnnotation(o)}a.isAnnotationOutsideAr=isAnnotationOutsideAr,a.isPreviousDerivedAnnotation=o=>{let a=o.metadata;return!!a?.previousDerivedMetadata}},834458:function(o,a){"use strict";var s,c,g,k;Object.defineProperty(a,"__esModule",{value:!0}),a.topdownTaskProcessorVersionList=a.topdownTaskProcessorVersionMap=a.TopdownTaskProcessorAlias=a.TopdownTaskProcessorVersion=void 0,a.TopdownTaskProcessorVersion=s,(g=s||(a.TopdownTaskProcessorVersion=s={})).latest_default="latest_default",g.production="production",a.TopdownTaskProcessorAlias=c,(k=c||(a.TopdownTaskProcessorAlias=c={})).latest_default="default",k.production="TopdownTaskProcessor-production";let A={[s.latest_default]:c.latest_default,[s.production]:c.production};a.topdownTaskProcessorVersionMap=A;let x=Object.keys(A);a.topdownTaskProcessorVersionList=x},281652:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.BEE_LABELS_KEEP_LOCKED=a.BEE_CUBOID_LABELS=void 0;var c=s(143986);let g=["Road Sign","Traffic Light","Pedestrian Crossing Light","Bicycle Crossing Light","Highway Metering Light","Railroad Crossing Light","Lane Control Signal","Uncommon Traffic Light","Traffic Light Can't Tell","Pedestrian Hybrid Beacon","Emergency Vehicle Hybrid Beacon","Traffic Light Ignore","Roadway Gate","Gate","Delete Cuboid"];a.BEE_CUBOID_LABELS=g;let k=g.concat([c.ANNOTATABLE_REGION,c.NO_DATA_ZONE]);a.BEE_LABELS_KEEP_LOCKED=k},143986:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.derivedAnnotationLinkLabelList=a.deleteAndDuplicateLabelList=a.deleteLabelList=a.OSM_HIGHWAY=a.SPOTTER_POINT=a.SPOTTER_POLYGON=a.CROSS_SECTION=a.NO_DATA_ZONE=a.ANNOTATABLE_REGION=a.DEFAULT_SEGMENTER_LABEL=void 0,a.DEFAULT_SEGMENTER_LABEL="Segmenter",a.ANNOTATABLE_REGION="Annotatable Region",a.NO_DATA_ZONE="No Data Zone",a.CROSS_SECTION="Cross Section",a.SPOTTER_POLYGON="Spotter Polygon",a.SPOTTER_POINT="Spotter Point";let s="OSM Highway";a.OSM_HIGHWAY=s;let c=["Delete Cuboid","Delete Polygon","Delete Line","Delete Point",s];a.deleteLabelList=c;let g=[...c,"Duplicate Polygon","Duplicate Line","Duplicate Point"];a.deleteAndDuplicateLabelList=g,a.derivedAnnotationLinkLabelList=["Lane Segment Stitch","Road Segment Stitch","Merge/Split Lane Segment Stitch","Bicycle Lane Segment Stitch"]},297393:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getPointIntersections=function(o){if(!o)throw Error("Computing point intersections with undefined context");return o.pointIntersections||(o.pointIntersections=computeIntersections(o)),o.pointIntersections},a.getPointIntersectionsWeighted=getPointIntersectionsWeighted;var c=_interopRequireDefault(s(298784)),g=s(168212),k=_interopRequireDefault(s(138385));function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}function computeIntersections(o,a){let s=new Map,A=Array.from(o.clusteredSegmentations.keys()).sort(),x=[[A[0],A[1]]];A[2]&&x.push([A[0],A[2]],[A[1],A[2]]);let P=o.isSceneFlattened?1:o.clusteredSegmentations.get(A[0]).length;function doFrame(a,c){for(let[k,A]of x){let x=o.clusteredSegmentations.get(k)[a],P=o.clusteredSegmentations.get(A)[a];g.buildLSSCounts({startSource:k,endSource:A,startLabels:x,endLabels:P,frame:a,intersectionMap:s,pointWeights:c})}}if(a){let a=function(o){if(!o.devicePositions)throw Error("No device positions in context");let a=c.default.sortBy(c.default.entries(o.devicePositions),([o])=>c.default.toNumber(o)).map(([,o])=>o);if(!a.length)return;let s=o.weightingByDistance;if(c.default.isEmpty(s))return;let g=new Map(c.default.map(s,(o,a)=>[c.default.toNumber(a)**2,o])),A=c.default.sortBy(Array.from(g.keys())),x=k.default.fromAxes([a.map(o=>o.x),a.map(o=>o.y),a.map(o=>o.z)]);return async o=>{let s=[],k=g.get(c.default.last(A));for(let c=0;c<o.length;c+=3){c%1e4==0&&await new Promise(setImmediate);let P=o.slice(c,c+3),w=a[x.nearestNeighbor(P)],F=(w.x-P[0])**2+(w.y-P[1])**2+(w.z-P[2])**2,R=k;for(let o of A)if(o>F){R=g.get(o);break}s.push(R)}return s}}(o);return(async()=>{for(let s=0;s<P;s++)doFrame(s,await a?.(o.pointData[s]));return s})()}for(let o=0;o<P;o++)doFrame(o);return s}async function getPointIntersectionsWeighted(o){if(!o)throw Error("Computing point intersections with undefined context");return o.distanceWeightedPointIntersections||(o.distanceWeightedPointIntersections=await computeIntersections(o,!0)),o.distanceWeightedPointIntersections}},567659:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.PerCustomerGrader=void 0,a.PerCustomerGrader=s,(c=s||(a.PerCustomerGrader=s={})).WhaleLSS="whale-lss",c.BeeLSS="bee-lss"},205308:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(599789),A=s(991984),x=s(440169),P=s(476670);let attributeGraderFnGenerator=(o,a,s)=>{let c;let g=s?.attributeTypes?.[o];switch(g){case k.AnnotationAttributeType.Angle:c=angleAttributeGraderFn;break;case k.AnnotationAttributeType.XLine:c=xLineAttributeGraderFn;break;case k.AnnotationAttributeType.YLine:c=yLineAttributeGraderFn;break;default:c=defaultAttributeGraderFn}return(s,g)=>c(o,s,g,a)},defaultAttributeGraderFn=(o,a,s,c)=>{let k=a?.attributes?.[o],A=s?.attributes?.[o],x=s?.isAttributeStatic?.[o];if(o.startsWith("LINK ATTRIBUTE")){let c=o.split(" "),x=c[2],P=c[c.length-1],w=`LINK ATTRIBUTE ${x} ${P}`,F=a?.attributes?.[w],R=s?.attributes?.[w];return g.default.isEqual(F,R)?{correctWork:g.default.isEqual(k,A)?.5:0,totalWork:.5,intermediates:{attrKey:o,correct:A,original:k}}:{correctWork:0,totalWork:0,intermediates:{attrKey:o,correct:A,original:k}}}return(c.ltdPerFrameKeys??[]).includes(o)?{correctWork:Array.isArray(k)&&Array.isArray(A)&&k.length===A.length&&A.length>0?A.filter((o,a)=>o===k[a]).length/A.length:0,totalWork:1,intermediates:{attrKey:o,correct:A,original:k}}:(Array.isArray(k)&&Array.isArray(A)&&(k.sort(),A.sort()),{correctWork:+g.default.isEqual(k,A),totalWork:1,intermediates:{attrKey:o,correct:A,original:k,static:x}})},angleAttributeGraderFn=(o,a,s,c)=>{let g=+(a?.attributes?.[o]||0),k=+(s?.attributes?.[o]||0),A=c.angleDiffThresholdDegrees||45,x=Math.min(Math.abs(g-k),Math.abs(g-k-360));return{correctWork:x<A?1:0,totalWork:1,intermediates:{angleDiff:x}}},xLineAttributeGraderFn=(o,a,s,c)=>{let g,k,A=0,P=+(a?.attributes?.[o]||0),w=+(s?.attributes?.[o]||0);if(a.width)A=s.width,g=a.left+P,k=s.left+w;else if(a.edges){let o=x.getCuboidFrontFaceAsBox(x.formatCuboidAnnotation(a)),c=x.getCuboidFrontFaceAsBox(x.formatCuboidAnnotation(s));A=c.width,g=o.left+P,k=c.left+w}else throw Error(`Annotation with type ${a?.type||a?.geometry} does not support the yline attribute.`);let F=c.xlineDiffThresholdFraction||.1,R=Math.abs(g-k);return{correctWork:R<A*F?1:0,totalWork:1,intermediates:{xlineDiff:R}}},yLineAttributeGraderFn=(o,a,s,c)=>{let g,k,A=0,P=+(a?.attributes?.[o]||0),w=+(s?.attributes?.[o]||0);if(a.height)A=s.height,g=a.top+P,k=s.top+w;else if(a.edges){let o=x.getCuboidFrontFaceAsBox(x.formatCuboidAnnotation(a)),c=x.getCuboidFrontFaceAsBox(x.formatCuboidAnnotation(s));A=c.height,g=o.top+P,k=c.top+w}else throw Error(`Annotation with type ${a?.type||a?.geometry} does not support the yline attribute.`);let F=c.ylineDiffThresholdFraction||.1,R=Math.abs(g-k);return{correctWork:R<A*F?1:0,totalWork:1,intermediates:{ylineDiff:R}}},textAttributeFnGenerator=o=>(a,s)=>{let c=a?.attributes?.[o]??"",g=s?.attributes?.[o]??"";return A.gradeFreeText(c,g)};a.default=(o,a,s,c,k,x)=>{k||(k={});let w=k.textAttributeKeys||x.textAttributeKeys||[],F=a?.frames?.[o],R=s?.frames?.[o],D=g.default.keys(R?.attributes||F?.attributes),G=g.default.isArray(k.enabledAttributeKeys)&&!g.default.isEmpty(k.enabledAttributeKeys)?k.enabledAttributeKeys:D,{rules:B}=x?.taxonomy??{};if(B){let o=P.getSensorFusionEnabledAttributeKeys(G,s??a,B);G=o}let W={};return g.default.forEach(D,o=>{if("scenarioParams"===o||G&&!G.includes(o))return;let a=w.includes(o)?textAttributeFnGenerator(o):attributeGraderFnGenerator(o,k,x);W[`attributes_${o}`]=A.gradeIfNotMissing(a,F,R)}),W}},51514:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.beeMappingAttributeGrader=a.defaultAttributeGraderFn=a.attributeGrader=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(599789),A=s(991984),x=s(691289);let attributeGrader=(o,a,s,c,P,w)=>{P||(P={});let F=a?.frames?.[o],R=s?.frames?.[o],D=g.default.keys(R?.attributes||F?.attributes),G=g.default.filter(D,o=>w?.attributeTypes?.[o]!==k.AnnotationAttributeType.Linked&&!x.BANNED_ATTRIBUTE_TYPES.includes(o)&&!x.toLinkingAttributeKeyBase(o)),B={};return g.default.forEach(G,o=>{let a=attributeGraderFnGenerator(o,P);B[`attribute_${o}`]=A.gradeIfNotMissing(a,F,R)}),B};a.attributeGrader=attributeGrader;let attributeGraderFnGenerator=(o,a)=>(s,c)=>defaultAttributeGraderFn(o,s,c,a),defaultAttributeGraderFn=(o,a,s)=>{let c=a?.attributes?.[o],k=s?.attributes?.[o];return Array.isArray(c)&&Array.isArray(k)&&(c=g.default.sortBy(c),k=g.default.sortBy(k)),{correctWork:+g.default.isEqual(c,k),totalWork:1}};a.defaultAttributeGraderFn=defaultAttributeGraderFn;let P={taskTypes:k.twoDTypes,title:"Bee GIS Attribute Grader",graderFn:A.gradePerFrameWithContext(attributeGrader,!1)};a.beeMappingAttributeGrader=P},119426:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.INFINITY=void 0,a.INFINITY=1e15},15455:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.beeMappingLinkingGrader=a.calculateCorrectAndTotalWork=a.getLinkedAttributeToAnnotations=a.fromAnnotationLabelChangedLinkingGraderGenerator=a.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=a.toAndFromAnnotationExistLinkingGraderGenerator=a.linkingGrader=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(599789),A=s(991984),x=s(691289);let linkingGrader=(o,a,s,c,P,w)=>{let F=a?.frames?.[o],R=s?.frames?.[o],D=g.default.union(g.default.keys(R?.attributes),g.default.keys(F?.attributes)),G=w?.matchedAnnotationsListContext,{attributeTypes:B,linkTypes:W}=w,z=W?Object.keys(W):[],V=g.default.filter(D,o=>!!x.toLinkingAttributeKeyBase(o,z)||B?.[o]===k.AnnotationAttributeType.Linked),U=g.default.compact(g.default.map(V,o=>x.toLinkingAttributeKeyBase(o,z))),K=[...new Set(U)],Y={};return K.forEach(o=>{let a=toAndFromAnnotationExistLinkingGraderGenerator(o,G),s=toAnnotationMissingOrLabelChangedLinkingGraderGenerator(o,G),c=fromAnnotationLabelChangedLinkingGraderGenerator(o,G);Y[`linking_${o}`]=A.gradeIfNotMissing(a,F,R),Y[`linking_${o}_UNMATCHED_TO_ANN`]=A.gradeIfNotMissing(s,F,R),Y[`linking_${o}_FROM_LABELS_DIFFERENT`]=A.gradeIfNotMissing(c,F,R)}),Y};a.linkingGrader=linkingGrader;let toAndFromAnnotationExistLinkingGraderGenerator=(o,a)=>(s,c)=>{let g=s?.label,k=c?.label;if(g!==k)return{correctWork:0,totalWork:0};let{originalToAnnotations:A,correctToAnnotations:x}=getLinkedAttributeToAnnotations(o,s,c,a),P=A.filter(o=>o?.correctAnnotation&&o?.correctAnnotation?.props.label===o?.currentAnnotation?.props.label),w=x.filter(o=>o?.correctAnnotation&&o?.correctAnnotation?.props.label===o?.currentAnnotation?.props.label),{correctWork:F,totalWork:R,intermediates:D}=calculateCorrectAndTotalWork(P,w);return{correctWork:F,totalWork:R,intermediates:D}};a.toAndFromAnnotationExistLinkingGraderGenerator=toAndFromAnnotationExistLinkingGraderGenerator;let toAnnotationMissingOrLabelChangedLinkingGraderGenerator=(o,a)=>(s,c)=>{let g=s?.label,k=c?.label;if(g!==k)return{correctWork:0,totalWork:0};let{originalToAnnotations:A,correctToAnnotations:x}=getLinkedAttributeToAnnotations(o,s,c,a),P=A.filter(o=>!o?.correctAnnotation||o.correctAnnotation?.props.label!==o.currentAnnotation?.props.label),w=x.filter(o=>!o?.correctAnnotation||o.correctAnnotation?.props.label!==o.currentAnnotation?.props.label),{correctWork:F,totalWork:R}=calculateCorrectAndTotalWork(P,w);return{correctWork:F,totalWork:R}};a.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=toAnnotationMissingOrLabelChangedLinkingGraderGenerator;let fromAnnotationLabelChangedLinkingGraderGenerator=(o,a)=>(s,c)=>{let g=s?.label,k=c?.label;if(g===k)return{correctWork:0,totalWork:0};let{originalToAnnotations:A,correctToAnnotations:x}=getLinkedAttributeToAnnotations(o,s,c,a),{totalWork:P}=calculateCorrectAndTotalWork(A,x);return{correctWork:0,totalWork:P}};a.fromAnnotationLabelChangedLinkingGraderGenerator=fromAnnotationLabelChangedLinkingGraderGenerator;let getLinkedAttributeToAnnotations=(o,a,s,c)=>{let k=a?.attributes,A=s?.attributes,x=Object.values(g.default.pickBy(k,(a,s)=>s.includes(o))),P=Object.values(g.default.pickBy(A,(a,s)=>s.includes(o))),w=x.map(o=>c?.find(a=>a.correctAnnotation?.props?.id===o)),F=P.map(o=>c?.find(a=>a.correctAnnotation?.props?.id===o));return{originalToAnnotations:w,correctToAnnotations:F}};a.getLinkedAttributeToAnnotations=getLinkedAttributeToAnnotations;let calculateCorrectAndTotalWork=(o,a)=>{let s=o.map(o=>o?.correctAnnotation?.props?.id),c=a.map(o=>o?.correctAnnotation?.props?.id),k=g.default.intersectionBy(s,c).length,A=Math.max(o.length,a.length);return{correctWork:k,totalWork:A,intermediates:{extraneous:g.default.difference(s,c),missing:g.default.difference(c,s)}}};a.calculateCorrectAndTotalWork=calculateCorrectAndTotalWork;let P={taskTypes:k.twoDTypes,title:"Bee GIS Linking Grader",graderFn:A.gradePerFrameWithContext(linkingGrader,!1,!1,!1)};a.beeMappingLinkingGrader=P},171665:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.beeMappingLinterDismissalGrader=a.beeMappingLinterDismissalGraderFn=void 0;var c=s(599789),g=s(971599),k=s(991984);let isFalsePositive=o=>o?.lintDismissal.dismissalType===g.LintDismissalType.Rejected,beeMappingLinterDismissalGraderFn=(o,a)=>({beeMappingLinterDismissal:k.ignoreIfMissing((o,a)=>{let s=[];o.metadata?.lintMetadata?.lintDismissals.forEach(o=>{let c=a.metadata?.lintMetadata?.lintDismissals.find(a=>a.lintErrorId===o.lintErrorId);s.push({actual:o,expected:c})}),a.metadata?.lintMetadata?.lintDismissals.forEach(o=>{s.find(a=>a.expected?.lintErrorId===o.lintErrorId)||s.push({actual:void 0,expected:o})});let c=s.filter(o=>isFalsePositive(o.actual)===isFalsePositive(o.expected)).length,g=s.length;return{correctWork:c,totalWork:g}},o,a)});a.beeMappingLinterDismissalGraderFn=beeMappingLinterDismissalGraderFn;let A={taskTypes:c.twoDTypes,title:"Bee GIS Linter Dismissal Grader",graderFn:k.gradePerFrame(beeMappingLinterDismissalGraderFn)};a.beeMappingLinterDismissalGrader=A},60738:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.defaultBeeMappingParams=void 0,a.defaultBeeMappingParams={splitTolerance:.1,segmentLinkTolerance:.001,crossSubdivisionThreshold:5,segmentLinkCandidateFcdThreshold:5,maximumSplitSegmentLength:10.3}},438292:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.makeGlobalBeeMappingGraderFn=makeGlobalBeeMappingGraderFn,a.makeGlobalBeeMappingMatcherFn=makeGlobalBeeMappingMatcherFn,a.globalGrader=void 0;var c,g=s(167469),k=(c=s(298784))&&c.__esModule?c:{default:c},A=s(45834),x=s(972281),P=s(114861),w=s(691289),F=s(991984),R=s(60738);function makeGlobalBeeMappingGraderFn(o){let graderFn=async(a,s)=>{let c=(await A.mapLimit(w.ALL_LABELS,async c=>{let g=a.filter(o=>o.label===c),k=s.filter(o=>o.label===c),{subdividedSegmentsA:A,subdividedSegmentsB:w}=await x.computeCrossDivision(g,k,o),F=x.getSegmentMatches(A,w,o),R=F.map(o=>P.scoreSegmentMatch(o,c));return R},1)).flat(),g=k.default.flatMap(w.ALL_LABELS,o=>w.ALL_ERROR_TYPES.map(a=>{let s=c.filter(a=>a.label===o);return P.transformScoresToGlobalScore(s,a,{label:o,graderType:"beeMapppingGlobal",key:`${o}::${a}`})})),F=k.default.fromPairs(g.map(o=>[o.key,o]));return F};return F.globalGradePerFrame(graderFn)}let transformScoredMatch=o=>{let a={type:"polyline-fragments",currentId:o.currentId,correctId:o.correctId,props:{label:o.label},rawScoredSegmentMatches:o.scoredSegmentMatches},s=o.currentAnn&&o.correctAnn?"Precision":o.currentAnn?"FalsePositive":"FalseNegative",c=k.default.map(o.scoredSegmentMatches,"score"),g=P.transformScoresToGlobalScore(c,s,{graderType:"beeMapppingGlobal",label:o.label,key:s});return{metadata:a,currentAnnotation:o.currentAnn,correctAnnotation:o.correctAnn,scores:[g],numFalseNegativeFrames:0,numFalsePositiveFrames:0,numIncorrectTruePositiveFrames:0,numTotalTruePositiveFrames:0}},getId=(o,a)=>o?`${a}-${o.uuid}`:`${a}-none`;function makeGlobalBeeMappingMatcherFn(o){let matcherFn=async(a,s)=>{let c=new Map([...a,...s].map(o=>[o.frames[0],o]));c.set(void 0,void 0);let g=a.map(o=>o.frames[0]),F=s.map(o=>o.frames[0]),R=(await A.mapLimit(w.ALL_LABELS,async a=>{let s=g.filter(o=>o.label===a),A=F.filter(o=>o.label===a),{subdividedSegmentsA:w,subdividedSegmentsB:R,segmentToAnnotationMap:D}=await x.computeCrossDivision(s,A,o),G=x.getSegmentMatches(w,R,o),B=G.map(o=>{let s=P.scoreSegmentMatch(o,a);return{score:s,segmentMatch:o}}),W=new Map([...s.map(o=>[getId(o,"a"),o]),["a-none",void 0],...A.map(o=>[getId(o,"b"),o]),["b-none",void 0]]),z=k.default.groupBy(B,({segmentMatch:o})=>{let s=o.currentSegment?D.get(o.currentSegment):void 0,c=o.correctSegment?D.get(o.correctSegment):void 0;return JSON.stringify({currentId:getId(s,"a"),correctId:getId(c,"b"),label:a})});return k.default.map(z,(o,a)=>{let{currentId:s,correctId:g,label:k}=JSON.parse(a);return{currentId:s,correctId:g,currentAnn:c.get(W.get(s)),correctAnn:c.get(W.get(g)),label:k,scoredSegmentMatches:o}})},1)).flat();return A.mapLimit(R,transformScoredMatch,1)};return matcherFn}let D={taskTypes:[g.TaskType.LineAnnotation],title:"(Bee GIS Global) Per-class bag-of-segments Line Grader",graderFn:makeGlobalBeeMappingGraderFn(R.defaultBeeMappingParams),matcherFn:makeGlobalBeeMappingMatcherFn(R.defaultBeeMappingParams),global:!0};a.globalGrader=D},487714:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"beeMappingGlobal",{enumerable:!0,get:function(){return c.globalGrader}}),Object.defineProperty(a,"beeMappingLinkingGrader",{enumerable:!0,get:function(){return g.beeMappingLinkingGrader}}),Object.defineProperty(a,"beeMappingAttributeGrader",{enumerable:!0,get:function(){return k.beeMappingAttributeGrader}}),Object.defineProperty(a,"beeMappingLinterDismissalGrader",{enumerable:!0,get:function(){return A.beeMappingLinterDismissalGrader}});var c=s(438292),g=s(15455),k=s(51514),A=s(171665)},972281:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.computeCrossDivision=a.getSegmentMatches=void 0;var c=s(45834),g=_interopRequireDefault(s(298784)),k=_interopRequireDefault(s(289624)),A=s(119426),x=_interopRequireDefault(s(540742)),P=s(490503);function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}let interpolate=([{x:o,y:a},{x:s,y:c}],g)=>({x:(1-g)*o+g*s,y:(1-g)*a+g*c});function getUpsampledSegments(o,a){let s=[];for(let c=0;c<o.length-1;c++){let g=[o[c],o[c+1]],k=P.computeSegmentLength(g),A=Math.ceil(k/a),x=g[0];for(let o=0;o<A;o++){let a=interpolate(g,(o+1)/A);s.push([x,a]),x=a}}return s}let getFcdMatrix=(o,a)=>o.map(o=>a.map(a=>P.computeFCD(o,a))),getCostMatrix=(o,a,s,c)=>{let k=o.map((o,k)=>a.map((a,A)=>{let x=P.computeSegmentLength(o),w=P.computeSegmentLength(a),F={x:o[1].x-o[0].x,y:o[1].y-o[0].y},R={x:a[1].x-a[0].x,y:a[1].y-a[0].y},D=Math.abs((F.x*R.x+F.y*R.y)/(x*w));return s[k][A]>c.segmentLinkCandidateFcdThreshold+c.segmentLinkTolerance?0:g.default.min([x,w])*D*Math.exp(-s[k][A]/c.segmentLinkCandidateFcdThreshold)})),x=k.map(o=>o.map(o=>g.default.isFinite(o)?A.INFINITY-o:0));return x},getConnectedComponents=(o,a)=>{let s=new x.default(o);for(let[o,c]of a)s.union(o,c);return s.compile()},hungarian=o=>o.length?k.default(o):[],getSpatialHashComponents=(o,a,s)=>{function getSpannedTiles(o){let a=g.default.min(o.map(o=>o.x)),s=g.default.min(o.map(o=>o.y)),c=g.default.max(o.map(o=>o.x)),k=g.default.max(o.map(o=>o.y));return g.default.flatMap(g.default.range(Math.floor(a/32),Math.floor(c/32)+1),o=>g.default.range(Math.floor(s/32),Math.floor(k/32)+1).map(a=>640*o+a))}function getNeighboringTiles(o){return g.default.range(3).flatMap(a=>g.default.range(3).map(s=>o+(a-1)*640+(s-1)))}let c=o.map(getSpannedTiles),k=a.map(getSpannedTiles),A=new Map;c.forEach((o,a)=>{o.forEach(o=>{A.has(o)||A.set(o,new Set),A.get(o).add(a)})});let x=g.default.size(o),w=g.default.size(a),F=[];k.forEach((c,k)=>{let w=new Set;for(let R of(g.default.flatMap(c,getNeighboringTiles).forEach(o=>{if(A.has(o))for(let a of A.get(o))w.add(a)}),w))P.computeFCD(o[R],a[k])<=s.segmentLinkCandidateFcdThreshold+s.segmentLinkTolerance&&F.push([R,x+k])});let R=getConnectedComponents(x+w,F);return R.map(o=>{let a=o.filter(o=>o<x),s=o.filter(o=>o>=x).map(o=>o-x);return{indicesA:a,indicesB:s}})};a.getSegmentMatches=(o,a,s)=>{if(g.default.isEmpty(o)&&g.default.isEmpty(a))return[];let c=getSpatialHashComponents(o,a,s),k=[];c.forEach(c=>{let g=c.indicesA.map(a=>o[a]),x=c.indicesB.map(o=>a[o]),P=getFcdMatrix(g,x),w=getCostMatrix(g,x,P,s),F=w.length>0&&w[0].length>0?hungarian(w).filter(([o,a])=>w[o][a]<A.INFINITY):[];k.push(...F.map(([o,a])=>[c.indicesA[o],c.indicesB[a]]))});let x=g.default.times(o.length,()=>!1),w=g.default.times(a.length,()=>!1);for(let[o,a]of k)x[o]=w[a]=!0;let F=[...k.map(([s,c])=>({currentSegment:o[s],correctSegment:a[c],fcd:P.computeFCD(o[s],a[c])})),...o.filter((o,a)=>!x[a]).map(o=>({currentSegment:o})),...a.filter((o,a)=>!w[a]).map(o=>({correctSegment:o}))];return F};let computeCrossDivision=async(o,a,s)=>{let k=g.default.flatMap(o,o=>o.vertices),A=g.default.flatMap(a,o=>o.vertices),x=[...k,...A],w=0,maybeWait=()=>w++%20==0?new Promise(setImmediate):null,F=await c.mapLimit(o,async o=>(await maybeWait(),getUpsampledSegments(P.projectVerticesOntoPolyline(o.vertices,x,s.crossSubdivisionThreshold,s.splitTolerance),s.maximumSplitSegmentLength)),1),R=await c.mapLimit(a,async o=>(await maybeWait(),getUpsampledSegments(P.projectVerticesOntoPolyline(o.vertices,x,s.crossSubdivisionThreshold,s.splitTolerance),s.maximumSplitSegmentLength)),1),D=new Map([...g.default.flatMap(F,(a,s)=>a.map(a=>[a,o[s]])),...g.default.flatMap(R,(o,s)=>o.map(o=>[o,a[s]]))]);return{segmentToAnnotationMap:D,subdividedSegmentsA:g.default.flatten(F),subdividedSegmentsB:g.default.flatten(R)}};a.computeCrossDivision=computeCrossDivision},114861:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.transformScoresToGlobalScore=a.scoreSegmentMatch=void 0;var c,g=s(691289),k=s(490503),A=(c=s(298784))&&c.__esModule?c:{default:c};a.scoreSegmentMatch=(o,a)=>{if(!g.isLabel(a))throw Error("unknown label: "+a);let{currentSegment:s,correctSegment:c,fcd:A}=o;return{label:a,currentLength:s?k.computeSegmentLength(s):0,correctLength:c?k.computeSegmentLength(c):0,isMatch:!!s&&!!c,isCorrect:!!s&&!!c&&A<=5}},a.transformScoresToGlobalScore=(o,a,s)=>{let c,g;let k=A.default.sumBy(o,"currentLength"),x=A.default.sumBy(o,"correctLength"),P=A.default.sumBy(A.default.filter(o,"isMatch"),"currentLength"),w=A.default.sumBy(A.default.filter(o,"isMatch"),"correctLength"),F=A.default.sumBy(A.default.filter(o,"isCorrect"),"currentLength");if("FalseNegative"===a)c=w,g=x;else if("FalsePositive"===a)c=P,g=k;else if("Precision"===a)c=F,g=P;else throw Error(`Unknown error type ${a}`);return{...s,errorType:a,numIncorrectFrames:0,numTotalFrames:0,correctWork:c,totalWork:g}}},691289:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.isScoredPolylineSegmentsMatchedAnnotations=function(o){return o?.metadata?.type==="polyline-fragments"},a.toLinkingAttributeKeyBase=a.ALL_ERROR_TYPES=a.ALL_SEVERITIES=a.isLabel=a.BANNED_ATTRIBUTE_TYPES=a.ALL_LINKING_ATTRIBUTE_KEY_BASES=a.ALL_LABELS=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c};let k=["Vehicle Lane Center","Bicycle Lane Center","Parking Lane Center","Pedestrian Lane Center","Other Lane Center","Transition","Double-Dashed-Solid","Double-Solid-Dashed","Single-Dotted","Single-Dashed","Single-Solid","Double-Dotted","Double-Dashed","Double-Solid","Double-Dashed-Solid","Double-Solid-Dashed","Virtual Lane Line","Other Lane Line","Stop Line","Yield Line","Speed Line","School Zone Line","Other Sign Line","Vehicle Lane Center","Bicycle Lane Center","Parking Lane Center","Pedestrian Lane Center","Other Lane Center","Curb","Barrier","Other Driveable Region Edge","Transition","Connection"];a.ALL_LABELS=k;let A=["Road Sign to Line","Road Sign to Point","Road Sign to Polygon","Road Surface Marker to Line","Road Surface Marker to Point","Road Surface Marker to Polygon","VLC Neighbor","Permeability None VLC to VLC","Permeability Free VLC to VLC","Sign Line to VLC","Merge Or Split Point to Line","Bike Lane Painted to VLC","Bus Or Taxi Lane Painted to VLC","Buffer Zone to Line Neighbor","Yield Shark's Teeth to VLC","Cul-de-sac to VLC","Crosswalk to VLC","Speed Bump to VLC","Speed Dip to VLC","Traffic Light to VLC","Pedestrian Crossing Light to VLC","Pedestrian Crossing Light to Crosswalk","Bicycle Crossing Light to VLC","Highway Metering Light to VLC","Railroad Crossing Light to VLC","Lane Control Signal to VLC","Uncommon Traffic Light to VLC","Railroad Crossing to VLC","Roadway Gate to Railroad Crossing","Other Relationship","Road Sign Links","Road Surface Marker Links","VLC Links","Neighbor Links","Merge Or Split Point Links","Misc Links","VLC to VLC attributes-Permeability-Not Permeable","VLC to VLC attributes-Permeability-Permeable"];a.ALL_LINKING_ATTRIBUTE_KEY_BASES=A,a.BANNED_ATTRIBUTE_TYPES=["change_id","relationship_change_id","Reference Map UIDs"],a.isLabel=o=>k.includes(o),a.ALL_SEVERITIES=["Critical","Severe","Moderate"],a.ALL_ERROR_TYPES=["FalseNegative","FalsePositive","Precision"],a.toLinkingAttributeKeyBase=(o,a)=>{let s=g.default.sortBy((a??[]).concat(A),o=>-o.length);return g.default.find(s,a=>o.includes(a))}},362714:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.gradeRotation=a.gradeDistance=a.boxDimensionsGrader=a.gradeWidth=a.gradeHeight=a.iouGrader=a.edgeGrader=a.DEFAULT_BOX_ROTATION_THRESHOLD_DEGS=a.DEFAULT_BOX_POSITION_THRESHOLD_PX=a.DEFAULT_BOX_DIMENSION_THRESHOLD_PX=a.DEFAULT_MAX_THRESHOLD_PX=a.DEFAULT_MIN_THRESHOLD_PX=a.DEFAULT_IOU_THRESHOLD=a.DEFAULT_EDGE_THRESHOLD=a.BOX_DISTANCE_LABEL_BIAS=a.BOX_DISTANCE_IOU_THRESHOLD=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(440169),x=s(991984);a.BOX_DISTANCE_IOU_THRESHOLD=.2,a.BOX_DISTANCE_LABEL_BIAS=.075;let P=.05;a.DEFAULT_EDGE_THRESHOLD=P;let w=.75;a.DEFAULT_IOU_THRESHOLD=w;let F=5;a.DEFAULT_MIN_THRESHOLD_PX=F;let R=15;a.DEFAULT_MAX_THRESHOLD_PX=R;let D=5;a.DEFAULT_BOX_DIMENSION_THRESHOLD_PX=D,a.DEFAULT_BOX_POSITION_THRESHOLD_PX=5;let G=15;a.DEFAULT_BOX_ROTATION_THRESHOLD_DEGS=G;let inSameSensor=(o,a)=>o?.sensor_id===a?.sensor_id,B={correctWork:0,totalWork:0},edgeGrader=(o,a,s,{threshold:c=P,leftThreshold:k=c,rightThreshold:A=c,topThreshold:w=c,bottomThreshold:D=c,minThresholdPx:G=F,maxThresholdPx:W=R,useBoundedThresholds:z=!1})=>inSameSensor(o,a)?{left:x.gradeIfNotMissing((o,a)=>{let s=k*a.width;z&&(s=g.default.clamp(s,G,W));let c=Math.abs(o.left-a.left)/a.width,A=+(c*a.width<s);return{correctWork:A,totalWork:1,intermediates:{leftDiff:c}}},o,a),right:x.gradeIfNotMissing((o,a)=>{let s=A*a.width;z&&(s=g.default.clamp(s,G,W));let c=Math.abs(o.left+o.width-(a.left+a.width))/a.width,k=+(c*a.width<s);return{correctWork:k,totalWork:1,intermediates:{rightDiff:c}}},o,a),top:x.gradeIfNotMissing((o,a)=>{let s=w*a.height;z&&(s=g.default.clamp(s,G,W));let c=Math.abs(o.top-a.top)/a.height,k=+(c*a.height<s);return{correctWork:k,totalWork:1,intermediates:{topDiff:c}}},o,a),bottom:x.gradeIfNotMissing((o,a)=>{let s=D*a.height;z&&(s=g.default.clamp(s,G,W));let c=Math.abs(o.top+o.height-(a.top+a.height))/a.height,k=+(c*a.height<s);return{correctWork:k,totalWork:1,intermediates:{bottomDiff:c}}},o,a)}:{left:B,right:B,top:B,bottom:B};a.edgeGrader=edgeGrader;let iouGrader=(o,a,s,{threshold:c=w})=>inSameSensor(o,a)?{iou:x.gradeIfNotMissing((o,a)=>{let s=A.boxIou(o,a);return{correctWork:+(s>c),totalWork:1,intermediates:{iou:s}}},o,a)}:{iou:B};a.iouGrader=iouGrader;let W=10,gradeHeight=(o,a,s)=>{let c=void 0!==o.rotation||void 0!==a.rotation,g=c&&o.width<o.height?o.width:o.height,k=c&&a.width<a.height?a.width:a.height,A=Math.abs(g-k);return{correctWork:+(A<s),totalWork:1,intermediates:{diff:A}}};a.gradeHeight=gradeHeight;let gradeWidth=(o,a,s)=>{let c=void 0!==o.rotation||void 0!==a.rotation,g=c&&o.width<o.height?o.height:o.width,k=c&&a.width<a.height?a.height:a.width,A=Math.abs(g-k);return{correctWork:+(A<s),totalWork:1,intermediates:{diff:A}}};a.gradeWidth=gradeWidth;let boxDimensionsGrader=(o,a,s,{threshold:c=D,heightThreshold:g=c,widthThreshold:k=c})=>inSameSensor(o,a)?{height:x.gradeIfNotMissing((o,a)=>gradeHeight(o,a,g),o,a),width:x.gradeIfNotMissing((o,a)=>gradeWidth(o,a,k),o,a)}:{height:B,width:B};a.boxDimensionsGrader=boxDimensionsGrader;let getBoxCenter=o=>({x:o.left+o.width/2,y:o.top+o.height/2}),gradeDistance=(o,a,s)=>{let c=getBoxCenter(o),g=getBoxCenter(a),k=A.findDistance(A.vertexToArr(c),A.vertexToArr(g));return{correctWork:+(k<=s),totalWork:1,intermediates:{distance:k}}};a.gradeDistance=gradeDistance;let gradeRotation=(o,a,s)=>{let c=o.rotation??0,g=a.rotation??0;o.width<o.height&&(c=A.addRadians(c,Math.PI/2)),a.width<a.height&&(g=A.addRadians(g,Math.PI/2)),c<0&&(c+=Math.PI),g<0&&(g+=Math.PI);let k=A.radianDifference(c,g);return{correctWork:+(k<=s*(Math.PI/180)),totalWork:1}};a.gradeRotation=gradeRotation;let z={edges:{taskTypes:[k.TaskType.VideoBoxAnnotation,k.TaskType.Annotation],title:"Edge positions",graderFn:x.gradePerFrame(edgeGrader),paramConfigs:[{name:"threshold",label:"Default Edge Threshold",type:"number",defaultValue:P},{name:"leftThreshold",label:"Left Threshold",type:"number",defaultValue:P},{name:"rightThreshold",label:"Right Threshold",type:"number",defaultValue:P},{name:"bottomThreshold",label:"Bottom Threshold",type:"number",defaultValue:P},{name:"topThreshold",label:"Top Threshold",type:"number",defaultValue:P},{name:"maxThresholdPx",label:"Maximum Edge Threshold",type:"number",defaultValue:R},{name:"minThresholdPx",label:"Minimum Edge Threshold",type:"number",defaultValue:F},{name:"useBoundedThresholds",label:"Whether to bound thresholds",type:"boolean",defaultValue:!1}]},iou:{taskTypes:[k.TaskType.VideoBoxAnnotation,k.TaskType.Annotation,k.TaskType.VideoPlaybackAnnotation],title:"Box size and position",graderFn:x.gradePerFrame(iouGrader),paramConfigs:[{name:"threshold",label:"IOU Threshold",type:"number",defaultValue:w}]},adjustmentDistance:{taskTypes:[k.TaskType.VideoBoxAnnotation,k.TaskType.VideoPlaybackAnnotation],title:"Adjustment Distance Grader",graderFn:x.gradePerFrame((o,a,s,{threshold:c=W})=>inSameSensor(o,a)?{adjustmentDistance:x.gradeIfNotMissing((o,a)=>{let s=Math.pow(o.top-a.top,2),g=Math.pow(o.top+o.height-(a.top+a.height),2),k=Math.pow(o.left+o.width-(a.left+a.width),2),A=Math.pow(o.left-a.left,2),x=Math.sqrt(s+g+k+A);return{correctWork:+(x<c),totalWork:1,intermediates:{topDiff:s,bottomDiff:g,rightDiff:k,leftDiff:A,result:x,threshold:c}}},o,a)}:{adjustmentDistance:B}),paramConfigs:[{name:"threshold",label:"Error Threshold",type:"number",defaultValue:W}]},boxDimensions:{taskTypes:[k.TaskType.VideoBoxAnnotation,k.TaskType.Annotation,k.TaskType.VideoPlaybackAnnotation],title:"Box Dimensions grader",graderFn:x.gradePerFrame(boxDimensionsGrader),paramConfigs:[{name:"threshold",label:"Default Dimension Threshold",type:"number",defaultValue:D},{name:"heightThreshold",label:"Height Threshold",type:"number",defaultValue:D},{name:"widthThreshold",label:"Width Threshold",type:"number",defaultValue:D}]},boxRotation:{taskTypes:[k.TaskType.VideoBoxAnnotation,k.TaskType.Annotation,k.TaskType.VideoPlaybackAnnotation],title:"Box Rotation grader",graderFn:x.gradePerFrame((o,a,s,{threshold:c=G})=>inSameSensor(o,a)?{rotation:x.gradeIfNotMissing((o,a)=>gradeRotation(o,a,c),o,a)}:{rotation:B}),paramConfigs:[{name:"rotationThreshold",label:"Rotation Threshold (degrees)",type:"number",defaultValue:G}]},boxPosition:{taskTypes:[k.TaskType.VideoBoxAnnotation,k.TaskType.Annotation,k.TaskType.VideoPlaybackAnnotation],title:"Box Position grader",graderFn:x.gradePerFrame((o,a,s,{threshold:c=D})=>inSameSensor(o,a)?{position:x.gradeIfNotMissing((o,a)=>gradeDistance(o,a,c),o,a)}:{position:B}),paramConfigs:[{name:"threshold",label:"Default Position Threshold",type:"number",defaultValue:5}]}};a.default=z},152672:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.unifyAnswers=a.checkSingleQuestion=a.responseIOUScore=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(991984);let responseIOUScore=(o,a)=>0===o.length?+(0===a.length):g.default.intersection(o,a).length/g.default.union(o,a).length;a.responseIOUScore=responseIOUScore;let checkSingleQuestion=(o,a)=>responseIOUScore(o,a);a.checkSingleQuestion=checkSingleQuestion;let unifyAnswers=o=>g.default.isArray(o)?o:[o];a.unifyAnswers=unifyAnswers;let x=Object.freeze({correctChoices:{taskTypes:[k.TaskType.Categorization],title:"categorization choices",graderFn:A.gradePerFrame((o,a,s)=>{if(g.default.isEmpty(a))return{choices:{correctWork:0,totalWork:0}};if(!g.default.isEmpty(o))return A.gradeForAcceptedAnnotations(o,a,(o,a)=>{let s=unifyAnswers(o.choices),c=unifyAnswers(a.choices);return{choices:{correctWork:checkSingleQuestion(s,c),totalWork:1,intermediates:{originalAnswers:s,correctAnswers:c}}}},s&&s.acceptedAnnotationMatchIndexes);{let o=g.default.findIndex(a.acceptedAnnotations,({annotation:o})=>!o)>=0;return{choices:{correctWork:+o,totalWork:1}}}})}});a.default=x},674291:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.covariantAttributeGrader=a.defaultAttributeGraderFn=a.attributeGrader=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(599789),A=s(991984),x=s(800259);let attributeGrader=(o,a,s,c,P,w)=>{P||(P={});let F=a?.frames?.[o],R=s?.frames?.[o],D=g.default.keys(R?.attributes||F?.attributes),G=g.default.filter(D,o=>w?.attributeTypes?.[o]!==k.AnnotationAttributeType.Linked&&!x.toLinkingAttributeKeyBase(o)),B={};return g.default.forEach(G,o=>{let a=attributeGraderFnGenerator(o,P);B[`attribute_${o}`]=A.gradeIfNotMissing(a,F,R)}),B};a.attributeGrader=attributeGrader;let attributeGraderFnGenerator=(o,a)=>(s,c)=>defaultAttributeGraderFn(o,s,c,a),defaultAttributeGraderFn=(o,a,s)=>{let c=a?.attributes?.[o],k=s?.attributes?.[o];return Array.isArray(c)&&Array.isArray(k)&&(c=g.default.sortBy(c),k=g.default.sortBy(k)),{correctWork:+g.default.isEqual(c,k),totalWork:1}};a.defaultAttributeGraderFn=defaultAttributeGraderFn;let P={taskTypes:k.twoDTypes,title:"Covariant Attribute Grader",graderFn:A.gradePerFrameWithContext(attributeGrader,!1)};a.covariantAttributeGrader=P},34038:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.covariantLinkingGrader=a.calculateCorrectAndTotalWork=a.getLinkedAttributeToAnnotations=a.fromAnnotationLabelChangedLinkingGraderGenerator=a.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=a.toAndFromAnnotationExistLinkingGraderGenerator=a.linkingGrader=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(599789),A=s(991984),x=s(800259);let linkingGrader=(o,a,s,c,P,w)=>{let F=a?.frames?.[o],R=s?.frames?.[o],D=g.default.union(g.default.keys(R?.attributes),g.default.keys(F?.attributes)),G=w?.matchedAnnotationsListContext,B=g.default.filter(D,o=>{let a=w?.attributeTypes;return!!x.toLinkingAttributeKeyBase(o)||a?.[o]===k.AnnotationAttributeType.Linked}),W=g.default.compact(g.default.map(B,o=>x.toLinkingAttributeKeyBase(o))),z=[...new Set(W)],V={};return z.forEach(o=>{let a=toAndFromAnnotationExistLinkingGraderGenerator(o,G),s=toAnnotationMissingOrLabelChangedLinkingGraderGenerator(o,G),c=fromAnnotationLabelChangedLinkingGraderGenerator(o,G);V[`linking_${o}`]=A.gradeIfNotMissing(a,F,R),V[`linking_${o}_UNMATCHED_TO_ANN`]=A.gradeIfNotMissing(s,F,R),V[`linking_${o}_FROM_LABELS_DIFFERENT`]=A.gradeIfNotMissing(c,F,R)}),V};a.linkingGrader=linkingGrader;let toAndFromAnnotationExistLinkingGraderGenerator=(o,a)=>(s,c)=>{let g=s?.label,k=c?.label;if(g!==k)return{correctWork:0,totalWork:0};let{originalToAnnotations:A,correctToAnnotations:x}=getLinkedAttributeToAnnotations(o,s,c,a),P=A.filter(o=>o?.correctAnnotation&&o?.correctAnnotation?.props.label===o?.currentAnnotation?.props.label),w=x.filter(o=>o?.correctAnnotation&&o?.correctAnnotation?.props.label===o?.currentAnnotation?.props.label),{correctWork:F,totalWork:R,intermediates:D}=calculateCorrectAndTotalWork(P,w);return{correctWork:F,totalWork:R,intermediates:D}};a.toAndFromAnnotationExistLinkingGraderGenerator=toAndFromAnnotationExistLinkingGraderGenerator;let toAnnotationMissingOrLabelChangedLinkingGraderGenerator=(o,a)=>(s,c)=>{let g=s?.label,k=c?.label;if(g!==k)return{correctWork:0,totalWork:0};let{originalToAnnotations:A,correctToAnnotations:x}=getLinkedAttributeToAnnotations(o,s,c,a),P=A.filter(o=>!o?.correctAnnotation||o.correctAnnotation?.props.label!==o.currentAnnotation?.props.label),w=x.filter(o=>!o?.correctAnnotation||o.correctAnnotation?.props.label!==o.currentAnnotation?.props.label),{correctWork:F,totalWork:R}=calculateCorrectAndTotalWork(P,w);return{correctWork:F,totalWork:R}};a.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=toAnnotationMissingOrLabelChangedLinkingGraderGenerator;let fromAnnotationLabelChangedLinkingGraderGenerator=(o,a)=>(s,c)=>{let g=s?.label,k=c?.label;if(g===k)return{correctWork:0,totalWork:0};let{originalToAnnotations:A,correctToAnnotations:x}=getLinkedAttributeToAnnotations(o,s,c,a),{totalWork:P}=calculateCorrectAndTotalWork(A,x);return{correctWork:0,totalWork:P}};a.fromAnnotationLabelChangedLinkingGraderGenerator=fromAnnotationLabelChangedLinkingGraderGenerator;let getLinkedAttributeToAnnotations=(o,a,s,c)=>{let k=a?.attributes,A=s?.attributes,x=Object.values(g.default.pickBy(k,(a,s)=>s.includes(o))),P=Object.values(g.default.pickBy(A,(a,s)=>s.includes(o))),w=x.map(o=>c?.find(a=>a.currentAnnotation?.props?.id===o)),F=P.map(o=>c?.find(a=>a.correctAnnotation?.props?.id===o));return{originalToAnnotations:w,correctToAnnotations:F}};a.getLinkedAttributeToAnnotations=getLinkedAttributeToAnnotations;let calculateCorrectAndTotalWork=(o,a)=>{let s=o.map(o=>o?.correctAnnotation?.props?.id),c=a.map(o=>o?.correctAnnotation?.props?.id),k=g.default.intersectionBy(s,c).length,A=Math.max(o.length,a.length);return{correctWork:k,totalWork:A,intermediates:{extraneous:g.default.difference(s,c),missing:g.default.difference(c,s)}}};a.calculateCorrectAndTotalWork=calculateCorrectAndTotalWork;let P={taskTypes:k.twoDTypes,title:"Covariant Linking Grader",graderFn:A.gradePerFrameWithContext(linkingGrader,!1,!1,!1)};a.covariantLinkingGrader=P},388746:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"covariantLinkingGrader",{enumerable:!0,get:function(){return c.covariantLinkingGrader}}),Object.defineProperty(a,"covariantAttributeGrader",{enumerable:!0,get:function(){return g.covariantAttributeGrader}});var c=s(34038),g=s(674291)},800259:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.toLinkingAttributeKeyBase=a.ALL_LINKING_ATTRIBUTE_KEY_BASES=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c};let k=["Object Occlusion Links","Is Hole For"];a.ALL_LINKING_ATTRIBUTE_KEY_BASES=k,a.toLinkingAttributeKeyBase=o=>{let a=g.default.sortBy(k,o=>-o.length);return g.default.find(a,a=>o.includes(a))}},278127:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.FRACTION_STEP=a.DEFAULT_IOU_THRESHOLD=a.DEFAULT_PARALLAX_POINT_THRESHOLD=a.DEFAULT_SIDE_EDGE_THRESHOLD=a.DEFAULT_MAX_FRONT_EDGE_THRESHOLD_PX=a.DEFAULT_MIN_FRONT_EDGE_THRESHOLD_PX=a.DEFAULT_FRONT_EDGE_THRESHOLD=a.CUBOID_DISTANCE_IOU_THRESHOLD=void 0;var c,g=s(167469),k=(c=s(298784))&&c.__esModule?c:{default:c},A=s(991984),x=s(440169);a.CUBOID_DISTANCE_IOU_THRESHOLD=.2;let P=.05;a.DEFAULT_FRONT_EDGE_THRESHOLD=P;let w=5;a.DEFAULT_MIN_FRONT_EDGE_THRESHOLD_PX=w;let F=15;a.DEFAULT_MAX_FRONT_EDGE_THRESHOLD_PX=F;let R=.05;a.DEFAULT_SIDE_EDGE_THRESHOLD=R;let D=.1;a.DEFAULT_PARALLAX_POINT_THRESHOLD=D;let G=.9;a.DEFAULT_IOU_THRESHOLD=G,a.FRACTION_STEP=.01;let gradeIsExtended=(o,a)=>o.isExtended||a.isExtended?o.isExtended&&a.isExtended?null:{correctWork:0,totalWork:1}:{correctWork:1,totalWork:1},B={cuboidFrontEdges:{taskTypes:[g.TaskType.CuboidAnnotation,g.TaskType.VideoCuboidAnnotation],title:"2D Cuboid Front Face Edge Positions",graderFn:A.gradePerFrame((o,a,s,{threshold:c=P,leftThreshold:g=c,rightThreshold:R=c,topThreshold:D=c,bottomThreshold:G=c,minThresholdPx:B=w,maxThresholdPx:W=F,useBoundedThresholds:z=!1})=>({edgeFaceTop:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),c=x.formatCuboidAnnotation(a),g=Math.abs(s.edges.faceTop.y1-c.edges.faceTop.y1)/c.height,A=D*c.height;return z&&(A=k.default.clamp(A,B,W)),{correctWork:+(g*c.height<A),totalWork:1,intermediates:{faceTopDiff:g}}},o,a),edgeFaceRight:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),c=x.formatCuboidAnnotation(a),g=Math.abs(s.edges.faceRight.x2-c.edges.faceRight.x2)/c.width,A=R*c.width;return z&&(A=k.default.clamp(A,B,W)),{correctWork:+(g*c.width<A),totalWork:1,intermediates:{faceRightDiff:g}}},o,a),edgeFaceBottom:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),c=x.formatCuboidAnnotation(a),g=Math.abs(s.edges.faceBottom.y2-c.edges.faceBottom.y2)/c.height,A=G*c.height;return z&&(A=k.default.clamp(A,B,W)),{correctWork:+(g*c.height<A),totalWork:1,intermediates:{faceTopDiff:g}}},o,a),edgeFaceLeft:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),c=x.formatCuboidAnnotation(a),A=Math.abs(s.edges.faceLeft.x1-c.edges.faceLeft.x1)/c.width,P=g*c.width;return z&&(P=k.default.clamp(P,B,W)),{correctWork:+(A*c.width<P),totalWork:1,intermediates:{faceLeftDiff:A}}},o,a)})),paramConfigs:[{name:"threshold",label:"Front Edge Threshold (Fraction of Correct Width or Height)",type:"number",defaultValue:P,min:0,step:.01},{name:"leftThreshold",label:"Left Threshold",type:"number",defaultValue:P,min:0,step:.01},{name:"rightThreshold",label:"Right Threshold",type:"number",defaultValue:P,min:0,step:.01},{name:"bottomThreshold",label:"Bottom Threshold",type:"number",defaultValue:P,min:0,step:.01},{name:"topThreshold",label:"Top Threshold",type:"number",defaultValue:P,min:0,step:.01},{name:"maxThresholdPx",label:"Maximum Edge Threshold",type:"number",defaultValue:F,min:0},{name:"minThresholdPx",label:"Minimum Edge Threshold",type:"number",defaultValue:w,min:0},{name:"useBoundedThresholds",label:"Whether to bound thresholds",type:"boolean",defaultValue:!1}]},cuboidSideEdges:{taskTypes:[g.TaskType.CuboidAnnotation,g.TaskType.VideoCuboidAnnotation],title:"2D Cuboid Side Face Edge Positions",graderFn:A.gradePerFrame((o,a,s,{threshold:c=R})=>({edgeSideTop:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),g=x.formatCuboidAnnotation(a),A=x.getExtendedCuboidDirection(g)||x.getExtendedCuboidDirection(s)||"faceLeft",P=s.edges.sideBack||k.default.get(s.edges,A),w=g.edges.sideBack||k.default.get(s.edges,A),F=Math.abs(P.y1-w.y1)/g.sideHeight;return{correctWork:+(F<c),totalWork:1,intermediates:{sideTopDiff:F}}},o,a),edgeSideBack:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),g=x.formatCuboidAnnotation(a),A=x.getExtendedCuboidDirection(g)||x.getExtendedCuboidDirection(s)||"faceLeft",P=s.edges.sideBack||k.default.get(s.edges,A),w=g.edges.sideBack||k.default.get(s.edges,A),F=x.midpoint(g.vertices.faceTopleft,g.vertices.faceBottomright),R=Math.abs(F.x-w.x1),D=Math.abs(P.x1-w.x1)/R;return{correctWork:+(D<c),totalWork:1,intermediates:{sideBackDiff:D}}},o,a),edgeSideBottom:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),g=x.formatCuboidAnnotation(a),A=x.getExtendedCuboidDirection(g)||x.getExtendedCuboidDirection(s)||"faceLeft",P=s.edges.sideBack||k.default.get(s.edges,A),w=g.edges.sideBack||k.default.get(s.edges,A),F=Math.abs(P.y2-w.y2)/g.sideHeight;return{correctWork:+(F<c),totalWork:1,intermediates:{sideBottomDiff:F}}},o,a)})),paramConfigs:[{name:"threshold",label:"Side Edge Threshold (Fraction of Correct Side Height or Distance from Front Face Center to Side)",type:"number",defaultValue:R,min:0,step:.01}]},parallaxPoint:{taskTypes:[g.TaskType.CuboidAnnotation,g.TaskType.VideoCuboidAnnotation],title:"2D Cuboid Projected Point",graderFn:A.gradePerFrame((o,a,s,{threshold:c=D})=>({parallaxPoint:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),g=x.formatCuboidAnnotation(a),k=x.projectedPointFromCuboid(s),A=x.projectedPointFromCuboid(g),P=Math.abs(k.y-A.y)/g.sideHeight;return{correctWork:+(P<c),totalWork:1,intermediates:{parallaxPointDiff:P}}},o,a)})),paramConfigs:[{name:"threshold",label:"Parallax Point Threshold (Fraction of Correct Side Height)",type:"number",defaultValue:D,min:0,step:.01}]},cuboidIou:{taskTypes:[g.TaskType.CuboidAnnotation,g.TaskType.VideoCuboidAnnotation],title:"2D Cuboid Iou",graderFn:A.gradePerFrame((o,a,s,{threshold:c=G})=>({frontFaceIou:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),g=x.formatCuboidAnnotation(a),k=x.getCuboidFrontFaceAsBox(s),A=x.getCuboidFrontFaceAsBox(g),P=x.boxIou(k,A);return{correctWork:+(P>=c),totalWork:1,intermediates:{iou:P}}},o,a),sideFaceIou:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),g=x.formatCuboidAnnotation(a),k=gradeIsExtended(s,g);if(k)return k;try{let o=x.getCuboidSideFaceVertices(s),a=x.getCuboidSideFaceVertices(g),k=x.genericIou(o,a);return{correctWork:+(k>=c),totalWork:1,intermediates:{iou:k}}}catch(o){return{correctWork:0,totalWork:1}}},o,a),cuboidIou:A.gradeIfNotMissing((o,a)=>{let s=x.formatCuboidAnnotation(o),g=x.formatCuboidAnnotation(a);try{let o=x.getCuboidVertices(s),a=x.getCuboidVertices(g),k=x.genericIou(o,a);return{correctWork:+(k>=c),totalWork:1,intermediates:{iou:k}}}catch(o){return{correctWork:0,totalWork:1}}},o,a)})),paramConfigs:[{name:"threshold",label:"IoU Threshold",type:"number",defaultValue:G,min:0,step:.01}]}};a.default=B},180858:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.dataCollectionV2Grader=a.dataCollectionV2GraderFn=void 0;var c=s(167469);let dataCollectionV2GraderFn=async o=>{let a=o?.props?.totalTime;return{dataCollectionV2:{correctWork:a,totalWork:a,relativeCorrectWork:a,relativeTotalWork:a,introducedErrorCorrectWork:0,errorType:"collectionTime",numIncorrectFrames:0,numTotalFrames:0}}};a.dataCollectionV2GraderFn=dataCollectionV2GraderFn;let g={taskTypes:[c.TaskType.DataCollectionV2],title:"DC V2 Grades",graderFn:dataCollectionV2GraderFn};a.dataCollectionV2Grader=g},567208:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.linkingIoUScore=a.DocumentTranscriptionErrorType=void 0;var c,g,k,A=s(991984),x=(c=s(298784))&&c.__esModule?c:{default:c},P=s(167469),w=s(116615),F=s(798451),R=s(247740);function preProcessText(o,a){return a.includes("trim")&&(o=o.trim()),a.includes("lowercase")&&(o=o.toLowerCase()),o}a.DocumentTranscriptionErrorType=k,(g=k||(a.DocumentTranscriptionErrorType=k={})).Missing="missing",g.Extraneous="extraneous",g.Label="label",g.Text="text",g.Linking="linking",g.Placement="placement",g.Date="date",g.Money="money",g.Checkbox="checkbox",g.Select="select",g.PageRange="pageRange";let linkingIoUScore=(o,a)=>x.default.intersection(a,o).length/x.default.union(a,o).length;a.linkingIoUScore=linkingIoUScore;let selectedIOUScore=(o,a)=>0===a.length?+(0===o.length):x.default.intersection(o,a).length/x.default.union(o,a).length;function forErrorType(o,a){return(s,c,g,k)=>({[a]:o(s,c,g,k)})}function forErrorTypeWithContext(o,a){return(s,c,g,k,A,P)=>{let w=x.default.get(c?.frames,s),F=x.default.get(g?.frames,s);return{[a]:o(w,F,k,A,P)}}}let D=Object.freeze({documentTranscriptionText:{taskTypes:[P.TaskType.DocumentTranscription],title:"document transcription text",graderFn:A.gradePerFrameWithContext(forErrorTypeWithContext((o,a,s,c,g)=>{let k=g?.textProcessing??[];return A.gradeIfNotMissing((o,a)=>A.gradeFreeText(preProcessText(o,k),preProcessText(a,k),g?.textComparisonMethod??A.TextComparisonMethod.Levenshtein),o?.text,a?.text)},k.Text))},documentTranscriptionLinking:{taskTypes:[P.TaskType.DocumentTranscription],title:"document transcription linking",graderFn:A.gradePerFrame((o,a)=>({[k.Linking]:A.gradeIfNotMissing((o,a)=>({correctWork:linkingIoUScore(o,a),totalWork:1,intermediates:{actual:o,expected:a}}),o?.refs,a?.refs)}))},documentTranscriptionPlacement:{taskTypes:[P.TaskType.DocumentTranscription],title:"document transcription placement",graderFn:A.gradePerFrameWithContext(forErrorTypeWithContext((o,a,s,c,g)=>{let k=c?.underThreshold??g?.underThreshold??2,x=c?.overThreshold??g?.overThreshold??5;return A.gradeIfNotMissing((o,a)=>{let s=!1;return o.type===w.GeometryType.BoundingBox&&a.type===w.GeometryType.BoundingBox?s=F.isBoundingBoxInMargin(o,a,k,x):o.type===w.GeometryType.Polygon&&a.type===w.GeometryType.Polygon&&(s=R.isPolygonInMargin(o,a,k,x)),{correctWork:+s,totalWork:1,intermediates:{actual:o,expected:a}}},o?.location,a?.location)},k.Placement)),paramConfigs:[{name:"underThreshold",label:"Clipping Margin Threshold",type:"number",defaultValue:2},{name:"overThreshold",label:"Oversizing Margin Threshold",type:"number",defaultValue:5}]},documentTranscriptionDate:{taskTypes:[P.TaskType.DocumentTranscription],title:"document transcription date",graderFn:A.gradePerFrame(forErrorType((o,a)=>A.gradeIfNotMissing((o,a)=>{let s=o.year===a.year&&o.month===a.month&&o.day===a.day;return{correctWork:s?1:0,totalWork:1,intermediates:{actual:o,expected:a}}},o?.date,a?.date),k.Date))},documentTranscriptionMoney:{taskTypes:[P.TaskType.DocumentTranscription],title:"document transcription money",graderFn:A.gradePerFrame(forErrorType((o,a)=>A.gradeIfNotMissing((o,a)=>{let s=o.amount===a.amount;return{correctWork:s?1:0,totalWork:1,intermediates:{actual:o,expected:a}}},o?.money,a?.money),k.Money))},documentTranscriptionCheckbox:{taskTypes:[P.TaskType.DocumentTranscription],title:"document transcription checkbox",graderFn:A.gradePerFrame(forErrorType((o,a)=>((o,a)=>{if(x.default.isNil(o)&&x.default.isNil(a))return{correctWork:0,totalWork:0};let s=!o==!a;return{correctWork:s?1:0,totalWork:1,intermediates:{actual:o,expected:a}}})(o?.checked,a?.checked),k.Checkbox))},documentTranscriptionSelect:{taskTypes:[P.TaskType.DocumentTranscription],title:"document transcription select",graderFn:A.gradePerFrame(forErrorType((o,a)=>A.gradeIfNotMissing((o,a)=>({correctWork:selectedIOUScore(o,a),totalWork:1,intermediates:{actual:o,expected:a}}),o?.selected,a?.selected),k.Select))},documentTranscriptionPageRange:{taskTypes:[P.TaskType.DocumentTranscription],title:"document transcription page range iou",graderFn:A.gradePerFrame(forErrorType((o,a)=>A.gradeIfNotMissing(([s,c],[g,k])=>{let A=(x.default.min([c,k])-x.default.max([s,g])+1)/(x.default.max([c,k])-x.default.min([s,g])+1);return{correctWork:A>0?A:0,totalWork:1,intermediates:{actual:o,expected:a}}},o?.pageRange,a?.pageRange),k.PageRange))}});a.default=D},587005:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.ELLIPSE_GRADER_IOU_DIFF_THRESHOLD=a.ELLIPSE_DISTANCE_IOU_THRESHOLD=void 0;var c=s(167469),g=s(991984),k=s(440169);a.ELLIPSE_DISTANCE_IOU_THRESHOLD=.6;let A=.9;a.ELLIPSE_GRADER_IOU_DIFF_THRESHOLD=A;let x={ellipseIou:{taskTypes:[c.TaskType.EllipseAnnotation],title:"Ellipse Intersection-Over-Union",graderFn:g.gradePerFrame((o,a,s,{threshold:c=A})=>({ellipseIou:g.gradeIfNotMissing((o,a)=>{try{let s=k.genericIou(o,a);return{correctWork:+(s>=c),totalWork:1,intermediates:{iou:s}}}catch(o){return{correctWork:0,totalWork:1}}},o,a)})),paramConfigs:[{name:"threshold",label:"IoU Threshold",type:"number"}]}};a.default=x},464746:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.evaluationProjectGrader=void 0;var c=s(167469);let g="evaluationProject",evaluationProjectGrader=(o,a,s,c,k,A,x)=>{let P=x?.evaluationScores,w=P?.correctWork||0,F=P?.totalWork||0;return{[g]:{correctWork:w,totalWork:F,graderType:g,label:g,numTotalFrames:1,numIncorrectFrames:Math.max(0,Math.trunc(F)-Math.trunc(w)),errorType:g}}};a.evaluationProjectGrader=evaluationProjectGrader;let k=Object.freeze({[g]:{taskTypes:[c.TaskType.TextCollection,c.TaskType.NamedEntityRecognition],title:"Evaluation project",graderFn:evaluationProjectGrader,global:!0}});a.default=k},995906:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.DEFAULT_POINT_DISTANCE_THRESHOLD=a.DEFAULT_BOX_POSITION_THRESHOLD_PX=a.DEFAULT_BOX_DIMENSION_THRESHOLD_PX=a.DEFAULT_MAX_THRESHOLD_PX=a.DEFAULT_MIN_THRESHOLD_PX=a.DEFAULT_IOU_THRESHOLD=a.DEFAULT_EDGE_THRESHOLD=a.BOX_DISTANCE_LABEL_BIAS=a.BOX_DISTANCE_IOU_THRESHOLD=void 0;var c=s(167469),g=s(991984),k=s(362714),A=s(260160),x=s(242603);a.BOX_DISTANCE_IOU_THRESHOLD=.2,a.BOX_DISTANCE_LABEL_BIAS=.075;let P=.05;a.DEFAULT_EDGE_THRESHOLD=P;let w=.75;a.DEFAULT_IOU_THRESHOLD=w;let F=5;a.DEFAULT_MIN_THRESHOLD_PX=F;let R=15;a.DEFAULT_MAX_THRESHOLD_PX=R;let D=5;a.DEFAULT_BOX_DIMENSION_THRESHOLD_PX=D,a.DEFAULT_BOX_POSITION_THRESHOLD_PX=5;let G=6;a.DEFAULT_POINT_DISTANCE_THRESHOLD=G;let B=[c.TaskType.PolygonAnnotation],W={extremalPointEdges:{taskTypes:B,title:"Extremal Point Box Edge positions",graderFn:g.gradePerFrame((o,a,s,{threshold:c=P,leftThreshold:g=c,rightThreshold:x=c,topThreshold:w=c,bottomThreshold:D=c,minThresholdPx:G=F,maxThresholdPx:B=R,useBoundedThresholds:W=!1})=>{let z=A.extremalPointAnnotToBoxAnnot(o),V=A.extremalPointAnnotToBoxAnnot(a);return k.edgeGrader(z,V,s,{threshold:c,leftThreshold:g,rightThreshold:x,topThreshold:w,bottomThreshold:D,minThresholdPx:G,maxThresholdPx:B,useBoundedThresholds:W})}),paramConfigs:[{name:"threshold",label:"Default Edge Threshold",type:"number",defaultValue:P},{name:"leftThreshold",label:"Left Threshold",type:"number",defaultValue:P},{name:"rightThreshold",label:"Right Threshold",type:"number",defaultValue:P},{name:"bottomThreshold",label:"Bottom Threshold",type:"number",defaultValue:P},{name:"topThreshold",label:"Top Threshold",type:"number",defaultValue:P},{name:"maxThresholdPx",label:"Maximum Edge Threshold",type:"number",defaultValue:R},{name:"minThresholdPx",label:"Minimum Edge Threshold",type:"number",defaultValue:F},{name:"useBoundedThresholds",label:"Whether to bound thresholds",type:"boolean",defaultValue:!1}]},extremalPointIOU:{taskTypes:B,title:"Extremal Point Box size and position",graderFn:g.gradePerFrame((o,a,s,{threshold:c=w})=>{let g=A.extremalPointAnnotToBoxAnnot(o),x=A.extremalPointAnnotToBoxAnnot(a);return k.iouGrader(g,x,s,{threshold:c})}),paramConfigs:[{name:"threshold",label:"IOU Threshold",type:"number",defaultValue:w}]},extremalPointDimensions:{taskTypes:B,title:"Extremal Point Box Dimensions grader",graderFn:g.gradePerFrame((o,a,s,{threshold:c=D,heightThreshold:g=c,widthThreshold:x=c})=>{let P=A.extremalPointAnnotToBoxAnnot(o),w=A.extremalPointAnnotToBoxAnnot(a);return k.boxDimensionsGrader(P,w,s,{threshold:c,heightThreshold:g,widthThreshold:x})}),paramConfigs:[{name:"threshold",label:"Default Dimension Threshold",type:"number",defaultValue:D},{name:"heightThreshold",label:"Height Threshold",type:"number",defaultValue:D},{name:"widthThreshold",label:"Width Threshold",type:"number",defaultValue:D}]},extremalPointDistance:{taskTypes:B,title:"Extremal Point Distance grader",graderFn:g.gradePerFrame((o,a,s,{threshold:c=G})=>{let g=A.standardizeExtremalPoints(o),k=A.standardizeExtremalPoints(a);return{top:x.distanceGrader(g.top,k.top,s,{threshold:c}).pointDistance,left:x.distanceGrader(g.left,k.left,s,{threshold:c}).pointDistance,bottom:x.distanceGrader(g.bottom,k.bottom,s,{threshold:c}).pointDistance,right:x.distanceGrader(g.right,k.right,s,{threshold:c}).pointDistance}}),paramConfigs:[{name:"threshold",label:"Distance Threshold",type:"number",defaultValue:G}]}};a.default=W},583456:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.fireflyDirectMatchGrader=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(991984),x=s(222357),P=s(963494),w=s(513254);let getScore=(o,a,s,c)=>{if(1!==o.length||1!==a.length||g.default.isBoolean(o[0])||g.default.isBoolean(a[0])||!c)return 0;let k=o[0],A=a[0],x=Number(k),w=Number(A),F=c.type===P.TextCollectionFieldType.Category?c.choices.length-1:c.options.length-1,scoreToRange=(o,a)=>o>=.8*a?2:o>=.5*a?1:0,R=scoreToRange(x,F),D=scoreToRange(w,F);return R===D?1:1===Math.abs(R-D)?.5:0},fireflyDirectMatchGrader=(o,a,s,c,k,F)=>({fireflyDirectMatch:A.gradeIfNotMissing((o,a)=>{if(!([P.TextCollectionFieldType.Category,P.TextCollectionFieldType.Autocomplete].includes(a.type)&&w.shouldGradeField(a.field_id,c?.fieldsWhitelist||F?.fieldsWhitelist,!!o.fieldWasReadOnly)))return{correctWork:0,totalWork:0};{let s=F?.taskFields?.find(o=>o.field_id===a.field_id);return{correctWork:g.default.sum(o.response.map(o=>o.result===x.GraderResult.Correct?1:o.result===x.GraderResult.Incorrect?a.type===P.TextCollectionFieldType.Category?getScore(o.expected,o.given,c,s):getScore([o.expected],[o.given],c,s):0)),totalWork:a.response.length}}},o,a)});a.fireflyDirectMatchGrader=fireflyDirectMatchGrader;let F={fireflyDirectMatchGrader:{taskTypes:[k.TaskType.TextCollection],title:"firefly direct match grader",graderFn:A.gradePerFrame(fireflyDirectMatchGrader)}};a.default=F},819354:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"marginLineLengthGrader",{enumerable:!0,get:function(){return c.marginLineLengthGrader}}),Object.defineProperty(a,"zCoordinateMarginLineGrader",{enumerable:!0,get:function(){return g.zCoordinateMarginLineGrader}});var c=s(40025),g=s(362508)},40025:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.marginLineLengthGrader=a.marginLineLength=a.LINE_GRADER_MARGIN_THRESHOLD=void 0;var c=s(167469),g=s(440169),k=s(991984);let A=5;a.LINE_GRADER_MARGIN_THRESHOLD=A;let marginLineLength=(o,a,s,{threshold:c=A})=>({marginLineLength:k.gradeIfNotMissing((o,a)=>{let{lengthCorrectUserLine:s,lengthTotalUserLine:k,lengthTotalCorrectLine:A}=g.getLengthOfLineInMargin(o.vertices,a.vertices,c),x=s/Math.max(A,k);return{correctWork:x*A,totalWork:A}},o,a)});a.marginLineLength=marginLineLength;let x={taskTypes:[c.TaskType.LineAnnotation],title:"GIS Margin Line Length Grader",graderFn:k.gradePerFrame(marginLineLength),paramConfigs:[{name:"threshold",label:"Margin Threshold",type:"number",defaultValue:A}]};a.marginLineLengthGrader=x},362508:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.zCoordinateMarginLineGrader=a.zCoordMarginLineLength=a.XY_LINE_GRADER_MARGIN_THRESHOLD=a.Z_LINE_GRADER_MARGIN_THRESHOLD=void 0;var c=s(167469),g=s(440169),k=s(991984);let A=.1;a.Z_LINE_GRADER_MARGIN_THRESHOLD=A;let x=5;a.XY_LINE_GRADER_MARGIN_THRESHOLD=x;let zCoordMarginLineLength=(o,a,s,{zthreshold:c=A,xythreshold:P=x})=>({zCoordMarginLineLength:k.gradeIfNotMissing((o,a)=>{let{lengthCorrectUserLine:s,lengthTotalUserLine:k,lengthTotalCorrectLine:A}=g.getLengthOfLineInMarginZCoordinate(o.vertices,a.vertices,c,P),x=s/Math.max(A,k);return{correctWork:x*A,totalWork:A}},o,a)});a.zCoordMarginLineLength=zCoordMarginLineLength;let P={taskTypes:[c.TaskType.LidarTopdown],title:"GIS Margin Z Coordinate Grader",graderFn:k.gradePerFrame(zCoordMarginLineLength),paramConfigs:[{name:"zthreshold",label:"Margin Threshold for z coordinate",type:"number",defaultValue:A},{name:"xythreshold",label:"Margin Threshold for matching line",type:"number",defaultValue:x}]};a.zCoordinateMarginLineGrader=P},401387:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"linksGrader",{enumerable:!0,get:function(){return c.linksGrader}}),Object.defineProperty(a,"nonLinksAttributeGrader",{enumerable:!0,get:function(){return g.nonLinksAttributeGrader}});var c=s(682675),g=s(424590)},682675:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.linksGrader=a.calculateCorrectAndTotalWork=a.getLinkedAttributeToAnnotations=a.fromAnnotationLabelChangedLinkingGraderGenerator=a.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=a.toAndFromAnnotationExistLinkingGraderGenerator=a.linksGraderFn=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(599789),A=s(991984),x=s(942991);let linksGraderFn=(o,a,s,c,P,w)=>{P||(P={});let F=g.default.get(P,"linkKeys",[]),R=a?.frames?.[o],D=s?.frames?.[o],G=g.default.union(g.default.keys(D?.attributes),g.default.keys(R?.attributes)),B=w?.matchedAnnotationsListContext,W=g.default.filter(G,o=>{let a=w?.attributeTypes;return!!x.toLinkingAttributeKeyBase(o,F)||a?.[o]===k.AnnotationAttributeType.Linked}),z=g.default.compact(g.default.map(W,o=>x.toLinkingAttributeKeyBase(o,F))),V=[...new Set(z)],U={};return V.forEach(o=>{let a=toAndFromAnnotationExistLinkingGraderGenerator(o,B),s=toAnnotationMissingOrLabelChangedLinkingGraderGenerator(o,B),c=fromAnnotationLabelChangedLinkingGraderGenerator(o,B);U[`linking_${o}`]=A.gradeIfNotMissing(a,R,D),U[`linking_${o}_UNMATCHED_TO_ANN`]=A.gradeIfNotMissing(s,R,D),U[`linking_${o}_FROM_LABELS_DIFFERENT`]=A.gradeIfNotMissing(c,R,D)}),U};a.linksGraderFn=linksGraderFn;let toAndFromAnnotationExistLinkingGraderGenerator=(o,a)=>(s,c)=>{let g=s?.label,k=c?.label;if(g!==k)return{correctWork:0,totalWork:0};let{originalToAnnotations:A,correctToAnnotations:x}=getLinkedAttributeToAnnotations(o,s,c,a),P=A.filter(o=>o?.correctAnnotation&&o?.correctAnnotation?.props.label===o?.currentAnnotation?.props.label),w=x.filter(o=>o?.correctAnnotation&&o?.correctAnnotation?.props.label===o?.currentAnnotation?.props.label),{correctWork:F,totalWork:R,intermediates:D}=calculateCorrectAndTotalWork(P,w,!0);return{correctWork:F,totalWork:R,intermediates:D}};a.toAndFromAnnotationExistLinkingGraderGenerator=toAndFromAnnotationExistLinkingGraderGenerator;let toAnnotationMissingOrLabelChangedLinkingGraderGenerator=(o,a)=>(s,c)=>{let g=s?.label,k=c?.label;if(g!==k)return{correctWork:0,totalWork:0};let{originalToAnnotations:A,correctToAnnotations:x}=getLinkedAttributeToAnnotations(o,s,c,a),P=A.filter(o=>!o?.correctAnnotation||o.correctAnnotation?.props.label!==o.currentAnnotation?.props.label),w=x.filter(o=>!o?.correctAnnotation||o.correctAnnotation?.props.label!==o.currentAnnotation?.props.label),{correctWork:F,totalWork:R}=calculateCorrectAndTotalWork(P,w);return{correctWork:F,totalWork:R}};a.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=toAnnotationMissingOrLabelChangedLinkingGraderGenerator;let fromAnnotationLabelChangedLinkingGraderGenerator=(o,a)=>(s,c)=>{let g=s?.label,k=c?.label;if(g===k)return{correctWork:0,totalWork:0};let{originalToAnnotations:A,correctToAnnotations:x}=getLinkedAttributeToAnnotations(o,s,c,a),{totalWork:P}=calculateCorrectAndTotalWork(A,x);return{correctWork:0,totalWork:P}};a.fromAnnotationLabelChangedLinkingGraderGenerator=fromAnnotationLabelChangedLinkingGraderGenerator;let getLinkedAttributeToAnnotations=(o,a,s,c)=>{let k=a?.attributes,A=s?.attributes,x=Object.values(g.default.pickBy(k,(a,s)=>s.includes(o))),P=Object.values(g.default.pickBy(A,(a,s)=>s.includes(o))),w=x.map(o=>c?.find(a=>a.currentAnnotation?.props?.id===o)),F=P.map(o=>c?.find(a=>a.correctAnnotation?.props?.id===o));return{originalToAnnotations:w,correctToAnnotations:F}};a.getLinkedAttributeToAnnotations=getLinkedAttributeToAnnotations;let calculateCorrectAndTotalWork=(o,a,s=!1)=>{let c=o.map(o=>o?.correctAnnotation?.props?.id),k=a.map(o=>o?.correctAnnotation?.props?.id),A=Math.max(o.length,a.length),x=g.default.intersectionBy(c,k).length,P=g.default.difference(c,k);return s&&P&&P.length>0&&(x-=P.length),{correctWork:x,totalWork:A,intermediates:{extraneous:P,missing:g.default.difference(k,c)}}};a.calculateCorrectAndTotalWork=calculateCorrectAndTotalWork;let P={taskTypes:k.twoDTypes,title:"Links Grader",graderFn:A.gradePerFrameWithContext(linksGraderFn,!1,!1,!1)};a.linksGrader=P},424590:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.nonLinksAttributeGrader=a.defaultAttributeGraderFn=a.attributeGrader=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(599789),A=s(991984),x=s(942991);let attributeGrader=(o,a,s,c,P,w)=>{P||(P={});let F=g.default.get(P,"linkKeys",[]),R=a?.frames?.[o],D=s?.frames?.[o],G=g.default.keys(D?.attributes||R?.attributes),B=g.default.filter(G,o=>w?.attributeTypes?.[o]!==k.AnnotationAttributeType.Linked&&!x.toLinkingAttributeKeyBase(o,F)),W={};return g.default.forEach(B,o=>{let a=attributeGraderFnGenerator(o,P);W[`attribute_${o}`]=A.gradeIfNotMissing(a,R,D)}),W};a.attributeGrader=attributeGrader;let attributeGraderFnGenerator=(o,a)=>(s,c)=>defaultAttributeGraderFn(o,s,c,a),defaultAttributeGraderFn=(o,a,s)=>{let c=a?.attributes?.[o],k=s?.attributes?.[o];return Array.isArray(c)&&Array.isArray(k)&&(c=g.default.sortBy(c),k=g.default.sortBy(k)),{correctWork:+g.default.isEqual(c,k),totalWork:1}};a.defaultAttributeGraderFn=defaultAttributeGraderFn;let P={taskTypes:k.twoDTypes,title:"Non-links Attribute Grader",graderFn:A.gradePerFrameWithContext(attributeGrader,!1)};a.nonLinksAttributeGrader=P},942991:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.toLinkingAttributeKeyBase=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c};a.toLinkingAttributeKeyBase=(o,a)=>{let s=g.default.sortBy(a,o=>-o.length);return g.default.find(s,a=>o.includes(a))}},524183:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.gradersForTaskType=a.calculatePathLength=a.extraneousGrader=void 0;var c=_interopRequireDefault(s(298784)),g=s(599789),k=s(167469),A=s(308408),x=s(19161),P=s(991984),w=_interopRequireDefault(s(205308)),F=_interopRequireDefault(s(362714)),R=_interopRequireDefault(s(587005)),D=_interopRequireDefault(s(278127)),G=_interopRequireDefault(s(729493)),B=_interopRequireDefault(s(147368)),W=_interopRequireDefault(s(233193)),z=_interopRequireDefault(s(152672)),V=_interopRequireDefault(s(513254)),U=_interopRequireDefault(s(464746)),K=_interopRequireDefault(s(909452)),Y=_interopRequireDefault(s(896135)),$=_interopRequireDefault(s(242603)),X=_interopRequireDefault(s(355427)),Z=_interopRequireDefault(s(216383)),J=_interopRequireDefault(s(642101)),ee=s(313220),et=_interopRequireDefault(s(63226)),er=_interopRequireDefault(s(567208)),en=_interopRequireDefault(s(30353)),ei=_interopRequireDefault(s(272455)),eo=_interopRequireDefault(s(875611)),ea=_interopRequireDefault(s(944129)),es=_interopRequireDefault(s(247915)),el=_interopRequireDefault(s(835802)),eu=_interopRequireDefault(s(798921)),ed=_interopRequireDefault(s(856753)),ec=_interopRequireDefault(s(197845)),ep=_interopRequireDefault(s(580792)),ef=_interopRequireDefault(s(995906)),eh=_interopRequireWildcard(s(68380)),em=_interopRequireWildcard(s(487714)),eg=_interopRequireWildcard(s(190913)),ey=_interopRequireWildcard(s(819354)),eb=_interopRequireWildcard(s(388746)),ev=_interopRequireWildcard(s(401387)),e_=_interopRequireDefault(s(410718)),eT=_interopRequireDefault(s(583456)),ek=_interopRequireDefault(s(844162)),eA=_interopRequireDefault(s(763081)),eS=s(180858),ex=_interopRequireDefault(s(709296)),eM=_interopRequireDefault(s(771679)),eC=s(476670);function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}function _interopRequireWildcard(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}let extraneousGrader=(o,a,s,g,A,x)=>{let P=c.default.keys(o&&o.frames),w=c.default.keys(a&&a.frames),F=c.default.keys(x&&x.frames),R=c.default.union(P,w,F),D=w.length||P.length||F.length||1,G=c.default.difference(P,w),B=c.default.map(R,(A,P)=>{let w=c.default.get(o,["frames",A]),F=c.default.get(a,["frames",A]),D=c.default.get(x,["frames",A]),G=s?.props.overriddenTaskType===k.TaskType.EventAnnotation&&!!g?.eventEndpointLeniency&&(P<g.eventEndpointLeniency||P>=R.length-g.eventEndpointLeniency);return F||G?{frame:A,correctWork:0,totalWork:0,relativeCorrectWork:0,relativeTotalWork:0,introducedErrorCorrectWork:0}:w&&D?{frame:A,correctWork:-1,totalWork:0,relativeCorrectWork:0,relativeTotalWork:1,introducedErrorCorrectWork:0,carriedOverWork:1}:w&&!D?{frame:A,correctWork:-1,totalWork:0,relativeCorrectWork:-1,relativeTotalWork:0,introducedErrorCorrectWork:-1}:!w&&D?{frame:A,correctWork:0,totalWork:0,relativeCorrectWork:1,relativeTotalWork:1,introducedErrorCorrectWork:0}:void 0}),W=c.default.map(c.default.filter(B,o=>+(o?.relativeCorrectWork!==o?.relativeTotalWork)),"frame"),z=W.length,V=-c.default.sumBy(B,"correctWork"),U=c.default.sumBy(B,"correctWork")/D,K=c.default.sumBy(B,"relativeCorrectWork")/D,Y=c.default.sumBy(B,"relativeTotalWork")/D,$=c.default.sumBy(B,"introducedErrorCorrectWork")/D,X=c.default.sumBy(B,o=>o?.carriedOverWork??0)/D;return{extraneous:{correctWork:U,totalWork:0,relativeCorrectWork:K,relativeTotalWork:Y,introducedErrorCorrectWork:$,carriedOverWork:X,incorrectFrames:G,relativeIncorrectFrames:W,errorType:"extraneous",numIncorrectFrames:V,numTotalFrames:D,numRelativeIncorrectFrames:z}}};a.extraneousGrader=extraneousGrader;let calculatePathLength=(o,a,s,g=1,k=1)=>{let A=[],P=[],w=x.generateChildToParentChoiceMapping(s),F=x.getChoice(s,o);for(;!c.default.isNil(F);)A.push(F),F=w.get(F);let R=x.getChoice(s,a);for(;!c.default.isNil(R);)P.push(R),R=w.get(R);A.reverse(),P.reverse();let D=0;for(;A[D]===P[D]&&!c.default.isNil(P[D]);)D+=1;if(0===D&&P.length!==D)return 1e3;let G=k*(P.length-D)+g*(A.length-D);return G};a.calculatePathLength=calculatePathLength;let eP=c.default.values(k.TaskType),eL={missing:{taskTypes:eP,title:"Missing",graderFn:P.gradePerFrameWithContext((o,a,s,g,k,A)=>{let x=a?.frames?.[o],w=s?.frames?.[o],{rules:F}=A?.taxonomy??{};if(F){let o=eC.isSensorFusionAnnotationLockedForMissingGrader(a??s,F);if(o)return{missing:{correctWork:0,totalWork:0}}}let R=w?.acceptedAnnotations&&c.default.findIndex(w.acceptedAnnotations,({annotation:o})=>c.default.isNil(o))>=0;return R&&c.default.isEmpty(x)?{missing:{correctWork:1,totalWork:1}}:{missing:P.gradeIfNotMissing(()=>({correctWork:1,totalWork:1}),x,w)}},!0)},extraneous:{taskTypes:eP,title:"Extraneous",graderFn:extraneousGrader},labels:{taskTypes:eP,title:"Labels",graderFn:P.gradeSingle((o,a,s,g={},k)=>{let{partialCredit:x,penaltyFactor:P=.5}=g,w=0;if(x){if(o.props.overriddenTaskType===a.props.overriddenTaskType&&!c.default.isNil(o.props.overriddenTaskType)){let s=A.taskTypeToGeometry[o.props.overriddenTaskType];if(c.default.isNil(s))throw Error(`No geometry corresponding to task type ${o.props.overriddenTaskType} for original annotation ${o.props.id}`);let g=k.labelChoices?.[s];if(c.default.isNil(g))throw Error(`No label choices corresponding to geometry ${s} for original annotation ${o.props.id}`);let x=calculatePathLength(o?.props?.label,a?.props?.label,g);w=+(P**(.5*x)).toFixed(3)}}else w=+(o?.props?.label===a?.props?.label);return{correctWork:w,totalWork:1,incorrectFrames:0===w?c.default.union(...[o,a].map(o=>c.default.keys(o?.frames))):[]}},"label"),paramConfigs:[{name:"partialCredit",label:"Give partial credit",type:"boolean",defaultValue:!1},{name:"penaltyFactor",label:"Penalty multiplier for each level",type:"number"}]},lenientLabels:{taskTypes:eP,title:"Lenient Labels",graderFn:P.gradeSingle((o,a,s,g={})=>{let k=o?.props?.label,A=a?.props?.label,x=+(k===A),P=c.default.get(g,"partialCreditKeysAndValues",[]);return P.forEach(o=>{o.initialLabel===k&&o.expectedLabel===A&&(x=o.partialCredit)}),{correctWork:x,totalWork:1,incorrectFrames:0===x?c.default.union(...[o,a].map(o=>c.default.keys(o?.frames))):[]}},"lenientLabel"),paramConfigs:[{name:"partialCreditKeysAndValues",label:"ordered pairs of labels to give partial credit for",type:"any",defaultValue:[]}]},attributes:{taskTypes:[...g.twoDTypes,...g.lidarTypes],title:"Attributes",graderFn:P.gradePerFrameWithContext(w.default,!1),paramConfigs:[{name:"angleDiffThresholdDegrees",label:"Angle Diff Threshold (Degrees)",type:"number"},{name:"xlineDiffThresholdFraction",label:"XLine Diff Threshold (Fraction of Correct Width)",type:"number"},{name:"ylineDiffThresholdFraction",label:"YLine Diff Threshold (Fraction of Correct Height)",type:"number"},{name:"enabledKeys",label:"Only run graders for these attributes",type:"any"},{name:"ltdPerFrameKeys",label:"Per Frame LTD Attributes",type:"any"}]}},eI={...eL,linkingUuid:{taskTypes:g.lidarLinkingSubtaskTypes,title:"Linking Uuid",graderFn:P.gradePerFrame(ee.linkingUuidGrader)},...F.default,...R.default,...D.default,...G.default,...ed.default,...ec.default,...ep.default,...ei.default,...B.default,...W.default,...ey,...z.default,...V.default,...U.default,...K.default,...Y.default,...$.default,...X.default,...Z.default,...er.default,...ef.default,...e_.default,...ek.default,...eA.default,...ex.default,...eM.default,...J.default,...et.default,...eo.default,...ea.default,...es.default,...el.default,...eu.default,...eT.default,...eh,...em,...eg,...en.default,...eb,...ev,dataCollectionV2Grader:eS.dataCollectionV2Grader},eE={[k.TaskType.Annotation]:{...eL,...F.default,linkingUuid:eI.linkingUuid,beeMappingLinkingGrader:em.beeMappingLinkingGrader,beeMappingAttributeGrader:em.beeMappingAttributeGrader,beeMappingLinterDismissalGrader:em.beeMappingLinterDismissalGrader},[k.TaskType.VideoBoxAnnotation]:{...eL,...F.default,beeMappingLinkingGrader:em.beeMappingLinkingGrader,beeMappingAttributeGrader:em.beeMappingAttributeGrader},[k.TaskType.LidarLinking]:{...eL,...F.default},[k.TaskType.PolygonAnnotation]:{...eL,...X.default,...ef.default,...eg,beeMappingLinkingGrader:em.beeMappingLinkingGrader,beeMappingAttributeGrader:em.beeMappingAttributeGrader,beeMappingLinterDismissalGrader:em.beeMappingLinterDismissalGrader},[k.TaskType.CuboidAnnotation]:{...eL,...D.default,beeMappingLinkingGrader:em.beeMappingLinkingGrader,beeMappingAttributeGrader:em.beeMappingAttributeGrader,beeMappingLinterDismissalGrader:em.beeMappingLinterDismissalGrader},[k.TaskType.LineAnnotation]:{...eL,...W.default,beeMappingGlobal:em.beeMappingGlobal,beeMappingLinkingGrader:em.beeMappingLinkingGrader,beeMappingAttributeGrader:em.beeMappingAttributeGrader,beeMappingLinterDismissalGrader:em.beeMappingLinterDismissalGrader},[k.TaskType.PointAnnotation]:{...eL,...$.default,beeMappingLinkingGrader:em.beeMappingLinkingGrader,beeMappingAttributeGrader:em.beeMappingAttributeGrader,beeMappingLinterDismissalGrader:em.beeMappingLinterDismissalGrader},[k.TaskType.DataCollectionV2]:{dataCollectionV2:eS.dataCollectionV2Grader}};a.gradersForTaskType=eE,a.default=eI},875611:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.gradeE5=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(991984),x=s(39083),P=s(74909);let w=.15,F=-.05,R=.2,D=1.5,gradeE1=o=>{let a=g.default.isEmpty(o)?0:1;return{E1:{correctWork:a,totalWork:1}}},gradeE2=(o,a)=>({E2:A.ignoreIfMissing((o,a)=>({correctWork:+(o.uuid===a.uuid),totalWork:1}),o,a)}),gradeE3=(o,a,s,{e3Threshold:c=D})=>({E3:A.ignoreIfMissing((o,a)=>{let s=Math.abs(x.computeAngleDiff(o.yaw,a.yaw));return{correctWork:+(s<c),totalWork:1,intermediates:{headingDiff:s}}},o,a)}),gradeE4=(o,a,s,{e4UpperBoundThreshold:c=w,e4LowerBoundThreshold:g=F})=>({E4:A.ignoreIfMissing((o,a)=>{let s=a.dimensions.x-o.dimensions.x,k=a.dimensions.y-o.dimensions.y,A=a.dimensions.z-o.dimensions.z;return{correctWork:+(s<c&&k<c&&A<c&&s>=g&&k>=g&&A>=g),totalWork:1,intermediates:{wDiff:s,lDiff:k,hDiff:A}}},o,a)}),gradeE5=(o,a,s,{e5Threshold:c=R})=>({E5:A.ignoreIfMissing((o,a)=>{let s=P.naiveDistance(o.position,a.position);return{correctWork:+(s<c),totalWork:1,intermediates:{positionDiff:s}}},o,a)});a.gradeE5=gradeE5;let gradeE7=(o,a)=>({E7:A.ignoreIfMissing((o,a)=>{let s=o.label,c=a.label;return{correctWork:+(s===c||"UNKNOWN_ZONE"===s),totalWork:1}},o,a)}),gradeE8=(o,a)=>{let s=g.default.isEmpty(a)?0:1;return{E8:{correctWork:s,totalWork:1}}},G={E0:{taskTypes:[k.TaskType.LidarAnnotation],title:"Falcon E0",graderFn:A.gradePerFrame((o,a,s,c)=>{let g=gradeE1(o).E1.correctWork,k=gradeE2(o,a).E2.correctWork,A=gradeE3(o,a,s,c).E3.correctWork,x=gradeE4(o,a,s,c).E4.correctWork,P=gradeE5(o,a,s,c).E5.correctWork,w=gradeE7(o,a).E7.correctWork,F=gradeE8(o,a).E8.correctWork;return{E0:{correctWork:g&&k&&A&&x&&P&&w&&F?1:0,totalWork:1}}},!0)},E1:{taskTypes:[k.TaskType.LidarAnnotation],title:"Falcon E1",graderFn:A.gradePerFrame(gradeE1,!0)},E2:{taskTypes:[k.TaskType.LidarAnnotation],title:"Falcon E2",graderFn:A.gradePerFrame(gradeE2,!0)},E3:{taskTypes:[k.TaskType.LidarAnnotation],title:"Falcon E3",graderFn:A.gradePerFrame(gradeE3,!0)},E4:{taskTypes:[k.TaskType.LidarAnnotation],title:"Falcon E4",graderFn:A.gradePerFrame(gradeE4,!0)},E5:{taskTypes:[k.TaskType.LidarAnnotation],title:"Falcon E5",graderFn:A.gradePerFrame(gradeE5,!0)},E7:{taskTypes:[k.TaskType.LidarAnnotation],title:"Falcon E7",graderFn:A.gradePerFrame(gradeE7,!0)},E8:{taskTypes:[k.TaskType.LidarAnnotation],title:"Falcon E8",graderFn:A.gradePerFrame(gradeE8,!0)}};a.default=G},580792:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var c=s(167469),g=s(991984);let k={gridSegmentationMatrixDifference:{taskTypes:[c.TaskType.GridSegmentation],title:"Grader for Grid Segmentation matrix difference",graderFn:g.gradePerFrame((o,a)=>({gridSegmentationMatrixDifference:g.gradeIfNotMissing((o,a)=>{if(o.values.length!==a.values.length||o.width!==a.width||o.height!==a.height||o.values.length!==o.width*o.height)throw Error("Grid Segmentation values must have the same shape.");let s=o.width*o.height,c=0,g=0;for(let g=0;g<s;g++)c+=o.values[g]!==a.values[g]?1:0;let k=1-c/s,A={differentValuesCount:c,totalNumbersCount:s};return{correctWork:k,totalWork:1,intermediates:A}},o,a)}))}};a.default=k},729493:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.PARAMS_WITH_FRONTEND_VIS=a.typedLidarGraders=a.sizeGrader=a.positionGrader=a.headingGrader=a.DEFAULT_FACE_POSITION_GRADER_CONFIG=a.DEFAULT_GROUP_IOU_THRESHOLD=a.DEFAULT_FACE_POSITION_OUTER_THRESHOLD=a.DEFAULT_FACE_POSITION_INNER_THRESHOLD=a.DEFAULT_PITCH_THRESHOLD=a.DEFAULT_BANK_THRESHOLD=a.DEFAULT_WEAK_HEADING_THRESHOLD=a.DEFAULT_HEADING_THRESHOLD=a.DEFAULT_STRICT_Z_THRESHOLD=a.DEFAULT_WEAK_Z_THRESHOLD=a.DEFAULT_IOU_THRESHOLD=a.DEFAULT_DIMENSIONS_THRESHOLD=a.DEFAULT_SIZE_THRESHOLD=a.DEFAULT_SINGLE_AXIS_POSITION_THRESHOLD=a.DEFAULT_POSITION_THRESHOLD=void 0;var c=s(167469),g=_interopRequireDefault(s(298784)),k=s(74909),A=s(39083),x=s(825555),P=s(108040),w=_interopRequireDefault(s(141862)),F=s(991984);function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}let R=.6;a.DEFAULT_POSITION_THRESHOLD=R,a.DEFAULT_SINGLE_AXIS_POSITION_THRESHOLD=.2;let D=.6;a.DEFAULT_SIZE_THRESHOLD=D;let G=.25;a.DEFAULT_DIMENSIONS_THRESHOLD=G;let B=.6;a.DEFAULT_IOU_THRESHOLD=B,a.DEFAULT_WEAK_Z_THRESHOLD=.2,a.DEFAULT_STRICT_Z_THRESHOLD=.02,a.DEFAULT_HEADING_THRESHOLD=.17,a.DEFAULT_WEAK_HEADING_THRESHOLD=.78;let W=.17;a.DEFAULT_BANK_THRESHOLD=W;let z=.17;a.DEFAULT_PITCH_THRESHOLD=z;let V=.025;a.DEFAULT_FACE_POSITION_INNER_THRESHOLD=V;let U=.1;a.DEFAULT_FACE_POSITION_OUTER_THRESHOLD=U;let K=.5;a.DEFAULT_GROUP_IOU_THRESHOLD=K;let createMultiFrameParamConfig=()=>new x.ParamConfig(x.MULTI_FRAME_PARAM_CONFIG_FLAG,!1,{label:"Parameterize per-frame. Unchecking will reset all multi-frame parameterization."}),Y=Object.freeze({innerThreshold:V,outerThreshold:U,rightInnerThreshold:V,rightOuterThreshold:U,leftInnerThreshold:V,leftOuterThreshold:U,frontInnerThreshold:V,frontOuterThreshold:U,backInnerThreshold:V,backOuterThreshold:U,topInnerThreshold:V,topOuterThreshold:U,bottomInnerThreshold:V,bottomOuterThreshold:U});a.DEFAULT_FACE_POSITION_GRADER_CONFIG=Y;let headingGrader=(o,a)=>(s,c,k,{yawThreshold:x=a,useRadians:P=!0})=>{let R=(P?x:w.default.deg2rad(x))%Math.PI;return{[`${o}${o&&"-"}heading`]:F.gradeIfNotMissing((o,a)=>{let s=Math.abs(A.computeAngleDiff(o.yaw,a.yaw)),c={headingDiff:s};return g.default.includes(["no label zone","no label"],g.default.toLower(a.label))?{correctWork:1,totalWork:1,intermediates:c}:{correctWork:+(s<R),totalWork:1,intermediates:c}},s,c)}};a.headingGrader=headingGrader;let positionGrader=(o,a,s,{threshold:c=R})=>({position:F.gradeIfNotMissing((o,a)=>{let s=k.naiveDistance(o.position,a.position);return{correctWork:+(s<c),totalWork:1,intermediates:{positionDiff:s}}},o,a)});a.positionGrader=positionGrader;let sizeGrader=(o,a,s,{threshold:c=D})=>({size:F.gradeIfNotMissing((o,a)=>{let s=k.naiveDistance(o.dimensions,a.dimensions);return{correctWork:+(s<c),totalWork:1,intermediates:{sizeDiff:s}}},o,a)});a.sizeGrader=sizeGrader;let zGrader=(o,a)=>(s,c,g,{threshold:k=a})=>({[`${o}-Z`]:F.gradeIfNotMissing((o,a)=>{let s=o?o.position.z-o.dimensions.z/2-(a.position.z-a.dimensions.z/2):0;return{correctWork:+(Math.abs(s)<k),totalWork:1,intermediates:{zDiff:s}}},s,c)}),$={precision:5},X={...$,type:"Number",min:.001,step:1e-4,supportMultiFrameParameterization:!0},Z=["innerThreshold","outerThreshold"],J=[createMultiFrameParamConfig(),...g.default.keys(Y).filter(o=>!Z.includes(o)).map(o=>{let[a,s]=g.default.startCase(o).split(" ");return new x.ParamConfig(o,Y[o],{label:`${a} (${s})`,...X})})],ee=[createMultiFrameParamConfig(),...g.default.map(P.Axis,o=>new x.ParamConfig(`${o}Threshold`,.2,{label:`${o.toUpperCase()} Threshold`,min:0,supportMultiFrameParameterization:!0,...$}))],et=[createMultiFrameParamConfig(),new x.ParamConfig("yawThreshold",g.default.round(w.default.rad2deg(.17),3),{...$,label:"Heading Threshold",min:0,supportMultiFrameParameterization:!0}),new x.ParamConfig("useRadians",!1,{label:"Use Radians",type:"boolean"})],er={iou_lidar:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"IOU",graderFn:F.gradePerFrame((o,a,s,{threshold:c=B})=>({iou:F.gradeIfNotMissing((o,a)=>{let s=A.computeIOU(o.position,o.dimensions,o.yaw,a.position,a.dimensions,a.yaw);return{correctWork:+(s>c),totalWork:1,intermediates:{iou:s}}},o,a)})),paramConfigs:[new x.ParamConfig("threshold",B,{...$,label:"IOU Threshold"})]},size:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Size",graderFn:F.gradePerFrame(sizeGrader),paramConfigs:[new x.ParamConfig("threshold",D,$)]},dimensions:{taskTypes:[c.TaskType.LidarAnnotation],title:"Dimensions",graderFn:F.gradePerFrame((o,a,s,{wThreshold:c=G,lThreshold:k=G,hThreshold:A=G,partialScore:x=!1})=>({dimensions:F.gradeIfNotMissing((o,a)=>{let s=Math.abs(o.dimensions.x-a.dimensions.x),P=Math.abs(o.dimensions.y-a.dimensions.y),w=Math.abs(o.dimensions.z-a.dimensions.z),F=[s<c,P<k,w<A].map(o=>+o),R=x?g.default.sum(F)/3:+g.default.every(F);return{correctWork:R,totalWork:1,intermediates:{wDiff:s,lDiff:P,hDiff:w,dimensionScores:F}}},o,a)})),paramConfigs:[new x.ParamConfig("wThreshold",G,{...$,label:"Width Dimension Threshold"}),new x.ParamConfig("hThreshold",G,{...$,label:"Height Dimension Threshold"}),new x.ParamConfig("lThreshold",G,{...$,label:"Length Dimension Threshold"}),new x.ParamConfig("partialScore",!1,{label:"Points for Partial Work"})]},segmentedDimensions:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Segmented Dimensions",graderFn:F.gradePerFrame((o,a,s,{wThreshold:c=G,lThreshold:g=G,hThreshold:k=G})=>({width:F.gradeIfNotMissing((o,a)=>{let s=Math.abs(o.dimensions.x-a.dimensions.x);return{correctWork:+(s<c),totalWork:1,intermediates:{diff:s}}},o,a),length:F.gradeIfNotMissing((o,a)=>{let s=Math.abs(o.dimensions.y-a.dimensions.y);return{correctWork:+(s<g),totalWork:1,intermediates:{diff:s}}},o,a),height:F.gradeIfNotMissing((o,a)=>{let s=Math.abs(o.dimensions.z-a.dimensions.z);return{correctWork:+(s<k),totalWork:1,intermediates:{diff:s}}},o,a)})),paramConfigs:[new x.ParamConfig("wThreshold",G,{...$,label:"Width Dimension Threshold"}),new x.ParamConfig("hThreshold",G,{...$,label:"Height Dimension Threshold"}),new x.ParamConfig("lThreshold",G,{...$,label:"Length Dimension Threshold"})]},position:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane,c.TaskType.LidarPointAnnotation],title:"Position",graderFn:F.gradePerFrame(positionGrader),paramConfigs:[new x.ParamConfig("threshold",R,$)]},heading:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Heading",graderFn:F.gradePerFrame(headingGrader("normal",.17)),supportMultiFrameParameterization:!0,paramConfigs:et},yaw:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Yaw",graderFn:F.gradePerFrame(headingGrader("",.17)),supportMultiFrameParameterization:!0,paramConfigs:et},weakHeading:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Weak Heading (45 deg)",graderFn:F.gradePerFrame(headingGrader("weak",.78))},bank:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Bank",graderFn:F.gradePerFrame((o,a,s,{threshold:c=W})=>({bank:F.gradeIfNotMissing((o,a)=>{let s=Math.abs(A.computeAngleDiff(o.roll,a.roll));return{correctWork:+(s<c),totalWork:1,intermediates:{bankDiff:s}}},o,a)}))},pitch:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Pitch",graderFn:F.gradePerFrame((o,a,s,{threshold:c=z})=>({pitch:F.gradeIfNotMissing((o,a)=>{let s=Math.abs(A.computeAngleDiff(o.pitch,a.pitch));return{correctWork:+(s<c),totalWork:1,intermediates:{pitchDiff:s}}},o,a)}))},stationary:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Stationary",graderFn:F.gradeSingle((o,a)=>({correctWork:+(g.default.get(o,"props.stationary")===g.default.get(a,"props.stationary")),totalWork:1}),"stationary")},zCoordinate:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Z-Coordinate",graderFn:F.gradePerFrame(zGrader("weak",.2))},strictZCoordinate:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Strict Z-Coordinate",graderFn:F.gradePerFrame(zGrader("strict",.02))},facePosition:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Face Position (Outwards)",graderFn:F.gradePerFrame((o,a,s,{innerThreshold:c=V,outerThreshold:A=U,rightInnerThreshold:x=c,rightOuterThreshold:P=A,leftInnerThreshold:w=c,leftOuterThreshold:R=A,frontInnerThreshold:D=c,frontOuterThreshold:G=A,backInnerThreshold:B=c,backOuterThreshold:W=A,topInnerThreshold:z=c,topOuterThreshold:K=A,bottomInnerThreshold:Y=c,bottomOuterThreshold:$=A})=>{let inRange=(o,a,s,c,g,k)=>{let A=o.clone().sub(a),x=A.dot(s)>=0?1:-1,P=A.projectOnVector(s).length()*c*x;return P<k&&P>-g},X=[1,-1,1,-1,1,-1],Z=[[x,P],[w,R],[D,G],[B,W],[z,K],[Y,$]];return{facePosition:F.gradeIfNotMissing((o,a)=>{let s=k.getFaceCenters(a),c=k.getFaceCenters(o),{xVector3:A,yVector3:x,zVector3:P}=k.getEdgeVectors(o),w=c.map((o,a)=>o.distanceTo(s[a])),F=g.default.zipWith(c,s,[A,A,x,x,P,P],X,Z,(o,a,s,c,g)=>+inRange(o,a,s,c,g[0],g[1]));return{correctWork:g.default.sum(F)/6,totalWork:1,intermediates:{centers1:c,centers2:s,faceScores:F,faceDistances:w}}},o,a)}}),supportMultiFrameParameterization:!0,paramConfigs:J},perAxisPosition:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Per Axis Position",graderFn:F.gradePerFrame((o,a,s,c)=>({position:F.gradeIfNotMissing((o,a)=>{let s={},k=0;return g.default.forEach(P.Axis,g=>{let A=`${g}Threshold`,x=c[A],P=o.position[g]-a.position[g],w=+(Math.abs(P)<x);s[`${g}PositionDiff`]=P,s[`${g}PositionWork`]=w,k+=w}),{correctWork:k,totalWork:3,intermediates:s}},o,a)})),supportMultiFrameParameterization:!0,paramConfigs:ee},groupIou:{taskTypes:[c.TaskType.LidarAnnotation,c.TaskType.LidarCuboidPlane],title:"Cuboid Group IOU",graderFn:F.globalGradePerFrame((o,a,{labels:s=[],threshold:c=K})=>{let groupIouFn=(o,a)=>{let s=A.computeGroupIOU(o,a);return{correctWork:+(s>=c),totalWork:1,intermediates:{iou:s}}},k=g.default.reduce(s,(s,c)=>{let k=g.default.filter(o,{label:c}),A=g.default.filter(a,{label:c}),x=F.gradeIfNotMissing(groupIouFn,k,A);return s[`groupIou-${c}`]={...x,label:c},s},{});return k}),global:!0}};a.typedLidarGraders=er,a.PARAMS_WITH_FRONTEND_VIS=["facePosition","perAxisPosition","yaw","dimensions"],a.default=er},856753:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.DEFAULT_LIDAR_POINT_ANNOTATION_DISTANCE_THRESHOLD=void 0;var c=s(167469),g=s(991984),k=s(74909),A=s(894574);let x=.5;a.DEFAULT_LIDAR_POINT_ANNOTATION_DISTANCE_THRESHOLD=x;let P={lidarPointAnnotationDistance:{taskTypes:[c.TaskType.LidarPointAnnotation],title:"Lidar Point Annotation Distance",graderFn:g.gradePerFrame((o,a,s,{threshold:c=x})=>({lidarPointAnnotationDistance:g.gradeIfNotMissing((o,a)=>{let{position:s,label:g}=o,{position:x,label:P}=a;if(!P||!x||!g||!s)return{correctWork:0,totalWork:0};let w=k.naiveDistance(s,x),F=A.CONSENSUS_ERROR_THRESHOLDS[P]||c;return{correctWork:+(w<=F),totalWork:1,intermediates:{distance:w,threshold:F}}},o,a)}))}};a.default=P},197845:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.DEFAULT_LIDAR_POLYGON_THRESHOLD=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(991984);let x=.05;a.DEFAULT_LIDAR_POLYGON_THRESHOLD=x;let P={lidarPolygonZLevel:{taskTypes:[k.TaskType.LidarPolygon],title:"Grader for Lidar Polygon Z Level",graderFn:A.gradePerFrame((o,a,s,{threshold:c=x})=>({lidarPolygonZLevel:A.gradeIfNotMissing((o,a)=>{let s=g.default.meanBy(o.vertices,o=>o.z),k=g.default.meanBy(a.vertices,o=>o.z),A=Math.abs(s-k);return{correctWork:+(A<=c),totalWork:1,intermediates:{distance:A,threshold:c}}},o,a)}))}};a.default=P},147368:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.DEFAULT_CLUSTER_OVERLAP_THRESHOLD=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(825555),x=s(297393),P=s(991984);let w=.8;a.DEFAULT_CLUSTER_OVERLAP_THRESHOLD=w;let F=[{cutoff:.9,work:1},{cutoff:.8,work:.75},{cutoff:.7,work:.5}],R={clusterOverlap:{taskTypes:[k.TaskType.LidarSegmentation],title:"Cluster Overlap",graderFn:P.gradePerFrameWithContext((o,a,s,c,{threshold:k=w},A)=>({clusterOverlap:P.gradeIfNotMissing((a,s)=>{let c=x.getPointIntersections(A),[P,w]=g.default.sortBy([a,s],o=>o.props.response),F=`${o}_${P.props.response}_${w.props.response}_${P.props.cluster}_${w.props.cluster}`,R=c?.get(F)||0,D=a.frames[o].numPoints-R,G=R/s.frames[o].numPoints;return{correctWork:+(G>=k),totalWork:1,intermediates:{incorrectPoints:D,correctPoints:R,overlap:G}}},a,s)}))},lssIoU:{taskTypes:[k.TaskType.LidarSegmentation],title:"Lidar Semantic Segmentation IoU",graderFn:P.gradePerFrameWithContext((o,a,s,c,{correctWorkThresholds:k=F},w)=>({lssIoU:P.gradeIfNotMissing((a,s)=>{let c=x.getPointIntersections(w),[P,F]=g.default.sortBy([a,s],o=>o.props.response),R=`${o}_${P.props.response}_${F.props.response}_${P.props.cluster}_${F.props.cluster}`,D=c?.get(R)||0,G=a.frames[o]?a.frames[o].numPoints-D:0,B=(a.frames?.[o]?.numPoints||0)+(s.frames?.[o]?.numPoints||0),W=D/(B-D),z=A.getHighestWorkThreshold(k,W);return{correctWork:z?.work??0,totalWork:g.default.maxBy(k,o=>o.cutoff)?.work??1,intermediates:{incorrectPoints:G,correctPoints:D,totalPoints:B,correctWorkThresholds:k},metrics:{lssIou:W}}},a,s)}))},numPoints:{taskTypes:[k.TaskType.LidarSegmentation],title:"Point Count",graderFn:(o,a)=>{let s=g.default.reduce(a?.frames,(o,{numPoints:a})=>o+=a??0,0);return{numPoints:{correctWork:s,totalWork:s,errorType:"numPoints",numIncorrectFrames:0,numTotalFrames:g.default.size(a?.frames)}}}}};a.default=R},272455:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.weightedProjectionIOU=a.LIDAR_POINT_THRESHOLD=a.LONG_RANGE_PROJECTION_THRESHOLD=void 0;var c,g=s(825555),k=s(167469),A=s(991984),x=s(440169),P=s(74909),w=s(729493),F=(c=s(298784))&&c.__esModule?c:{default:c};let R=.7;a.LONG_RANGE_PROJECTION_THRESHOLD=R,a.LIDAR_POINT_THRESHOLD=5;let projectionIntersectionAndUnion=(o,a)=>{let s=x.polygonFor(o).convexHull(),c=x.polygonFor(a).convexHull(),g=s.union(c).getArea(),k=s.intersection(c).getArea();return{projUnion:g,projIntersection:k}},weightedProjectionIOU=(o,a)=>{let s=0,c=0;for(let g=0;g<o.length;g++){let k=o[g],A=a[g];if(!k||!A)continue;let{projUnion:x,projIntersection:P}=projectionIntersectionAndUnion(k,A);s+=x,c+=P}return c&&s?c/s:0};a.weightedProjectionIOU=weightedProjectionIOU;let D={type:"Number",min:.001,step:1e-4},G={facePositionAndProjectionIou:{taskTypes:[k.TaskType.LidarAnnotation],title:"Long Range Lidar Projections",graderFn:A.gradePerFrame((o,a,s,{projectionIouThreshold:c=R,innerThreshold:g=w.DEFAULT_FACE_POSITION_INNER_THRESHOLD,outerThreshold:k=w.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,rightInnerThreshold:x=g,rightOuterThreshold:D=k,leftInnerThreshold:G=g,leftOuterThreshold:B=k,frontInnerThreshold:W=g,frontOuterThreshold:z=k,backInnerThreshold:V=g,backOuterThreshold:U=k,topInnerThreshold:K=g,topOuterThreshold:Y=k,bottomInnerThreshold:$=g,bottomOuterThreshold:X=k})=>{let shouldGradeProjection=(o,a)=>{if(!o||!a)return!1;let s=!F.default.every(o.projections,o=>F.default.isNull(o)),c=!F.default.every(a.projections,o=>F.default.isNull(o)),g=o.numberOfPoints<=5,k=a.numberOfPoints<=5;return s&&c&&g&&k},inRange=(o,a,s,c)=>o<a+c&&o>a-s,Z=["x","x","y","y","z","z"],J=[1,-1,1,-1,1,-1],ee=[[x,D],[G,B],[W,z],[V,U],[K,Y],[$,X]];return{projectionIou:((s,g)=>{if(F.default.isEmpty(o)||F.default.isEmpty(a)||!shouldGradeProjection(s,g))return{correctWork:0,totalWork:0};let k=weightedProjectionIOU(s.projections,g.projections);return{correctWork:+(k>=c),totalWork:1,intermediates:{iou:k,longRange:!0}}})(o,a),facePosition:A.gradeIfNotMissing((o,a)=>{if(shouldGradeProjection(o,a))return{correctWork:0,totalWork:0};let s=P.getFaceCenters(a),c=P.getFaceCenters(o),g=F.default.zipWith(c,s,Z,J,ee,(o,a,s,c,g)=>+inRange(o[s]*c,a[s]*c,g[0],g[1]));return{correctWork:F.default.sum(g)/6,totalWork:1,intermediates:{centers1:c,centers2:s,faceScores:g,longRange:!1}}},o,a)}}),paramConfigs:[new g.ParamConfig("rightInnerThreshold",w.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Right (Inner)",...D}),new g.ParamConfig("rightOuterThreshold",w.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Right (Outer)",...D}),new g.ParamConfig("leftInnerThreshold",w.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Left (Inner)",...D}),new g.ParamConfig("leftOuterThreshold",w.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Left (Outer)",...D}),new g.ParamConfig("frontInnerThreshold",w.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Front (Inner)",...D}),new g.ParamConfig("frontOuterThreshold",w.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Front (Outer)",...D}),new g.ParamConfig("backInnerThreshold",w.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Back (Inner)",...D}),new g.ParamConfig("backOuterThreshold",w.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Back (Outer)",...D}),new g.ParamConfig("topInnerThreshold",w.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Top (Inner)",...D}),new g.ParamConfig("topOuterThreshold",w.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Top (Outer)",...D}),new g.ParamConfig("bottomInnerThreshold",w.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Bottom (Inner)",...D}),new g.ParamConfig("bottomOuterThreshold",w.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Bottom (Outer)",...D})]}};a.default=G},63226:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.DEFAULT_MAX_STRAY_POINTS=a.DEFAULT_STRAY_POINTS_THRESHOLD=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(297393),x=s(991984);let P=.05;a.DEFAULT_STRAY_POINTS_THRESHOLD=P;let w=10;a.DEFAULT_MAX_STRAY_POINTS=w;let F={strayPoints:{taskTypes:[k.TaskType.LidarSegmentation],title:"Stray Points",graderFn:x.gradePerFrameWithContext((o,a,s,c,{maxStray:k=w,threshold:F=P},R)=>({annotationOverlap:x.gradeIfNotMissing((s,c)=>{if(!R)throw Error("Missing context for stray points grader");let x=A.getPointIntersections(R),[P,w]=g.default.sortBy([s,c],o=>o.props.response),D=`${o}_${P.props.response}_${w.props.response}_${P.props.cluster}_${w.props.cluster}`,G=x.get(D)||0,B=a.frames[o]?a.frames[o].numPoints-G:0,W=Math.min(k,F*(a.frames[o]?a.frames[o].numPoints:0));return{correctWork:+(B<W),totalWork:1,intermediates:{incorrectPoints:B,maxIncorrect:W}}},a,s)}))}};a.default=F},233193:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.LINE_GRADER_MARGIN_THRESHOLD=a.LINE_DISTANCE_MARGIN_THRESHOLD=a.LINE_EP_DISTANCE_THRESHOLD=void 0;var c=s(167469),g=s(440169),k=s(991984),A=s(362508);let x=15;a.LINE_EP_DISTANCE_THRESHOLD=x,a.LINE_DISTANCE_MARGIN_THRESHOLD=50;let P=5;a.LINE_GRADER_MARGIN_THRESHOLD=P;let w={endpointDistance:{taskTypes:[c.TaskType.LineAnnotation],title:"Line Endpoint Distance",graderFn:k.gradePerFrame((o,a,s,{threshold:c=x})=>({endpointDistance:k.gradeIfNotMissing((o,a)=>{let s=g.calculateEndpointDistance(o.vertices,a.vertices);return{correctWork:+(s<=c),totalWork:1,intermediates:{distance:s}}},o,a)})),paramConfigs:[{name:"threshold",label:"Endpoint Distance Threshold",type:"number",defaultValue:x}]},margin:{taskTypes:[c.TaskType.LineAnnotation],title:"Line Margin",graderFn:k.gradePerFrame((o,a,s,{threshold:c=P,partialCredit:A=!1})=>({margin:k.gradeIfNotMissing((o,a)=>{if(A){let{numUserPoints:s,numUserPointsInMargin:k,numCorrectPoints:A}=g.getAmountOfLineInMargin(o.vertices,a.vertices,c);return{correctWork:Math.max(A-(s-k),0)/A,totalWork:1,intermediates:{inMargin:+(k===s)}}}let s=+g.lineInMargin(o.vertices,a.vertices,c);return{correctWork:s,totalWork:1,intermediates:{inMargin:s}}},o,a)})),paramConfigs:[{name:"threshold",label:"Margin Threshold",type:"number",defaultValue:P},{name:"partialCredit",label:"Partial Credit",type:"boolean",defaultValue:!1}]},zCoordMargin:{taskTypes:[c.TaskType.LineAnnotation],title:"GIS Line Margin Z Coordinate Grader",graderFn:k.gradePerFrame(A.zCoordMarginLineLength),paramConfigs:[{name:"zthreshold",label:"Margin Threshold for z coordinate",type:"number",defaultValue:A.Z_LINE_GRADER_MARGIN_THRESHOLD},{name:"xythreshold",label:"Margin Threshold for matching line",type:"number",defaultValue:A.XY_LINE_GRADER_MARGIN_THRESHOLD}]},frechetLineDistance:{taskTypes:[c.TaskType.LineAnnotation],title:"Frechet Line Distance",graderFn:k.gradePerFrame((o,a,s,{threshold:c=P})=>({frechetDistance:k.gradeIfNotMissing((o,a)=>{let s=g.discreteFrechetDistance(o.vertices,a.vertices);return{correctWork:+(s<c),totalWork:1,intermediates:{frechetLineDistance:s}}},o,a)})),paramConfigs:[{name:"threshold",label:"Frechet Line Distance Threshold",type:"number",defaultValue:P}]}};a.default=w},313220:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.linkingUuidGrader=void 0;var c=s(991984);a.linkingUuidGrader=(o,a)=>({linkingUuid:c.ignoreIfMissing((o,a)=>{if(!o.is_base_annotation&&!a.is_base_annotation)return{correctWork:0,totalWork:0};if(!o.is_base_annotation||!a.is_base_annotation)return{correctWork:0,totalWork:1};let s=!!o?.uuid&&o.uuid===a?.uuid;return{correctWork:+s,totalWork:1}},o,a)})},804850:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.globalGraderLiteParams=a.defaultMammothMappingParams=void 0;let s={splitTolerance:.1,segmentLinkTolerance:.001,crossSubdivisionThreshold:5,segmentLinkCandidateFcdThreshold:5,maximumSplitSegmentLength:10.3};a.defaultMammothMappingParams=s;let c={...s,maximumSplitSegmentLength:100};a.globalGraderLiteParams=c},662171:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.makeGlobalMammothMappingGraderFn=makeGlobalMammothMappingGraderFn,a.makeGlobalMammothMappingMatcherFn=makeGlobalMammothMappingMatcherFn,a.legacyGlobalGrader=a.globalGraderLite=a.globalGrader=void 0;var c,g=s(167469),k=(c=s(298784))&&c.__esModule?c:{default:c},A=s(105879),x=s(604744),P=s(401976),w=s(896888),F=s(991984),R=s(804850);let getErrorTypeWithSeverity=(o,a)=>`mammothMapping${a}${o}`;function makeGlobalMammothMappingGraderFn(o){return F.globalGradePerFrame((a,s)=>{let c=k.default.flatMap(P.ALL_LABELS,c=>{let g=a.filter(o=>o.label===c),k=s.filter(o=>o.label===c),{subdividedSegmentsA:P,subdividedSegmentsB:w}=A.computeCrossDivision(g,k,o),F=A.getSegmentMatches(P,w,o),R=F.map(o=>x.scoreSegmentMatch(o,c));return R}),g=k.default.flatMap(P.ALL_LABELS,o=>P.ALL_ERROR_TYPES.map(a=>{let s=c.filter(a=>a.label===o),g=w.ERROR_TYPE_LABEL_SEVERITY_MAP[a][o];return x.transformScoresToGlobalScore(s,a,getErrorTypeWithSeverity(a,g),{label:o,graderType:"mammothMapppingGlobal",key:`${o}::${a}`})})),F=k.default.flatMap(P.ALL_SEVERITIES,o=>P.ALL_ERROR_TYPES.map(a=>{let s=c.filter(s=>w.ERROR_TYPE_LABEL_SEVERITY_MAP[a][s.label]===o);return x.transformScoresToGlobalScore(s,a,getErrorTypeWithSeverity(a,o),{graderType:"mammothMapppingGlobal",label:"mixed",key:getErrorTypeWithSeverity(a,o)})})),R=[...g,...F],D=k.default.fromPairs(R.map(o=>[o.key,o]));return D})}let transformScoredMatch=o=>{let a={type:"polyline-fragments",currentId:o.currentId,correctId:o.correctId,props:{label:o.label},rawScoredSegmentMatches:o.scoredSegmentMatches},s=o.currentAnn&&o.correctAnn?"Precision":o.currentAnn?"FalsePositive":"FalseNegative",c=w.ERROR_TYPE_LABEL_SEVERITY_MAP[s][o.label],g=k.default.map(o.scoredSegmentMatches,"score"),A=x.transformScoresToGlobalScore(g,s,getErrorTypeWithSeverity(s,c),{graderType:"mammothMapppingGlobal",label:o.label,key:s});return{metadata:a,currentAnnotation:o.currentAnn,correctAnnotation:o.correctAnn,scores:[A],numFalseNegativeFrames:0,numFalsePositiveFrames:0,numIncorrectTruePositiveFrames:0,numTotalTruePositiveFrames:0}},getId=(o,a)=>o?`${a}-${o.uuid}`:`${a}-none`;function makeGlobalMammothMappingMatcherFn(o){return(a,s)=>{let c=new Map([...a,...s].map(o=>[o.frames[0],o]));c.set(void 0,void 0);let g=a.map(o=>o.frames[0]),w=s.map(o=>o.frames[0]),F=k.default.flatMap(P.ALL_LABELS,a=>{let s=g.filter(o=>o.label===a),P=w.filter(o=>o.label===a),{subdividedSegmentsA:F,subdividedSegmentsB:R,segmentToAnnotationMap:D}=A.computeCrossDivision(s,P,o),G=A.getSegmentMatches(F,R,o),B=G.map(o=>{let s=x.scoreSegmentMatch(o,a);return{score:s,segmentMatch:o}}),W=new Map([...s.map(o=>[getId(o,"a"),o]),["a-none",void 0],...P.map(o=>[getId(o,"b"),o]),["b-none",void 0]]),z=k.default.groupBy(B,({segmentMatch:o})=>{let s=o.currentSegment?D.get(o.currentSegment):void 0,c=o.correctSegment?D.get(o.correctSegment):void 0;return JSON.stringify({currentId:getId(s,"a"),correctId:getId(c,"b"),label:a})});return k.default.map(z,(o,a)=>{let{currentId:s,correctId:g,label:k}=JSON.parse(a);return{currentId:s,correctId:g,currentAnn:c.get(W.get(s)),correctAnn:c.get(W.get(g)),label:k,scoredSegmentMatches:o}})});return F.map(transformScoredMatch)}}let D={taskTypes:[g.TaskType.LineAnnotation],title:"(Mammoth GIS Global) Per-class bag-of-segments Line Grader",graderFn:makeGlobalMammothMappingGraderFn(R.defaultMammothMappingParams),matcherFn:makeGlobalMammothMappingMatcherFn(R.defaultMammothMappingParams),global:!0};a.globalGrader=D;let G={taskTypes:[g.TaskType.LineAnnotation],title:"(Mammoth GIS Global Lite) Faster Per-class bag-of-segments Line Grader",graderFn:makeGlobalMammothMappingGraderFn(R.globalGraderLiteParams),matcherFn:makeGlobalMammothMappingMatcherFn(R.globalGraderLiteParams),global:!0};a.globalGraderLite=G;let B={taskTypes:[g.TaskType.LineAnnotation],title:"(Legacy) Per-class bag-of-segments Line Grader",graderFn:makeGlobalMammothMappingGraderFn(R.defaultMammothMappingParams),matcherFn:makeGlobalMammothMappingMatcherFn(R.defaultMammothMappingParams),global:!0};a.legacyGlobalGrader=B},68380:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"mammothMappingGlobal",{enumerable:!0,get:function(){return c.globalGrader}}),Object.defineProperty(a,"nuroLine",{enumerable:!0,get:function(){return c.legacyGlobalGrader}}),Object.defineProperty(a,"mammothMappingLite",{enumerable:!0,get:function(){return c.globalGraderLite}}),Object.defineProperty(a,"mammothMapping",{enumerable:!0,get:function(){return g.legacyLocalGrader}});var c=s(662171),g=s(676116)},676116:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.legacyLocalGrader=a.localMammothMappingGraderFn=void 0;var c,g=s(662171),k=s(167469),A=(c=s(298784))&&c.__esModule?c:{default:c};let localMammothMappingGraderFn=async(o,a)=>{let s=await g.globalGrader.graderFn(A.default.compact([o]),A.default.compact([a]));return s};a.localMammothMappingGraderFn=localMammothMappingGraderFn;let x={taskTypes:[k.TaskType.LineAnnotation],title:"(Mammoth GIS) Matched pairs segments Line Grader",graderFn:localMammothMappingGraderFn,global:!1};a.legacyLocalGrader=x},896888:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.PRECISION_FCD_THRESHOLDS=a.ERROR_TYPE_LABEL_SEVERITY_MAP=a.INFINITY=void 0,a.INFINITY=1e15,a.ERROR_TYPE_LABEL_SEVERITY_MAP={FalsePositive:{"road boundary":"Critical","road boundary (polygon)":"Critical","reversible lane center":"Critical","shared turn lane center":"Critical","vehicle lane center":"Critical","vehicle lane connection":"Critical","traffic line":"Moderate",driveway:"Moderate","dashed odot":"Severe","dashed sdot":"Severe","solid odot":"Severe","solid sdot":"Severe","bicycle lane":"Moderate"},FalseNegative:{"road boundary":"Critical","road boundary (polygon)":"Critical","reversible lane center":"Critical","shared turn lane center":"Critical","vehicle lane center":"Critical","vehicle lane connection":"Critical","traffic line":"Critical",driveway:"Critical","dashed odot":"Severe","dashed sdot":"Severe","solid odot":"Severe","solid sdot":"Severe","bicycle lane":"Moderate"},Precision:{"road boundary":"Critical","road boundary (polygon)":"Critical","reversible lane center":"Critical","shared turn lane center":"Critical","vehicle lane center":"Critical","vehicle lane connection":"Critical","traffic line":"Severe",driveway:"Severe","dashed odot":"Severe","dashed sdot":"Severe","solid odot":"Severe","solid sdot":"Severe","bicycle lane":"Moderate"}},a.PRECISION_FCD_THRESHOLDS={"road boundary":1,"road boundary (polygon)":1,"reversible lane center":2,"shared turn lane center":2,"vehicle lane center":2,"vehicle lane connection":2,"traffic line":2,driveway:1,"dashed odot":1,"dashed sdot":1,"solid odot":1,"solid sdot":1,"bicycle lane":3}},105879:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.computeCrossDivision=a.getSegmentMatches=void 0,s(825555);var c=_interopRequireDefault(s(298784)),g=_interopRequireDefault(s(289624)),k=_interopRequireDefault(s(540742)),A=s(896888),x=s(490503);function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}let interpolate=([{x:o,y:a},{x:s,y:c}],g)=>({x:(1-g)*o+g*s,y:(1-g)*a+g*c});function getUpsampledSegments(o,a){let s=[];for(let c=0;c<o.length-1;c++){let g=[o[c],o[c+1]],k=x.computeSegmentLength(g),A=Math.ceil(k/a),P=g[0];for(let o=0;o<A;o++){let a=interpolate(g,(o+1)/A);s.push([P,a]),P=a}}return s}let getFcdMatrix=(o,a)=>o.map(o=>a.map(a=>x.computeFCD(o,a))),getCostMatrix=(o,a,s,g)=>{let k=o.map((o,k)=>a.map((a,A)=>{let P=x.computeSegmentLength(o),w=x.computeSegmentLength(a),F={x:o[1].x-o[0].x,y:o[1].y-o[0].y},R={x:a[1].x-a[0].x,y:a[1].y-a[0].y},D=Math.abs((F.x*R.x+F.y*R.y)/(P*w));return s[k][A]>g.segmentLinkCandidateFcdThreshold+g.segmentLinkTolerance?0:c.default.min([P,w])*D*Math.exp(-s[k][A]/g.segmentLinkCandidateFcdThreshold)})),P=k.map(o=>o.map(o=>c.default.isFinite(o)?A.INFINITY-o:0));return P},getConnectedComponents=(o,a)=>{let s=new k.default(o);for(let[o,c]of a)s.union(o,c);return s.compile()},hungarian=o=>o.length?g.default(o):[],getSpatialHashComponents=(o,a,s)=>{function getSpannedTiles(o){let a=c.default.min(o.map(o=>o.x)),s=c.default.min(o.map(o=>o.y)),g=c.default.max(o.map(o=>o.x)),k=c.default.max(o.map(o=>o.y));return c.default.flatMap(c.default.range(Math.floor(a/32),Math.floor(g/32)+1),o=>c.default.range(Math.floor(s/32),Math.floor(k/32)+1).map(a=>640*o+a))}function getNeighboringTiles(o){return c.default.range(3).flatMap(a=>c.default.range(3).map(s=>o+(a-1)*640+(s-1)))}let g=o.map(getSpannedTiles),k=a.map(getSpannedTiles),A=new Map;g.forEach((o,a)=>{o.forEach(o=>{A.has(o)||A.set(o,new Set),A.get(o).add(a)})});let P=c.default.size(o),w=c.default.size(a),F=[];k.forEach((g,k)=>{let w=new Set;for(let R of(c.default.flatMap(g,getNeighboringTiles).forEach(o=>{if(A.has(o))for(let a of A.get(o))w.add(a)}),w))x.computeFCD(o[R],a[k])<=s.segmentLinkCandidateFcdThreshold+s.segmentLinkTolerance&&F.push([R,P+k])});let R=getConnectedComponents(P+w,F);return R.map(o=>{let a=o.filter(o=>o<P),s=o.filter(o=>o>=P).map(o=>o-P);return{indicesA:a,indicesB:s}})};a.getSegmentMatches=(o,a,s)=>{if(c.default.isEmpty(o)&&c.default.isEmpty(a))return[];let g=getSpatialHashComponents(o,a,s),k=[];g.forEach(c=>{let g=c.indicesA.map(a=>o[a]),x=c.indicesB.map(o=>a[o]),P=getFcdMatrix(g,x),w=getCostMatrix(g,x,P,s),F=w.length>0&&w[0].length>0?hungarian(w).filter(([o,a])=>w[o][a]<A.INFINITY):[];k.push(...F.map(([o,a])=>[c.indicesA[o],c.indicesB[a]]))});let P=c.default.times(o.length,()=>!1),w=c.default.times(a.length,()=>!1);for(let[o,a]of k)P[o]=w[a]=!0;let F=[...k.map(([s,c])=>({currentSegment:o[s],correctSegment:a[c],fcd:x.computeFCD(o[s],a[c])})),...o.filter((o,a)=>!P[a]).map(o=>({currentSegment:o})),...a.filter((o,a)=>!w[a]).map(o=>({correctSegment:o}))];return F},a.computeCrossDivision=(o,a,s)=>{let g=c.default.flatMap(o,o=>o.vertices),k=c.default.flatMap(a,o=>o.vertices),A=[...g,...k],P=o.map(o=>getUpsampledSegments(x.projectVerticesOntoPolyline(o.vertices,A,s.crossSubdivisionThreshold,s.splitTolerance),s.maximumSplitSegmentLength)),w=a.map(o=>getUpsampledSegments(x.projectVerticesOntoPolyline(o.vertices,A,s.crossSubdivisionThreshold,s.splitTolerance),s.maximumSplitSegmentLength)),F=new Map([...c.default.flatMap(P,(a,s)=>a.map(a=>[a,o[s]])),...c.default.flatMap(w,(o,s)=>o.map(o=>[o,a[s]]))]);return{segmentToAnnotationMap:F,subdividedSegmentsA:c.default.flatten(P),subdividedSegmentsB:c.default.flatten(w)}}},604744:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.transformScoresToGlobalScore=a.scoreSegmentMatch=void 0;var c,g=s(401976),k=s(896888),A=s(490503),x=(c=s(298784))&&c.__esModule?c:{default:c};a.scoreSegmentMatch=(o,a)=>{if(!g.isLabel(a))throw Error("unknown label: "+a);let{currentSegment:s,correctSegment:c,fcd:x}=o;return{label:a,currentLength:s?A.computeSegmentLength(s):0,correctLength:c?A.computeSegmentLength(c):0,isMatch:!!s&&!!c,isCorrect:!!s&&!!c&&x<=k.PRECISION_FCD_THRESHOLDS[a]}},a.transformScoresToGlobalScore=(o,a,s,c)=>{let g,k;let A=x.default.sumBy(o,"currentLength"),P=x.default.sumBy(o,"correctLength"),w=x.default.sumBy(x.default.filter(o,"isMatch"),"currentLength"),F=x.default.sumBy(x.default.filter(o,"isMatch"),"correctLength"),R=x.default.sumBy(x.default.filter(o,"isCorrect"),"currentLength");if("FalseNegative"===a)g=F,k=P;else if("FalsePositive"===a)g=w,k=A;else if("Precision"===a)g=R,k=w;else throw Error(`Unknown error type ${a}`);return{...c,errorType:a,errorTypeWithSeverity:s,numIncorrectFrames:0,numTotalFrames:0,correctWork:g,totalWork:k}}},401976:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.isScoredPolylineSegmentsMatchedAnnotations=function(o){return o?.metadata?.type==="polyline-fragments"},a.ALL_ERROR_TYPES=a.ALL_SEVERITIES=a.isLabel=a.ALL_LABELS=void 0;let s=["road boundary","road boundary (polygon)","reversible lane center","shared turn lane center","vehicle lane center","vehicle lane connection","traffic line","driveway","dashed odot","dashed sdot","solid odot","solid sdot","bicycle lane"];a.ALL_LABELS=s,a.isLabel=o=>s.includes(o),a.ALL_SEVERITIES=["Critical","Severe","Moderate"],a.ALL_ERROR_TYPES=["FalseNegative","FalsePositive","Precision"]},190913:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"mammothMappingPolygonGrader",{enumerable:!0,get:function(){return c.mammothMappingPolygonGrader}});var c=s(912140)},290637:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.POLYGON_IOU_THRESHOLD=a.POLYGON_ERROR_TYPE_LABEL_SEVERITY_MAP=void 0,a.POLYGON_ERROR_TYPE_LABEL_SEVERITY_MAP={FalsePositive:{intersection:"Severe","keep clear zone":"Moderate","parking area":"Severe","pedestrian crosswalk":"Moderate","road boundary (polygon)":"Critical","speed regulator":"Severe"},FalseNegative:{intersection:"Critical","keep clear zone":"Severe","parking area":"Severe","pedestrian crosswalk":"Critical","road boundary (polygon)":"Critical","speed regulator":"Critical"},Precision:{intersection:"Severe","keep clear zone":"Critical","parking area":"Severe","pedestrian crosswalk":"Critical","road boundary (polygon)":"Critical","speed regulator":"Severe"}},a.POLYGON_IOU_THRESHOLD=.9},912140:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.mammothMappingPolygonGrader=a.localMammothMappingPolygonGraderFn=void 0;var c,g=s(167469),k=s(440169),A=(c=s(298784))&&c.__esModule?c:{default:c},x=s(290637),P=s(991984),w=s(105879),F=s(604744),R=s(804850);let getErrorTypeWithSeverity=(o,a)=>{let s=x.POLYGON_ERROR_TYPE_LABEL_SEVERITY_MAP[o][a];return`mammothMappingPolygon${s}${o}`},transformPolygonToLine=o=>({...o,vertices:[...o.vertices,o.vertices[0]]}),gradeRoadBoundaryPolygon=(o,a)=>{let s=transformPolygonToLine(o),c=transformPolygonToLine(a),g=R.defaultMammothMappingParams,{subdividedSegmentsA:k,subdividedSegmentsB:x}=w.computeCrossDivision([s],[c],g),P="road boundary (polygon)",D=w.getSegmentMatches(k,x,g),G=D.map(o=>F.scoreSegmentMatch(o,P)),B=A.default.sum(G.map(o=>o.correctLength)),W=A.default.sum(G.filter(o=>o.isCorrect).map(o=>o.currentLength));return{[getErrorTypeWithSeverity("Precision",P)]:{correctWork:W,totalWork:B},[getErrorTypeWithSeverity("FalseNegative",P)]:{correctWork:B,totalWork:B}}},localMammothMappingPolygonGraderFn=(o,a)=>A.default.mapValues((()=>{if(o&&a){let s=o.label;if("road boundary (polygon)"===s)return gradeRoadBoundaryPolygon(o,a);let c=k.genericIou(o,a),g=k.getPolygonPerimeter(a);return{[getErrorTypeWithSeverity("Precision",s)]:{correctWork:c<x.POLYGON_IOU_THRESHOLD?0:g,totalWork:g},[getErrorTypeWithSeverity("FalseNegative",s)]:{correctWork:g,totalWork:g}}}if(a){let o=a.label,s=k.getPolygonPerimeter(a);return{[getErrorTypeWithSeverity("FalseNegative",o)]:{correctWork:0,totalWork:s}}}{let a=o.label,s=k.getPolygonPerimeter(o);return{[getErrorTypeWithSeverity("FalsePositive",a)]:{correctWork:-s,totalWork:0}}}})(),(o,a)=>({...o,errorType:a,numIncorrectFrames:o.correctWork<o.totalWork?1:0,numTotalFrames:1}));a.localMammothMappingPolygonGraderFn=localMammothMappingPolygonGraderFn;let D={taskTypes:[g.TaskType.PolygonAnnotation],title:"Mammoth GIS Polygon Grader",graderFn:P.gradePerFrame(localMammothMappingPolygonGraderFn,!1,!1,!0),global:!1};a.mammothMappingPolygonGrader=D},247915:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.comparisonGraderFn=a.melonAudioDeviceGraderFn=a.adjustCoefficient=a.melonAudioRankFnGenerator=a.DEFAULT_ACCEPTABLE_DEVICES=void 0;var c,g,k,A=(c=s(298784))&&c.__esModule?c:{default:c},x=s(167469),P=s(991984),w=s(222357);let F=s(555956),R=["headphone","headset","airpod","usb audio device"].map(o=>o.toLowerCase());a.DEFAULT_ACCEPTABLE_DEVICES=R,(g=k||(k={})).Pearson="pearson",g.Spearman="spearman",g.Kendall="kendall";let melonAudioRankFnGenerator=(o,a,s)=>(c,g,k)=>{let x=[];c.forEach(o=>{let a=o.field_id,s=o.response[0],c=s.result;if(!k?.questionPrefix||o.field_id.startsWith(k.questionPrefix)){if(c===w.GraderResult.Correct){let o=s.given[0],c=getNumericValue(o);x.push({model:a,expected:c,given:c})}else c===w.GraderResult.Incorrect&&x.push({model:a,expected:getNumericValue(s.expected[0]),given:getNumericValue(s.given[0])})}});let P=new F(x,{expected:"metric",given:"metric"}),R=P[a]("expected","given"),D=A.default.get(R,s),G=k?.correlationThreshold,B=isNaN(D)||void 0!==G&&D<G?0:adjustCoefficient(D),W=c.length,z=k?.questionPrefix?`${o}_${k.questionPrefix}`:o;return{[z]:{label:`${o} correlation`,correctWork:B,totalWork:1,intermediates:{modelScores:x,modelCount:W,metadata:R}}}};a.melonAudioRankFnGenerator=melonAudioRankFnGenerator;let getNumericValue=o=>"string"==typeof o?parseFloat(o):"number"==typeof o?o:NaN,adjustCoefficient=o=>(o+1)/2;a.adjustCoefficient=adjustCoefficient;let melonAudioDeviceGraderFn=(o,a,s,c,g)=>{let k;let x=g?.responseMetadata?.audioDevices||[],P=s?.acceptableDevices||[],w=0===P.length?R:P,F=x.map(o=>o.label),D=s?.failWhenMissingDevice??!0;if(0===F.length)k=+!D;else{let o=A.default.intersection(F.map(o=>o.toLowerCase()),w.map(o=>o.toLowerCase()));k=+(o.length>0)}return{audioDeviceRequirement:{label:"audio device requirement",totalWork:1,correctWork:k,intermediates:{givenDevices:F,acceptableDevices:w}}}};a.melonAudioDeviceGraderFn=melonAudioDeviceGraderFn;let comparisonGraderFn=(o,a,s)=>{let c={};o.forEach(o=>{let a=o.field_id,s=o.response[0],g=s.result;if(g===w.GraderResult.Correct){let o=s.given[0],g=getNumericValue(o);c[a]=g}else if(g===w.GraderResult.Incorrect){let o=getNumericValue(s.given[0]);c[a]=o}});let{operator:g,firstAnnotation:k,secondAnnotation:x}=s,P={"===":(o,a)=>o===a,"!==":(o,a)=>o!==a,">":(o,a)=>o>a,">=":(o,a)=>o>=a,"<":(o,a)=>o<a,"<=":(o,a)=>o<=a},F=0;return A.default.has(P,g)&&P[g](c[k],c[x])&&(F=1),{comparison:{label:"comparison between categories",totalWork:1,correctWork:F,intermediates:{modelScoresRecord:c}}}};a.comparisonGraderFn=comparisonGraderFn;let D={melonAudioPearsonRank:{taskTypes:[x.TaskType.TextCollection],title:"melon audio pearson rank",graderFn:P.globalGradePerFrame(melonAudioRankFnGenerator(k.Pearson,"correlationCoefficient","correlationCoefficient")),global:!0},melonAudioSpearmanRank:{taskTypes:[x.TaskType.TextCollection],title:"melon audio spearman rank",graderFn:P.globalGradePerFrame(melonAudioRankFnGenerator(k.Spearman,"spearmansRho","rho")),global:!0},melonAudioKendallRank:{taskTypes:[x.TaskType.TextCollection],title:"melon audio kendall rank",graderFn:P.globalGradePerFrame(melonAudioRankFnGenerator(k.Kendall,"kendallsTau","b.tauB")),global:!0},melonAudioDevice:{taskTypes:[x.TaskType.TextCollection],title:"melon audio device",graderFn:P.globalGradePerFrame(melonAudioDeviceGraderFn),global:!0},comparisonGrader:{taskTypes:[x.TaskType.TextCollection],title:"comparion grader",graderFn:P.globalGradePerFrame(comparisonGraderFn),global:!0}};a.default=D},835802:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.melonImageGrader=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(963494),x=s(991984),P=s(222357);let melonImageGrader=(o,a)=>({melonImage:x.gradeIfNotMissing((o,a)=>a.type===A.TextCollectionFieldType.Category?{correctWork:g.default.sum(o.response.map(o=>{if(o.result===P.GraderResult.Correct)return 1;if(o.result===P.GraderResult.Incorrect){if(1!==o.given.length||1!==o.expected.length)return 0;let a=Number(o.given[0]),s=Number(o.expected[0]);if(s>0&&a>0||s<0&&a<0||0===s&&a>=-1&&a<=1)return 1}return 0})),totalWork:a.response.length}:{correctWork:0,totalWork:0},o,a)});a.melonImageGrader=melonImageGrader;let w=Object.freeze({melonImage:{taskTypes:[k.TaskType.TextCollection],title:"melon image",graderFn:x.gradePerFrame(melonImageGrader)}});a.default=w},410718:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.indexAssignmentDistance=a.timespanIou=a.MultiModalTranscriptionNerAnnotationComponentWeights=a.MultiModalTranscriptionNerAnnotationComponents=a.MULTI_MODAL_TRANSCRIPTION_NER_MATCHING_THRESHOLD=a.MULTI_MODAL_TRANSCRIPTION_TIMESTAMP_GRADING_THRESHOLD=a.MULTI_MODAL_TRANSCRIPTION_TIMESTAMP_MATCHING_THRESHOLD=void 0;var c,g,k,A,x=s(167469),P=s(991984),w=(c=s(298784))&&c.__esModule?c:{default:c};a.MULTI_MODAL_TRANSCRIPTION_TIMESTAMP_MATCHING_THRESHOLD=.4;let F=.8;a.MULTI_MODAL_TRANSCRIPTION_TIMESTAMP_GRADING_THRESHOLD=F,a.MULTI_MODAL_TRANSCRIPTION_NER_MATCHING_THRESHOLD=.3,a.MultiModalTranscriptionNerAnnotationComponents=A,(g=A||(a.MultiModalTranscriptionNerAnnotationComponents=A={}))[g.TokenOverlap=0]="TokenOverlap",g[g.LabelAssignment=1]="LabelAssignment",g[g.IndexAssignment=2]="IndexAssignment";let R={[A.TokenOverlap]:.6,[A.LabelAssignment]:.2,[A.IndexAssignment]:.2};a.MultiModalTranscriptionNerAnnotationComponentWeights=R;let timespanIou=(o,a)=>{let s=Math.max(o[0],a[0]),c=Math.min(o[1],a[1]),g=Math.max(0,c-s),k=Math.max(o[1],a[1])-Math.min(o[0],a[0]);return g/k};a.timespanIou=timespanIou;let speakerIndicator=(o,a)=>o===a?1:0,indexAssignmentDistance=(o,a)=>Math.exp(-Math.abs(o-a)/10);a.indexAssignmentDistance=indexAssignmentDistance;let graderPerFrameForTranscripts=o=>(a,s,...c)=>{let g=s?.props.type??a?.props.type;return"transcript"===g?P.gradePerFrame(o)(a,s,...c):{}},D=Object.freeze({multiModalTranscriptionTimestamp:{taskTypes:[x.TaskType.MultiModalTranscription],title:"MultiModalTranscription Timestamp IOU",graderFn:graderPerFrameForTranscripts((o,a,s,{threshold:c=F})=>({multiModalTranscriptionTimestamp:P.gradeIfNotMissing((o,a)=>{let s=timespanIou(o.timestamps,a.timestamps);return{correctWork:+(s>=c),totalWork:1,intermediates:{iou:s}}},o,a)})),paramConfigs:[{name:"threshold",label:"IoU Threshold",type:"number"}]},multiModalTranscriptionSpeaker:{taskTypes:[x.TaskType.MultiModalTranscription],title:"MultiModalTranscription Speaker Assignment",graderFn:graderPerFrameForTranscripts((o,a)=>({multiModalTranscriptionSpeaker:P.gradeIfNotMissing((o,a)=>({correctWork:speakerIndicator(o.speakerIndex??"0",a.speakerIndex??"0"),totalWork:1}),o,a)}))},multiModalTranscriptionText:{taskTypes:[x.TaskType.MultiModalTranscription],title:"MultiModalTranscription Text",graderFn:graderPerFrameForTranscripts((o,a)=>({multiModalTranscriptionText:P.gradeIfNotMissing((o,a)=>P.gradeFreeText(o.text,a.text,P.TextComparisonMethod.NormalizedLevenshtein),o,a)}))},multiModalTranscriptionNerText:{taskTypes:[x.TaskType.MultiModalTranscription],title:"MultiModalTranscription NER Text",graderFn:(k=(o,a,s)=>{let gradeTextIou=(o,a)=>({correctWork:R[A.TokenOverlap]*P.gradeFreeText(o.text,a.text,P.TextComparisonMethod.NormalizedLevenshtein).correctWork+R[A.LabelAssignment]*(o.label===a.label?1:0)+R[A.IndexAssignment]*indexAssignmentDistance(o.transcriptSectionStart,a.transcriptSectionStart),totalWork:1});if(w.default.isEmpty(a))return{multiModalTranscriptionNerText:{correctWork:0,totalWork:0}};if(w.default.isEmpty(o)){let o=w.default.findIndex(a.acceptedAnnotations,({annotation:o})=>!o)>=0;return{multiModalTranscriptionNerText:{correctWork:+o,totalWork:1}}}return w.default.isNil(a.text)||w.default.isNil(a.label)||w.default.isNil(a.transcriptSectionStart)||w.default.isNil(a.transcriptSectionEnd)||w.default.isNil(o.text)||w.default.isNil(o.label)||w.default.isNil(o.transcriptSectionStart)||w.default.isNil(o.transcriptSectionEnd)?{multiModalTranscriptionNerText:{correctWork:0,totalWork:0}}:P.gradeForAcceptedAnnotations(o,a,(o,a)=>{let s=gradeTextIou(o,a);return{multiModalTranscriptionNerTextGrader:s}},s&&s.acceptedAnnotationMatchIndexes)},(o,a,...s)=>{let c=a?.props.type??o?.props.type;return"annotation"===c?P.gradePerFrame(k)(o,a,...s):{}})}});a.default=D},896135:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.gradePerFrameForAnnotations=a.nerRelationshipsGrader=a.nerLabelsGrader=a.endpointGrader=a.nullGrader=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(991984);a.nullGrader=()=>{};let endpointGrader=(o,a,s)=>{let gradeStart=(o,a)=>({correctWork:+(o.start===a.start),totalWork:1}),gradeEnd=(o,a)=>({correctWork:+(o.end===a.end),totalWork:1});if(g.default.isEmpty(a)){let o={correctWork:0,totalWork:0};return{start:o,end:o}}if(g.default.isEmpty(o)){let o=g.default.findIndex(a.acceptedAnnotations,({annotation:o})=>!o)>=0,s={correctWork:+o,totalWork:1};return{start:s,end:s}}return g.default.isNil(a.start)||g.default.isNil(a.end)||g.default.isNil(o.start)||g.default.isNil(o.end)?{start:{correctWork:0,totalWork:0},end:{correctWork:0,totalWork:0}}:A.gradeForAcceptedAnnotations(o,a,(o,a)=>{let s=gradeStart(o,a),c=gradeEnd(o,a);return{start:s,end:c}},s&&s.acceptedAnnotationMatchIndexes)};a.endpointGrader=endpointGrader;let nerLabelsGrader=(o,a,s)=>{let gradeLabels=(o,a)=>({correctWork:+(o===a),totalWork:1});if(g.default.isEmpty(a))return{nerLabels:{correctWork:0,totalWork:0}};if(g.default.isEmpty(o)){let o=g.default.findIndex(a.acceptedAnnotations,({annotation:o})=>!o)>=0;return{nerLabels:{correctWork:+o,totalWork:1}}}return g.default.isNil(a.label)||g.default.isNil(o.label)?{nerLabels:{correctWork:0,totalWork:0}}:A.gradeForAcceptedAnnotations(o,a,(o,a)=>{let s=gradeLabels(o.label,a.label);return{nerLabels:s}},s&&s.acceptedAnnotationMatchIndexes)};a.nerLabelsGrader=nerLabelsGrader;let nerRelationshipsGrader=(o,a,s,c,k,A)=>{if(g.default.isEmpty(a?.name))return{nerRelationships:{correctWork:0,totalWork:0}};if(g.default.isEmpty(o))return{nerRelationships:{correctWork:0,totalWork:1}};{let c=A.directedRelationshipNames.includes(o.name);return{nerRelationships:{correctWork:+(!(c&&s?.reversed)&&o.name===a.name),totalWork:1}}}};a.nerRelationshipsGrader=nerRelationshipsGrader;let gradePerFrameForAnnotations=o=>(a,s,...c)=>{let g=s?.props.type??a?.props.type;return"annotation"===g?A.gradePerFrame(o)(a,s,...c):{}};a.gradePerFrameForAnnotations=gradePerFrameForAnnotations;let x=Object.freeze({textEndpoints:{taskTypes:[k.TaskType.NamedEntityRecognition],title:"Text endpoints",graderFn:gradePerFrameForAnnotations(endpointGrader)},nerLabels:{taskTypes:[k.TaskType.NamedEntityRecognition,k.TaskType.MultiModalTranscription],title:"Text Labels",graderFn:gradePerFrameForAnnotations(nerLabelsGrader)},nerRelationships:{taskTypes:[k.TaskType.NamedEntityRecognition,k.TaskType.MultiModalTranscription],title:"Text relationships",graderFn:(o,a,...s)=>{let c=a?.props.type??o?.props.type;return"relationship"===c?A.gradePerFrame(nerRelationshipsGrader)(o,a,...s):{}}}});a.default=x},642101:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.hasCorrectLabels=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(991984),A=s(167469),x=s(440169);let P=.95,w=.95;let ErrorContainer=class ErrorContainer{appendError(o){this.count+=1,this.details.push(o)}toJson(){return{count:this.count,details:this.details}}constructor(){this.count=0,this.details=[]}};let F={small_vehicles:["car_or_van_or_suv","pickup_truck"],large_vehicles:["truck","pickup_truck","trailer","front_of_semi_truck","bendy_bus","rigid_bus","train"],emergency_vehicles:["firetruck","police_car","ambulance"],construction_vehicles:["construction_vehicle"],other_vehicles:["motorcycle","bicycle","bicycle_rack","police_bicycle","police_motorcycle"],pedestrians:["adult_pedestrian","child pedestrian"],"construction_workers_&_police_officers":["police","construction_worker"],animals:["small_animal","large_animal"],others:["stroller","wheelchair","other_pushable_pullable","portable_personal_mobility_vehicle"],movable_objects:["traffic_cone","temporary_traffic_barrier","movable_obstacle_in_road"]},R=g.default.flatMap(F),D={};g.default.forEach(F,(o,a)=>{g.default.forEach(o,o=>{D[o]=a})});let G=["vehicle_activity"],B=["rider_status","emergency_lights","is_directing_traffic"],isTaller=(o,a)=>g.default.get(o,"height",0)>a,hasQualifyingLabel=o=>R.includes(o),hasTightBoundingBox=(o,a)=>{let s=o.currentAnnotation,c=o.correctAnnotation,k=[s.left-c.left,s.top-c.top,s.left+s.width-(c.left+c.width),s.top+s.height-(c.top+c.height)];return g.default.every(k,o=>Math.abs(o)<a)},hasCorrectLabels=(o,a=[])=>{if(o.correctLabel!==o.currentLabel)return!1;let s=g.default.get(o.correctAnnotation,"attributes",{}),c=g.default.get(o.currentAnnotation,"attributes",{}),k=g.default.differenceWith(g.default.entries(s),g.default.entries(c),g.default.isEqual);for(let[o]of k)if(!a.includes(o))return!1;return!0};a.hasCorrectLabels=hasCorrectLabels;let isFalsePositiveError=o=>{let a=o.currentAnnotation&&!o.correctAnnotation&&hasQualifyingLabel(o.currentLabel);return a?`extra ${o.currentLabel}`:null},isFalseNegativeError=o=>{let a=!o.currentAnnotation&&o.correctAnnotation&&hasQualifyingLabel(o.correctLabel);return a?`missing ${o.correctLabel}`:null},isTruePositiveError=o=>{if(!o.currentAnnotation||!o.correctAnnotation)return null;let a=[];return(hasTightBoundingBox(o,2)||a.push("loose bounding box"),hasCorrectLabels(o,G)||a.push(`incorrect label (${o.currentLabel})`),a.length>0)?`${o.correctLabel}: ${a.join(", ")}`:null},hasCriticalWrongSuperclass=o=>{let a=D[o.currentLabel],s=D[o.correctLabel];return a!==s},hasCriticalWrongAttributes=(o,a)=>{let s=g.default.get(o.currentAnnotation,"attributes",{}),c=g.default.get(o.currentAnnotation,"attributes",{}),k=g.default.difference(g.default.entries(s),g.default.entries(c));for(let[o]of k)if(a.includes(o))return!0;return!1},hasCriticalLossBoundingBox=(o,a)=>x.genericIou(o.correctAnnotation,o.currentAnnotation)<a,isCriticalTruePositiveError=o=>{let a=isTaller(o.correctAnnotation,40);return o.correctAnnotation&&o.currentAnnotation&&(hasCriticalWrongSuperclass(o)&&a||hasCriticalWrongAttributes(o,B)&&a||hasCriticalLossBoundingBox(o,.7))},getVertices=o=>{let a=o.top,s=o.left,c=o.height,g=o.width,k=[];return k.push({x:s,y:a}),k.push({x:s+g,y:a}),k.push({x:s+g,y:a+c}),k.push({x:s,y:a+c}),k.push({x:s,y:a}),k},convertToNuTonomyAnnotation=o=>{let a=g.default.get(o.correctAnnotation,"frames.0");a&&(a.vertices=getVertices(a));let s=g.default.get(o.currentAnnotation,"frames.0");return s&&(s.vertices=getVertices(s)),{correctLabel:g.default.get(o.correctAnnotation,"props.label"),currentLabel:g.default.get(o.currentAnnotation,"props.label"),correctAnnotation:a,currentAnnotation:s}},W={neutronBox:{taskTypes:[A.TaskType.Annotation],title:"neutron rubric",graderFn:k.globalGradePerFrame((o,a,{recallThreshold:s=P,precisionThreshold:c=w},g)=>{let k=g.map(convertToNuTonomyAnnotation),A=new ErrorContainer,x=new ErrorContainer,F=0,R=new ErrorContainer,D=new ErrorContainer,G=0;for(let o of k){o.correctAnnotation&&(F+=1),o.currentAnnotation&&(G+=1);let a=isFalseNegativeError(o);a&&(isTaller(o.correctAnnotation,40)?A.appendError(a):x.appendError(a));let s=isFalsePositiveError(o);s&&(isTaller(o.currentAnnotation,40)?R.appendError(s):D.appendError(s));let c=isTruePositiveError(o);c&&(isCriticalTruePositiveError(o)?R.appendError(c):D.appendError(c))}let B=F>0?1-(3*A.count+x.count)/F:+(0===G),W=G>0?1-(3*R.count+D.count)/G:+(0===G);return{recall:{label:"recall",correctWork:+(B>s),totalWork:1,intermediates:{recall:B,"critical false negatives":A.toJson(),"non-critical false negatives":x.toJson(),"total ground truth annotations":F}},precision:{label:"precision",correctWork:+(W>c),totalWork:1,intermediates:{precision:W,"critical errors":R.toJson(),"non-critical errors":D.toJson(),"total annotations":G}}}}),global:!0}};a.default=W},242603:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.pointGraders=a.distanceGrader=a.POINT_DISTANCE_THRESHOLD=void 0;var c=s(440169),g=s(167469),k=s(991984);let A=6;a.POINT_DISTANCE_THRESHOLD=A;let inSameSensor=(o,a)=>o?.sensor_id===a?.sensor_id,x={correctWork:0,totalWork:0},distanceGrader=(o,a,s,{threshold:g=A})=>inSameSensor(o,a)?{pointDistance:k.gradeIfNotMissing((o,a)=>{let s=c.findDistance(c.vertexToArr(o),c.vertexToArr(a));return{correctWork:+(s<=g),totalWork:1,intermediates:{distance:s}}},o,a)}:{pointDistance:x};a.distanceGrader=distanceGrader;let P={pointDistance:{taskTypes:[g.TaskType.PointAnnotation],title:"Distance",graderFn:k.gradePerFrame(distanceGrader)}};a.pointGraders=P,a.default=P},355427:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.splitIntoPolygonLikes=a.polygonIouClampedGrader=a.DEFAULT_PX_MAPPINGS=a.POLYGON_GRADER_MARGIN_THRESHOLD=a.POLYGON_GRADER_IOU_DIFF_THRESHOLD=a.VIDEO_POLYGON_DISTANCE_IOU_THRESHOLD=a.POLYGON_DISTANCE_IOU_THRESHOLD=void 0;var c=s(167469),g=s(991984),k=s(440169),A=s(311311);a.POLYGON_DISTANCE_IOU_THRESHOLD=.6,a.VIDEO_POLYGON_DISTANCE_IOU_THRESHOLD=.3;let x=.9;a.POLYGON_GRADER_IOU_DIFF_THRESHOLD=x;let P=5;a.POLYGON_GRADER_MARGIN_THRESHOLD=P;let w=[{min:0,max:5,threshold:.5},{min:5,max:10,threshold:.6}];a.DEFAULT_PX_MAPPINGS=w;let polygonIouClampedGrader=(o,a,s,{threshold:c=x,mappings:A=w})=>({polygonIouClamped:g.gradeIfNotMissing((o,a)=>{let s=c;try{let o=k.polygonFor(a),c=o.getArea(),g=A.filter(o=>o.min<=c&&o.max>c);g.length>0&&(s=g[0].threshold)}catch(o){}try{let c=k.genericIou(o,a);return{correctWork:+(c>=s),totalWork:1,intermediates:{iou:c}}}catch(o){return{correctWork:0,totalWork:1}}},o,a)});a.polygonIouClampedGrader=polygonIouClampedGrader;let splitIntoPolygonLikes=o=>{let a=A.splitPointsByFragment(o.vertices,o.multiple_polygon_vertices).filter(o=>o.length);return a.map(o=>({vertices:o}))};a.splitIntoPolygonLikes=splitIntoPolygonLikes;let F={polygonIou:{taskTypes:[c.TaskType.PolygonAnnotation,c.TaskType.LidarPolygon],title:"Polygon Intersection-Over-Union",graderFn:g.gradePerFrame((o,a,s,{threshold:c=x})=>({polygonIou:g.gradeIfNotMissing((o,a)=>{try{let s=splitIntoPolygonLikes(o),g=splitIntoPolygonLikes(a),A=k.fragmentsIou(s,g);return{correctWork:+(A>=c),totalWork:1,intermediates:{iou:A}}}catch(o){return{correctWork:0,totalWork:1}}},o,a)})),paramConfigs:[{name:"threshold",label:"IoU Threshold",type:"number"}]},polygonMargin:{taskTypes:[c.TaskType.PolygonAnnotation,c.TaskType.LidarPolygon],title:"Polygon Margin",graderFn:g.gradePerFrame((o,a,s,{threshold:c=P})=>({polygonMargin:g.gradeIfNotMissing((o,a)=>{let s=A.splitPointsByFragment(o.vertices,o.multiple_polygon_vertices),g=A.splitPointsByFragment(a.vertices,a.multiple_polygon_vertices),x=+k.lineListInMargin(k.loopBackToStart(s),k.loopBackToStart(g),c);return{correctWork:x,totalWork:1,intermediates:{inMargin:x}}},o,a)})),paramConfigs:[{name:"threshold",label:"Margin Threshold",type:"number",defaultValue:P}]},polygonIouClamped:{taskTypes:[c.TaskType.PolygonAnnotation,c.TaskType.LidarPolygon],title:"Polygon Intersection-Over-Union with clamping by size",graderFn:g.gradePerFrame(polygonIouClampedGrader),paramConfigs:[{name:"threshold",label:"default IoU Threshold",type:"number"},{name:"mappings",label:"possible px range to threshold mappings",type:"any"}]}};a.default=F},216383:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.getEdgeAccuracy=a.queryNearestNeighbor=a.kdTreeify=a.getSegmentIouDetail=a.getSegmentIou=void 0;var c,g=s(167469),k=s(991984),A=(c=s(298784))&&c.__esModule?c:{default:c};let getRelativeSegmentIou=(o,a,s)=>{let c=a.difference(s),g=s.difference(a),k=o.difference(s),A=s.difference(o),x=k.intersectionArea(c),P=A.intersectionArea(g),w=k.getArea()-x,F=A.getArea()-P,R=a.getArea()||1,D=c.getArea()+g.getArea(),G=-(w+F);return{relativeCorrectWork:(x+P+G)/R,relativeTotalWork:D/R,introducedErrorCorrectWork:G/R}},getSegmentIou=(o,a)=>getSegmentIouDetail(o,a).iou;a.getSegmentIou=getSegmentIou;let getSegmentIouDetail=(o,a)=>{let s=o.columnMin<=a.columnMax&&o.columnMax>=a.columnMin,c=o.rowMin<=a.rowMax&&o.rowMax>=a.rowMin;if(!(c&&s))return{iou:0,intersection:0};let g=o.intersectionArea(a);if(0===g)return{iou:0,intersection:0};let k=o.unionArea(a);return{iou:k>0?g/k:0,intersection:g}};a.getSegmentIouDetail=getSegmentIouDetail;let segment2WayIouGrader=(o,a)=>({segmentIou:k.gradeIfNotMissing((o,a)=>{let s=o.segment,c=a.segment,g=getSegmentIou(s,c);return{correctWork:g,totalWork:1,intermediates:{segmentIou:g}}},o,a)}),kdTreeify=(o,a=0)=>{let s=o.sort((o,s)=>o[a]-s[a]);if(0===o.length)return null;let c=Math.floor(s.length/2);return{point:s[c],left:kdTreeify(s.slice(0,c),a?0:1),right:kdTreeify(s.slice(c+1),a?0:1)}};a.kdTreeify=kdTreeify;let distSq=(o,a)=>(o[0]-a[0])*(o[0]-a[0])+(o[1]-a[1])*(o[1]-a[1]),queryNearestNeighbor=(o,a,s=null,c=1/0,g=0)=>{let k,A;if(null===o)return s;distSq(o.point,a)<c&&(c=distSq(s=o.point,a)),a[g]<o.point[g]?(k=o.left,A=o.right):(k=o.right,A=o.left),c=(s=queryNearestNeighbor(k,a,s,c,g?0:1))?distSq(s,a):1/0;let x=Math.abs(a[g]-o.point[g]);return x*x<c&&(s=queryNearestNeighbor(A,a,s,c,g?0:1)),s};a.queryNearestNeighbor=queryNearestNeighbor;let getEdgeAccuracy=(o,a,s)=>{let c=o.getEdge(),g=a.getEdge(),k=kdTreeify(g),A=0,x=0;for(let o of c){let a=queryNearestNeighbor(k,o);a&&(distSq(o,a)<=s*s&&(A+=1),x+=1)}return x?A/x:0};a.getEdgeAccuracy=getEdgeAccuracy;let getAnnotationWeightFromParams=(o,a)=>{let s=A.default.get(a,"nonCritical",[]),c=o.props.label;return s.includes(c)?.5:1},x={segmentIou:{taskTypes:[g.TaskType.SegmentAnnotation],title:"Overlap between matching segment annotations",graderFn:(o,a,s,{threshold:c=1}={},g,x)=>{let P=A.default.get(o,"frames.[0]"),w=A.default.get(a,"frames.[0]"),F=A.default.get(x,"frames.[0]"),R="segmentIou",{correctWork:D,totalWork:G}=segment2WayIouGrader(P,w).segmentIou,B=D>=c?1:D,W={errorType:R,rawErrorType:R,correctWork:B,totalWork:G,relativeCorrectWork:B,relativeTotalWork:G,introducedErrorCorrectWork:0,numIncorrectFrames:+(D<c&&G),incorrectFrames:G&&D<c?["0"]:[],numTotalFrames:1,isMissingProp:!P||void 0,isExtraneousProp:!w||void 0};if(!g||!w)return{[R]:W};if(!P){if(!F)return{[k.getMissingPropErrorType(R)]:Object.assign({},W,{relativeCorrectWork:0,relativeTotalWork:1,isMissingProp:!0})};{let{correctWork:o,totalWork:a}=segment2WayIouGrader(F,w).segmentIou;return{[k.getMissingPropErrorType(R)]:Object.assign({},W,{relativeCorrectWork:-1,relativeTotalWork:0,introducedErrorCorrectWork:o<a?0:-1,isMissingProp:!0})}}}if(!F)return{[R]:Object.assign({},W,{relativeCorrectWork:D,relativeTotalWork:1})};let z=P.segment,V=w.segment,U=F.segment,K=getRelativeSegmentIou(z,V,U);return{[R]:Object.assign({},W,K)}},paramConfigs:[{name:"threshold",label:"IOU Threshold",type:"number",defaultValue:1}]},segmentEdgeFScore:{taskTypes:[g.TaskType.SegmentAnnotation],title:"F-Score computed from classifying edge pixels as explainable or not",graderFn:k.gradePerFrame((o,a,s,c)=>({edgeFScore:k.gradeIfNotMissing((o,a)=>{let s=o.segment,g=a.segment,k=getEdgeAccuracy(s,g,c?.bandwidth??3),A=getEdgeAccuracy(g,s,c?.bandwidth??3),x=k+A?2*k*A/(k+A):0;return{correctWork:x,totalWork:1,intermediates:{fScore:x}}},o,a)})),paramConfigs:[{name:"bandwidth",label:"Edge Width",type:"number",defaultValue:3}]},segmentAnnotationPrecisionRecall:{taskTypes:[g.TaskType.SegmentAnnotation],title:"Per annotation precision recall grader",graderFn:(o,a,s,c,g,k)=>{let x=0,P=0,w=0,F=0;for(let o of k||[]){let a=o.currentAnnotation,c=o.correctAnnotation,g=A.default.get(a,"frames.[0]"),k=A.default.get(c,"frames.[0]");if(!k&&!g)continue;let R=0,D=0,G=0,B=0,{correctWork:W}=segment2WayIouGrader(g,k).segmentIou;if(k&&!g)R+=1,D+=1;else if(g&&!k)G+=1,B+=1;else if(g&&k&&(R+=1,G+=1,g.label!==k.label?B+=1:B+=1-W,g.attributes||k.attributes)){let o=A.default.union(A.default.keys(g.attributes||{}),A.default.keys(k.attributes||{}));G+=o.length,B+=o.filter(o=>g.attributes?.[o]!==k.attributes?.[o]).length}let z=getAnnotationWeightFromParams(c||a,s);x+=z*R,P+=z*D,w+=z*G,F+=z*B}let R="segmentAnnotationRecall",D="segmentAnnotationPrecision";return{[R]:{errorType:R,correctWork:x-P,totalWork:x,relativeCorrectWork:x-P,relativeTotalWork:x},[D]:{errorType:D,correctWork:w-F,totalWork:w,relativeCorrectWork:w-F,relativeTotalWork:w}}},global:!0},pixelPrecision:{taskTypes:[g.TaskType.SegmentAnnotation],title:"Pixel Precision",graderFn:(o,a,s,c,g,k)=>{let A={errorPixels:0,totalPixels:0};for(let o of k||[]){let a=o.currentAnnotation,c=o.correctAnnotation;if(!c&&!a)continue;let g=getAnnotationWeightFromParams(c||a,s);if(!c){let o=a.props.area*g;A.errorPixels+=o,A.totalPixels+=o;continue}if(a){if(c.props.label!==a.props.label){let o=c.props.area*g;A.errorPixels+=o,A.totalPixels+=o;continue}A.totalPixels+=c.props.area*g,A.errorPixels+=a.frames[0].segment.difference(c.frames[0].segment).getArea()*g}}let x="pixelPrecision",P={errorType:x,rawErrorType:x,correctWork:A.totalPixels-A.errorPixels,totalWork:A.totalPixels,relativeCorrectWork:A.totalPixels-A.errorPixels,relativeTotalWork:A.totalPixels,introducedErrorCorrectWork:0};return{[x]:P}},global:!0},pixelRecall:{taskTypes:[g.TaskType.SegmentAnnotation],title:"Pixel Recall",graderFn:(o,a,s,c,g,k)=>{let A={totalPixels:0,missingPixels:0};for(let o of k||[]){let a=o.currentAnnotation,c=o.correctAnnotation;if(!c&&!a)continue;let g=getAnnotationWeightFromParams(c||a,s);if(!c)continue;let k=c.props.area*g;A.totalPixels+=k,a||(A.missingPixels=k)}let x="pixelRecall",P={errorType:x,rawErrorType:x,correctWork:A.totalPixels-A.missingPixels,totalWork:A.totalPixels,relativeCorrectWork:A.totalPixels-A.missingPixels,relativeTotalWork:A.totalPixels,introducedErrorCorrectWork:0};return{[x]:P}},global:!0}};a.default=x},476670:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.isSensorFusionAnnotationLockedForMissingGrader=a.getSensorFusionEnabledAttributeKeys=void 0;var c=s(167469),g=s(69879),k=s(939440);let getAnnotationTypeFromOverriddenTaskType=o=>o===c.TaskType.LidarAnnotation?g.SensorFusionAnnotationType.Cuboid:null,getGraderAnnotationPermissions=(o,a,s)=>{if(!o)return k.PERMISSIONS;let c=getAnnotationTypeFromOverriddenTaskType(o.props.overriddenTaskType);if(!c||0===a.length)return k.PERMISSIONS;let g=k.processRules(a,{annotationType:c,annotation:{type:c,id:o?.props?.id??"",label:o?.props.label},sensorId:s?.sensorId,attributeName:s?.attributeName},k.PERMISSIONS);return g};a.getSensorFusionEnabledAttributeKeys=(o,a,s)=>{let c=[];for(let g of o){let o=getGraderAnnotationPermissions(a,s,{attributeName:g});o.includes(k.Permission.ChangeAttributes)&&c.push(g)}return c},a.isSensorFusionAnnotationLockedForMissingGrader=(o,a)=>{let s=getGraderAnnotationPermissions(o,a),c=s.filter(o=>o!==k.Permission.ChangeAttributes);return 0===c.length}},19552:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.arraysEqual=function(o,a){if(o.length!==a.length)return!1;let s=[...o].sort(),c=[...a].sort();return s.every((o,a)=>o===c[a])};var c=function(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}(s(632114));Object.keys(c).forEach(function(o){"default"!==o&&"__esModule"!==o&&(o in a&&a[o]===c[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return c[o]}}))})},632114:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.calculatePortionOfPolylineInMargin=function(o,a,s=5,c=1,g=1){if(o.length<2||a.length<2)throw Error("Both polylines must have at least 2 points");let k=s/100/c,A=g/1e3/c;function distance3D(o,a){let s=a.x-o.x,c=a.y-o.y,g=a.z-o.z;return Math.sqrt(s*s+c*c+g*g)}let x=0,P=0;for(let s=0;s<a.length-1;s++){let c=a[s],g=a[s+1],w=distance3D(c,g);x+=w;let F=Math.max(1,Math.ceil(w/A)),R=0;for(let a=0;a<=F;a++){let s=a/F,A={x:c.x+s*(g.x-c.x),y:c.y+s*(g.y-c.y),z:c.z+s*(g.z-c.z)},x=function(a){let s=1/0;for(let c=0;c<o.length-1;c++){let g=function(o,a,s){let c=s.x-a.x,g=s.y-a.y,k=s.z-a.z,A=c*c+g*g+k*k;if(A<1e-10)return distance3D(o,a);let x=o.x-a.x,P=o.y-a.y,w=o.z-a.z,F=Math.max(0,Math.min(1,(x*c+P*g+w*k)/A)),R=a.x+F*c,D=a.y+F*g,G=a.z+F*k,B=o.x-R,W=o.y-D,z=o.z-G;return Math.sqrt(B*B+W*W+z*z)}(a,o[c],o[c+1]);s=Math.min(s,g)}return s}(A);x<=k&&R++}let D=R/(F+1);P+=w*D}return 0===x?0:P/x}},771679:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.ltdLinkGrader=a.ltdPolylinePolygonGrader=a.ltdPointGrader=a.DEFAULT_POINT_ERROR_MARGIN=a.DEFAULT_POLY_ERROR_MARGIN=void 0;var c=s(991984),g=s(19552),k=s(167469),A=s(709296),x=s(74909);let P=5;a.DEFAULT_POLY_ERROR_MARGIN=P;let w=5;a.DEFAULT_POINT_ERROR_MARGIN=w;let ltdPointGrader=(o,a,s,{errorMarginCm:g=w}={})=>c.gradeIfNotMissing((o,a,s,{errorMarginCm:c=w}={})=>{let g=A.maybeGetFirstFrame(o).vertex,k=A.maybeGetFirstFrame(a).vertex,P=x.naiveDistance(g,k);return{correctWork:P<.01*c?1:0,totalWork:1}},o,a,s,{errorMarginCm:g});a.ltdPointGrader=ltdPointGrader;let ltdPolylinePolygonGrader=(o,a,s,{errorMarginCm:k=P}={})=>c.gradeIfNotMissing((o,a,s,{errorMarginCm:c=P}={})=>{let k=A.maybeGetFirstFrame(o).vertices,x=A.maybeGetFirstFrame(a).vertices,w=g.calculatePortionOfPolylineInMargin(x,k,c);return{correctWork:w,totalWork:1}},o,a,s,{errorMarginCm:k});a.ltdPolylinePolygonGrader=ltdPolylinePolygonGrader;let ltdLinkGrader=(o,a)=>c.gradeIfNotMissing((o,a)=>{let{from:s,to:c,isBidirectional:k}=A.maybeGetFirstFrame(o),{from:x,to:P}=A.maybeGetFirstFrame(a);return k?g.arraysEqual([s,c],[x,P])?{correctWork:1,totalWork:1}:{correctWork:0,totalWork:1}:s===x&&c===P?{correctWork:1,totalWork:1}:{correctWork:0,totalWork:1}},o,a);a.ltdLinkGrader=ltdLinkGrader;let F={ltdPolylinePolygonGrader:{taskTypes:[k.TaskType.TopdownPolygonAnnotation,k.TaskType.PolylineAnnotation],title:"LTD Type Polyline/Polygon Grader",graderFn:c.gradeSingle(ltdPolylinePolygonGrader,"ltdPolylinePolygonGrader"),paramConfigs:[{name:"errorMarginCm",label:"Default Error Margin (cm)",type:"number",defaultValue:P}]},ltdPointGrader:{taskTypes:[k.TaskType.TopdownPointAnnotation],title:"LTD Point Grader",graderFn:c.gradeSingle(ltdPointGrader,"ltdPointGrader"),paramConfigs:[{name:"errorMarginCm",label:"Default Error Margin (cm)",type:"number",defaultValue:w}]},ltdLinkGrader:{taskTypes:[k.TaskType.LinkAnnotation],title:"LTD Link Grader",graderFn:c.gradeSingle(ltdLinkGrader,"ltdLinkGrader"),paramConfigs:[]}};a.default=F},30353:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.sizeChartGrader=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(991984),x=s(222357),P=s(810755);function sanitizeUnit(o){return"inch"===o?"in":o}function checkNotMistake(o,a){if(o===a)return!0;if(o.length-a.length==1){let s=0,c=0;for(s=0;s<o.length;s++)o[s]===a[c]&&(c+=1);return s-c<=1}if(a.length-o.length==1){let s=0,c=0;for(s=0;s<a.length;s++)a[s]===o[c]&&(c+=1);return s-c<=1}if(a.length!==o.length)return!1;{let s=0;for(let c=0;c<a.length;c++)a[c]!==o[c]&&(s+=1);return s<=1}}function getConversionsFromSizes(o){return g.default.flatMap(o,o=>g.default.map(o.conversions,a=>({label:o.label,conversion:a,sizeGroupingKey:[o.label,a.key,a.value].join("__DELIM__").replace(/ /g,"").toLowerCase()})))}function getMeasurementsFromSizes(o){return g.default.flatMap(o,o=>g.default.map(o.measurements,a=>({label:o.label,measurement:a,sizeGroupingKey:[o.label,a.measurement,sanitizeUnit(a.size_unit_override)].join("__DELIM__").replace(/ /g,"").toLowerCase(),measurementGroupingKey:[a.measurement,sanitizeUnit(a.size_unit_override)].join("__DELIM__").replace(/ /g,"").toLowerCase()})))}function getLabelsFromSizes(o){return g.default.map(o,o=>o.label)}let sizeChartGrader=(o,a,s,c)=>{let k="sizeChart";P.assertDefined(c);let A=g.default.groupBy(o,"field_id"),w=A.containsSizeChart?.[0];if(!w||g.default.get(w,"response.0.result")!==x.GraderResult.Correct)return{sizeChart:{label:k,correctWork:0,totalWork:20}};if("no"===g.default.get(w,"response.0")||"website_down"===g.default.get(w,"response.0"))return{sizeChart:{label:k,correctWork:20,totalWork:20}};let F={sizeChartName:0,missingConversions:0,extraneousConversions:0,missingMeasurements:0,extraneousMeasurements:0,typosMeasurements:0,missingLabels:0,extraneousLabels:0,minSizeFloatError:0,maxSizeFloatError:0,sizeUnitOverride:0,jsonParseError:0},R=A.size_chart_name??[];for(let o of R)F.sizeChartName+=g.default.get(o,"response.0.result")===x.GraderResult.Correct?0:1;let D=A.json_input??[];for(let o of D)if(g.default.get(o,"response.0.result")!==x.GraderResult.Correct){let a;try{a=JSON.parse(g.default.get(o,"response.0.expected"));let s=JSON.parse(g.default.get(o,"response.0.given"));!function(o,a,s){let c=getLabelsFromSizes(o.sizes),k=getLabelsFromSizes(a.sizes),A=g.default.differenceBy(c,k);s.missingLabels+=A.length;let x=g.default.differenceBy(k,c);s.extraneousLabels+=x.length;let P=getConversionsFromSizes(o.sizes),w=getConversionsFromSizes(a.sizes),F=g.default.differenceBy(P,w,"sizeGroupingKey");s.missingConversions+=F.length;let R=g.default.differenceBy(w,P,"sizeGroupingKey");s.extraneousConversions+=R.length;let D=getMeasurementsFromSizes(o.sizes).sort(),G=getMeasurementsFromSizes(a.sizes).sort();if(G.length>D.length)s.extraneousMeasurements+=G.length-D.length;else if(G.length<D.length)s.missingMeasurements+=D.length-G.length;else{let o=g.default.difference(D,G),a=g.default.differenceWith(o.map(o=>o.sizeGroupingKey),G.map(o=>o.sizeGroupingKey),checkNotMistake),c=g.default.differenceWith(G.map(o=>o.sizeGroupingKey),o.map(o=>o.sizeGroupingKey),checkNotMistake);s.missingMeasurements+=a.length,s.extraneousMeasurements+=c.length,s.typosMeasurements+=2*G.length-a.length-c.length}let B=g.default.values(g.default.groupBy([...D,...G],o=>o.sizeGroupingKey)).filter(o=>o.length>=2);g.default.forEach(B,([o,a])=>{s.minSizeFloatError+=o&&a&&o.measurement.min_size_float===a.measurement.min_size_float?0:1,s.maxSizeFloatError+=o&&a&&o.measurement.max_size_float===a.measurement.max_size_float?0:1});let W=g.default.values(g.default.groupBy([...D,...G],o=>o.measurementGroupingKey));g.default.forEach(W,o=>{s.sizeUnitOverride+=1===g.default.uniqBy(o.map(o=>sanitizeUnit(o.measurement.size_unit_override)),"size_unit_override").length?0:1})}(a,s,F)}catch{a?F.jsonParseError+=function(o){let a=0,s=getConversionsFromSizes(o.sizes);a+=s.length;let c=getMeasurementsFromSizes(o.sizes);return a+(2*g.default.uniqBy(c,"sizeGroupingKey").length+g.default.uniqBy(c,"measurementGroupingKey").length)}(a):F.jsonParseError+=1}}if(F.missingLabels+F.extraneousLabels+F.missingConversions+F.extraneousConversions+F.missingMeasurements+F.extraneousMeasurements+F.sizeUnitOverride>0)return{sizeChart:{label:k,correctWork:0,totalWork:20,intermediates:{errors:F}}};let G=20;return 0!==F.sizeChartName&&(G-=1),0!==F.typosMeasurements&&(G-=1),{sizeChart:{label:k,correctWork:Math.max(G-=6*Math.min(F.minSizeFloatError+F.maxSizeFloatError,3),0),totalWork:20,intermediates:{errors:F}}}};a.sizeChartGrader=sizeChartGrader;let w=Object.freeze({sizeChart:{taskTypes:[k.TaskType.TextCollection],title:"e-commerse size chart grader",graderFn:A.globalGradePerFrame(sizeChartGrader),global:!0}});a.default=w},798921:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.snowberryCqlGraderFn=a.CqlField=void 0;var c,g,k,A,x=s(167469),P=s(991984),w=s(222357);a.CqlField=k,(c=k||(a.CqlField=k={})).IsUnjudgeable="is_unjudgeable",c.PoorVideoQuality="poor_video_quality",c.PoorAudioQuality="poor_audio_quality",c.NegativeCharacteristics="negative_characteristics",c.TypesOfContent="types_of_content",(g=A||(A={})).Unjudgeable="unjudgeable",g.Good="good",g.Bad="bad",g.Debatable="debatable",g.Empty="empty";let getRawAnnotationsFromGraderAnnotations=o=>{let a={},s={};return o.forEach(o=>{let c=o.field_id,g=o.response[0],k=g.result;k===w.GraderResult.Correct||k===w.GraderResult.Matched?(a[c]=g.given,s[c]=g.given):(k!==w.GraderResult.Missing&&(a[c]=g.given),k!==w.GraderResult.Extraneous&&(s[c]=g.expected))}),{givenResponsesPerField:a,expectedResponsesPerField:s}},getCQLResultFromAnnotations=o=>{if(0===Object.keys(o).length)return A.Empty;let a=o[k.IsUnjudgeable]&&"no"!==o[k.IsUnjudgeable][0],s=o[k.PoorVideoQuality]&&"no"!==o[k.PoorVideoQuality][0],c=o[k.PoorAudioQuality]&&"no"!==o[k.PoorAudioQuality][0],g=o[k.NegativeCharacteristics]&&"none"!==o[k.NegativeCharacteristics][0],x=o[k.TypesOfContent]&&"debatable"!==o[k.TypesOfContent][0];return a?A.Unjudgeable:s||c||g?A.Bad:x?A.Good:A.Debatable},checkMatchingSubCategories=(o,a)=>{let s=[k.PoorVideoQuality,k.PoorAudioQuality,k.NegativeCharacteristics,k.TypesOfContent];for(let c of s)if((o[c]?.[0]||a[c]?.[0])&&o[c]?.[0]!==a[c]?.[0])return!1;return!0},snowberryCqlGraderFn=o=>{let{givenResponsesPerField:a,expectedResponsesPerField:s}=getRawAnnotationsFromGraderAnnotations(o),c=0,g=getCQLResultFromAnnotations(a),k=getCQLResultFromAnnotations(s),x=checkMatchingSubCategories(a,s);return g===A.Empty?c=0:g===k?c=g!==A.Good&&g!==A.Bad||x?1:.97:g===A.Unjudgeable&&k!==A.Unjudgeable||g!==A.Unjudgeable&&k===A.Unjudgeable?c=.3:g===A.Debatable&&k===A.Good||g===A.Bad&&k===A.Debatable?c=.75:(g===A.Debatable&&k!==A.Debatable||g!==A.Debatable&&k===A.Debatable)&&(c=.5),{snapCql:{label:"snap cql",totalWork:1,correctWork:c,intermediates:{givenAnswer:g,expectedAnswer:k}}}};a.snowberryCqlGraderFn=snowberryCqlGraderFn;let F={snowberryCqlGrader:{taskTypes:[x.TaskType.TextCollection],title:"snowberry cql grader",graderFn:P.globalGradePerFrame(snowberryCqlGraderFn),global:!0}};a.default=F},709296:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.computeLevenshteinDistance=computeLevenshteinDistance,a.default=a.attributesWithTextAnnotation=a.extraneousWithTextAnnotation=a.missingWithTextAnnotation=a.textClipTextAccuracyGrader=a.textClipTimingGrader=a.isTextClipAnnotation=a.maybeReconstructAnnotation=a.maybeGetFirstFrame=a.ApplicableClipGraderTypes=void 0;var c,g=s(599789),k=s(991984),A=(c=s(524183))&&c.__esModule?c:{default:c};a.ApplicableClipGraderTypes=["missingWithTextAnnotation","extraneousWithTextAnnotation","attributesWithTextAnnotation","textClipTextAccuracy","textClipTiming"];let maybeGetFirstFrame=o=>{if(!o)return;let a=Object.keys(o.frames),s=a[0];if(!s)throw Error("No first frame key found!");return o.frames[s]};a.maybeGetFirstFrame=maybeGetFirstFrame;let maybeReconstructAnnotation=o=>{let a=maybeGetFirstFrame(o);return a?{...a,props:a,frames:{0:a}}:void 0};a.maybeReconstructAnnotation=maybeReconstructAnnotation;let isTextClipAnnotation=o=>"scopeId"in o;function computeLevenshteinDistance(o,a){let s=o?o.length:0,c=a?a.length:0;if(0===s)return c;if(0===c)return s;let g=Array(c+1);for(let o=0;o<=c;++o){let a=g[o]=Array(s+1);a[0]=o}let k=g[0];for(let o=1;o<=s;++o)k[o]=o;for(let k=1;k<=c;++k)for(let c=1;c<=s;++c)a.charAt(k-1)===o.charAt(c-1)?g[k][c]=g[k-1][c-1]:g[k][c]=Math.min(g[k-1][c-1],g[k][c-1],g[k-1][c])+1;return g[c][s]}a.isTextClipAnnotation=isTextClipAnnotation;let textClipTimingGrader=(o,a)=>k.gradeIfNotMissing((o,a)=>{let s=maybeGetFirstFrame(o),c=maybeGetFirstFrame(a);if(!s||!c)throw Error("Clip does not have an annotation frame");if(!(isTextClipAnnotation(s)&&isTextClipAnnotation(c)))return{totalWork:0,correctWork:0};{let o=s.timestamp,a=c.timestamp,g=o+s.duration,k=a+c.duration;return 5e5>=Math.abs(o-a)&&5e5>=Math.abs(g-k)?{totalWork:1,correctWork:1}:{totalWork:1,correctWork:0}}},o,a);a.textClipTimingGrader=textClipTimingGrader;let textClipTextAccuracyGrader=(o,a)=>k.gradeIfNotMissing((o,a)=>{let s=maybeGetFirstFrame(o),c=maybeGetFirstFrame(a);if(!s||!c)throw Error("Clip does not have an annotation frame");if(!(isTextClipAnnotation(s)&&isTextClipAnnotation(c)))return{totalWork:0,correctWork:0};{let o=s.text,a=c.text,g=computeLevenshteinDistance(o,a);return g<1?{totalWork:1,correctWork:1}:{totalWork:1,correctWork:0}}},o,a);a.textClipTextAccuracyGrader=textClipTextAccuracyGrader;let missingWithTextAnnotation=(o,a,s,c,g=!0,k)=>{let x=A.default.missing.graderFn,P=o?.props.overriddenTaskType==="sensorfusiontext"||a?.props.overriddenTaskType==="sensorfusiontext"||k?.props.overriddenTaskType==="sensorfusiontext";return P?((o,a,k)=>{let A=maybeReconstructAnnotation(o),P=maybeReconstructAnnotation(a),w=maybeReconstructAnnotation(k);return x(A,P,s,c,g,w)})(o,a,k):x(o,a,s,c,g,k)};a.missingWithTextAnnotation=missingWithTextAnnotation;let extraneousWithTextAnnotation=(o,a,s,c,g=!0,k)=>{let x=A.default.extraneous.graderFn,P=o?.props.overriddenTaskType==="sensorfusiontext"||a?.props.overriddenTaskType==="sensorfusiontext"||k?.props.overriddenTaskType==="sensorfusiontext";if(P){let A=maybeReconstructAnnotation(o),P=maybeReconstructAnnotation(a),w=maybeReconstructAnnotation(k);return x(A,P,s,c,g,w)}return x(o,a,s,c,g,k)};a.extraneousWithTextAnnotation=extraneousWithTextAnnotation;let attributesWithTextAnnotation=(o,a,s,c,g=!0,k,x)=>{let P=A.default.attributes.graderFn,w=o?.props.overriddenTaskType==="sensorfusiontext"||a?.props.overriddenTaskType==="sensorfusiontext";if(w){let A=maybeReconstructAnnotation(o),w=maybeReconstructAnnotation(a),F=maybeReconstructAnnotation(k);return P(A,w,s,c,g,F,x)}return P(o,a,s,c,g,k,x)};a.attributesWithTextAnnotation=attributesWithTextAnnotation;let x=Object.freeze({missingWithTextAnnotation:{taskTypes:[g.TaskType.SensorFusion],title:"missingWithTextAnnotation",graderFn:missingWithTextAnnotation},extraneousWithTextAnnotation:{taskTypes:[g.TaskType.SensorFusion],title:"extraneousWithTextAnnotation",graderFn:extraneousWithTextAnnotation},attributesWithTextAnnotation:{taskTypes:[g.TaskType.SensorFusion],title:"attributesWithTextAnnotation",graderFn:attributesWithTextAnnotation},textClipTiming:{taskTypes:[g.TaskType.SensorFusionText],title:"textClipTiming",graderFn:k.gradeSingle(textClipTimingGrader,"textClipTiming")},textClipTextAccuracy:{taskTypes:[g.TaskType.SensorFusionText],title:"textClipTextAccuracy",graderFn:k.gradeSingle(textClipTextAccuracyGrader,"textClipTextAccuracy")}});a.default=x},944129:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.quizGrader=a.entityExtraneousFn=a.modifierGrader=a.textGrader=a.priceGrader=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(991984),x=s(524183),P=s(513254),w=s(222357),F=s(963494),R=s(934788);let gradeByMatchingResult=(o,a,s)=>c=>{if(!c||0===c.response.length)return w.IGNORED_GRADER_OUTPUT;let g=c.response[0];return g.result===w.GraderResult.Correct?o(g.given,g.given):g.result===w.GraderResult.Incorrect?o(g.given,g.expected):g.result===w.GraderResult.Missing?a?a(g.expected):w.MISSING_GRADER_OUTPUT:g.result!==w.GraderResult.Extraneous?w.IGNORED_GRADER_OUTPUT:s?s(g.given):w.IGNORED_GRADER_OUTPUT},getNumber=o=>parseFloat(o)||0,priceGrader=(o,a,s,c)=>{let incorrectPriceFn=(o,a)=>({correctWork:+(getNumber(o)===getNumber(a)),totalWork:1}),missingPriceFn=o=>({correctWork:+(0===getNumber(o)),totalWork:1}),g=c?.parentGiven?"_parentGiven":"";return{[`itemPrice${g}`]:R.gradeIfFieldMatch(["item_price","price_value"],gradeByMatchingResult(incorrectPriceFn,missingPriceFn))(o,a),[`optionPrice${g}`]:R.gradeIfFieldMatch(["option_price"],gradeByMatchingResult(incorrectPriceFn,missingPriceFn))(o,a)}};a.priceGrader=priceGrader;let getStandardizedText=o=>o.trim().toLowerCase(),textGrader=(o,a)=>({menuText:R.gradeIfTypeMatch(F.TextCollectionFieldType.Text,gradeByMatchingResult((o,a)=>A.gradeFreeText(getStandardizedText(o),getStandardizedText(a),A.TextComparisonMethod.Levenshtein)))(o,a)});a.textGrader=textGrader;let modifierGrader=(o,a,s,c)=>{let graderFn=(o,a)=>({correctWork:+(getNumber(o)===getNumber(a)),totalWork:1}),categoryExtraneousGraderFn=(o,a)=>({correctWork:-R.redundantDifference(o,a||[]).length,totalWork:0}),g=c?.parentGiven?"_parentGiven":"";return{[`extraMin${g}`]:R.gradeIfFieldMatch(["extra_min"],gradeByMatchingResult(graderFn))(o,a),[`extraMax${g}`]:R.gradeIfFieldMatch(["extra_max"],gradeByMatchingResult(graderFn))(o,a),[`extraFree${g}`]:R.gradeIfFieldMatch(["extra_free"],gradeByMatchingResult(graderFn))(o,a),[`extraNumChoice${g}`]:R.gradeIfFieldMatch(["extra_num_choice"],gradeByMatchingResult(graderFn))(o,a),[`itemDefaultOptionsCount${g}`]:R.gradeIfFieldMatch(["item_default_options"],gradeByMatchingResult((o,a)=>({correctWork:R.redundantIntersection(o,a).length,totalWork:a.length}),o=>({correctWork:0,totalWork:o.length})))(o,a),[`itemDefaultOptionsExtraneous${g}`]:R.gradeIfFieldMatch(["item_default_options"],gradeByMatchingResult(categoryExtraneousGraderFn,()=>({correctWork:0,totalWork:0}),categoryExtraneousGraderFn))(o,a)}};a.modifierGrader=modifierGrader;let entityExistenceFn=()=>w.CORRECT_GRADER_OUTPUT,entityCountFn=(o,a)=>(s,c)=>({[`${a}Count`]:R.gradeIfFieldMatch([o],gradeByMatchingResult(entityExistenceFn))(s,c)}),isAnnotationPresent=o=>{if(!o)return!1;let a=o.frames[0].response;return 0!==a.length&&a[0].result!==w.GraderResult.Missing},entityExtraneousGrader=async(...o)=>{let a=await Promise.all([entityExtraneousFn("category_name","category")(...o),entityExtraneousFn("item_name","item")(...o),entityExtraneousFn("price_label","itemPrice")(...o),entityExtraneousFn("extra_name","extra")(...o),entityExtraneousFn("option_name","option")(...o)]);return g.default.merge(a)},entityExtraneousFn=(o,a)=>async(s,c,g,k,A,P)=>{let w=P?.props?.grandParentGiven?"_parentGiven":"",F=`${a}Extraneous${w}`;if((!s||o!==s.props.label)&&(!c||o!==c.props.label)&&(!P||o!==P.props.label))return{};{let o=await x.extraneousGrader(isAnnotationPresent(s)?s:void 0,isAnnotationPresent(c)?c:void 0,g,k,A,isAnnotationPresent(P)?P:void 0);return o.extraneous.errorType=F,{[F]:o.extraneous}}};a.entityExtraneousFn=entityExtraneousFn;let quizGrader=(o,a)=>{let s=R.gradeIfFieldLike(["Question"],P.singleGraderFn)(o,a),c={[`${a?.field_id}`]:s};return c};a.quizGrader=quizGrader;let D={dragonfruitCategoryCount:{taskTypes:[k.TaskType.TextCollection],title:"Number of categories",graderFn:A.gradePerFrame(entityCountFn("category_name","category"))},dragonfruitItemCount:{taskTypes:[k.TaskType.TextCollection],title:"Number of items",graderFn:A.gradePerFrame(entityCountFn("item_name","item"))},dragonfruitItemPriceLabelCount:{taskTypes:[k.TaskType.TextCollection],title:"Number of item price labels",graderFn:A.gradePerFrame(entityCountFn("price_label","itemPrice"))},dragonfruitExtraCount:{taskTypes:[k.TaskType.TextCollection],title:"Number of extras",graderFn:A.gradePerFrame(entityCountFn("extra_name","extra"))},dragonfruitOptionCount:{taskTypes:[k.TaskType.TextCollection],title:"Number of options",graderFn:A.gradePerFrame(entityCountFn("option_name","option"))}},G={dragonfruitCategoryExtraneous:{taskTypes:[k.TaskType.TextCollection],title:"Extraneous categories",graderFn:entityExtraneousFn("category_name","category")},dragonfruitItemExtraneous:{taskTypes:[k.TaskType.TextCollection],title:"Extraneous items",graderFn:entityExtraneousFn("item_name","item")},dragonfruitItemPriceLabelExtraneous:{taskTypes:[k.TaskType.TextCollection],title:"Extraneous item price labels",graderFn:entityExtraneousFn("price_label","itemPrice")},dragonfruitExtraExtraneous:{taskTypes:[k.TaskType.TextCollection],title:"Extraneous extras",graderFn:entityExtraneousFn("extra_name","extra")},dragonfruitOptionExtraneous:{taskTypes:[k.TaskType.TextCollection],title:"Extraneous options",graderFn:entityExtraneousFn("option_name","option")}},B={dragonfruitPrice:{taskTypes:[k.TaskType.TextCollection],title:"Menu price",graderFn:R.textCollectionGradePerFrame(priceGrader)},dragonfruitText:{taskTypes:[k.TaskType.TextCollection],title:"Transcription text",graderFn:R.textCollectionGradePerFrame(textGrader)},dragonfruitModifier:{taskTypes:[k.TaskType.TextCollection],title:"Entry modifiers",graderFn:R.textCollectionGradePerFrame(modifierGrader)},...D,dragonfruitEntityCount:{taskTypes:[k.TaskType.TextCollection],title:"Number of menu entries",graderFn:R.textCollectionGradePerFrame((o,a,s,c)=>{let g=c?.grandParentGiven?"_parentGiven":"";return{[`categoryCount${g}`]:R.gradeIfFieldMatch(["category_name"],gradeByMatchingResult(entityExistenceFn))(o,a),[`itemCount${g}`]:R.gradeIfFieldMatch(["item_name"],gradeByMatchingResult(entityExistenceFn))(o,a),[`itemPriceLabelCount${g}`]:R.gradeIfFieldMatch(["price_label"],gradeByMatchingResult(entityExistenceFn))(o,a),[`extraCount${g}`]:R.gradeIfFieldMatch(["extra_name"],gradeByMatchingResult(entityExistenceFn))(o,a),[`optionCount${g}`]:R.gradeIfFieldMatch(["option_name"],gradeByMatchingResult(entityExistenceFn))(o,a)}})},...G,dragonfruitExtraneous:{taskTypes:[k.TaskType.TextCollection],title:"Extraneous entries",graderFn:entityExtraneousGrader},dragonfruitQuizGrader:{taskTypes:[k.TaskType.TextCollection],title:"Quiz Categorization Question",graderFn:R.textCollectionGradePerFrame(quizGrader)}};a.default=B},513254:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.shouldGradeField=shouldGradeField,a.default=a.textCollectionGraders=a.categoryDistanceGrader=a.getCategoryScoreByDistance=a.DecayFunction=a.tokenIOUTextGrader=a.clampedEditDistanceFallbackFn=a.numericValueFallbackFn=a.singleGraderFn=a.categoryFieldFullPathGrader=a.calculatePrecisionMultiSelectFullPathScore=a.calculateIOUMultiSelectFullPathScore=a.computeTranscriptionEntitiesScore=a.extractTranscriptionEntities=a.checkTranscriptionEntitiesFormatting=a.categoryFieldLeafGrader=a.gradeByMatchingResult=a.multiSelectConfirmationRateGradingWeights=a.TextParamKey=void 0;var c,g,k,A,x=_interopRequireDefault(s(298784)),P=s(167469),w=_interopRequireDefault(s(952256)),F=s(963494),R=s(991984),D=s(934788),G=s(222357);function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}a.TextParamKey=k,(c=k||(a.TextParamKey=k={})).CaseInsensitive="caseInsensitive",c.AlphaNumericOnly="alphaNumericOnly",c.Trim="trim",c.SkipEmpty="skipEmpty",c.IgnoreCurlyQuotes="ignoreCurlyQuotes";let B={[k.CaseInsensitive]:D.safeToLowerCase,[k.AlphaNumericOnly]:D.safeAlphaNum,[k.Trim]:D.safeTrim,[k.IgnoreCurlyQuotes]:D.safeIgnoreCurlyQuotes},W={missing:1,extraneous:0};a.multiSelectConfirmationRateGradingWeights=W;let isGraderValue=o=>void 0!==o.result,getResultValue=o=>{if(!isGraderValue(o))return o;if(o.result===G.GraderResult.Missing)return o.expected;if(o.result===G.GraderResult.Correct||o.result===G.GraderResult.Incorrect||o.result===G.GraderResult.Extraneous)return o.given;throw Error(`Unexpected grader result: ${JSON.stringify(o)}`)},getResultValues=o=>o.map(getResultValue),gradeByMatchingResult=(o,a)=>(s,c)=>s&&0!==s.response.length?x.default.every(s.response,o=>o.result===G.GraderResult.Missing)?G.MISSING_GRADER_OUTPUT:o(s,c,void 0,a):G.IGNORED_GRADER_OUTPUT;a.gradeByMatchingResult=gradeByMatchingResult;let gradeByGradient=o=>(a,s)=>{if(!a||0===a.response.length||!s||0===s.response.length)return G.IGNORED_GRADER_OUTPUT;if(x.default.every(a.response,o=>o.result===G.GraderResult.Missing))return G.MISSING_GRADER_OUTPUT;let c=o.gradientList,g=a.response.length,k=a.response.map(o=>{if("correct"===o.result)return 1;let a=x.default.get(o,"given.0",null),s=x.default.get(o,"expected.0",null);if(s&&a){if(!c.includes(a)||!c.includes(s))return 0;let o=Math.abs(c.indexOf(a)-c.indexOf(s))/((c.length-1)/2);return Math.max(0,1-o)}return 0});return{correctWork:x.default.sum(k),totalWork:g}},getFormattedValues=(o,a)=>(a?.forEach(a=>{o=o.map(B[a]??x.default.identity)}),o),simpleFieldGrader=(o,a,s,c)=>{let g=getResultValues(a.response),A=getResultValues(o.response),P=c?.fieldTextParams?.[o.field_id],w=x.default.keys(x.default.pickBy(P,x.default.identity)),F=getFormattedValues(g,w),R=getFormattedValues(A,w);return w.includes(k.SkipEmpty)&&x.default.every(R,x.default.isEmpty)&&x.default.every(F,x.default.isEmpty)?{correctWork:0,totalWork:0}:{correctWork:D.redundantIou(F,R),totalWork:1}},categoryFieldLeafGrader=(o,a)=>({correctWork:x.default.sum(o.response.map(o=>o.result===G.GraderResult.Correct?1:o.result===G.GraderResult.Incorrect?D.redundantIou(o.expected,o.given):0)),totalWork:a.response.length});a.categoryFieldLeafGrader=categoryFieldLeafGrader;let checkTranscriptionEntitiesFormatting=(o,a)=>{let s=Object.keys(a),c=x.default.compact(Object.values(a)),g=0,k=0;for(let A of o)if(s.includes(A)){if((g+=1)>=k+2)return!1;a[A]||(k+=1)}else if(c.includes(A)&&(k+=1)>g)return!1;return!0};a.checkTranscriptionEntitiesFormatting=checkTranscriptionEntitiesFormatting;let extractTranscriptionEntities=(o,a)=>{let s,c;let g=Object.keys(a).filter(o=>a[o]),k=[];for(let A=0;A<o.length;A++){let P=o[A];if(g.includes(P)&&(c=A,s=P),!x.default.isNil(s)&&!x.default.isNil(c)&&a[s]===P){let a=x.default.map(o.slice(c+1,A).split(","),o=>o.trim());k.push(a),s=null,c=null}}return k};a.extractTranscriptionEntities=extractTranscriptionEntities;let computeTranscriptionEntitiesScore=(o,a,s)=>{let c=extractTranscriptionEntities(o,s),g=extractTranscriptionEntities(a,s);return{correctWork:D.redundantListOfList(c,g,D.redundantIou),totalWork:c.length}};a.computeTranscriptionEntitiesScore=computeTranscriptionEntitiesScore;let transcriptionTextGrader=(o,a)=>{let s=x.default.head(getResultValues(a.response)),c=a.tags,g=x.default.head(getResultValues(o.response));if(!checkTranscriptionEntitiesFormatting(s,c)||!checkTranscriptionEntitiesFormatting(g,c))return{correctWork:0,totalWork:0};let k=computeTranscriptionEntitiesScore(s,g,c);return k},extractValuesFromChoicePaths=o=>x.default.flatten(x.default.values(o||{}).map(o=>o.values)),getPathValuesPerChoice=o=>x.default.mapValues(o||{},o=>o.values),calculateScoreForPath=(o,a,s)=>{let{incorrectPath:c,partialPath:g}=s,k=D.redundantIntersection(o,a),A=Math.max(o.length,a.length),x=k.length/A;return isPerfectMatchScore(x)||(x*=c),o.length<a.length&&(x*=g),x},getAllMatchingScoresSorted=(o,a,s)=>{let c=[];x.default.forOwn(o,(o,g)=>{x.default.forOwn(a,(a,k)=>{let A=calculateScoreForPath(o,a,s);c.push({actualChoice:g,expectedChoice:k,score:A})})});let g=x.default.sortBy(c,({score:o})=>o);return g},isPerfectMatchScore=o=>1===o,calculateMultiSelectFullPathScore=(o,a,s)=>{let{perChoiceBase:c,perChoiceError:g,missing:k,extraneous:A}=s,P=getAllMatchingScoresSorted(o,a,s),w=x.default.cloneDeep(o),F=x.default.cloneDeep(a),R=[],D=x.default.sum(c.slice(0,x.default.size(a)));for(;!x.default.isEmpty(w)&&!x.default.isEmpty(F);){let o=P.pop();if(!o)break;let{actualChoice:a,expectedChoice:s,score:k}=o,A=R.length;if(a in w&&s in F){delete w[a],delete F[s];let o=k*c[A];isPerfectMatchScore(k)||(o+=(1-k)*g[A]),R.push({actualChoice:a,expectedChoice:s,weightedScore:o})}}let G=x.default.sumBy(R,({weightedScore:o})=>o),B=0,W=0;x.default.isEmpty(F)?x.default.isEmpty(w)||(W=A*x.default.size(w)):B=k*x.default.size(F),G+=B+W;let z=G/D,V=Math.max(z,0);return V},calculateIOUMultiSelectFullPathScore=(o,a,s)=>{let c=s?.missing??1,g=s?.extraneous??1,k=new Set,A=new Set,P=new Set;x.default.forOwn(o,(o,a)=>o.forEach(o=>{k.add(o),P.add(o)})),x.default.forOwn(a,(o,a)=>o.forEach(o=>{A.add(o),P.add(o)}));let w=0,F=0;return P.forEach(o=>{k.has(o)&&!A.has(o)?F+=g:A.has(o)&&!k.has(o)?F+=c:(w+=1,F+=1)}),w===F?1:w/F};a.calculateIOUMultiSelectFullPathScore=calculateIOUMultiSelectFullPathScore;let splitChoiceNodes=(o,a=">")=>{let s={};for(let c of o){let o=c.split(a).map(o=>o.trim()),g=[];for(let s=0;s<o.length;s++){let c=o.slice(0,s+1).join(` ${a} `);g.push(c)}s[c]=g}return s},calculatePrecisionMultiSelectFullPathScore=(o,a,s)=>{if(x.default.isEqual(Object.keys(o),Object.keys(a)))return 1;let c=x.default.isEmpty(o),g=x.default.isEmpty(a);if(c&&g)return 1;if(c!==g)return 0;let k=s?.pathHierarchyDelimiter?splitChoiceNodes(Object.keys(o),s?.pathHierarchyDelimiter):o,A=s?.pathHierarchyDelimiter?splitChoiceNodes(Object.keys(a),s?.pathHierarchyDelimiter):a,P=(o=>{let a={};return o.forEach((o,s)=>{a[o]=s+1}),a})(Object.values(A).flat()),w={},F=s&&s.tiers?Object.fromEntries(Object.entries(s.tiers).map(([o,a])=>[Number(o),a])):{},R=s&&s.tiers?x.default.max(Object.keys(F).map(Number)):1;for(let[o,a]of Object.entries(k)){let c=null;if(A[o])c=1;else{let o=0,g=0;for(let s=0;s<a.length;s++){let k=s+1,A=F[Math.min(k,R)]??1;P[a[s]]&&(o++,c=A),g++}s&&s.tiers||(c=o/g)}w[o]=c||0}return x.default.mean(Object.values(w))??0};a.calculatePrecisionMultiSelectFullPathScore=calculatePrecisionMultiSelectFullPathScore;let categoryFieldFullPathGrader=(o,a,s,c)=>({correctWork:x.default.sum(o.response.map(o=>{if(o.result===G.GraderResult.Correct)return 1;if(o.result===G.GraderResult.Incorrect){let s=getPathValuesPerChoice(o.categoryMetadata?.given),g=a.fullPaths?a.fullPaths:o.categoryMetadata?.expected,k=getPathValuesPerChoice(g);switch(c?.strategy){case F.TextCollectionFullPathGradingStrategy.WeightedMultiSelect:{let o=c?.weights,a=calculateMultiSelectFullPathScore(s,k,o);return a}case F.TextCollectionFullPathGradingStrategy.IOUMultiSelect:{let o=c?.iouWeights,a=calculateIOUMultiSelectFullPathScore(s,k,o);return a}case F.TextCollectionFullPathGradingStrategy.PrecisionMultiSelect:{let o=c?.precisionWeights,a=calculatePrecisionMultiSelectFullPathScore(s,k,o);return a}default:{let s=extractValuesFromChoicePaths(o.categoryMetadata?.given),c=a.fullPaths?extractValuesFromChoicePaths(a.fullPaths):extractValuesFromChoicePaths(o.categoryMetadata?.expected),g=Math.max(c.length,s.length);return 0!==g?D.redundantIntersection(c,s).length/g:0}}}return 0})),totalWork:a.response.length});a.categoryFieldFullPathGrader=categoryFieldFullPathGrader;let getDatetimeString=o=>`${o.year}-${o.month}-${o.day} ${o.hour}:${o.minute}`,datetimeFieldGrader=(o,a)=>{let s=getResultValues(o.response).map(getDatetimeString),c=getResultValues(a.response).map(getDatetimeString);return{correctWork:D.redundantIou(c,s),totalWork:1}},timeRangeFieldGrader=(o,a)=>({correctWork:x.default.sum(a.response.map((a,s)=>D.redundantIou(getResultValue(a),getResultValue(o.response[s])||[]))),totalWork:a.response.length}),rankingOrderFieldGraderFn=(o,a,s,c)=>{let g=getResultValues(o.response),k=getResultValues(a.response);return c?.checkExactOrder?{correctWork:Number(x.default.isEqual(g,k)),totalWork:1}:k.length?c?.kendallsTau?function(o,a){let s=0;try{let c=a.map(o=>"null"===o?-1:o.includes(",")?o.split(",").map(o=>Number(o)).sort().map(o=>`${o}`):o).flat().map(o=>Number(o)),g=o.map(o=>"null"===o?-1:o.includes(",")?o.split(",").map(o=>Number(o)).sort().map(o=>`${o}`):o).flat().map(o=>Number(o)),k=g.map(o=>c.indexOf(o)+1),A=0,x=0;for(let[o,a]of k.entries())for(let s of k.slice(o+1,k.length))a<s&&(A+=1),a>s&&(x+=1);s=Math.abs((A-x)/(A+x))}catch(o){throw Error(`Error in evalKendallsTau: ${o}`)}return isNaN(s)&&(s=0),{correctWork:s,totalWork:1}}(g,k):function(o,a,s){let c=a.length,g=[...Array(c).keys()],k=new Map;g.forEach(o=>{k.set(a[o],Math.pow(c-o,2))});let A=x.default.sum(g.map(a=>(k.get(o[a])??0)/(a+1))),P=x.default.sum(g.map(o=>(k.get(a[o])??0)/(o+1)));return{correctWork:Math.pow(A/P,s),totalWork:1}}(g,k,c?.ndcgPenalty??2):{correctWork:0,totalWork:0}},singleGraderFn=(o,a,s,c)=>{let g=a.type;if(o.type!==g)throw Error(`Inconsistent original and correct annotation types: ${o.type} vs ${g}`);switch(g){case F.TextCollectionFieldType.TranscriptionText:return transcriptionTextGrader(o,a,c);case F.TextCollectionFieldType.Text:case F.TextCollectionFieldType.Number:case F.TextCollectionFieldType.Select:case F.TextCollectionFieldType.Autocomplete:case F.TextCollectionFieldType.QueryableTextAndResults:case F.TextCollectionFieldType.JSON:case F.TextCollectionFieldType.Boolean:case F.TextCollectionFieldType.Markdown:return simpleFieldGrader(o,a,s,c);case F.TextCollectionFieldType.Category:return categoryFieldLeafGrader(o,a);case F.TextCollectionFieldType.Datetime:return datetimeFieldGrader(o,a);case F.TextCollectionFieldType.TimeRange:return timeRangeFieldGrader(o,a);case F.TextCollectionFieldType.RankingOrder:return rankingOrderFieldGraderFn(o,a,s,c);case F.TextCollectionFieldType.BoundingBox:case F.TextCollectionFieldType.Code:case F.TextCollectionFieldType.WorkspaceContainer:case F.TextCollectionFieldType.FileUpload:case F.TextCollectionFieldType.WfeButton:case F.TextCollectionFieldType.Tool:case F.TextCollectionFieldType.Instruction:case F.TextCollectionFieldType.Rubric:case F.TextCollectionFieldType.AudioRecording:case F.TextCollectionFieldType.MultiChannelAudioUpload:case F.TextCollectionFieldType.DynamicLabeledText:case F.TextCollectionFieldType.AttachmentUpload:case F.TextCollectionFieldType.MultiPartText:return{correctWork:0,totalWork:0}}};a.singleGraderFn=singleGraderFn;let numericValueFallbackFn=(o,a,s,c)=>{let g=a.type;if(o.type!==g)throw Error(`Inconsistent original and correct annotation types: ${o.type} vs ${g}`);if(c?.tolerance&&g===F.TextCollectionFieldType.Text){let s=Number(x.default.head(getResultValues(o.response))),g=Number(x.default.head(getResultValues(a.response)));if(!isNaN(s)&&!isNaN(g)){let o=Math.abs(s-g),a=Math.max(c.tolerance-o,0),k=a/c.tolerance;return{correctWork:k,totalWork:1}}}return singleGraderFn(o,a,s,c)};a.numericValueFallbackFn=numericValueFallbackFn;let clampedEditDistanceFallbackFn=(o,a,s,c)=>{let g=a.type;if(o.type!==g)throw Error(`Inconsistent original and correct annotation types: ${o.type} vs ${g}`);if(g===F.TextCollectionFieldType.TranscriptionText||g===F.TextCollectionFieldType.Text||g===F.TextCollectionFieldType.Autocomplete){let s=x.default.head(getResultValues(o.response)).replace(/\W/g,"").toLowerCase(),c=x.default.head(getResultValues(a.response)).replace(/\W/g,"").toLowerCase();if(0===c.length)return{correctWork:0===s.length?1:0,totalWork:1};let g=w.default(s,c);if(g>=c.length)return{correctWork:0,totalWork:1};let k=(c.length-g)/c.length,A=Math.pow(k,c.length<=20?4:3);return{correctWork:A,totalWork:1}}if(g===F.TextCollectionFieldType.Number){let s=Number(x.default.head(getResultValues(o.response))),c=Number(x.default.head(getResultValues(a.response)));if(!isNaN(s)&&!isNaN(c)){let o=Math.abs(s-c),a=Math.pow(2,-o);return{correctWork:a,totalWork:1}}}return singleGraderFn(o,a,s,c)};function shouldGradeField(o,a,s){return!!(!s&&(x.default.isNil(a)||x.default.includes(a,o)))}a.clampedEditDistanceFallbackFn=clampedEditDistanceFallbackFn;let tokenIOUSingleGraderFn=(o,a,s,c)=>{let g=a.type;if(o.type!==g)throw Error(`Inconsistent original and correct annotation types: ${o.type} vs ${g}`);let k=s?.fieldsWhitelist||c?.fieldsWhitelist;if(!((g===F.TextCollectionFieldType.Text||g===F.TextCollectionFieldType.Autocomplete)&&(!k||k.includes(a.field_id)))||o.fieldWasReadOnly)return{correctWork:0,totalWork:0};{if(!Array.isArray(o.response)||!Array.isArray(a.response))return{correctWork:0,totalWork:0};let c=getResultValue(o.response[0]),g=getResultValue(a.response[0]),k=s?.redundant?R.TextComparisonMethod.TokenIOURedundant:R.TextComparisonMethod.TokenIOU;return R.gradeFreeText(c,g,k)}},tokenIOUTextGrader=(o,a,s,c,g,k)=>{let A=c?.fieldsWhitelist||k?.fieldsWhitelist;if(!a||x.default.isEmpty(a)||a.type!==F.TextCollectionFieldType.Text||A&&!A.includes(a.field_id)||o.fieldWasReadOnly)return{tokenIOUText:{correctWork:0,totalWork:0}};if(!x.default.isEmpty(o)&&o?.response[0].result!==G.GraderResult.Missing)return R.gradeForAcceptedAnnotations(o,a,(o,a)=>({tokenIOUText:tokenIOUSingleGraderFn(o,a,c)}),s&&s.acceptedAnnotationMatchIndexes);{let o=x.default.findIndex(a.acceptedAnnotations,({annotation:o})=>!o)>=0;return{tokenIOUText:{correctWork:+o,totalWork:1}}}};a.tokenIOUTextGrader=tokenIOUTextGrader,a.DecayFunction=A,(g=A||(a.DecayFunction=A={})).Linear="linear",g.Constant="constant",g.CustomSteps="custom_steps";let getCategoryScoreByDistance=(o,a,s)=>{let c=s?.maxAcceptableDistance||0,g=s?.valueMap||{};if(1!==o.length||1!==a.length||c<0||x.default.isBoolean(o[0])||x.default.isBoolean(a[0]))return 0;let k=o[0],P=a[0],w=x.default.isNil(g[k])?""===k?-1/0:Number(k):g[k],F=x.default.isNil(g[P])?""===P?-1/0:Number(P):g[P];if(x.default.isEqual(w,F))return 1;if(0===c)return 0;let R=Math.abs(w-F);if(isNaN(R)||R>c)return 0;if(s?.decayFunction===A.Constant)return 1;if(s?.decayFunction===A.CustomSteps){let o=Math.floor(R),a=s?.steps??[];return o>=a.length?0:a[o]}return 1-R/c};a.getCategoryScoreByDistance=getCategoryScoreByDistance;let categoryDistanceGrader=(o,a,s,c,g,k)=>({categoryDistance:R.gradeIfNotMissing((o,a)=>[F.TextCollectionFieldType.Category,F.TextCollectionFieldType.Number,F.TextCollectionFieldType.Autocomplete].includes(a.type)&&shouldGradeField(a.field_id,c?.fieldsWhitelist||k?.fieldsWhitelist,!!o.fieldWasReadOnly)?{correctWork:x.default.sum(o.response.map(o=>o.result===G.GraderResult.Correct?1:o.result===G.GraderResult.Incorrect?a.type===F.TextCollectionFieldType.Category?getCategoryScoreByDistance(o.expected,o.given,c):getCategoryScoreByDistance([o.expected],[o.given],c):0)),totalWork:a.response.length}:{correctWork:0,totalWork:0},o,a)});a.categoryDistanceGrader=categoryDistanceGrader;let z=Object.freeze({textCollection:{taskTypes:[P.TaskType.TextCollection],title:"text content",graderFn:R.gradePerFrame((o,a,s,c,g,k)=>({textFieldContent:R.gradeIfNotMissing((o,a)=>shouldGradeField(a.field_id,c?.fieldsWhitelist||k?.fieldsWhitelist,!!o.fieldWasReadOnly)?gradeByMatchingResult(singleGraderFn,c)(o,a):{correctWork:0,totalWork:0},o,a)}))},textCategoryFullChoicePath:{taskTypes:[P.TaskType.TextCollection],title:"full choice path",graderFn:R.gradePerFrame((o,a,s,c,g,k)=>{let A=c?.fieldsWhitelist||k?.fieldsWhitelist,graderFn=(o,a)=>a.type===F.TextCollectionFieldType.Category&&(x.default.isNil(A)||A.includes(o.field_id))&&!o.fieldWasReadOnly?gradeByMatchingResult(categoryFieldFullPathGrader,c)(o,a):{correctWork:0,totalWork:0},P=x.default.isEqual(c?.iouWeights,W);return R.gradeForAcceptedAnnotations(o,a,(o,a)=>({[`fullChoicePath${P?"ConfirmationRate":""}`]:graderFn(o,a)}),s&&s.acceptedAnnotationMatchIndexes)})},tokenIOUText:{taskTypes:[P.TaskType.TextCollection],title:"token iou text grader",graderFn:R.gradePerFrame(tokenIOUTextGrader)},gradientGrader:{taskTypes:[P.TaskType.TextCollection],title:"gradient grader",graderFn:R.gradePerFrame((o,a,s,c,g,k)=>({textFieldContent:R.gradeIfNotMissing((o,a)=>{if(!shouldGradeField(a.field_id,c?.fieldsWhitelist||k?.fieldsWhitelist,!!o.fieldWasReadOnly))return{correctWork:0,totalWork:0};{let s={gradientList:["1","2","3","4","5"],fieldsWhitelist:[]};return c&&(s=c),gradeByGradient(s)(o,a)}},o,a)}))},rankingOrderFieldGrader:{taskTypes:[P.TaskType.TextCollection],title:"ranking order field grader",graderFn:R.gradePerFrame((o,a,s,c,g,k)=>({textFieldContent:R.gradeIfNotMissing((o,g)=>shouldGradeField(g.field_id,c?.fieldsWhitelist||k?.fieldsWhitelist,!!o.fieldWasReadOnly)&&a?.type===F.TextCollectionFieldType.RankingOrder?gradeByMatchingResult(rankingOrderFieldGraderFn,c)(o,g,s,c):{correctWork:0,totalWork:0},o,a)}))},clampedEditDistanceWithFallback:{taskTypes:[P.TaskType.TextCollection],title:"clamped alphanumeric edit distance grader that falls back to textcollection",graderFn:R.gradePerFrame((o,a,s,c,g,k)=>({textFieldContent:R.gradeIfNotMissing((o,a)=>shouldGradeField(a.field_id,c?.fieldsWhitelist||k?.fieldsWhitelist,!!o.fieldWasReadOnly)?gradeByMatchingResult(clampedEditDistanceFallbackFn,c)(o,a):{correctWork:0,totalWork:0},o,a)}))},numericValueWithFallback:{taskTypes:[P.TaskType.TextCollection],title:"numeric value grader that falls back to textcollection",graderFn:R.gradePerFrame((o,a,s,c,g,k)=>({textFieldContent:R.gradeIfNotMissing((o,a)=>shouldGradeField(a.field_id,c?.fieldsWhitelist||k?.fieldsWhitelist,!!o.fieldWasReadOnly)?gradeByMatchingResult(numericValueFallbackFn,c)(o,a):{correctWork:0,totalWork:0},o,a)}))},categoryDistance:{taskTypes:[P.TaskType.TextCollection],title:"category distance",graderFn:R.gradePerFrame(categoryDistanceGrader)}});a.textCollectionGraders=z,a.default=z},909452:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var c=s(167469),g=s(991984);let k=Object.freeze({transcriptionContent:{taskTypes:[c.TaskType.Transcription],title:"transcription content",graderFn:g.gradePerFrame((o,a)=>({transcriptionContent:g.gradeIfNotMissing((o,a)=>g.gradeFreeText(o.value,a.value),o,a)}))}});a.default=k},168212:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.isLSS=function(o,a,s){return!!a&&!!s&&o.taskType===k.TaskType.LidarSegmentation},a.parseIntersectionKey=function(o){let a=o.split("_");if(5!==a.length)return null;let[s,c,g,k,A]=a;return{frame:parseInt(s),source:c,dest:g,sourceId:k,destId:A}},a.convertMatchedLidarSemsegLabelDeltaToLidarSemsegLabelDelta=function(o){return g.default.omit(o,"totalPoints","isMatch")},a.getDeltaKey=getDeltaKey,a.buildLabelDeltaWeightingMap=buildLabelDeltaWeightingMap,a.getWeightingForDelta=getWeightingForDelta,a.aggregateClassResults=aggregateClassResults,a.averageClassResults=averageClassResults,a.upsertClassResults=upsertClassResults,a.generateLssMetrics=a.generatePerIndexInfo=a.generateMatchedDeltas=a.generateLabelIntersections=a.buildLSSCounts=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(825555),x=s(297393),P=s(810755);a.buildLSSCounts=({startSource:o,endSource:a,frame:s,startLabels:c,endLabels:g,intersectionMap:k=new Map,pointWeights:A})=>{if(c.length!==g.length)throw Error(`Unexpected length, start had ${c.length}, end had ${g.length}`);let x=c.length,P={};for(let o=0;o<x;o++){let a=c[o],s=g[o];P[a]||(P[a]={}),P[a][s]||(P[a][s]=0);let k=A?A[o]:1;P[a][s]+=k}for(let c in P)for(let g in P[c]){let A=`${s}_${o}_${a}_${c}_${g}`;k.set(A,P[c][g])}return k};let generateLabelIntersections=({graderParams:o,pointIntersections:a,distanceWeightedPointIntersections:s,currentInfoMap:c,correctInfoMap:k})=>{let x=[A.ResponseSource.Current,A.ResponseSource.Correct],P=new Date,w=g.default.omitBy({project:o?.project?.toString(),subtask:o?.subtask?.toString(),attempt:o?.attempt?.toString(),graderSource:o?.source},g.default.isNil),F=[];return a.forEach((o,a)=>{let[g,R,D,G,B]=a.split("_");if(!x.includes(R)||!x.includes(D))return;let W=parseInt(g),z=R===A.ResponseSource.Correct,V=parseInt(z?G:B),U=parseInt(z?B:G),K=c[U],Y=k[V];K&&Y&&F.push({correctLabelIndex:V,currentLabelIndex:U,currentLabel:K.label,correctLabel:Y.label,currentIsInstance:K.instance,correctIsInstance:Y.instance,pointCount:o,distanceWeightedPointCount:s?s.get(a):void 0,frame:W,gradedAt:P,...w})}),F};function getDeltaKey(o){return`${o.currentLabelIndex}-${o.correctLabelIndex}`}a.generateLabelIntersections=generateLabelIntersections;let generateMatchedDeltas=o=>{let a=g.default.groupBy(o,o=>o.frame),s=g.default.map(g.default.groupBy(o,getDeltaKey),o=>{let a=g.default.omit(o[0],"frame","pointCount","distanceWeightedPointCount"),s=g.default.sumBy(o,o=>o.distanceWeightedPointCount??o.pointCount);return Object.assign({},a,{totalPointsAcrossFrames:s})}),c={},k={};s.forEach(o=>{o.correctLabel===o.currentLabel&&(c[o.currentLabelIndex]+=o.totalPointsAcrossFrames,k[o.correctLabelIndex]+=o.totalPointsAcrossFrames)});let A=g.default.groupBy(s,o=>o.correctLabelIndex),x={},P={};function setMatch(o){x[o.correctLabelIndex]=o,P[o.currentLabelIndex]=o,o.isMatch=!0}function isEligibleMatch(o){return o.currentLabel===o.correctLabel&&!x[o.correctLabelIndex]&&!P[o.currentLabelIndex]}let w=g.default.sortBy(g.default.keys(A),o=>{let a=A[o];return -1*g.default.sumBy(a,o=>o.totalPointsAcrossFrames??0)});return w.forEach(o=>{let a=A[o];if(!a.length)return;let s=a[0];if(x[s.correctLabelIndex])return;let c=a.filter(isEligibleMatch);if(!c.length)return;let P=c[0];if(!P.correctIsInstance){setMatch(P);return}let w=k[s.correctLabelIndex],F=g.default.maxBy(c,o=>0===w?o.correctLabelIndex===o.currentLabelIndex:o.totalPointsAcrossFrames/(w||1));F&&setMatch(F)}),g.default.mapValues(a,o=>{let a=g.default.groupBy(o,o=>o.correctLabelIndex),s=g.default.mapValues(a,o=>g.default.sumBy(o,o=>o.distanceWeightedPointCount??o.pointCount)),c={};return g.default.forEach(a,(o,a)=>{let k=g.default.toNumber(a),A=x[k],P=s[k],w=o.map(o=>g.default.assign({isMatch:!!A&&o.currentLabelIndex===A.currentLabelIndex,totalPoints:P},o));c[k]=w}),c})};function buildLabelDeltaWeightingMap(o){let a={};return o?.forEach(({correctedLabel:o,originalLabel:s,weight:c})=>{a[o]||(a[o]={}),a[o][s]=c}),a}function getWeightingForDelta(o,a){return a[o.correctLabel]?.[o.currentLabel]??1}a.generateMatchedDeltas=generateMatchedDeltas;let generatePerIndexInfo=o=>{let a={};return o.forEach(o=>{let{label:s,index:c,instance:g}=o.props;a[c]={label:s,instance:!!g,index:c}}),a};a.generatePerIndexInfo=generatePerIndexInfo;let generateLssMetrics=async({context:o,currentAnnotations:a,correctAnnotations:s,graderParams:c,labelDeltaWeighting:k})=>{let A=buildLabelDeltaWeightingMap(k),w=x.getPointIntersections(o),F=await x.getPointIntersectionsWeighted(o),R=generatePerIndexInfo(a),D=generatePerIndexInfo(s),G=generateLabelIntersections({graderParams:c,pointIntersections:w,distanceWeightedPointIntersections:F,currentInfoMap:R,correctInfoMap:D});P.assertDefined(G,{message:"Could not get label intersections"});let B=generateMatchedDeltas(G),W={};return g.default.forEach(B,o=>{g.default.forEach(o,o=>{g.default.forEach(o,o=>{let a=getWeightingForDelta(o,A);upsertClassResults(o,W,a)})})}),{classResults:g.default.mapValues(W,o=>averageClassResults(o)),averagedClassResult:averageClassResults(aggregateClassResults(g.default.values(W)))}};function aggregateClassResults(o){let a=emptyClassResults();return o.forEach(o=>{g.default.forEach(o,(o,s)=>{a[s]+=o})}),a}function averageClassResults(o){return Object.assign({weightedAverage:function(o){let a=o.weightedNumUnion;return 0===a?1:Math.min(o.weightedNumIntersection/a,1)}(o)},o)}function upsertClassResults(o,a,s){upsertClassResultsHelper(o,a,s,!0),upsertClassResultsHelper(o,a,s,!1)}function upsertClassResultsHelper(o,a,s,c){let g=o[c?"currentLabel":"correctLabel"];a[g]||(a[g]=emptyClassResults());let k=a[g],A=o.distanceWeightedPointCount??o.pointCount,x=A*s;k[c?"weightedNumOriginal":"weightedNumExpected"]+=x,o.isMatch&&!c?(k.weightedNumIntersection+=x,k.weightedNumUnion+=x):o.isMatch||(k.weightedNumUnion+=x)}function emptyClassResults(){return{weightedNumOriginal:0,weightedNumExpected:0,weightedNumIntersection:0,weightedNumUnion:0}}a.generateLssMetrics=generateLssMetrics},438614:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getAnnotationWeight=a.pointCountScalingFns=a.isPointCountScalerParams=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(167469),A=s(825555),x=s(709296);let P={multiplier:1,intercept:0},w=[0,.2,1];a.isPointCountScalerParams=o=>g.default.isPlainObject(o)&&g.default.isNumber(o?.multiplier)&&g.default.isNumber(o?.intercept);let getMultiplierAndIntercept=o=>({multiplier:o?.multiplier??P.multiplier,intercept:o?.intercept??P.intercept}),constructScalingFn=o=>(a,s)=>{let{multiplier:c,intercept:g}=getMultiplierAndIntercept(s);return c*o(a)+g},F={linear:constructScalingFn(g.default.identity),logarithmic:constructScalingFn(o=>Math.max(Math.log(o),0)),squareRoot:constructScalingFn(Math.sqrt)};a.pointCountScalingFns=F;let getNumFrames=o=>{let getAnnotationFrameLength=o=>g.default.size(o?.frames);return getAnnotationFrameLength(o.correctAnnotation)||getAnnotationFrameLength(o.currentAnnotation)||getAnnotationFrameLength(o.previousAnnotation)},getLidarAnnotationWeight=(o,a,s,c)=>{let g=s.disableWeightByNumFrames?1:getNumFrames(o),{correctAnnotation:k,currentAnnotation:x,previousAnnotation:P,metadata:F}=o,R=k?.props?.stationary??F?.props?.stationary??x?.props?.stationary??P?.props?.stationary,D=s?.perLabelWeights?.[c],G=s?.defaultWeight,B=A.isGraderWeighterConfig(D)?D:A.isGraderWeighterConfig(G)?G:void 0,[W,z,V]=B?[B.perCuboid,B.perStationaryCuboidFrame,B.perDynamicCuboidFrame]:w;return(R?z:V)*g+W},getVideoAnnotationWeight=(o,a,s)=>{let c=!!s?.disableWeightByNumFrames;if(c)return 1;let g=getNumFrames(o);return g},getImageAnnotationWeight=()=>1,defaultAnnotationWeight=()=>1,R={[k.TaskType.Annotation]:getImageAnnotationWeight,[k.TaskType.Categorization]:()=>1,[k.TaskType.CuboidAnnotation]:getImageAnnotationWeight,[k.TaskType.DocumentTranscription]:()=>1,[k.TaskType.EllipseAnnotation]:getImageAnnotationWeight,[k.TaskType.EventAnnotation]:()=>1,[k.TaskType.GlobalAttribute]:()=>1,[k.TaskType.ImageAnnotation]:getImageAnnotationWeight,[k.TaskType.LidarAnnotation]:getLidarAnnotationWeight,[k.TaskType.LidarPointAnnotation]:getLidarAnnotationWeight,[k.TaskType.LidarStitching]:getLidarAnnotationWeight,[k.TaskType.LidarSegmentation]:(o,a,s)=>{let c=s?.pointCountWeighting&&F?.[s.pointCountWeighting];if(c){let getNumPointsPerFrame=o=>o?.frames&&g.default.map(o.frames,o=>o.numPoints),a=getNumPointsPerFrame(o.correctAnnotation)||getNumPointsPerFrame(o.currentAnnotation)||getNumPointsPerFrame(o.previousAnnotation);return g.default.sumBy(a,o=>c(o,s?.params?.pointCountScalerParams))}return getNumFrames(o)},[k.TaskType.LineAnnotation]:(o,a,s)=>{let c=!!s?.disableWeightByNumFrames;return c?1:getNumFrames(o)},[k.TaskType.NamedEntityRecognition]:()=>1,[k.TaskType.PointAnnotation]:getImageAnnotationWeight,[k.TaskType.PolygonAnnotation]:getImageAnnotationWeight,[k.TaskType.SegmentAnnotation]:o=>{let a=g.default.get(o,"correctAnnotation.props.perimeter"),s=g.default.get(o,"previousAnnotation.props.perimeter"),c=g.default.get(o,"currentAnnotation.props.perimeter");return a||s||c||1},[k.TaskType.SensorFusionText]:(o,a,s)=>{let c=x.maybeGetFirstFrame(o.currentAnnotation),g=x.maybeGetFirstFrame(o.correctAnnotation),k=x.maybeGetFirstFrame(o.previousAnnotation),A=!!c&&x.isTextClipAnnotation(c),P=!!g&&x.isTextClipAnnotation(g),w=!!k&&x.isTextClipAnnotation(k),F=A||P||w;return"missingWithTextAnnotation"===s.type||"extraneousWithTextAnnotation"===s.type||"textClipTiming"===s.type||"textClipTextAccuracy"===s.type?F?1:0:"labels"===s.type&&F?0:1},[k.TaskType.VideoAnnotation]:getVideoAnnotationWeight,[k.TaskType.VideoBoxAnnotation]:getVideoAnnotationWeight,[k.TaskType.VideoCuboidAnnotation]:getVideoAnnotationWeight,[k.TaskType.VideoPolygonAnnotation]:getVideoAnnotationWeight,[k.TaskType.TextCollection]:()=>1,[k.TaskType.Transcription]:()=>1,[k.TaskType.MultiModalTranscription]:()=>1,[k.TaskType.Chat]:()=>1};a.getAnnotationWeight=(o,a,s,c)=>{let g=R?.[a.taskType]||defaultAnnotationWeight;return g(o,a,s,c)}},407232:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.aggregatedErrorScoreKeys=a.ErrorScoreAggregatorName=void 0,a.ErrorScoreAggregatorName=s,(c=s||(a.ErrorScoreAggregatorName=s={})).SimpleSum="simple_sum",c.RapidSemseg="rapid_semseg",c.CapByGraderType="cap_by_grader_type",c.ThresholdedSum="thresholded_sum",c.BeeCuboidsSum="bee_cuboids_sum",c.TextCollectionBinary="text_collection_binary",a.aggregatedErrorScoreKeys=["correctWork","correctWork","totalWork","relativeCorrectWork","relativeTotalWork","introducedErrorCorrectWork","gradedUncorruptedWork"]},440169:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.vertexToArr=vertexToArr,a.radianDifference=function(o,a){return Math.abs(normalizeToNegPiPi(o-a))},a.interpolatePointsSegmentsLinear=interpolatePointsSegmentsLinear,a.calcMinDist=function(o,a){let s=vertexToArr(c.default.first(o)),g=vertexToArr(c.default.last(o)),k=vertexToArr(c.default.first(a)),A=vertexToArr(c.default.last(a));return Math.min(findDistance(s,k)+findDistance(g,A),findDistance(s,A)+findDistance(g,k))},a.calculateEndpointDistance=function(o,a){let s=vertexToArr(c.default.first(o)),g=vertexToArr(c.default.last(o)),k=vertexToArr(c.default.first(a)),A=vertexToArr(c.default.last(a));return Math.min(Math.max(findDistance(s,k),findDistance(g,A)),Math.max(findDistance(s,A),findDistance(g,k)))},a.nearestPointOnSegment=nearestPointOnSegment,a.vertexSqDistanceToSegment=vertexSqDistanceToSegment,a.lineInMargin=function(o,a,s){let g=a.slice(0,-1).map((o,s)=>[o,a[s+1]]);o=interpolatePointsLinear(o);let k=vertexInMarginGen(g,s),A=c.default.every(o,o=>k(o));return A},a.loopBackToStart=function(o){return o.map(o=>[...o,o[0]])},a.lineListInMargin=function(o,a,s){if(c.default.isEmpty(a))return!0;let g=a.map(o=>o.slice(0,-1).map((a,s)=>[a,o[s+1]])).flat(),k=o.map(o=>interpolatePointsLinear(o)).flat(),A=vertexInMarginGen(g,s),x=c.default.every(k,o=>A(o));return x},a.getAmountOfLineInMargin=function(o,a,s){let g=a.slice(0,-1).map((o,s)=>[o,a[s+1]]);o=interpolatePointsLinear(o);let k=vertexInMarginGen(g,s),A=c.default.filter(o,o=>k(o));return a=interpolatePointsLinear(a),{numUserPoints:o.length,numUserPointsInMargin:A.length,numCorrectPoints:a.length}},a.getLengthOfLineInMargin=function(o,a,s){let g=a.slice(0,-1).map((o,s)=>[o,a[s+1]]),k=interpolatePointsSegmentsLinear(o),A=vertexInMarginGen(g,s),x=c.default.filter(k,o=>A(o.point)),P=c.default.sumBy(x,o=>o.pixelLength),w=c.default.sumBy(k,o=>o.pixelLength),F=c.default.sumBy(g,o=>findDistance(vertexToArr(o[0]),vertexToArr(o[1])));return{lengthCorrectUserLine:P,lengthTotalUserLine:w,lengthTotalCorrectLine:F}},a.getLengthOfLineInMarginZCoordinate=function(o,a,s,g){let A=a.slice(0,-1).map((o,s)=>[o,a[s+1]]),x=interpolatePointsSegmentsLinear(o),P=A.map(o=>{let[a,s]=o;if(c.default.isNil(a.worldZ)||c.default.isNil(s.worldZ))throw Error("Z coordinate is not defined");return[{...a,z:a.worldZ},{...s,z:s.worldZ}]}),w=x.map(o=>{let{point:a,pixelLength:s}=o;if(c.default.isNil(a.worldZ))throw Error("Z coordinate is not defined");return{point:{...a,z:a.worldZ},pixelLength:s}}),F=function(o,a,s){let g=new k.default(o.length);for(let[a,c]of o){let o=Math.min(a.x,c.x),k=Math.max(a.x,c.x),A=Math.min(a.y,c.y),x=Math.max(a.y,c.y);g.add(o-s,A-s,k+s,x+s)}return g.finish(),s=>{let k=g.search(s.x,s.y,s.x,s.y),A=c.default.map(k,a=>({distance:vertexSqDistanceToSegment(s,o[a]),idx:a,nearestPoint:nearestPointOnSegment(s,o[a])})),x=c.default.minBy(A,o=>o.distance);if(!x)return!1;let{idx:P,nearestPoint:w}=x,F=function(o,a){let{x:s,y:c}=o,[{x:g,y:k,z:A},{x:x,y:P,z:w}]=a;if(g!==x&&(s<Math.min(g,x)||s>Math.max(g,x))||k!==P&&(c<Math.min(k,P)||c>Math.max(k,P)))throw Error("The point does not lie on the line segment.");let F=Math.sqrt((s-g)**2+(c-k)**2)/Math.sqrt((x-g)**2+(P-k)**2);return A+F*(w-A)}(w,o[P]);return Math.abs(F-s.z)<=a}}(P,s,g),R=c.default.filter(w,o=>F(o.point)),D=c.default.sumBy(R,o=>o.pixelLength),G=c.default.sumBy(x,o=>o.pixelLength),B=c.default.sumBy(A,o=>findDistance(vertexToArr(o[0]),vertexToArr(o[1])));return{lengthCorrectUserLine:D,lengthTotalUserLine:G,lengthTotalCorrectLine:B}},a.idsMatch=a.addRadians=a.normalizeToNegPiPi=a.findDistance=a.findDistance2=a.getExtendedCuboidDirection=a.getCuboidVertices=a.getCuboidSideFaceVertices=a.getCuboidFrontFaceVertices=a.getCuboidFrontFaceAsBox=a.formatCuboidAnnotation=a.projectedPointFromCuboid=a.discreteFrechetDistance=a.midpoint=a.rotatedBoxIou=a.boxIou=a.getPolygonPerimeter=a.fragmentsIou=a.genericIou=a.genericIouNucleus=a.iouWithBuffer=a.polygonListIou=a.iou=a.polygonListPolyboolIou=a.polyboolIou=a.geoJsonFor=a.polygonFor=a.geometryFactory=a.geom=a.ACCURACY_THRESHOLD=a.POLYGON_DIFF_THRESHOLD=a.MARGIN_OF_ERROR_FOR_CUBOIDANNOTATION=a.MARGIN_OF_ERROR_FOR_ANNOTATION=void 0;var c=_interopRequireDefault(s(298784)),g=function(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}(s(593539)),k=_interopRequireDefault(s(533637)),A=s(903779),x=_interopRequireDefault(s(132764)),P=_interopRequireDefault(s(373291)),w=s(60271),F=_interopRequireDefault(s(378970));function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}a.MARGIN_OF_ERROR_FOR_ANNOTATION=10,a.MARGIN_OF_ERROR_FOR_CUBOIDANNOTATION=95,a.POLYGON_DIFF_THRESHOLD=.7,a.ACCURACY_THRESHOLD=.9;let R=g.geom;a.geom=R;let D=new R.GeometryFactory;a.geometryFactory=D;let polygonFor=o=>{let a=c.default.map(c.default.concat(o.vertices,[o.vertices[0]]),o=>new R.Coordinate(o.x,o.y));return D.createPolygon(D.createLinearRing(a),[])};a.polygonFor=polygonFor;let geoJsonFor=o=>{let a=o.vertices.map(o=>[o.x,o.y]);return a.push(a[0]),P.default.polygonFromGeoJSON(A.polygon([a]).geometry)};a.geoJsonFor=geoJsonFor;let polyboolIou=(o,a)=>{let s=P.default.intersect(o,a),c=P.default.union(o,a),g=x.default(P.default.polygonToGeoJSON(s)),k=x.default(P.default.polygonToGeoJSON(c));return g&&k?g/k:0};a.polyboolIou=polyboolIou;let polygonListPolyboolIou=(o,a)=>{let s;let g=F.default(o,a),k=0;c.default.each(g,([o,a])=>{let s=P.default.intersect(o,a),c=x.default(P.default.polygonToGeoJSON(s));k+=c}),c.default.each([...o,...a],o=>{s=s?P.default.union(s,o):o});let A=x.default(P.default.polygonToGeoJSON(s));return k&&A?k/A:0};a.polygonListPolyboolIou=polygonListPolyboolIou;let iou=(o,a)=>{let s=o.intersection(a);if(!s?.getArea())return 0;let c=o.union(a);return c?s.getArea()/c.getArea():0};a.iou=iou;let polygonListIou=(o,a)=>{let s;let g=F.default(o,a),k=0;return c.default.each(g,([o,a])=>{let s=o.intersection(a);s&&(k+=s.getArea())}),c.default.each([...o,...a],o=>{s=s?o.union(s):o}),s?k/s.getArea():0};a.polygonListIou=polygonListIou;let iouWithBuffer=(o,a)=>{let s=o.buffer(0).intersection(a.buffer(0)),c=o.buffer(0).union(a.buffer(0));return s&&c?s.getArea()/c.getArea():0};a.iouWithBuffer=iouWithBuffer,a.genericIouNucleus=(o,a)=>{let s=polygonFor(o),c=polygonFor(a);try{let o=iou(s,c);return Number.isNaN(o)||!isFinite(o)?0:o}catch(a){let o=iouWithBuffer(s,c);return Number.isNaN(o)||!isFinite(o)?0:o}};let genericIou=(o,a)=>{try{let s=polygonFor(o),c=polygonFor(a);return iou(s,c)}catch(s){try{let s=polygonFor(o).buffer(.001),c=polygonFor(a).buffer(.001);return iou(s,c)}catch(g){let s=geoJsonFor(o),c=geoJsonFor(a);return polyboolIou(s,c)}}};a.genericIou=genericIou,a.fragmentsIou=(o,a)=>{try{let s=o.map(o=>polygonFor(o)),c=a.map(o=>polygonFor(o));return polygonListIou(s,c)}catch(s){try{let s=o.map(o=>polygonFor(o).buffer(.001)),c=a.map(o=>polygonFor(o).buffer(.001));return polygonListIou(s,c)}catch(g){let s=o.map(geoJsonFor),c=a.map(geoJsonFor);return polygonListPolyboolIou(s,c)}}},a.getPolygonPerimeter=o=>{if(o.vertices.length<3)return 1;let a=polygonFor(o);return a?.getLength()||1},a.boxIou=(o,a)=>{let s=o.rotation??0,c=a.rotation??0;if(0!==s||0!==c)return rotatedBoxIou(o,a);let g=Math.max(o.left,a.left),k=Math.min(o.left+o.width,a.left+a.width),A=Math.max(o.top,a.top),x=Math.min(o.top+o.height,a.top+a.height),P=Math.max(0,k-g)*Math.max(0,x-A),w=o.width*o.height+a.width*a.height-P;return P/w};let rotatedBoxIou=(o,a)=>{let s=w.getRotatedVertices({height:o.height,width:o.width,rotation:o.rotation??0,center:{x:o.left+o.width/2,y:o.top+o.height/2},returnMidpoints:!1}),c=w.getRotatedVertices({height:a.height,width:a.width,rotation:a.rotation??0,center:{x:a.left+a.width/2,y:a.top+a.height/2},returnMidpoints:!1}),g=genericIou({vertices:s},{vertices:c});return g};a.rotatedBoxIou=rotatedBoxIou;let cuboidEdgeLength=o=>{if(!o)return 0;let a=c.default.get(o,"x1"),s=c.default.get(o,"x2"),g=c.default.get(o,"y1"),k=c.default.get(o,"y2");return Math.pow(Math.pow(a-s,2)+Math.pow(g-k,2),.5)},midpoint=(o,a)=>{let s=(o.x+a.x)/2,c=(o.y+a.y)/2;return{x:s,y:c}};a.midpoint=midpoint,a.discreteFrechetDistance=(o,a)=>{let s=discreteFrechetHelper(o,a),c=discreteFrechetHelper(o.reverse(),a);return Math.min(s,c)};let discreteFrechetHelper=(o,a)=>{let s=[...Array(o.length)].map(()=>Array(a.length));s[0][0]=findDistance(vertexToArr(o[0]),vertexToArr(a[0]));for(let c=1;c<o.length;c++)s[c][0]=Math.max(s[c-1][0],findDistance(vertexToArr(o[c]),vertexToArr(a[0])));for(let c=1;c<a.length;c++)s[0][c]=Math.max(s[0][c-1],findDistance(vertexToArr(o[0]),vertexToArr(a[c])));for(let c=1;c<o.length;c++)for(let g=1;g<a.length;g++)s[c][g]=Math.max(Math.min(s[c-1][g],s[c-1][g-1],s[c][g-1]),findDistance(vertexToArr(o[c]),vertexToArr(a[g])));return s[o.length-1][a.length-1]},intersection=(o,a)=>{if(!o||!a)return null;let{x1:s,x2:c,y1:g,y2:k}=o,{x1:A,x2:x,y1:P,y2:w}=a,F=(s-c)*(P-w)-(g-k)*(A-x);return 0===F?null:{x:((s*k-g*c)*(A-x)-(s-c)*(A*w-P*x))/F,y:((s*k-g*c)*(P-w)-(g-k)*(A*w-P*x))/F}};a.projectedPointFromCuboid=o=>{let a=midpoint(o.vertices.faceTopleft,o.vertices.faceBottomright),s=intersection(o.edges.sideTop,o.edges.sideBottom);return s||a},a.formatCuboidAnnotation=o=>{let a={edges:c.default.keyBy(o.edges,o=>c.default.camelCase(o.description)),vertices:c.default.keyBy(o.vertices,o=>c.default.camelCase(o.description)),isExtended:!!o.edges&&o.edges.length>4};return a.width=cuboidEdgeLength(a.edges.faceTop),a.height=cuboidEdgeLength(a.edges.faceLeft),a.sideHeight=cuboidEdgeLength(a.edges.sideBack)||a.height,a},a.getCuboidFrontFaceAsBox=o=>({top:o.vertices.faceTopleft.y,left:o.vertices.faceTopleft.x,height:o.vertices.faceBottomright.y-o.vertices.faceTopleft.y,width:o.vertices.faceBottomright.x-o.vertices.faceTopleft.x});let getCuboidFrontFaceVertices=o=>({vertices:[o.vertices.faceTopleft,o.vertices.faceTopright,o.vertices.faceBottomright,o.vertices.faceBottomleft]});a.getCuboidFrontFaceVertices=getCuboidFrontFaceVertices,a.getCuboidSideFaceVertices=o=>({vertices:[o.vertices.faceTopright,o.vertices.sideTopcorner,o.vertices.sideBottomcorner,o.vertices.faceBottomright]}),a.getCuboidVertices=o=>o.isExtended?{vertices:[o.vertices.faceTopleft,o.vertices.faceTopright,o.vertices.sideTopcorner,o.vertices.sideBottomcorner,o.vertices.faceBottomright,o.vertices.faceBottomleft]}:getCuboidFrontFaceVertices(o),a.getExtendedCuboidDirection=o=>{if(!o.isExtended)return null;let a=Math.abs(o.edges.sideBack.x1-o.edges.faceLeft.x1),s=Math.abs(o.edges.sideBack.x1-o.edges.faceRight.x1);return a>s?"faceRight":"faceLeft"};let findDistance2=(o,a)=>Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2);a.findDistance2=findDistance2;let findDistance=(o,a)=>Math.sqrt(findDistance2(o,a));function vertexToArr(o){return[o.x,o.y]}a.findDistance=findDistance;let normalizeToNegPiPi=o=>(o%=2*Math.PI,(o=(o+2*Math.PI)%(2*Math.PI))>Math.PI&&(o-=2*Math.PI),o);function interpolatePointsLinear(o,a=1){let s=c.default.flatten(o.map((s,g)=>{if(g===o.length-1)return[s];let k=o[g+1],A=findDistance(vertexToArr(s),vertexToArr(k)),x=c.default.ceil(A/a),P=(k.x-s.x)/x,w=(k.y-s.y)/x,F=c.default.times(x,o=>({x:s.x+o*P,y:s.y+o*w}));return F}));return s}function interpolatePointsSegmentsLinear(o,a=1){let s=c.default.flatten(o.map((s,g)=>{if(g===o.length-1)return[];let k=o[g+1],A=findDistance(vertexToArr(s),vertexToArr(k)),x=c.default.ceil(A/a),P=A/x,w=k.worldZ,F=s.worldZ,R=!c.default.isNil(w)&&!c.default.isNil(F),D=(k.x-s.x)/x,G=(k.y-s.y)/x,B=R?(w-F)/x:0,W=c.default.times(x+1,o=>({x:s.x+o*D,y:s.y+o*G,worldZ:R?F+o*B:void 0})),z=c.default.times(x,o=>{let a=W[o],s=W[o+1],g=c.default.isNil(a.worldZ)||c.default.isNil(s.worldZ)?void 0:(a.worldZ+s.worldZ)/2,k={x:(a.x+s.x)/2,y:(a.y+s.y)/2,worldZ:g};return{point:k,pixelLength:P}});return z}));return s}function vertexInMarginGen(o,a){let s=new k.default(o.length);for(let[c,g]of o){let o=Math.min(c.x,g.x),k=Math.max(c.x,g.x),A=Math.min(c.y,g.y),x=Math.max(c.y,g.y);s.add(o-a,A-a,k+a,x+a)}return s.finish(),g=>{let k=s.search(g.x,g.y,g.x,g.y);return c.default.some(k,s=>vertexSqDistanceToSegment(g,o[s])<=a*a)}}function nearestPointOnSegment(o,a){let{x:s,y:c}=o,[{x:g,y:k},{x:A,y:x}]=a,P=A-g,w=x-k,F=P*P+w*w,R=F?((s-g)*P+(c-k)*w)/F:-1;return R<0?{x:g,y:k}:R>1?{x:A,y:x}:{x:g+R*P,y:k+R*w}}function vertexSqDistanceToSegment(o,a){let{x:s,y:c}=o,{x:g,y:k}=nearestPointOnSegment(o,a),A=s-g,x=c-k;return A*A+x*x}a.normalizeToNegPiPi=normalizeToNegPiPi,a.addRadians=(o,a)=>normalizeToNegPiPi(o+a),a.idsMatch=(o,a)=>!!o?.id&&o.id===a?.id},910951:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var c=function(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}(s(814412));let BoxQuadTree=class BoxQuadTree{static fromObject(o){return new BoxQuadTree(parseNode(o.root),new Map(o.nodes.map(([o,a])=>[o,parseNode(a)])))}static empty(){return new BoxQuadTree({id:0,offset:0,count:0,depth:0,children:[],index:new Uint32Array(0),boundingBox:new c.Box3})}static fromPositions(o,a){if(0===o.length)return BoxQuadTree.empty();let s=a?.maxDepth||this.defaultOptions.maxDepth,g=a?.maxElements||this.defaultOptions.maxElements,k=Math.floor(o.length/3),A=new Uint32Array(k),x=new Uint32Array(4),P=new Uint32Array(4),w=new Uint32Array(k),F=new Uint8Array(k),R=new c.Vector3,D=new c.Vector3,G=new Map;for(let o=0;o<k;o++)A[o]=o;let createNode=(o,a,s=0)=>{let g={id:G.size,offset:o,count:a,depth:s,index:A.subarray(o,o+a),boundingBox:new c.Box3,children:[]};return G.set(g.id,g),g},split=a=>{w.set(A.subarray(a.offset,a.offset+a.count)),P.fill(0),x.fill(0),a.boundingBox.getCenter(D);for(let s=0;s<a.count;s++)F[s]=o[3*w[s]]>D.x?1:0,F[s]+=o[3*w[s]+1]>D.y?2:0,x[F[s]]++;let c=a.offset;for(let o=0;o<4;o++)P[o]=c,c+=x[o];let k=[];for(let o=0;o<4;o++){let s=createNode(P[o],x[o],a.depth+1);k.push(s)}for(let s=0;s<a.count;s++){let a=F[s];A[P[a]++]=w[s],R.fromArray(o,3*w[s]),k[F[s]].boundingBox.expandByPoint(R)}for(let o of(a.children=k,k))o.count>g&&o.depth<s&&split(o)},B=createNode(0,k);for(let a=0;a<B.count;a++)R.fromArray(o,3*(B.offset+a)),B.boundingBox.expandByPoint(R);return split(B),new BoxQuadTree(B,G)}get index(){return this.root.index}get count(){return this.root.count}getIndexForNodes(o){let a=o.reduce((o,a)=>o+a.count,0),s=0,c=new Uint32Array(a);for(let a of o)for(let o=0;o<a.count;o++)c[s++]=this.index[a.offset+o];return c}queryNodes(o,a=1/0){let s=[],visit=c=>{if(o(c)){if(0===c.children.length||c.depth>=a){s.push(c);return}c.children.forEach(o=>visit(o))}};return visit(this.root),s}queryNodesWithFull(o,a,s=1/0){let c=[],visit=g=>{if(o(g)){if(0===g.children.length||g.depth>=s||a(g)){c.push(g);return}g.children.forEach(o=>visit(o))}};return visit(this.root),c}queryIndex(o,a=1/0){return this.getIndexForNodes(this.queryNodes(o,a))}toObject(){return{root:stringifyNode(this.root),nodes:function(o,a){let s=[];for(let[c,g]of o.entries())s.push([c,a(g)]);return s}(this.nodes,stringifyNode)}}clone(){return this}constructor(o,a){this.root=o,this.nodes=a||new Map([[0,o]])}};function stringifyNode(o){return{id:o.id,count:o.count,depth:o.depth,index:o.index,offset:o.offset,boundingBox:{min:o.boundingBox.min.toArray(),max:o.boundingBox.max.toArray()},children:o.children.map(stringifyNode)}}function parseNode(o){return{id:o.id,count:o.count,depth:o.depth,index:o.index,offset:o.offset,boundingBox:new c.Box3(new c.Vector3().fromArray(o.boundingBox.min),new c.Vector3().fromArray(o.boundingBox.max)),children:o.children.map(parseNode)}}a.BoxQuadTree=BoxQuadTree,BoxQuadTree.defaultOptions={maxDepth:8,maxElements:1e3},a.default=BoxQuadTree},141971:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=_interopRequireDefault(s(298784)),g=_interopRequireDefault(s(910951));function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}let BoxTreeSelection=class BoxTreeSelection{static build(o=g.default.empty()){return new BoxTreeSelection(o)}get selectedNodeIds(){return Array.from(this.nodes.keys())}clone(){return BoxTreeSelection.build(this.boxTree).copy(this)}copy(o){if(this.boxTree!==o.boxTree)throw Error("Selections should share the same box tree.");return this.clear(),o.nodes.forEach((o,a)=>{this.nodes.set(a,{ids:o.ids?o.ids.slice():void 0,full:o.full})}),this}getNode(o){if(!this.nodes.has(o)){let a={};return this.nodes.set(o,a),a}return this.nodes.get(o)}clear(){return this.nodes.clear(),this}selectNode(o){let a=this.boxTree.nodes.get(o);return this.nodes.set(o,{ids:a.index,full:!0}),this}union(o){return this.assertComparable(o),o.nodes.forEach((o,a)=>{if(o.ids?.length){let s=this.getNode(a);s.ids?.length?s.ids=Uint32Array.from(c.default.uniq([...Array.from(s.ids),...Array.from(o.ids)])):s.ids=o.ids}}),this}intersection(o){this.assertComparable(o);let a=[];return this.nodes.forEach((s,g)=>{if(s.ids?.length&&o.nodes.has(g)){let a=o.getNode(g);s.ids=Uint32Array.from(c.default.intersection(s.ids,a.ids))}s.ids?.length&&o.nodes.has(g)||a.push(g)}),a.forEach(o=>{this.nodes.delete(o)}),this}difference(o){return this.assertComparable(o),this.nodes.forEach((a,s)=>{if(a.ids?.length&&o.nodes.has(s)){let g=o.getNode(s);g.ids?.length&&(a.ids=Uint32Array.from(c.default.difference(a.ids,g.ids)))}}),this}select(o,a){let s=this.getNode(o);return s.ids=a,this}forEach(o){this.nodes.forEach(a=>{let s=a.ids;if(s)for(let a=0;a<s.length;a++)o(s[a])})}getCount(){let o=0;return this.nodes.forEach(a=>{o+=a.ids?.length||0}),o}isEmpty(){return 0===this.getCount()}getIndex(){let o=new Uint32Array(this.getCount()),a=0;return this.nodes.forEach(s=>{s.ids&&(o.set(s.ids,a),a+=s.ids.length)}),o}constructor(o){this.assertComparable=o=>{if(this.boxTree!==o.boxTree)throw Error("Selections should share the same box tree.")},this.boxTree=o,this.nodes=new Map}};a.BoxTreeSelection=BoxTreeSelection},252575:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c={},g=_interopRequireWildcard(s(910951));Object.keys(g).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===g[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return g[o]}}))});var k=_interopRequireWildcard(s(141971));function _interopRequireWildcard(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}Object.keys(k).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===k[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return k[o]}}))})},545224:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(252575),g=s(592159),k=s(145564);let IndexedPointCloud=class IndexedPointCloud extends g.PointCloud{static fromPointCloud(o,a){if(o instanceof IndexedPointCloud)return o;let s=a?.boxQuadTree||(o.xyz?c.BoxQuadTree.fromPositions(o.xyz):c.BoxQuadTree.empty());return new IndexedPointCloud({...o,boxQuadTree:s})}static fromObject(o){let a=g.PointCloud.buildFromObject(o.pointCloud),s=c.BoxQuadTree.fromObject(o.boxQuadTree);return new IndexedPointCloud({...a,boxQuadTree:s})}toObject(){return{pointCloud:super.toJSON(),boxQuadTree:this.boxQuadTree.toObject()}}clone(){return new IndexedPointCloud({boxQuadTree:this.boxQuadTree.clone(),...super.clone()})}getFilterContext(){return{points:this.xyz,timestamps:this.pointTimestampArray,boxTree:this.boxQuadTree}}applySelection(o){return this.applyIndex(o.getIndex())}applyFilter(o){return this.applySelection(o.getSelection(this.getFilterContext()))}getIndexByFilter(o){return o.getSelection(this.getFilterContext()).getIndex()}getIndexBySmartSample(o){return this.getIndexByFilter(new k.SmartSampleFilter(o))}filterByRange(o){return this.applyFilter(new k.RangeQueryFilter(o))}getIndexByFilterByRange(o){return this.getIndexByFilter(new k.RangeQueryFilter(o))}filterByRangeAndTimestamp(o,a,s){return this.applyFilter(new k.RangeTimestampFilter(o,a,s))}filterByCuboid(o){return this.applyFilter(new k.CuboidFilter(o))}filterByNotInCuboid(o){return this.applyFilter(new k.CuboidSubtractionFilter(o))}getIndexByCuboid(o){return this.getIndexByFilter(new k.CuboidFilter(o))}filterByCuboidBorder(o,a=0,s=0,c=0){return this.applyFilter(new k.CuboidBorderFilter(o,a,s,c))}filterByPointsOutsideCuboidFace(o,a=0,s=0,c=0){return new k.CuboidBorderFilter(o,a,s,c).filterPointsInPartialExteriorBorder(this.getFilterContext())}filterByCylinder(o){return this.applyFilter(new k.CylinderFilter(o))}filterByCuboidAndTimestamp(o,a,s){return this.applyFilter(new k.HyperCuboidFilter(o,a,s))}getIndexByCuboidAndTimestamp(o,a,s){return this.getIndexByFilter(new k.HyperCuboidFilter(o,a,s))}countPointsInCuboid(o){return new k.CuboidFilter(o).countPoints(this.getFilterContext())}countPointsInCuboidAndTimestamp(o,a,s){return new k.HyperCuboidFilter(o,a,s).countPoints(this.getFilterContext())}countPointsOutsideCuboidFace(o,a=0,s=0,c=0){return new k.CuboidBorderFilter(o,a,s,c).countPointsInPartialExteriorBorder(this.getFilterContext())}constructor(o){super(o),this.boxQuadTree=o.boxQuadTree}};a.IndexedPointCloud=IndexedPointCloud},592159:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(257868);let PointCloud=class PointCloud{static buildFromObject(o){return new PointCloud({xyz:o.xyz,photoColors:o.photoColors,bloomLevel:o.bloomLevel,intensities:o.intensities,deviceIds:o.deviceIds,uniqueDeviceIds:o.uniqueDeviceIds,ids:o.ids,meta:o.meta,pointTimestampArray:o.pointTimestampArray})}static combinePointClouds(o){if(!o.length)return new PointCloud;let a={xyz:o.map(o=>o.xyz),intensities:o.map(o=>o.intensities),photoColors:o.map(o=>o.photoColors),bloomLevel:o.map(o=>o.bloomLevel),deviceIds:o.map(o=>o.deviceIds),ids:o.map(o=>o.ids),pointTimestampArray:o.map(o=>o.pointTimestampArray)},s=g.default.uniq(g.default.flatten(g.default.compact(o.map(o=>o.uniqueDeviceIds))));return new PointCloud({xyz:k.concat(a.xyz),intensities:g.default.every(a.intensities)?k.concat(g.default.compact(a.intensities)):null,photoColors:g.default.every(a.photoColors)?k.concat(g.default.compact(a.photoColors)):null,bloomLevel:g.default.every(a.bloomLevel)?k.concat(g.default.compact(a.bloomLevel)):null,deviceIds:g.default.every(a.deviceIds)?k.concat(g.default.compact(a.deviceIds)):null,ids:g.default.every(a.ids)?k.concat(g.default.compact(a.ids)):null,pointTimestampArray:g.default.every(a.pointTimestampArray)?k.concat(g.default.compact(a.pointTimestampArray)):null,uniqueDeviceIds:s,meta:o[0].meta})}toJSON(){return{xyz:this.xyz,photoColors:this.photoColors,bloomLevel:this.bloomLevel,intensities:this.intensities,deviceIds:this.deviceIds,uniqueDeviceIds:this.uniqueDeviceIds,ids:this.ids,meta:this.meta,pointTimestampArray:this.pointTimestampArray}}zeros(o){return new PointCloud({xyz:new Float32Array(3*o),intensities:this.intensities?new Float32Array(o):null,photoColors:this.photoColors?new Uint8Array(3*o):null,bloomLevel:this.bloomLevel?new Uint8Array(o):null,deviceIds:this.deviceIds?new Float32Array(o):null,ids:this.ids?new Uint32Array(o):null,pointTimestampArray:this.pointTimestampArray?new Float64Array(o):null})}randomSample(o){if(o>=this.numPoints)return this;let a=g.default.sampleSize(g.default.range(this.numPoints),o);return this.slice(a)}subPointCloud(o,a){return new PointCloud({xyz:this.xyz.subarray(3*o,3*a),intensities:this.intensities?this.intensities.subarray(o,a):null,photoColors:this.photoColors?this.photoColors.subarray(3*o,3*a):null,bloomLevel:this.bloomLevel?this.bloomLevel.subarray(o,a):null,deviceIds:this.deviceIds?this.deviceIds.subarray(o,a):null,ids:this.ids?this.ids.subarray(o,a):null,pointTimestampArray:this.pointTimestampArray?this.pointTimestampArray.subarray(o,a):null,meta:this.meta})}slice(o){return this.applyIndex(Uint32Array.from(o))}applyIndex(o){let a=this.deviceIds?k.pick(this.deviceIds,o):null,s=a?this.uniqueDeviceIds:null;return new PointCloud({xyz:k.pick(this.xyz,o,3),intensities:this.intensities?k.pick(this.intensities,o):null,photoColors:this.photoColors?k.pick(this.photoColors,o,3):null,bloomLevel:this.bloomLevel?k.pick(this.bloomLevel,o):null,deviceIds:a,uniqueDeviceIds:s,ids:this.ids?k.pick(this.ids,o):null,pointTimestampArray:this.pointTimestampArray?k.pick(this.pointTimestampArray,o):null,meta:this.meta})}clone(){return new PointCloud({xyz:this.xyz.slice(),intensities:this.intensities?this.intensities.slice():null,photoColors:this.photoColors?this.photoColors.slice():null,bloomLevel:this.bloomLevel?this.bloomLevel.slice():null,deviceIds:this.deviceIds?this.deviceIds.slice():null,uniqueDeviceIds:this.deviceIds?this.uniqueDeviceIds?.slice():null,ids:this.ids?this.ids.slice():null,pointTimestampArray:this.pointTimestampArray?this.pointTimestampArray.slice():null,meta:g.default.clone(this.meta)})}constructor(o={}){if(o.xyz=o.xyz||new Float32Array(0),!(o.xyz instanceof Float32Array))throw Error("Malformed xyz (incorrect type)");if(o.ids){if(!(o.ids instanceof Uint32Array))throw Error("Malformed ids (incorrect type)");if(o.ids.length!==o.xyz.length/3)throw Error("Malformed ids (incorrect length)")}this.numPoints=o.xyz.length/3,this.xyz=o.xyz,this.meta=o.meta,this.photoColors=o.photoColors??null,this.bloomLevel=o.bloomLevel??null,this.intensities=o.intensities??null,this.deviceIds=o.deviceIds??null,this.uniqueDeviceIds=o.uniqueDeviceIds??null,this.pointTimestampArray=o.pointTimestampArray??null,this.ids=o.ids??null,!g.default.isEmpty(this.deviceIds)&&g.default.isEmpty(this.uniqueDeviceIds)&&(this.uniqueDeviceIds=g.default.uniq(this.deviceIds))}};a.PointCloud=PointCloud},827004:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(252575);a.BaseFilter=class{selectNode(o){return!0}getIdsFromNode(o,a){return a.index}getSelection(o){let a=c.BoxTreeSelection.build(o.boxTree);return o.boxTree.queryNodes(o=>this.selectNode(o)).forEach(s=>a.select(s.id,this.getIdsFromNode(o,s))),a}}},674026:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(814412),g=s(252575),k=s(376570);let A=new c.Vector3;let CuboidBorderFilter=class CuboidBorderFilter extends k.CuboidFilter{shouldSelectId(o,a){A.set(o.points[3*a+0]-this.cuboid.position.x,o.points[3*a+1]-this.cuboid.position.y,o.points[3*a+2]-this.cuboid.position.z),A.applyMatrix3(this.rotation);let s=Math.abs(A.x),c=Math.abs(A.y),g=Math.abs(A.z),k=Math.min(this.diag[0],this.diag[0]+this.borderX),x=Math.max(this.diag[0],this.diag[0]+this.borderX),P=Math.min(this.diag[1],this.diag[1]+this.borderY),w=Math.max(this.diag[1],this.diag[1]+this.borderY),F=Math.min(this.diag[2],this.diag[2]+this.borderZ),R=Math.max(this.diag[2],this.diag[2]+this.borderZ);return s>k&&c>P&&g>F&&s<=x&&c<=w&&g<=R}shouldSelectPointInPartialExteriorBorder(o,a){if(A.set(o.points[3*a+0]-this.cuboid.position.x,o.points[3*a+1]-this.cuboid.position.y,o.points[3*a+2]-this.cuboid.position.z),A.applyMatrix3(this.rotation),this.borderX>0){let o=A.x>this.diag[0]&&A.x<=this.diag[0]+this.borderX,a=A.y>=-this.diag[1]&&A.y<=this.diag[1]&&A.z>=-this.diag[2]&&A.z<=this.diag[2];return o&&a}if(this.borderX<0){let o=A.x<-this.diag[0]&&A.x>=-this.diag[0]+this.borderX,a=A.y>=-this.diag[1]&&A.y<=this.diag[1]&&A.z>=-this.diag[2]&&A.z<=this.diag[2];return o&&a}if(this.borderY>0){let o=A.y>this.diag[1]&&A.y<=this.diag[1]+this.borderY,a=A.x>=-this.diag[0]&&A.x<=this.diag[0]&&A.z>=-this.diag[2]&&A.z<=this.diag[2];return o&&a}if(this.borderY<0){let o=A.y<-this.diag[1]&&A.y>=-this.diag[1]+this.borderY,a=A.x>=-this.diag[0]&&A.x<=this.diag[0]&&A.z>=-this.diag[2]&&A.z<=this.diag[2];return o&&a}if(this.borderZ>0){let o=A.z>this.diag[2]&&A.z>=this.diag[2]+this.borderZ,a=A.x>=-this.diag[0]&&A.x<=this.diag[0]&&A.y>=-this.diag[1]&&A.y<=this.diag[1];return o&&a}if(this.borderZ<0){let o=A.z<-this.diag[2]&&A.z>=-this.diag[2]+this.borderZ,a=A.x>=-this.diag[0]&&A.x<=this.diag[0]&&A.y>=-this.diag[1]&&A.y<=this.diag[1];return o&&a}return!1}filterPointsInPartialExteriorBorder(o){let a=g.BoxTreeSelection.build(o.boxTree);return o.boxTree.queryNodes(o=>this.selectNode(o)).forEach(s=>{let c=0,g=new Uint32Array(s.count);for(let a=0;a<s.count;a++)this.shouldSelectPointInPartialExteriorBorder(o,s.index[a])&&(g[c++]=s.index[a]);a.select(s.id,g.slice(0,c))}),a}countPointsInPartialExteriorBorder(o){let a=0;return o.boxTree.queryNodes(o=>this.selectNode(o)).forEach(s=>{for(let c=0;c<s.count;c++)this.shouldSelectPointInPartialExteriorBorder(o,s.index[c])&&a++}),a}constructor(o,a=0,s=0,c=0){super({...o,dimensions:{x:o.dimensions.x+a,y:o.dimensions.y+s,z:o.dimensions.z+c}}),this.borderX=a,this.borderY=s,this.borderZ=c,this.diag=[.5*o.dimensions.x,.5*o.dimensions.y,.5*o.dimensions.z]}};a.CuboidBorderFilter=CuboidBorderFilter},376570:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(814412),g=s(565407);let k=new c.Vector3,A=new c.Vector3,x=new c.Box3;let CuboidFilter=class CuboidFilter extends g.RangeQueryFilter{shouldSelectId(o,a){return k.set(o.points[3*a+0]-this.cuboid.position.x,o.points[3*a+1]-this.cuboid.position.y,o.points[3*a+2]-this.cuboid.position.z),k.applyMatrix3(this.rotation),k.x>=-this.diag[0]&&k.y>=-this.diag[1]&&k.z>=-this.diag[2]&&k.x<=this.diag[0]&&k.y<=this.diag[1]&&k.z<=this.diag[2]}getIdsFromNode(o,a){let s=new Uint32Array(a.count),c=0;for(let g=0;g<s.length;g++)this.shouldSelectId(o,a.index[g])&&(s[c++]=a.index[g]);return s.slice(0,c)}countPoints(o){let a=0;return o.boxTree.queryNodes(this.selectNode).forEach(s=>{for(let c=0;c<s.index.length;c++)this.shouldSelectId(o,s.index[c])&&a++}),a}constructor(o){super(function(o){x.makeEmpty();let a=getRotation(o);for(let s=0;s<=1;s++)for(let c=0;c<=1;c++)for(let g=0;g<=1;g++)k.set(s,c,g).subScalar(.5).multiply(A.set(o.dimensions.x,o.dimensions.y,o.dimensions.z)).applyMatrix3(a).add(A.set(o.position.x,o.position.y,o.position.z)),x.expandByPoint(k);return{minX:x.min.x,maxX:x.max.x,minY:x.min.y,maxY:x.max.y,minZ:x.min.z,maxZ:x.max.z}}(o)),this.cuboid=o,this.rotation=getRotation(o),this.diag=[.5*o.dimensions.x,.5*o.dimensions.y,.5*o.dimensions.z]}};function getRotation({yaw:o,pitch:a,roll:s}){let g=new c.Euler(-(a||0),s||0,o,"ZYX"),k=new c.Matrix4().makeRotationFromEuler(g);return new c.Matrix3().setFromMatrix4(k).transpose()}a.CuboidFilter=CuboidFilter},467913:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(814412),g=s(376570);let k=new c.Vector3;let CuboidSubtractionFilter=class CuboidSubtractionFilter extends g.CuboidFilter{shouldSelectId(o,a){return k.set(o.points[3*a+0]-this.cuboid.position.x,o.points[3*a+1]-this.cuboid.position.y,o.points[3*a+2]-this.cuboid.position.z),k.applyMatrix3(this.rotation),k.x<-this.diag[0]||k.y<-this.diag[1]||k.z<-this.diag[2]||k.x>this.diag[0]||k.y>this.diag[1]||k.z>this.diag[2]}constructor(o){super(o),this.cuboid=o}};a.CuboidSubtractionFilter=CuboidSubtractionFilter},71930:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(814412),g=s(565407);let k=new c.Vector3;let CylinderFilter=class CylinderFilter extends g.RangeQueryFilter{getIdsFromNode(o,a){let s=this.cylinder.radius*this.cylinder.radius,c=0,g=new Uint32Array(a.count);for(let A=0;A<g.length;A++)k.set(o.points[3*a.index[A]+0]-this.cylinder.center[0],o.points[3*a.index[A]+1]-this.cylinder.center[1],o.points[3*a.index[A]+2]-this.cylinder.center[2]),k.x*k.x+k.y*k.y<s&&2*k.z>-this.cylinder.height&&2*k.z<this.cylinder.height&&(g[c++]=a.index[A]);return g.slice(0,c)}constructor(o){super({minX:o.center[0]-o.radius,maxX:o.center[0]+o.radius,minY:o.center[1]-o.radius,maxY:o.center[1]+o.radius,minZ:o.center[2]-o.height/2,maxZ:o.center[2]+o.height/2}),this.cylinder=o}};a.CylinderFilter=CylinderFilter},774371:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(376570);let HyperCuboidFilter=class HyperCuboidFilter extends c.CuboidFilter{shouldSelectId(o,a){let s=o.timestamps[a]>=this.start&&o.timestamps[a]<=this.end;return s&&super.shouldSelectId(o,a)}getIdsFromNode(o,a){if(!o.timestamps)throw Error("Cannot apply timestamp filter in this pointcloud");return super.getIdsFromNode(o,a)}constructor(o,a,s){super(o),this.start=a,this.end=s}};a.HyperCuboidFilter=HyperCuboidFilter},565407:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(814412),g=s(827004);let RangeQueryFilter=class RangeQueryFilter extends g.BaseFilter{constructor(o){super(),this.selectNode=o=>o.boundingBox.intersectsBox(this.box3),this.box3=new c.Box3(new c.Vector3(o.minX,o.minY,o.minZ),new c.Vector3(o.maxX,o.maxY,o.maxZ))}};a.RangeQueryFilter=RangeQueryFilter},243474:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(565407);let RangeTimestampFilter=class RangeTimestampFilter extends c.RangeQueryFilter{getIdsFromNode(o,a){if(!o.timestamps)throw Error("Cannot apply timestamp filter in this pointcloud");let s=new Uint32Array(a.count),c=0;for(let g=0;g<s.length;g++)o.timestamps[a.index[g]]>=this.start&&o.timestamps[a.index[g]]<=this.end&&(s[c++]=a.index[g]);return s.slice(0,c)}constructor(o,a,s){super(o),this.start=a,this.end=s}};a.RangeTimestampFilter=RangeTimestampFilter},787863:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(827004);let SampleFilter=class SampleFilter extends c.BaseFilter{getIdsFromNode(o,a){if(0===o.points.length||0===this.sampleRate)return new Uint32Array;let s=Math.floor(a.count*this.sampleRate),c=new Uint32Array(s),g=1/this.sampleRate;for(let o=0;o<s;o++)c[o]=a.index[o*g];return c}constructor(o){super(),this.sampleRate=o}};a.SampleFilter=SampleFilter},35914:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(252575);a.SmartSampleFilter=class{getSelection({boxTree:o}){let a=k.BoxTreeSelection.build(o),s=o.queryNodes(()=>!0),c=s.map(a=>Math.pow(a.count/o.count,.25)),A=g.default.sum(c);return s.forEach((s,g)=>{let k=0,x=o.count*this.sampleRate*(c[g]/A),P=s.count/x,w=new Uint32Array(2*x);for(let o=0;o<s.count&&!(k>=w.length);o+=P)w[k++]=s.index[o<<0];a.select(s.id,w.subarray(0,k))}),a}constructor(o){this.sampleRate=o}}},145564:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c={},g=_interopRequireWildcard(s(827004));Object.keys(g).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===g[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return g[o]}}))});var k=_interopRequireWildcard(s(565407));Object.keys(k).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===k[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return k[o]}}))});var A=_interopRequireWildcard(s(674026));Object.keys(A).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===A[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return A[o]}}))});var x=_interopRequireWildcard(s(376570));Object.keys(x).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===x[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return x[o]}}))});var P=_interopRequireWildcard(s(467913));Object.keys(P).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===P[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return P[o]}}))});var w=_interopRequireWildcard(s(71930));Object.keys(w).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===w[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return w[o]}}))});var F=_interopRequireWildcard(s(787863));Object.keys(F).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===F[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return F[o]}}))});var R=_interopRequireWildcard(s(35914));Object.keys(R).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===R[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return R[o]}}))});var D=_interopRequireWildcard(s(774371));Object.keys(D).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===D[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return D[o]}}))});var G=_interopRequireWildcard(s(243474));function _interopRequireWildcard(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}Object.keys(G).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===G[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return G[o]}}))})},152122:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c={};a.default=void 0;var g=_interopRequireWildcard(s(592159));Object.keys(g).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===g[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return g[o]}}))});var k=_interopRequireWildcard(s(549041));Object.keys(k).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===k[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return k[o]}}))});var A=_interopRequireWildcard(s(545224));Object.keys(A).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===A[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return A[o]}}))});var x=_interopRequireWildcard(s(198360));function _interopRequireWildcard(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}Object.keys(x).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===x[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return x[o]}}))});var P=g.PointCloud;a.default=P},198360:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0})},549041:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.normalizeIntensities=function(o){if(.005>g.default.mean(o))for(let a=0;a<o.length;a++)o[a]*=63356,o[a]=Math.tanh(o[a]);let a=g.default.max(o)||0,s=1;if(a>255?s=65536:a>1&&(s=255),s>1)for(let a=0;a<o.length;a++)o[a]/=s;for(let a=0;a<o.length;a++)isNaN(o[a])&&(o[a]=0)},a.processIntensityData=function(o,a){let s=a.mean;void 0===s&&(s=g.default.mean(o));let c=a.variance;if(void 0===c){let a=0;for(let c of o)a+=Math.pow(c-s,2);c=a/o.length}a.intensityBand=s+c};var c,g=(c=s(298784))&&c.__esModule?c:{default:c}},490063:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(o){let a=o.slice();return a.sort(POINT_COMPARATOR),function(o){if(o.length<=1)return o.slice();let a=[];for(let s of o){for(;a.length>=2;){let o=a[a.length-1],c=a[a.length-2];if((o.x-c.x)*(s.y-c.y)<(o.y-c.y)*(s.x-c.x))break;a.pop()}a.push(s)}a.pop();let s=[];for(let a=o.length-1;a>=0;a--){let c=o[a];for(;s.length>=2;){let o=s[s.length-1],a=s[s.length-2];if((o.x-a.x)*(c.y-a.y)<(o.y-a.y)*(c.x-a.x))break;s.pop()}s.push(c)}return(s.pop(),1===a.length&&1===s.length&&g.default.isEqual(a,s))?a:a.concat(s)}(a)};var c,g=(c=s(298784))&&c.__esModule?c:{default:c};function POINT_COMPARATOR(o,a){return o.x<a.x?-1:o.x>a.x?1:o.y<a.y?-1:o.y>a.y?1:0}},74909:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getEuler=getEuler,a.getToCuboidTransformationMatrix=getToCuboidTransformationMatrix,a.getEdgeVectors=getEdgeVectors,a.getHeadingVector=function(o){let a=getEuler(o),s=new g.Vector3(0,1,0).applyEuler(a);return s},a.containingPoints=containingPoints,a.cuboidsOverlap=function(o,a){return containingPoints(o.cuboidProps,getCorners(a.cuboidProps)).length>0||containingPoints(a.cuboidProps,getCorners(o.cuboidProps)).length>0},a.getCorners=getCorners,a.getEdges=getEdges,a.getVisibleCameras=function(o,a){let s=o.map((o,a)=>({camIndex:a,camera:o}));return a?s.filter(({camera:o})=>{let s=o.projectFn?o.projectFn.bind(o):F.getProjectionFunction(o);return getCorners(a).some(o=>s?.(o).visible)}):s},a.getProjectedConvexHullOnCamera=function(o,a){let s=a.projectFn;s||(s=F.getProjectionFunction(a));let c=getCorners(o),g=[],k=!0;for(let o of c){let{preDistortPosition:c,distortPosition:A,distortGood:x,visible:P}=s(o);P&&(k=!1);let w=x?A:c;w.x=Math.max(0,w.x),w.x=Math.min(a.imageWidth*(a.scale_factor||1),w.x),w.y=Math.max(0,w.y),w.y=Math.min(a.imageHeight*(a.scale_factor||1),w.y),g.push(w)}return k?[]:R.default(g)},a.transformPoint=function(o,a){let{xVector3:s,yVector3:c}=getEdgeVectors(o),k=x.parseVector3(a);k.sub(x.parseVector3(o.position));let A=s.dot(k),P=c.dot(k),w=k.z;return new g.Vector3(A,P,w)},a.naiveDistance=function(o,a){let s=x.parseVector3(o),c=x.parseVector3(a);return x.vsub(s,c).length()},a.cuboidVolume=cuboidVolume,a.cuboidsIOU=function(o,a,s=5){return c.default.round(P.computeIOU(o.position,o.dimensions,o.yaw,a.position,a.dimensions,a.yaw),s)},a.cuboidsIOV=function(o,a,s=5){let g=Math.max(0,Math.min(P.zBounds(o.position,o.dimensions).hi,P.zBounds(a.position,a.dimensions).hi)-Math.max(P.zBounds(o.position,o.dimensions).lo,P.zBounds(a.position,a.dimensions).lo)),k=P.getIntersectionPolygonArea(o.position,o.dimensions,o.yaw,a.position,a.dimensions,a.yaw),A=Math.max(cuboidVolume(o),1e-5);return c.default.round(g*k/A,s)},a.cuboidsIntersect=function(o,a){return P.computeIOU(o.position,o.dimensions,o.yaw,a.position,a.dimensions,a.yaw)>0},a.cuboidContainsCuboid=function(o,a){let s=getCorners(a);return containingPoints(o,s).length===s.length},a.cuboidContainsPoint=function(o,a){let s=getCorners(o);return s.some(o=>o.x>=a.x)&&s.some(o=>o.x<=a.x)&&s.some(o=>o.y>=a.y)&&s.some(o=>o.y<=a.y)&&s.some(o=>o.z>=a.z)&&s.some(o=>o.z<=a.z)},a.cuboidAABB=cuboidAABB,a.cuboidsPoints=function(o,a,s,c,A=0,x=0,P=0,w=!1,F=1.33){let R={},D={},G={},B=[],W=[],z=[],V={};o.forEach(o=>{o&&o.id&&(w&&(R[o.id]=[],s&&(D[o.id]=[]),c&&(G[o.id]=[])),V[o.id]=getToCuboidTransformationMatrix(o))});let U=o.map(o=>{let a=Math.min(o.extrapolatedFrameDist||0,5);return cuboidAABB(o,A+a*F,x+a*F,P+a*F)}),K=new k.RBush3D(8);K.load(U);let Y=new g.Vector3,$=new g.Vector3,X={minX:0,maxX:0,minY:0,maxY:0,minZ:0,maxZ:0};function shouldSkipPoint({cuboid:o}){if(!o||!o.id)return!0;let a=V[o.id];$.set(Y.x-o.position.x,Y.y-o.position.y,Y.z-o.position.z),$.applyMatrix3(a);let s=Math.abs($.x),c=Math.abs($.y),g=Math.abs($.z),k=Math.min(o.extrapolatedFrameDist||0,5),w=A+k*F,R=x+k*F,D=P+k*F,G=.5*o.dimensions.x+w/2,B=.5*o.dimensions.y+R/2,W=.5*o.dimensions.z+D/2;return s<-(w/2)||s>G||c<-(R/2)||c>B||g<-(D/2)||g>W}for(let o=0;o<a.length;o+=3){X.minX=X.maxX=a[o],X.minY=X.maxY=a[o+1],X.minZ=X.maxZ=a[o+2];let c=K.search(X);c.length&&(Y.set(a[o],a[o+1],a[o+2]),c.forEach(a=>{if(shouldSkipPoint(a))return;let c=a.cuboid.id;w?(R[c].push(Y.x,Y.y,Y.z),s&&D[c].push(s[o/3])):(B.push(Y.x,Y.y,Y.z),s&&W.push(s[o/3]))}))}for(let o of c??[]){X.minX=X.maxX=o.position.x,X.minY=X.maxY=o.position.y,X.minZ=X.maxZ=o.position.z;let a=K.search(X);a.length&&(Y.set(o.position.x,o.position.y,o.position.z),a.forEach(a=>{shouldSkipPoint(a)||(w?G[a.cuboid.id].push(o):z.push(o))}))}if(w){let o={};for(let a in R)o[a]={points:new Float32Array(R[a]),intensities:s?new Float32Array(D[a]):null,radar_points:c?G[a]:null};return o}{let o={points:new Float32Array(B),intensities:s?new Float32Array(W):null,radar_points:c?z:null};return o}},a.cuboidsHavePointsInPadding=function(o,a,s){let c={},A={},x=new Set(o.map(o=>o.id)),P={};o.forEach(o=>{o&&o.id&&(o.id in c||(c[o.id]=!1,A[o.id]=0),P[o.id]=getToCuboidTransformationMatrix(o))});let w=o.map(o=>cuboidAABB(o)),F=new k.RBush3D(8);F.load(w);let R=new g.Vector3,D=new g.Vector3,G={minX:0,maxX:0,minY:0,maxY:0,minZ:0,maxZ:0};for(let o=0;o<a.length&&0!==x.size;o+=3){G.minX=G.maxX=a[o],G.minY=G.maxY=a[o+1],G.minZ=G.maxZ=a[o+2];let g=F.search(G);g.length&&(R.set(a[o],a[o+1],a[o+2]),g.forEach(o=>{let a=o.cuboid;if(!a||!a.id||!x.has(a.id))return;let g=P[a.id];D.set(R.x-a.position.x,R.y-a.position.y,R.z-a.position.z),D.applyMatrix3(g);let k=Math.abs(D.x),w=Math.abs(D.y),F=Math.abs(D.z),G=.5*a.dimensions.x,B=.5*a.dimensions.y,W=.5*a.dimensions.z;if((!(k<0)||!(k>G))&&(!(w<0)||!(w>B))&&(!(F<0)||!(F>W))){if(k>=G-s||w>=B-s||F>=W-s)return x.delete(a.id),c[a.id]=!0;A[a.id]++}}))}return{pointsInPaddingById:c,pointCounts:A}},a.cuboidInsidePolygon2D=function(o,a){let s=getCorners(o);return c.default.some(s,o=>insidePolygon(o.x,o.y,a))},a.insidePolygon=insidePolygon,a.polygonContainsPolygon=function(o,a){for(let s of a)if(!insidePolygon(s.x,s.y,o))return!1;return!0},a.extendCuboid=extendCuboid,a.transformPointsToCuboid=function(o,a){let s=new Float32Array(a.length),c=[o.position.x,o.position.y,o.position.z],g=[[Math.cos(o.yaw),-Math.sin(o.yaw),0],[Math.sin(o.yaw),Math.cos(o.yaw),0],[0,0,1]];for(let o=0;o<a.length/3;o++)for(let k=0;k<3;k++){s[3*o+k]=0;for(let A=0;A<3;A++)s[3*o+k]+=(a[3*o+A]-c[A])*g[A][k]}return s},a.getCuboidMatrix4=function(o){let{x:a,y:s,z:c}=o.position,k=new g.Matrix4().makeRotationFromEuler(getEuler(o)),A=new g.Matrix4().makeTranslation(a,s,c);return A.multiply(k)},a.applyMatrix4Transform=function(o,a){let s=new g.Vector3,c=new g.Quaternion,k=new g.Vector3;a.decompose(s,c,k);let A=new g.Euler().setFromQuaternion(c,"ZYX");o.position={x:s.x,y:s.y,z:s.z},o.pitch=-A.x,o.roll=A.y,o.yaw=A.z},a.matchCloseCuboids=function(o,a,s=.2,g=.9){let k={};a.forEach(o=>k[o.id]=o);let x={};for(let a in o.forEach(o=>{o.id in k&&delete k[o.id]}),o.forEach(o=>{for(let a in k){let c=k[a],w=A.distance3D(c.position,o.position);if(w>s)return;let F=P.computeIOU(o.position,o.dimensions,o.yaw,c.position,c.dimensions,c.yaw);!(F>g)||o.id in x&&!(x[o.id].iou<F)||(x[o.id]={iou:F,cuboid:c})}}),x){let o=x[a].cuboid;x[o.id]={cuboid:o,iou:0}}return c.default.values(x).map(o=>o.cuboid.id)},a.getCuboidHalves=function(o){let{xVector3:a,yVector3:s}=getEdgeVectors(o);a.multiplyScalar(o.dimensions.x/4),s.multiplyScalar(o.dimensions.y/4);let g=c.default.cloneDeep(o);addTo(g.position,a),g.dimensions.x/=2;let k=c.default.cloneDeep(o);subtractFrom(k.position,a),k.dimensions.x/=2;let A=c.default.cloneDeep(o);addTo(A.position,s),A.dimensions.y/=2;let x=c.default.cloneDeep(o);return subtractFrom(x.position,s),x.dimensions.y/=2,{left:g,right:k,front:x,back:A}},a.createSimpleCuboidClone=function(o){let a={dimensions:{x:o.dimensions.x,y:o.dimensions.y,z:o.dimensions.z},position:{x:o.position.x,y:o.position.y,z:o.position.z},yaw:o.yaw,pitch:o.pitch,roll:o.roll,id:o.id,label:o.label};return a},a.cuboidToPlane=function(o){let a=new g.BoxGeometry(o.dimensions.x,o.dimensions.y,o.dimensions.z),s=new g.Object3D;s.position.set(o.position.x,o.position.y,o.position.z),s.rotateZ(o.yaw),s.updateMatrixWorld();let c=[a.vertices[7],a.vertices[2],a.vertices[1],a.vertices[4]].map(o=>s.localToWorld(o));return c},a.combineCuboids=combineCuboids,a.filterAreaByCuboidPaths=function(o,a,s,c,g,k=0,A=0,x=0){let P=extendCuboid(combineCuboids(o),k,A,x),F=w.IndexedPointCloud.fromPointCloud(new w.PointCloud({xyz:a,intensities:s})),R=w.IndexedPointCloud.fromPointCloud(new w.PointCloud({xyz:function(o){if(!o)return new Float32Array;let a=new Float32Array(3*o.length);for(let s=0;s<o.length;s++)a[3*s+0]=o[s].position.x,a[3*s+1]=o[s].position.y,a[3*s+2]=o[s].position.z;return a}(c)})),D=w.IndexedPointCloud.fromPointCloud(new w.PointCloud({xyz:g||new Float32Array})),G=F.getIndexByCuboid(P),B=R.getIndexByCuboid(P),W=D.filterByCuboid(P),z=F.applyIndex(G),V=[];if(c)for(let o=0;o<B.length;o++)V.push(c[B[o]]);let U={points:z.xyz,intensities:z.intensities,groundPoints:W.xyz,radar_points:c?V:null};return{pointSubset:U,pointIndices:G}},a.getCuboidName=function(o,a,s=!1){if(!o||!a)return;let g=s?c.default.truncate(o,{length:17}):o;return g+" "+c.default.split(a,"#")[0].slice(-4)},a.minDistanceLines3D=minDistanceLines3D,a.minDistanceCuboids=function(o,a){let s=getEdges(o),c=getEdges(a),g=Number.MAX_VALUE;return s.forEach(o=>{c.forEach(a=>{let s=minDistanceLines3D(o[0],o[1],a[0],a[1]);g=s<g?s:g})}),g},a.notEmpty=notEmpty,a.getCheckpoints=getCheckpoints,a.getCuboidEdges=function(o,a,s,g=20,k){let A=getCorners(a),P=x.parseVector3(o.position),w=A.map(o=>x.parseVector3(o).distanceTo(P)),F=c.default.indexOf(w,c.default.max(w));A=c.default.range(8).map(o=>A[7^o^F]);let R=[];return[{isDashed:!1,edgePaths:[[0,1,3,2],[1,5,4,0,2,6,4]]},{isDashed:!0,edgePaths:[[5,7,3],[7,6]]}].forEach(({isDashed:o,edgePaths:a})=>{a.forEach(a=>{let c=[];for(let o=0;o+1<a.length;o+=1){let x=getCheckpoints(A[a[o]],A[a[o+1]],g);try{c.push(...x.map(s).filter(notEmpty))}catch(o){k?.(o)}}R.push({points:c,isDashed:o})})}),R},a.getFaceCenters=a.DEFAULT_SEGMENT_COUNT=a.EULER_ORDER=void 0;var c=_interopRequireDefault(s(298784)),g=function(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}(s(814412)),k=s(527352),A=s(141862),x=s(108040),P=s(39083),w=s(152122),F=s(320716),R=_interopRequireDefault(s(490063));function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}function getEuler(o){return new g.Euler(o.pitch?-o.pitch:0,o.roll||0,o.yaw,"ZYX")}function getToCuboidTransformationMatrix(o){let a=new g.Quaternion().setFromEuler(getEuler(o)).invert(),s=new g.Matrix4().makeRotationFromQuaternion(a);return new g.Matrix3().getNormalMatrix(s)}function getEdgeVectors(o){let a=getEuler(o),s=new g.Vector3(1,0,0).applyEuler(a),c=new g.Vector3(0,1,0).applyEuler(a),k=new g.Vector3(0,0,1).applyEuler(a);return{xVector3:s,yVector3:c,zVector3:k}}function containingPoints(o,a,s,k=!1){return o.pitch||o.roll?function(o,a,s,k=!0){let A=getToCuboidTransformationMatrix(o),x=new g.Vector3(o.position.x,o.position.y,o.position.z),P=o.dimensions.x/2+c.default.get(s,"x",0),w=o.dimensions.y/2+c.default.get(s,"y",0),F=o.dimensions.z/2+c.default.get(s,"z",0),R=P**2+w**2+F**2;return a.filter(o=>{if(x.distanceToSquared(o)>R)return!1;let a=o.clone().sub(x).applyMatrix3(A);return k?Math.abs(a.x)<=P&&Math.abs(a.y)<=w&&Math.abs(a.z)<=F:Math.abs(a.x)<P&&Math.abs(a.y)<w&&Math.abs(a.z)<F})}(o,a,s,k):function(o,a,s,k=!1){let A=o.dimensions.x/2+c.default.get(s,"x",0),x=o.dimensions.y/2+c.default.get(s,"y",0),P=o.dimensions.z/2+c.default.get(s,"z",0),{xVector3:w,yVector3:F}=getEdgeVectors(o),R=new g.Vector3(o.position.x,o.position.y,o.position.z),D=a.filter(o=>{let a=o.clone().sub(R),s=Math.abs(w.dot(a)),c=Math.abs(F.dot(a)),g=Math.abs(a.z);return k?c<=x&&s<=A&&g<=P:c<x&&s<A&&g<P});return D}(o,a,s,k)}function getCorners(o){let a=x.parseVector3(o.position),{xVector3:s,yVector3:c,zVector3:g}=getEdgeVectors(o),k=s.multiplyScalar(o.dimensions.x/2),A=c.multiplyScalar(o.dimensions.y/2),P=g.multiplyScalar(o.dimensions.z/2),w=a.clone(),F=a.clone(),R=a.clone(),D=a.clone(),G=a.clone(),B=a.clone(),W=a.clone(),z=a.clone();return w.add(k).add(A).add(P),F.sub(k).add(A).add(P),R.add(k).sub(A).add(P),D.sub(k).sub(A).add(P),G.add(k).add(A).sub(P),B.sub(k).add(A).sub(P),W.add(k).sub(A).sub(P),z.sub(k).sub(A).sub(P),[w,F,R,D,G,B,W,z]}function getEdges(o){let a=getCorners(o);return[[a[0],a[1]],[a[1],a[3]],[a[3],a[2]],[a[2],a[0]],[a[4],a[5]],[a[5],a[7]],[a[7],a[6]],[a[6],a[4]],[a[0],a[4]],[a[1],a[5]],[a[3],a[7]],[a[2],a[6]]]}function cuboidVolume(o){return o.dimensions.x*o.dimensions.y*o.dimensions.z}function cuboidAABB(o,a=0,s=0,c=0){let k=a+o.dimensions.x/2,A=s+o.dimensions.y/2,x=c+o.dimensions.z/2,P=-(2*a+o.dimensions.x)/2,w=-(2*s+o.dimensions.y)/2,F=-(2*c+o.dimensions.z)/2,R=[P,w,F,P,w,x,P,A,F,P,A,x,k,w,F,k,w,x,k,A,F,k,A,x],D=new g.Vector3,G=Number.POSITIVE_INFINITY,B=Number.POSITIVE_INFINITY,W=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY,V=Number.NEGATIVE_INFINITY,U=Number.NEGATIVE_INFINITY,K=getEuler(o),Y=new g.Quaternion;Y.setFromEuler(K);for(let o=0;o<R.length;o+=3)D.set(R[o],R[o+1],R[o+2]),D.applyQuaternion(Y),G=Math.min(D.x,G),B=Math.min(D.y,B),W=Math.min(D.z,W),z=Math.max(D.x,z),V=Math.max(D.y,V),U=Math.max(D.z,U);G+=o.position.x,z+=o.position.x,B+=o.position.y,V+=o.position.y,W+=o.position.z,U+=o.position.z;let $={cuboid:o,minX:G,minY:B,minZ:W,maxX:z,maxY:V,maxZ:U};return $}function insidePolygon(o,a,s){let c=!1;for(let g=0,k=s.length-1;g<s.length;k=g++){let A=s[g].x,x=s[g].y,P=s[k].x,w=s[k].y,F=x>a!=w>a&&o<(P-A)*(a-x)/(w-x)+A;F&&(c=!c)}return c}function extendCuboid(o,a,s,c){return{...o,dimensions:{x:o.dimensions.x+a,y:o.dimensions.y+s,z:o.dimensions.z+c}}}a.EULER_ORDER="ZYX",a.DEFAULT_SEGMENT_COUNT=20,a.getFaceCenters=o=>{let a=x.parseVector3(o.position),{xVector3:s,yVector3:c,zVector3:g}=getEdgeVectors(o),k=s.multiplyScalar(o.dimensions.x/2),A=c.multiplyScalar(o.dimensions.y/2),P=g.multiplyScalar(o.dimensions.z/2),w=a.clone().add(k),F=a.clone().sub(k),R=a.clone().add(A),D=a.clone().sub(A),G=a.clone().add(P),B=a.clone().sub(P);return[w,F,R,D,G,B]};let addTo=function(o,a){o.x+=a.x,o.y+=a.y,o.z+=a.z},subtractFrom=function(o,a){o.x-=a.x,o.y-=a.y,o.z-=a.z};function combineCuboids(o){let a=new g.Box3;for(let s of o){let o=getCorners(s);for(let s=0;s<o.length;s++)a.expandByPoint(o[s])}let s=a.getCenter(new g.Vector3),c=a.getSize(new g.Vector3);return{...o[0],yaw:0,position:{x:s.x,y:s.y,z:s.z},dimensions:{x:c.x,y:c.y,z:c.z}}}function minDistanceLines3D(o,a,s,c){let k,A,x,P;let w=new g.Vector3().subVectors(a,o),F=new g.Vector3().subVectors(c,s),R=new g.Vector3().subVectors(o,s),D=w.dot(w),G=w.dot(F),B=F.dot(F),W=w.dot(R),z=F.dot(R),V=D*B-G*G;k=V,A=V,V<Number.EPSILON?(x=0,k=1,P=z,A=B):(x=G*z-B*W,P=D*z-G*W,x<0?(x=0,P=z,A=B):x>k&&(x=k,P=z+G,A=B)),P<0?(P=0,0>-W?x=0:-W>D?x=k:(x=-W,k=D)):P>A&&(P=A,-W+G<0?x=0:-W+G>D?x=k:(x=-W+G,k=D));let U=Math.abs(x)<Number.EPSILON?0:x/k,K=Math.abs(P)<Number.EPSILON?0:P/A,Y=new g.Vector3().copy(w).multiplyScalar(U),$=new g.Vector3().copy(F).multiplyScalar(K),X=new g.Vector3().copy(R).add(Y).sub($);return X.length()}function notEmpty(o){return null!=o}function getCheckpoints(o,a,s=20){return c.default.range(s+1).map(c=>o.clone().lerp(a,c/s))}},39083:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.computeAngleDiff=computeAngleDiff,a.computeIOU=computeIOU,a.computeGroupIOU=computeGroupIOU,a.build2DPolygonFor=build2DPolygonFor,a.getIntersectionPolygonArea=getIntersectionPolygonArea,a.mistakeProperties=a.mistakeCategory=a.zBounds=a.xyzToPoint3D=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(593539),A=s(74909);let x=Math.PI;function computeAngleDiff(o,a){let s=o-a;return s-2*x*Math.round(s/(2*x))}let P=new k.geom.GeometryFactory,volume=({x:o,y:a,z:s})=>Math.max(o,0)*Math.max(a,0)*Math.max(s,0);a.xyzToPoint3D=o=>({x:o[0],y:o[1],z:o[2]});let zBounds=({z:o},{z:a})=>({lo:o-Math.max(a,0)/2,hi:o+Math.max(a,0)/2});a.zBounds=zBounds;let polygonForCuboidGroup=o=>{let[a,...s]=o.map(o=>build2DPolygonFor(o.position,o.dimensions,o.yaw)),c=a;for(let o of s)c=c.union(o);return c};function computeIOU(o,a,s,c,g,k){let A=Math.max(0,Math.min(zBounds(o,a).hi,zBounds(c,g).hi)-Math.max(zBounds(o,a).lo,zBounds(c,g).lo));if(0===A)return 0;let x=volume(a)+volume(g),P=getIntersectionPolygonArea(o,a,s,c,g,k),w=A*P,F=x-w;return w/(F=Math.max(F,.001))}function computeGroupIOU(o,a){let[s,c]=[o,a].map(polygonForCuboidGroup),g=s.intersection(c).getArea(),k=s.union(c).getArea();return g/k}function build2DPolygonFor({x:o,y:a},{x:s,y:c},g){s=Math.max(s,0),c=Math.max(c,0);let A=[[s/2,c/2],[s/2,-c/2],[-s/2,-c/2],[-s/2,c/2],[s/2,c/2]].map(([s,c])=>new k.geom.Coordinate(o+s*Math.cos(g)-c*Math.sin(g),a+c*Math.cos(g)+s*Math.sin(g)));return P.createPolygon(P.createLinearRing(A),[])}function getIntersectionPolygonArea(o,a,s,c,g,k){return build2DPolygonFor(o,a,s).intersection(build2DPolygonFor(c,g,k)).getArea()}let w=Object.freeze({BAD_SIZE:"badSize",BAD_POSITION:"badPosition",BAD_HEADING:"badHeading",BAD_HEADING_25DEG:"badHeading25Deg",BAD_HEADING_45DEG:"badHeading45Deg",STRICT_BAD_HEADING:"strictBadHeading",DEFINITELY_BAD_HEADING:"definitelyBadHeading",MISSING:"missing",EXTRANEOUS:"extraneous",STATIONARY:"stationary",MISLABELED:"mislabeled",BAD_ATTRIBUTES:"badAttributes",BAD_ATTRIBUTES_WEAK:"badAttributesWeak",BAD_Z:"badZ",DEFINITELY_BAD_Z:"definitelyBadZ",WEAK_BAD_Z:"weakBadZ",STRICT_BAD_POSITION:"strictBadPosition",STRICT_BAD_SIZE:"strictBadSize",STRICT_BAD_Z:"strictBadZ",FACE_POSITION:"facePosition",FACE_POSITION_OUTWARDS:"facePositionOutwards",BAD_IOU:"badIOU",WEAK_BAD_IOU:"weakBadIOU",FACE_PARAMETRIZED:"faceParametrized",ATTR_PARAMETRIZED:"attrParametrized",POSITION_RANGE:"positionRange",FACE_RANGE:"faceRange",BAD_GROUP_IOU:"badGroupIOU"});a.mistakeCategory=w;let gradePerFrameProperty=(o,a={},s=!1)=>(c,k)=>{let A=g.default.keys(k.frames);if(s){let s={};g.default.map(A,A=>{let x=c.frames[A],P=k.frames[A],w=o(x,P,a,A);g.default.map(w,(o,a)=>{s[a]=s[a]||[],o&&s[a].push(A)})});let x=g.default.map(s,(o,a)=>({isIncorrect:o.length>0,frames:o,errorType:a}));return x}{let s=g.default.compact(g.default.map(A,s=>{let g=c.frames[s],A=k.frames[s];return o(g,A,a,s)?s:void 0}));return[{isIncorrect:s.length>0,frames:s}]}},isSizeIncorrect=(o,a,{threshold:s})=>!o||A.naiveDistance(o.dimensions,a.dimensions)>s,isPositionIncorrect=(o,a,{threshold:s})=>!o||A.naiveDistance(o.position,a.position)>s,isPositionOutOfRange=(o,a,{perFramePositionRanges:s,sizeRange:c},g)=>{let outOfRange=(o,a,s)=>o>Math.max(a,s)+.01||Math.min(a,s)>o+.01,pointOutOfRange=(o,a,s)=>o&&(outOfRange(o.x,a[0],s[0])||outOfRange(o.y,a[1],s[1])||outOfRange(o.z,a[2],s[2]));if(s[g]){let{r1:a,r2:c}=s[g],k=o&&o.position;if(pointOutOfRange(k,a,c))return!0}if(c){let{r1:a,r2:s}=c;return pointOutOfRange(o&&o.dimensions,a,s)}return!1},areFacesOutOfRange=(o,a,{perFrameFaceRanges:s,faceRanges:c},k)=>{if(!o)return!0;let x=g.default.get(s,k)||c;if(!x)return!1;let{r1:P,r2:w}=x,F=A.getFaceCenters({...P,yaw:0}),R=A.getFaceCenters({...w,yaw:0}),D=A.getFaceCenters({...o,yaw:0}),outOfRange=(o,a,s)=>o>Math.max(a,s)+.02||Math.min(a,s)>o+.02,G=g.default.zipWith(D,F,R,["x","x","y","y","z","z"],(o,a,s,c)=>outOfRange(o[c],a[c],s[c]));return g.default.some(G)},isHeadingIncorrect=(o,a,{yawThreshold:s})=>{if(g.default.includes(["no label zone","no label"],g.default.toLower(a.label)))return!1;let c=o?computeAngleDiff(o.yaw,a.yaw):1/0;return Math.abs(c)>s},isZIncorrect=(o,a,{threshold:s})=>{let c=o?o.position.z-o.dimensions.z/2-(a.position.z-a.dimensions.z/2):0;return Math.abs(c)>s},isAttributeIncorrect=(o,a,{attributeThreshold:s,perFrameAttributeRanges:c},k,A)=>{if(c&&c[k]){let a=c[k];return!!o&&a[A]&&!g.default.includes(a[A],o.attributes[A])}if("visibility"===A){let c=g.default.get(o,"attributes.visibility"),k=g.default.get(a,"attributes.visibility");if(c&&c!==k){let o={"41%-60%":["61%-80%"],"61%-80%":["41%-60%"]};s>0&&(o={"21%-40%":["41%-60%"],"41%-60%":["21%-40%","61%-80%"],"61%-80%":["41%-60%","81%-100%"],"81%-100%":["61%-80%"]});let a=o[c];if(!a||!g.default.includes(a,k))return!0}return!1}return!!o&&o.attributes[A]!==a.attributes[A]},areAttributesIncorrect=(o,a,s,c)=>a?g.default.mapValues(a.attributes,(g,k)=>isAttributeIncorrect(o,a,s,c,k)):{},isIOUIncorrect=(o,a,{threshold:s})=>!o||computeIOU(o.position,o.dimensions,o.yaw,a.position,a.dimensions,a.yaw)<s,areFacesIncorrect=(o,a,{threshold:s,perFramePerFaceThresholds:c,noLabelThreshold:k=.3},x)=>{let P;if(!o)return!0;if(g.default.includes(["no label zone","no label"],g.default.toLower(a.label)))return isIOUIncorrect(o,a,{threshold:k});let w=A.getFaceCenters(a),F=A.getFaceCenters(o);if(c&&c[x]){let o=c[x];P=g.default.zipWith(F,w,o,(o,a,s)=>o.distanceTo(a)>s)}else P=g.default.zipWith(F,w,(o,a)=>o.distanceTo(a)>s);return g.default.some(P)},F={[w.BAD_SIZE]:{title:"Incorrect size",grader:gradePerFrameProperty(isSizeIncorrect,{threshold:.6}),maxPerFrameWeight:1},[w.BAD_POSITION]:{title:"Incorrect position",grader:gradePerFrameProperty(isPositionIncorrect,{threshold:.6}),maxPerFrameWeight:1},[w.STRICT_BAD_HEADING]:{title:"Incorrect heading (2 deg, really strict)",description:"Accepts headings within 2 degrees. So if the correct answer is 100, the grader would \naccept answers between 98 degrees and 102 degrees. This is really strict.",grader:gradePerFrameProperty(isHeadingIncorrect,{yawThreshold:.04}),maxPerFrameWeight:1},[w.DEFINITELY_BAD_HEADING]:{title:"Incorrect heading (5 deg, pretty strict)",description:"Accepts headings within 5 degrees. So if the correct answer is 100, the grader would \naccept answers between 95 degrees and 105 degrees.",grader:gradePerFrameProperty(isHeadingIncorrect,{yawThreshold:.09}),maxPerFrameWeight:1},[w.BAD_HEADING]:{title:"Incorrect heading (10 deg)",description:"Accepts headings within 10 degrees (this is pretty strict). So if the correct answer is 100, the \ngrader would accept answers between 75 degrees and 125 degrees",grader:gradePerFrameProperty(isHeadingIncorrect,{yawThreshold:.17}),maxPerFrameWeight:1},[w.BAD_HEADING_25DEG]:{title:"Incorrect heading (25 deg)",description:"Accepts headings within 25 degrees. So if the correct answer is 100, the grader would accept answers \nbetween 75 degrees and 125 degrees",grader:gradePerFrameProperty(isHeadingIncorrect,{yawThreshold:.44}),maxPerFrameWeight:1},[w.BAD_HEADING_45DEG]:{title:"Incorrect heading (45 deg)",description:"Accepts headings within 45 degrees. So if the correct answer is 100, the grader would accept answers \nbetween 55 degrees and 145 degrees. Good for pedestrians, esp when pedestrians are blurry.",grader:gradePerFrameProperty(isHeadingIncorrect,{yawThreshold:.78}),maxPerFrameWeight:1},[w.BAD_Z]:{title:"Incorrect Z-index",grader:gradePerFrameProperty(isZIncorrect,{threshold:.03}),maxPerFrameWeight:1},[w.BAD_ATTRIBUTES]:{title:"Incorrect Attributes",grader:gradePerFrameProperty(areAttributesIncorrect,{},!0),maxPerFrameWeight:1},[w.BAD_ATTRIBUTES_WEAK]:{title:"Incorrect Attributes (relaxed)",grader:gradePerFrameProperty(areAttributesIncorrect,{attributeThreshold:1},!0),maxPerFrameWeight:1},[w.STATIONARY]:{title:"Stationary",grader:(o,a)=>[{isIncorrect:o.stationary!==a.stationary}],maxPerFrameWeight:0},[w.MISLABELED]:{title:"Incorrect label",grader:(o,a)=>[{isIncorrect:o.label!==a.label}],maxPerFrameWeight:0},[w.STRICT_BAD_SIZE]:{title:"Incorrect size (strict)",grader:gradePerFrameProperty(isSizeIncorrect,{threshold:.3}),maxPerFrameWeight:1},[w.STRICT_BAD_POSITION]:{title:"Incorrect position (strict)",grader:gradePerFrameProperty(isPositionIncorrect,{threshold:.3}),maxPerFrameWeight:1},[w.WEAK_BAD_Z]:{title:"Incorrect Z-index (relaxed)",grader:gradePerFrameProperty(isZIncorrect,{threshold:.2}),maxPerFrameWeight:1},[w.STRICT_BAD_Z]:{title:"Incorrect Z-index (strict)",grader:gradePerFrameProperty(isZIncorrect,{threshold:.035}),maxPerFrameWeight:1},[w.MISSING]:{title:"Missing cuboid",maxPerFrameWeight:0},[w.EXTRANEOUS]:{title:"Cuboid should have been deleted",maxPerFrameWeight:1},[w.DEFINITELY_BAD_Z]:{title:"Incorrect Z-index (very wrong)",grader:gradePerFrameProperty(isZIncorrect,{threshold:.05}),maxPerFrameWeight:1},[w.FACE_POSITION]:{title:"Incorrect cuboid (position or size)",description:"Use this grader to grade the tasker's cuboid by checking the center positions of each face. \nThis grader will consider tasker correct if each of the faces in the tasker's cuboid is\nwithin 0.2m of the corresponding face of the cuboid in the answer key.",grader:gradePerFrameProperty(areFacesIncorrect,{threshold:.2}),maxPerFrameWeight:1},[w.FACE_POSITION_OUTWARDS]:{title:"Incorrect cuboid (position or size)",description:"Use this grader when the answer key cuboids are the tightest acceptable answer. \nThis grader will consider tasker correct if tasker's cuboid is no more than 0.05m smaller \nthan the answer key cuboid and no more than 0.2m larger than the answer key cuboid",grader:gradePerFrameProperty((o,a,{innerThreshold:s,outerThreshold:c,perFramePerFaceInnerThresholds:k,perFramePerFaceOuterThresholds:x},P)=>{let w;if(!o)return!0;g.default.includes(["no label zone","no label"],g.default.toLower(a.label))&&(s=.5,c=5);let F=A.getFaceCenters(a),R=A.getFaceCenters(o),D=["x","x","y","y","z","z"],G=[1,-1,1,-1,1,-1];if(k&&k[P]&&x&&x[P]){let o=k[P],a=x[P];w=g.default.zipWith(R,F,D,G,(s,c,g,k)=>{var A,x;return(A=s[g]*k)>(x=c[g]*k)+a||A<x-o})}else w=g.default.zipWith(R,F,D,G,(o,a,g,k)=>{var A,x,P;return A=o[g]*k,x=a[g]*k,P=s,A>x+c||A<x-P});return g.default.some(w)},{outerThreshold:.2,innerThreshold:.05}),maxPerFrameWeight:1},[w.BAD_IOU]:{title:"Incorrect cuboid (overlap, strict)",description:"Use this grader when tasker's cuboid should overlap cuboid from answer key by at least 75%",grader:gradePerFrameProperty(isIOUIncorrect,{threshold:.75}),maxPerFrameWeight:1},[w.WEAK_BAD_IOU]:{title:"Incorrect cuboid (overlap, relaxed)",description:"Use this grader when tasker's cuboid should overlap cuboid from answer key by at least 50%",grader:gradePerFrameProperty(isIOUIncorrect,{threshold:.5}),maxPerFrameWeight:1},[w.FACE_PARAMETRIZED]:{title:"Incorrect cuboid (position or size)",description:"This is a parameterized grader - only use this if you know what you are doing.",grader:o=>gradePerFrameProperty(areFacesIncorrect,o),maxPerFrameWeight:1},[w.ATTR_PARAMETRIZED]:{title:"Incorrect attributes",description:"This is a parameterized grader - only use this if you know what you are doing.",grader:o=>gradePerFrameProperty(areAttributesIncorrect,o,!0),maxPerFrameWeight:1},[w.POSITION_RANGE]:{title:"Incorrect cuboid (position)",description:"This is a parameterized grader - only use this if you know what you are doing.",grader:o=>gradePerFrameProperty(isPositionOutOfRange,o),maxPerFrameWeight:1},[w.FACE_RANGE]:{title:"Incorrect cuboid (position or size)",description:"This grader will consider tasker correct if tasker's cuboid is no more \nthan 0.02 larger or smaller than the cuboid range",grader:o=>gradePerFrameProperty(areFacesOutOfRange,o),maxPerFrameWeight:1},[w.BAD_GROUP_IOU]:{title:"Incorrect Cuboid Group",grader:((o,a={})=>(s,c)=>{let k=g.default.keys(c.cuboids[0].frames),A=g.default.compact(g.default.map(k,g=>{let k=s.cuboids.map(o=>o.frames[g]),A=c.cuboids.map(o=>o.frames[g]);return o(k,A,a)?g:void 0}));return[{isIncorrect:A.length>0,frames:A}]})(function(o,a,{threshold:s}){return computeGroupIOU(o,a)<s},{threshold:.5}),maxPerFrameWeight:1}};a.mistakeProperties=F},894574:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getPointKey=getPointKey,a.filterDuplicateMissingAnnotations=function(o){let[a,s]=A.default.partition(o,o=>A.default.every(o.props.perFrame.position,o=>o));return A.default.uniqBy([...a,...s],o=>getPointKey(o.props.static))},a.READ_ONLY_ACTIONS=a.MAX_ERROR_THRESHOLD=a.MEAN_ERROR_THRESHOLD=a.CONSENSUS_ERROR_THRESHOLDS=a.SKELETON_LABELS=a.SHOULDER_RIGHT_LABEL=a.SHOULDER_LEFT_LABEL=a.ELBOW_RIGHT_LABEL=a.ELBOW_LEFT_LABEL=a.WRIST_RIGHT_LABEL=a.WRIST_LEFT_LABEL=a.HIP_RIGHT_LABEL=a.HIP_LEFT_LABEL=a.KNEE_RIGHT_LABEL=a.KNEE_LEFT_LABEL=a.ANKLE_RIGHT_LABEL=a.ANKLE_LEFT_LABEL=a.CENTER_HEAD_LABEL=a.NOSE_LABEL=a.KeypointFailure=void 0;var c,g,k,A=(c=s(298784))&&c.__esModule?c:{default:c};a.KeypointFailure=k,(g=k||(a.KeypointFailure=k={})).MissingCamera="missing-camera",g.InvisibleCuboid="invisible-cuboid",g.ImproperSubtasks="improper-subtasks",g.MissingCuboid="missing-cuboid",g.MultiCuboid="multi-cuboid",g.GeneralError="general-error",g.MissingPoints="missing-points",g.FloatingCuboid="floating-cuboid",g.UndergroundCuboid="underground-cuboid";let x="Nose";a.NOSE_LABEL=x;let P="Center of Head";a.CENTER_HEAD_LABEL=P;let w="Ankle-Left";a.ANKLE_LEFT_LABEL=w;let F="Ankle-Right";a.ANKLE_RIGHT_LABEL=F;let R="Knee-Left";a.KNEE_LEFT_LABEL=R;let D="Knee-Right";a.KNEE_RIGHT_LABEL=D;let G="Hip-Left";a.HIP_LEFT_LABEL=G;let B="Hip-Right";a.HIP_RIGHT_LABEL=B;let W="Wrist-Left";a.WRIST_LEFT_LABEL=W;let z="Wrist-Right";a.WRIST_RIGHT_LABEL=z;let V="Elbow-Left";a.ELBOW_LEFT_LABEL=V;let U="Elbow-Right";a.ELBOW_RIGHT_LABEL=U;let K="Shoulder-Left";a.SHOULDER_LEFT_LABEL=K;let Y="Shoulder-Right";a.SHOULDER_RIGHT_LABEL=Y;let $=[K,Y,V,U,W,z,G,B,R,D,w,F,P,x];a.SKELETON_LABELS=$;let X=Object.freeze({[P]:.036,[x]:.049,[K]:.049,[Y]:.049,[V]:.054,[U]:.054,[W]:.079,[z]:.079,[G]:.065,[B]:.065,[R]:.064,[D]:.064,[w]:.077,[F]:.077});a.CONSENSUS_ERROR_THRESHOLDS=X,a.MEAN_ERROR_THRESHOLD=.04,a.MAX_ERROR_THRESHOLD=.15;let Z=Object.freeze({origLabels:{_ignore:{changeParams:!1}},currLabels:{_ignore:{changeParams:!1}},blockCreateAndDelete:!0,creatable:[],editableAttrs:[],enforceWithoutOrigLabel:!0});function getPointKey(o){return`${o.label}-${o.linkedCuboidId}`}a.READ_ONLY_ACTIONS=Z},108040:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Axis=a.vec3ArraySortBy=a.foreachVec4Array=a.foreachVec3Array=a.mapFilterVec3Array=a.filterMapVec3Array=a.mapVec3Array=a.filterVec3Array=a.filterCountVec3Array=a.prettify=a.vsub=a.vadd=a.vectorToObject=a.parseVector4=a.parseVector3=a.parseVector2=void 0;var c,g,k=_interopRequireDefault(s(298784)),A=_interopRequireDefault(s(141862)),x=function(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}(s(814412));function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}a.parseVector2=o=>new x.Vector2(parseFloat(o.x),parseFloat(o.y)),a.parseVector3=o=>new x.Vector3(parseFloat(o.x),parseFloat(o.y),parseFloat(o.z)),a.parseVector4=o=>new x.Vector4(parseFloat(o.x),parseFloat(o.y),parseFloat(o.z),parseFloat(o.w)),a.vectorToObject=o=>o.isVector4?{type:"vec4",x:o.x,y:o.y,z:o.z}:o.isVector3?{type:"vec3",x:o.x,y:o.y,z:o.z}:{type:"vec2",x:o.x,y:o.y},a.vadd=(o,a)=>{if(!o.isVector2&&!o.isVector3&&!o.isVector4)return o-a;{let s=o.clone();return s.add(a),s}},a.vsub=(o,a)=>{if(!o.isVector2&&!o.isVector3&&!o.isVector4)return o-a;{let s=o.clone();return s.sub(a),s}},a.prettify=o=>{let a=A.default.round(o.x,4),s=A.default.round(o.y,4),c=A.default.round(o.z,4),g=A.default.round(o.w,4);return o.isVector4?`<${a}, ${s}, ${c}, ${g}>`:o.isVector3?`<${a}, ${s}, ${c}>`:o.isVector2?`<${a}, ${s}>`:o.toString()},a.filterCountVec3Array=(o,a,s=-1)=>{let c=0,g=new x.Vector3;for(let k=0;k<o.length&&(g.fromArray(o,k),!a(g)||++c!==s);k+=3);return c},a.filterVec3Array=(o,a)=>{let s=new Float32Array(o.length),c=0,g=new x.Vector3;for(let k=0;k<o.length;k+=3){g.fromArray(o,k);let A=a(g);A&&(g.toArray(s,c),c+=3)}return s.slice(0,c)},a.mapVec3Array=(o,a)=>{let s=new Float32Array(o.length),c=new x.Vector3;for(let g=0;g<o.length;g+=3)c.fromArray(o,g),a(c).toArray(s,g);return s},a.filterMapVec3Array=(o,a)=>{let s=new Float32Array(o.length),c=0,g=new x.Vector3;for(let k=0;k<o.length;k+=3){g.fromArray(o,k);let A=a(g);A&&(g.toArray(s,c),c+=3)}return s.slice(0,c)},a.mapFilterVec3Array=(o,a)=>{let s=new Float32Array(o.length),c=0,g=new x.Vector3;for(let k=0;k<o.length;k+=3){g.fromArray(o,k);let A=a(g);A&&(A.toArray(s,c),c+=3)}return s.slice(0,c)},a.foreachVec3Array=(o,a)=>{let s=new x.Vector3;for(let c=0;c<o.length;c+=3)s.fromArray(o,c),a(s,c/3)},a.foreachVec4Array=(o,a)=>{let s=new x.Vector4;for(let c=0;c<o.length;c+=4)s.fromArray(o,c),a(s,c/4)},a.vec3ArraySortBy=(o,a)=>{let s=new Float32Array(o.length),c=new x.Vector3,g=k.default.range(o.length/3),toVec=a=>c.fromArray(o,3*a);void 0===a&&(a=[k.default.identity]),a instanceof Function&&(a=[a]),a=k.default.map(a,o=>a=>o(toVec(a)));let A=k.default.sortBy(g,a);for(let a=0;a<A.length;a++)s[3*a]=o[3*A[a]],s[3*a+1]=o[3*A[a]+1],s[3*a+2]=o[3*A[a]+2];return s},a.Axis=g,(c=g||(a.Axis=g={})).X="x",c.Y="y",c.Z="z"},378970:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(...o){return o.reduce((o,a)=>o.flatMap(o=>a.map(a=>[o,a].flat())))}},490503:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.downsampleCoordsByAngle=function(o,a=2.5){if(o.length<=2)return o;let s=[];o.slice(0,-1).forEach((a,c)=>{let g=o[c+1],k=g.x-a.x,A=g.y-a.y;s.push(Math.atan2(A,k)*(180/Math.PI))});let c=[],g=0;for(;g<s.length;){let o=s[g],k=0,A=g+1;for(;A<s.length&&!((k+=Math.abs(s[A]-o))>=a);)c.push(A),A++;g=A}return o.filter((o,a)=>!c.includes(a))},a.extendLineSegment=a.projectVerticesOntoPolyline=a.computeDistanceToPolyline=a.computeFCD=a.projectVertexOntoLine=a.polylineLen=a.computeSegmentLength=a.dist=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(440169),A=s(950382);let dist=(o,a)=>Math.sqrt((o.x-a.x)*(o.x-a.x)+(o.y-a.y)*(o.y-a.y));a.dist=dist,a.computeSegmentLength=([o,a])=>dist(o,a),a.polylineLen=o=>g.default.sum(g.default.range(o.length-1).map(a=>dist(o[a],o[a+1]))),a.projectVertexOntoLine=([o,a],s,c)=>{A.samePoint(o,a,0)&&(a={x:o.x+1,y:o.y});let g=s.x-o.x,k=s.y-o.y,x=a.x-o.x,P=a.y-o.y,w=(g*x+k*P)/(x*x+P*P);if(c&&(w<=c[0]||w>=c[1]))return null;let F={x:o.x+w*x,y:o.y+w*P},R=dist(s,F);return{proj:F,coeff:w,distance:R}},a.computeFCD=(o,a)=>Math.sqrt(g.default.max([k.vertexSqDistanceToSegment(o[0],a),k.vertexSqDistanceToSegment(o[1],a),k.vertexSqDistanceToSegment(a[0],o),k.vertexSqDistanceToSegment(a[1],o)])),a.computeDistanceToPolyline=(o,a)=>Math.sqrt(g.default.min(g.default.range(a.length-1).map(s=>k.vertexSqDistanceToSegment(o,[a[s],a[s+1]])))),a.projectVerticesOntoPolyline=(o,a,s=1/0,c=0)=>g.default.flatMap(o,(k,x)=>{if(x+1===o.length)return[k];let P=o[x+1],w=dist(k,P),F=function([o,a],[s,c],g){A.samePoint(o,a,0)&&(a={x:o.x+1,y:o.y});let k=a.x-o.x,x=a.y-o.y,P=k*k+x*x,w=c*P,F=s*P;return a=>{let s=a.x-o.x,c=a.y-o.y,A=s*k+c*x;if(A<=F||A>=w)return null;let R=A/P,D={x:o.x+R*k,y:o.y+R*x},G=dist(a,D);return G>g?null:{proj:D,coeff:R,distance:G}}}([k,P],0===w?[0,1]:[c/w,1-c/w],s),R=[];for(let o of a){let a=F(o);a&&R.push(a)}R.sort((o,a)=>o.coeff-a.coeff);let D=[],G=c/w;for(let o of R)(0===D.length||0===G||o.coeff>g.default.last(D).coeff+G)&&D.push(o);return[k,...g.default.map(D,"proj")]}),a.extendLineSegment=(o,a,s)=>{if(0===dist(o,a))return o;let c=s/dist(o,a);return{x:a.x+c*(a.x-o.x),y:a.y+c*(a.y-o.y)}}},398314:function(o,a){"use strict";var s,c,g,k,A,x;Object.defineProperty(a,"__esModule",{value:!0}),a.CeleryResponses=a.TASK_VISIBILITY=a.CeleryTasks=a.CeleryQueues=void 0,a.CeleryQueues=s,(k=s||(a.CeleryQueues=s={})).RapidEmbeddingObject="rapid.embed.object",k.NucleusAutotagRefinement="nucleus.autotag.refinement.new_cluster",k.NucleusAutotagInference="nucleus.autotag.inference.new_cluster",k.NucleusAutotagStreamingInference="nucleus.autotag.streaming_inference",k.NucleusAutotagPostgresOnly="nucleus.autotag.postgres_only.new_cluster",k.NucleusEmbeddingObject="nucleus.embed.object.new_cluster",k.NucleusEmbeddingImageAll="nucleus.embed.image.clip.new_cluster",k.NucleusEmbeddingImageAllContinuous="nucleus.embed.image.clip.continuous.new_cluster",k.NucleusEmbeddingImageAllContinuousTest="nucleus.embed.image.clip.continuous.test.new_cluster",k.NucleusNms="nucleus.nms.new_cluster",k.NucleusIndexing="nucleus.indexing.new_cluster",k.NucleusIndexingCacheWorker="nucleus.indexing.cache_worker.new_cluster",k.NucleusSimilarity="nucleus.similarity_search.new_cluster",k.NucleusSimilarityPostgresOnly="nucleus.similarity_search.postgres_only.new_cluster",k.NucleusUniquenessSampling="nucleus.unique_sampler.new_cluster",k.ModelCiEvaluate="validate.evaluate.new_cluster",k.ModelCiEvaluateProdclone="validate.evaluate.prodclone.new_cluster",k.ModelCiDiscover="validate.discover.slices.new_cluster",k.ValidateMetrics="validate.metrics",k.DiscoverModelSlices="validate.discover.new_cluster",k.InsightEvaluate="insight.evaluate",k.InsightValidate="insight.validate",k.InstacartTaxonomyClassificationCPU="product_cls.instacart.inference.cpu",k.InstacartTaxonomyClassificationGPU="product_cls.instacart.inference.gpu",k.FlamingoBulletsSingleCategoryClassification="catalog.classification.inference.tasks.bullet-refiner",k.FlamingoBulletsMultiCategoryClassification="flamingo.inference.cpu.multiclass",k.FlamingoTaxonomy="flamingo.inference.cpu.taxonomy",k.FlamingoTaxonomyV2="flamingo.inference.cpu.taxonomymulti",k.FlamingoSizeChartClassification="size_charts.inference.tasks.size-chart",k.FlamingoBulletsNER="catalog.ner.inference.tasks.dimension",k.FlamingoBulletsHighRecallDimensionsClassification="catalog.quality.inference.tasks.d-rec",k.FlamingoBulletsHighPrecisionDimensionsClassification="catalog.quality.inference.tasks.d-prec",k.CatalogTaxonomy="flamingo.inference.cpu.updatedtaxonomyroberta",k.CatalogTCE="catalog.color_extraction.inference.tasks.color-text",k.CatalogMaterials="catalog.material_categorization.inference.tasks.material",k.CatalogSizeChartClassification="catalog.size_charts.inference.tasks.sizemodel",k.ProductIDExtraction="catalog.product_id.inference.tasks.product-id-matcher",k.CatalogMaterialsClassification="catalog.quality.inference.tasks.m-class",k.CatalogMaterialsNER="catalog.ner.inference.tasks.material",k.CatalogImg2Attr="catalog.im2attr.inference.tasks.pattern",k.CatalogNERText2Attr="catalog.ner.inference.tasks.plg_t2a",k.CatalogTaskConfidence="catalog.task_confidence.inference.tasks.conf",k.CatalogSimilarBullets="catalog.similar_bullets.inference.tasks.sim",k.CatalogCondorProductMatching="catalog.plg_dedupe.inference.tasks.dedupe-condor",k.LidarAutoflag="lidar.autoflag",k.LidarWorkflow="lidar.workflow",k.InternalOCR="models.ocr.all",k.HermesDocumentEmbedding="chat_ingestion.queue",k.CategorizationPrediction="categorization.prediction",a.CeleryTasks=c,(A=c||(a.CeleryTasks=c={})).NucleusAutotagRefinement="nucleus.autotag_migration.tasks.handle_worker_request",A.NucleusAutotagStreamingInference="nucleus.autotag_migration.tasks.streaming_inference",A.NucleusEmbeddingObject="nucleus.embedding_object.tasks.object_embedding_handler",A.NucleusEmbeddingImageClip="nucleus.embedding_image_clip.tasks.batch_embedding_request_handler",A.NucleusEmbeddingImageEfficientNet="nucleus.embedding_image_clip.tasks.batch_embedding_request_handler_EfficientNet",A.NucleusNms="nucleus.nms.tasks.handle_nms_request",A.NucleusIndexing="nucleus.indexing.tasks.handle_request",A.NucleusIndexingCacheWorker="nucleus.indexing_cache_worker.tasks.load_index_into_cache",A.NucleusSimilarity="nucleus.similarity_search_migration.tasks.similarity_search_request_handler",A.NucleusUniquenessImageSampling="nucleus.unique_sampler.tasks.handle_image_sampling_request",A.NucleusUniquenessObjectSampling="nucleus.unique_sampler.tasks.handle_image_sampling_with_object_embeddings_request",A.ModelCiEvaluate="services.evaluate.tasks.evaluate",A.ModelCiDiscover="services.discover.tasks.discover",A.ModelCiDiscoverCache="services.discover.tasks.cache_scenario",A.ModelCiDiscoverModel="services.discover.tasks.discover_model_run",A.ValidateMetricsCalculate="services.metrics.tasks.calculate_metrics",A.ValidateMetricsIouMatches="services.metrics.tasks.iou_matches",A.ValidateQueryableMetrics="services.metrics.tasks.pr_curve_metrics",A.InsightEvaluate="insight.services.evaluate.tasks.evaluate",A.InsightValidate="insight.services.validate.tasks.evaluate",A.InstacartTaxonomyClassification="product_classification.inference.cpu.tasks.run_fasttext_inference",A.InstacartRobertaTaxonomyClassification="product_classification.inference.gpu.tasks.run_torch_inference",A.InstacartTaxonomyUnjudgeableClassification="product_classification.inference.cpu.tasks.run_unjudgeable_inference",A.FlamingoBulletClassification="flamingo_product_classification.inference.tasks.run_flamingo_fasttext_inference",A.FlamingoBulletRefinementClassification="catalog.classification.inference.tasks.run_bullet_refiner_inference",A.FlamingoTaxonomyTask="flamingo_product_classification.inference.tasks.run_flamingo_taxonomy_fasttext_inference",A.FlamingoTaxonomyTaskV2="flamingo_product_classification.inference.tasks.run_flamingo_taxonomy_multimodel_inference",A.FlamingoSizeChartClassification="size_charts.inference.tasks.sizemodel_function",A.FlamingoBulletsNER="catalog.ner.inference.tasks.dimension_function",A.FlamingoBulletsHighRecallDimensionsClassification="catalog.quality.inference.tasks.dimensions_recall_function",A.FlamingoBulletsHighPrecisionDimensionsClassification="catalog.quality.inference.tasks.dimensions_precision_function",A.CatalogTaxonomy="catalog.classification.inference.tasks.run_flamingo_taxonomy_updated_roberta_inference",A.CatalogTCE="catalog.color_extraction.inference.tasks.titlecolorextraction_function",A.CatalogSizeChartClassification="catalog.size_charts.inference.tasks.sizemodel_function",A.StandardMLServeTask="ml_serve.celery_service.exec_func",A.CatalogMaterialsTask="catalog.material_categorization.inference.tasks.materialcategorization_function",A.ProductIDExtractionTask="catalog.product_id.inference.tasks.productidextraction_function",A.CatalogMaterialsClassificationTask="catalog.quality.inference.tasks.materialclassification_function",A.CatalogMaterialsNERTask="catalog.ner.inference.tasks.material_function",A.CatalogImg2AttrTask="catalog.im2attr.inference.tasks.bimodal_catalog_cls_function",A.CatalogNERText2AttrTask="catalog.ner.inference.tasks.plg_t2a_function",A.CatalogTaskConfidenceTask="catalog.task_confidence.inference.tasks.task_confidence_function",A.CatalogSimilarBulletsTask="catalog.similar_bullets.inference.tasks.similar_bullets_function",A.CatalogCondorProductMatchingTask="catalog.plg_dedupe.inference.tasks.dedupe_catalog_cls_function",A.AutoflagLintLidarAnnotation="lidar.autoflag.tasks.lint_lidarannotation",A.PrelabelLidarAnnotation="lidar.workflow.tasks.prelabel_lidarannotation",A.InternalOCRTask="ocr.internal.run_model",A.HermesDocumentEmbeddingTask="federal.projects.llm.fed_hermes.ingestion_celery.tasks.handle_ingestion_request",A.CategorizationPredictionTask="categorization.prediction.tasks.predict_categorization",a.TASK_VISIBILITY={VISIBILITY_1H:"0",VISIBILITY_10M:"1",VISIBILITY_1M:"2",VISIBILITY_24H:"3"},a.CeleryResponses=g,(x=g||(a.CeleryResponses=g={})).PENDING="PENDING",x.STARTED="STARTED",x.SUCCESS="SUCCESS",x.ERROR="ERROR",x.FAILURE="FAILURE"},482767:function(o,a){"use strict";var s,c,g,k,A,x,P,w;Object.defineProperty(a,"__esModule",{value:!0}),a.PrelabelSubtaskResult=a.PrelabelType=a.UnofficialModelName=a.ModelName=void 0,a.ModelName=s,(A=s||(a.ModelName=s={})).VIDEOBOX="videobox",A.ORCHESTRATOR="orchestrator",A.FRCNN="frcnn",a.UnofficialModelName=c,(x=c||(a.UnofficialModelName=c={})).APPLEVEHICLES="apple-vehicles",x.AURORAVIDEOBOX="aurora-videobox",x.AURORAVEHICLES="aurora-vehicles",x.LUCIDDYNAMICOBJECTS="lucid-dynamic-objects",x.TRI="tri",x.NURO="nuro",x.ZOOXVEHICLES="zoox-vehicles",a.PrelabelType=g,(P=g||(a.PrelabelType=g={})).BBOX="videobox",P.ANNOTATION="annotation",P.ORCHESTRATION="orchestration",a.PrelabelSubtaskResult=k,(w=k||(a.PrelabelSubtaskResult=k={})).Success="prelabelSubtaskResultSuccess",w.Errored="prelabelSubtaskResultErrored",w.Ignored="prelabelSubtaskResultIgnored",w.Skipped="prelabelSubtaskResultSkipped"},348701:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.isStrategyName=a.SpamDetectionStrategies=void 0,a.SpamDetectionStrategies=s,(c=s||(a.SpamDetectionStrategies=s={})).EarlyGrade="early_grade",c.SingleSubmission="only_one_submission",c.BenchmarkScore="benchmark_score",c.WorkerMetricValue="worker_metric_value",c.TimeSpent="time_spent",c.OverpaymentRate="overpayment_rate",c.PaySBQs="pay_sbqs",a.isStrategyName=o=>Object.values(s).includes(o)},782828:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.tierMultipliersSchemaValidator=function(o){if(g.default.isNil(o)||g.default.isEmpty(o))return!0;if(tierMappingSchemaValidator(o),o[A.ProjectPayTier.Unranked]&&o[A.ProjectPayTier.Unranked]>1)throw Error("Multiplier for unranked tasker cannot be greater than 1");return!0},a.validatePayTiersConfigsSchema=function(o){if(o&&!g.default.isArray(o))throw Error("Pay Tiers Config should be an array (one entry per partition)");for(let a of o)a.autoUpdateEnabled&&(function(o){if(!g.default.isArray(o)||0===o.length)throw Error("Need non-empty array of conditions");if(g.default.uniqBy(o,o=>o.metricType).length!==o.length)throw Error("Each condition should be on a different metric type");for(let a of o)return function(o){if(tierMappingSchemaValidator(o),o[A.ProjectPayTier.Unranked]&&o[A.ProjectPayTier.Unranked]>0)throw Error("Minimum accuracy for unranked can only be 0 or undefined")}(a.tierAccuracies),!0}(a.autoUpdateConditions),k.assertDefined(a.autoUpdateWindowSize,{message:"Missing auto update window size"})),a.speedDemotionEnabled&&(k.assertDefined(a.speedDemotionMaxAverageTimeSpentSeconds,{message:"Missing speed demotion max average time spent seconds"}),k.assertDefined(a.speedDemotionWindowSize,{message:"Missing speed demotion window size"}));return!0};var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(810755),A=s(599789);function tierMappingSchemaValidator(o){let a,s;for(let c of A.ProjectPayTierOrder){let k=o[c];if(c===A.ProjectPayTier.Unranked||g.default.isFinite(k)){if(s&&s>k)throw Error(`Value for tier ${a} cannot be higher than value for tier ${c}`);if(k<0)throw Error(`Value for tier ${c} cannot be negative`)}else throw Error(`Missing or invalid value for tier ${c}`);a=c,s=k}return!0}},323625:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.customersToDummyResponses=void 0;var c=s(963494);let g={ostrich:{annotations:{foreign_language:{field_id:"foreign_language",type:c.TextCollectionFieldType.Category,response:[["no"]]},is_invalid:{field_id:"is_invalid",type:c.TextCollectionFieldType.Category,response:[["no"]]},is_sexual:{field_id:"is_sexual",type:c.TextCollectionFieldType.Category,response:[["no"]]},is_hateful:{field_id:"is_hateful",type:c.TextCollectionFieldType.Category,response:[["no"]]},is_harassment:{field_id:"is_harassment",type:c.TextCollectionFieldType.Category,response:[["no"]]},is_violence:{field_id:"is_violence",type:c.TextCollectionFieldType.Category,response:[["no"]]},is_self_harm:{field_id:"is_self_harm",type:c.TextCollectionFieldType.Category,response:[["no"]]}}},testCustomer:{annotations:{answer_1:{field_id:"answer_1",type:c.TextCollectionFieldType.Category,response:[["choice1"]]},answer_2:{field_id:"answer_2",type:c.TextCollectionFieldType.Text,response:["some words"]}}}};a.customersToDummyResponses=g},369943:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.binaryClassifierFn=a.isValidBinaryClassifierFnParams=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(599789),A=s(323625),x=s(48792);let isValidDecisionFnResultAction=o=>{if(!o||!g.default.isPlainObject(o)||g.default.isArray(o)||!("type"in o)||!g.default.values(x.DecisionFnResultActionType).includes(o.type)||!("params"in o)||!g.default.isPlainObject(o.params))return!1;let a=o.params;if(o.type===x.DecisionFnResultActionType.GoToReview){if(!("reviewLevel"in a)||!g.default.values(k.ReviewLevel).includes(a.reviewLevel))return!1}else if(o.type===x.DecisionFnResultActionType.GoToConsensus&&(!("includeMLModelAttemptInConsensus"in a)||"boolean"!=typeof a.includeMLModelAttemptInConsensus))return!1;return!0};a.isValidBinaryClassifierFnParams=o=>{if(!o||!g.default.isPlainObject(o)||g.default.isArray(o)||!("predictionLabel"in o)||"string"!=typeof o.predictionLabel||!("actions"in o)||!g.default.isArray(o.actions))return!1;for(let a of o.actions)if(!("confidenceRange"in a)||!g.default.isArray(a.confidenceRange)||2!==a.confidenceRange.length||g.default.some(a.confidenceRange.map(o=>!g.default.isFinite(o)||o<0||o>1))||a.confidenceRange[0]>a.confidenceRange[1]||!("action"in a)||!isValidDecisionFnResultAction(a.action))return!1;return!0},a.binaryClassifierFn=(o,a)=>{let s;let c=o.predictions,k=+c[a.predictionLabel],P=x.DEFAULT_DECISION_FN_RESULT_ACTION;if(g.default.isFinite(k)){for(let o of a.actions)if(k>=o.confidenceRange[0]&&k<=o.confidenceRange[1]){P=o.action,o.response&&(s=o.response);break}}let w={annotations:o.predictions};if(s)w=s;else if(o.params){let a=A.customersToDummyResponses[o.params.customerName];a&&(w=a)}return{action:P,response:w}}},845376:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.defaultTextCollectionFn=a.isValidDefaultFnParams=void 0;var c=s(48792);a.isValidDefaultFnParams=()=>!0,a.defaultTextCollectionFn=o=>({action:c.DEFAULT_DECISION_FN_RESULT_ACTION,response:{annotations:o.predictions}})},48792:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.decisionFnTypeToImpl=a.decisionFnTypeToParamsValidation=a.DEFAULT_DECISION_FN_RESULT_ACTION=a.DecisionFnResultActionType=a.ConsensusDecisionFnType=void 0;var c,g,k,A,x=s(369943),P=s(845376);a.ConsensusDecisionFnType=k,(c=k||(a.ConsensusDecisionFnType=k={})).BinaryClassifier="binary_classifier",c.Default="default",a.DecisionFnResultActionType=A,(g=A||(a.DecisionFnResultActionType=A={})).GoToReview="go_to_review",g.GoToConsensus="go_to_consensus",g.None="none";let w={type:A.None,params:{}};a.DEFAULT_DECISION_FN_RESULT_ACTION=w;let F={[k.BinaryClassifier]:x.isValidBinaryClassifierFnParams,[k.Default]:P.isValidDefaultFnParams};a.decisionFnTypeToParamsValidation=F;let R={[k.BinaryClassifier]:x.binaryClassifierFn,[k.Default]:P.defaultTextCollectionFn};a.decisionFnTypeToImpl=R},309028:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.perStageReviewValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object({numL0Reviews:g.default.number().optional(),needsL1Review:g.default.boolean().optional(),needsCorpReview:g.default.boolean().optional(),holdDeliverable:g.default.boolean().optional(),autoflagParams:g.default.any().optional()});a.perStageReviewValidator=k},825971:function(o,a){"use strict";var s;Object.defineProperty(a,"__esModule",{value:!0}),a.DocumentSplittingStrategy=void 0,a.DocumentSplittingStrategy=s,(s||(a.DocumentSplittingStrategy=s={})).Serial="serial"},662598:function(o,a){"use strict";var s,c,g,k,A,x,P,w,F,R;Object.defineProperty(a,"__esModule",{value:!0}),a.ModelOutputConfidenceFilterer=a.ModelComparisonFunction=a.ModelTransformerFunction=a.ModelAction=a.ModelDecisionEntrypoint=void 0,a.ModelDecisionEntrypoint=s,(x=s||(a.ModelDecisionEntrypoint=s={})).Immediate="Immediate",x.AfterAttempt="After Attempt",a.ModelAction=c,(P=c||(a.ModelAction=c={})).CompleteTask="Complete Task",P.CompleteSubtask="Complete Subtask",a.ModelTransformerFunction=g,(w=g||(a.ModelTransformerFunction=g={})).TaxonomyAttempt="Taxonomy Attempt",w.TaxonomyReview="Taxonomy Review",w.SizeChart="Size Chart",w.TCE="TCE",w.Materials="Materials",w.ProductID="Product ID",w.NoTransformation="No Transformation",a.ModelComparisonFunction=k,(F=k||(a.ModelComparisonFunction=k={})).Equality="Equality",F.TCE="TCE",a.ModelOutputConfidenceFilterer=A,(R=A||(a.ModelOutputConfidenceFilterer=A={})).SingleNumericalConfidence="SingleNumericalConfidence",R.MinOfAllConfidences="MinOfAllConfidences"},128668:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.validatePipelineConfigParams=function(o,a){if("string"==typeof a)try{a=JSON.parse(a)}catch(o){return["Invalid JSON string"]}let s=eW[o];if(!s)return["Invalid pipeline name"];let{error:c}=s.concat(ej).validate(a);return c?c.details.map(o=>o.message):[]},a.validateTRModelConfig=a.commonPipelineValidator=void 0;var c,g=s(167469),k=(c=s(39300))&&c.__esModule?c:{default:c},A=s(749715),x=s(127627),P=s(102213),w=s(643646),F=s(711195),R=s(313750),D=s(844707),G=s(393714),B=s(704799),W=s(968700),z=s(825971),V=s(565817),U=s(466162),K=s(696722),Y=s(863986),$=s(721879),X=s(628784),Z=s(75796),J=s(312388);let ee=k.default.object().keys({numL0Reviews:k.default.number().integer().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean(),responsesRequired:k.default.number().integer().min(1).optional(),alwaysSendBackToAttempt:k.default.boolean(),autoflagParams:Y.autoflagParamsValidator.optional(),predictionsParams:$.predictionsParamsValidator.optional(),confidenceModelParams:X.standardPipelineConfidenceModelParamsValidator.optional()}),et=k.default.object().keys({numL0Reviews:k.default.number().integer().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean(),responsesRequired:k.default.number().integer().min(1).optional()}),er=k.default.object().keys({}),en=k.default.object().keys({numL0Reviews:k.default.number().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean(),autoflagParams:Y.autoflagParamsValidator.optional(),predictionsParams:$.predictionsParamsValidator.optional()}),ei=k.default.object().keys({numL0Reviews:k.default.number().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean(),targetProjectID:k.default.string().required(),globalAttributes:k.default.object().required()}),eo=k.default.object().keys({categorization:k.default.object().required(),zeroAnnotation:k.default.object().required(),specializationDefault:k.default.object().required(),globalAttributes:k.default.object().required(),subprojectToCategorizationMap:k.default.object().required(),emptyImageThreshold:k.default.number().min(0).max(1).optional()}),ea=k.default.object().keys({numL0Reviews:k.default.number().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean(),responsesRequired:k.default.number().min(0).optional()}),es=k.default.object().keys({numL0Reviews:k.default.number().integer().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean(),maxTracksPerSubtask:k.default.number().integer().min(1).optional()}),el=k.default.object().keys({numL0Reviews:k.default.number().integer().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean()}),eu=k.default.object().keys({numL0Reviews:k.default.number().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean(),responsesRequired:k.default.number().min(0).optional(),cuboidFrameDensityThreshold:k.default.number().min(0)}),ed=k.default.object().keys({numL0Reviews:k.default.number().integer().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean(),numAttempts:k.default.number().min(1).optional()}),ec=k.default.object().keys({numInitialL0Reviews:k.default.number().integer().min(0),needsInitialL1Review:k.default.boolean(),needsInitialCorpReview:k.default.boolean(),numMiniL0Reviews:k.default.number().integer().min(0),needsMiniL1Review:k.default.boolean(),needsMiniCorpReview:k.default.boolean(),numFinalL0Reviews:k.default.number().integer().min(0),needsFinalL1Review:k.default.boolean(),needsFinalCorpReview:k.default.boolean(),focusFirstCuboid:k.default.boolean(),cuboidTrailsEnabled:k.default.boolean(),bigPoints:k.default.boolean(),initialReviewCreateReadonly:k.default.boolean()}),ep=k.default.object().keys({skipInitialSubtask:k.default.boolean().optional(),skipSpecializationSubtask:k.default.boolean().optional(),initialDiscoveryTask:k.default.boolean().optional(),numInitialL0Reviews:k.default.number().integer().min(0),needsInitialL1Review:k.default.boolean(),needsInitialCorpReview:k.default.boolean(),numMiniL0Reviews:k.default.number().integer().min(0),numPostSplitL0Reviews:k.default.number().integer().min(0),needsMiniL1Review:k.default.boolean(),needsMiniCorpReview:k.default.boolean(),needsPostSplitL1Review:k.default.boolean(),needsPostSplitCorpReview:k.default.boolean(),numFinalL0Reviews:k.default.number().integer().min(0),needsFinalL1Review:k.default.boolean(),needsFinalCorpReview:k.default.boolean(),needsAttributeLabeling:k.default.boolean(),numAttributeLabelingL0Reviews:k.default.number().integer().min(0),needsAttributeLabelingL1Reviews:k.default.boolean(),needsAttributeLabelingCorpReview:k.default.boolean()}),ef=k.default.object().keys({numSpecializationL0Reviews:k.default.number().integer().min(0),needsSpecializationL1Review:k.default.boolean(),needsSpecializationCorpReview:k.default.boolean(),numFinalL0Reviews:k.default.number().integer().min(0),needsFinalL1Review:k.default.boolean(),needsFinalCorpReview:k.default.boolean()}),eh=k.default.object().keys({}),em=k.default.object().keys({numAttempts:k.default.number().min(1).optional(),numReviewsIfEscalated:k.default.number().min(0).optional(),needsCorpReview:k.default.boolean().optional(),needsL1Review:k.default.boolean().optional(),consensusFunctionType:k.default.optional(),attemptFilterStrategy:k.default.string().optional(),targetConfidenceThreshold:k.default.number().min(0).max(1).optional(),shortCircuitConfidenceThreshold:k.default.number().min(0).max(1).optional(),confidenceFieldInclusionList:k.default.array().items(k.default.string()).optional(),targetAgreementThreshold:k.default.number().min(0).max(1).optional(),agreementFieldInclusionList:k.default.array().items(k.default.string()).optional(),shortCircuitHighestAnswerShareThreshold:k.default.number().min(0).max(1).optional(),highestAnswerShareFieldInclusionList:k.default.array().items(k.default.string()).optional(),maxNumAttempts:k.default.number().min(k.default.ref("numAttempts")).optional(),numIncrementalAttempts:k.default.number().optional().min(1),considerAttemptsInReviewConsensus:k.default.boolean().optional(),skipReviewsConfidenceThreshold:k.default.number().min(0).max(1).optional(),useSubtaskPipelineParams:k.default.boolean().optional(),useOldUnexcludedAttemptsWhenRecalling:k.default.boolean().optional()}),eg=k.default.object().keys({numAttempts:k.default.number().min(1).optional(),numReviewsIfEscalated:k.default.number().min(0).optional(),consensusFunctionType:k.default.optional(),needsCorpReview:k.default.boolean().optional(),needsL1Review:k.default.boolean().optional(),escalateToCorp:k.default.boolean().optional()}),ey=k.default.object().keys({}),eb=k.default.object().keys({subtaskPipelineName:k.default.string(),standardSubtaskParams:en.optional(),consensusSubtaskParams:eg.optional()}),ev=k.default.object().keys({maxAttemptReviewIteration:k.default.number().min(1).optional(),numL0Reviews:k.default.number().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean(),numAttempts:k.default.number().min(1).optional()}),e_=k.default.object().keys({}),eT=k.default.object().keys({}),ek=k.default.object().keys({}),eA=k.default.object().keys({}),eS=k.default.object().keys({transitionStrategy:k.default.string(),rlhf_standard_pipeline_generation:k.default.object(),rlhf_standard_pipeline_review:k.default.object().optional(),rlhf_standard_pipeline_final_fix:k.default.object().optional()}),ex=k.default.object().keys({numL0Reviews:k.default.number().integer().min(0).optional(),needsL1Review:k.default.boolean().optional(),needsCorpReview:k.default.boolean().optional()}),eM=k.default.object().keys({numL0Reviews:k.default.number().integer().min(0).optional(),needsL1Review:k.default.boolean().optional(),needsCorpReview:k.default.boolean().optional()}),eC=k.default.object().keys({numInitialL0Reviews:k.default.number().integer().min(0),needsInitialL1Review:k.default.boolean(),needsInitialCorpReview:k.default.boolean(),alwaysSendBackToAttempt:k.default.boolean().optional()}),eP=k.default.object().keys({numL0Reviews:k.default.number().integer().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean()}),eL=k.default.object().keys({numL0Reviews:k.default.number().integer().min(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean()}),eI=k.default.object().keys({}),eE=k.default.object().keys({numAttempts:k.default.number().min(1).optional(),useDescriptionSplicing:k.default.boolean().optional(),consensusFunctionType:k.default.optional(),numL0Reviews:k.default.number().integer().min(0),confidenceThresholds:k.default.object().pattern(k.default.string(),k.default.number()).optional(),needsL1Review:k.default.boolean().optional(),needsCorpReview:k.default.boolean().optional(),confidenceFieldInclusionList:k.default.array().items(k.default.string()).optional(),maxNumAttempts:k.default.number().optional(),targetConfidenceThreshold:k.default.number().optional(),descriptionNumAttempts:k.default.number().optional(),descriptionMaxNumAttempts:k.default.number().optional(),descriptionTargetConfidenceThreshold:k.default.number().optional(),clearDescriptionIfBelowAgreement:k.default.number().optional()}),ew=k.default.object().keys({numAttempts:k.default.number().min(1).optional(),consensusFunctionType:k.default.optional(),numL0Reviews:k.default.number().integer().min(0),confidenceThresholds:k.default.object().pattern(k.default.string(),k.default.number()).optional(),needsL1Review:k.default.boolean().optional(),needsCorpReview:k.default.boolean().optional(),confidenceFieldInclusionList:k.default.array().items(k.default.string()).optional(),maxNumAttempts:k.default.number().optional(),targetConfidenceThreshold:k.default.number().optional(),nerModelConfig:k.default.object().keys({queueName:k.default.string(),taskName:k.default.string(),attributeConfigs:k.default.object().optional()}).optional()}),eF=k.default.object().keys({numAttempts:k.default.number().min(1).optional(),consensusFunctionType:k.default.optional(),numL0Reviews:k.default.number().integer().min(0),confidenceThresholds:k.default.object().pattern(k.default.string(),k.default.number()).optional(),agreementThresholds:k.default.object().pattern(k.default.string(),k.default.number()).optional(),needsL1Review:k.default.boolean().optional(),needsCorpReview:k.default.boolean().optional(),completeIfNotTargeted:k.default.boolean().optional(),numIncrementalAttempts:k.default.number().optional(),maxNumAttempts:k.default.number().optional(),targetConfidenceThreshold:k.default.number().optional(),shortCircuitConfidenceThreshold:k.default.number().optional(),attemptFilterStrategy:k.default.string().optional(),reviewMaxChoices:k.default.number().optional(),reviewMinChoices:k.default.number().optional(),confidenceFieldInclusionList:k.default.array().items(k.default.string()).optional(),fetchAdditionalChoices:k.default.boolean().optional(),addUnjudgeableField:k.default.boolean().optional(),autogetSecondAttempt:k.default.object().pattern(k.default.string(),[k.default.boolean(),k.default.number()]).optional(),requiredFieldsForConsensusCompletion:k.default.array().items(k.default.string()).optional(),fieldResponseValuesToTarget:k.default.object().pattern(k.default.string(),k.default.any()).optional()}),eR=k.default.object().keys({}),eO=k.default.object().keys({numDownsampledL0Reviews:k.default.number().integer().min(0),needsDownsampledL1Review:k.default.boolean(),needsDownsampledCorpReview:k.default.boolean(),numDetailL0Reviews:k.default.number().integer().min(0),needsDetailL1Review:k.default.boolean(),needsDetailCorpReview:k.default.boolean(),numSinglePathL0Reviews:k.default.number().integer().min(0),needsSinglePathL1Review:k.default.boolean(),needsSinglePathCorpReview:k.default.boolean(),numFinalDetailL0Reviews:k.default.number().integer().min(0),needsFinalDetailL1Review:k.default.boolean(),needsFinalDetailCorpReview:k.default.boolean()}),eD=k.default.object().keys({detection:en,refinement:en,reconciliation:en,subprojectToLabelGroupsMap:k.default.object().pattern(k.default.string().lowercase().length(1),k.default.array().items(k.default.string())).required()}),eN=en.keys({splittingConfig:k.default.object().optional().keys({strategy:k.default.string().valid(...Object.values(z.DocumentSplittingStrategy)).required(),maxSubdocumentPages:k.default.number().integer().min(1).required()}),processAttachmentsInPipeline:k.default.boolean().optional(),redactedLabels:k.default.array().items(k.default.string()).optional(),preLabelModel:k.default.string().optional(),instantModel:k.default.string().optional(),enableRedactionSubtask:k.default.boolean().optional(),barcodeScanner:k.default.object().optional().keys({scanners:k.default.array().items(k.default.string().valid(...Object.values(V.BarcodeScanner))).required()})}),eG=k.default.object().keys({nlzLabels:k.default.array().items(k.default.string())}),eB=k.default.object().keys({numL0Reviews:k.default.number().integer().min(0).max(0),needsL1Review:k.default.boolean(),needsCorpReview:k.default.boolean(),responsesRequired:k.default.number().integer().min(1).optional(),instantModel:k.default.string().required(),skipPipeline:k.default.boolean().optional()}),eW={[g.TaskPipelineName.StandardTask]:ee,[g.TaskPipelineName.VideoStitchingTask]:ex,[g.TaskPipelineName.VideoPlaybackStitchingTask]:eM,[g.TaskPipelineName.TaxonomyChunkingTask]:eb,[g.TaskPipelineName.GenerationTask]:ev,[g.TaskPipelineName.EvalPipeline]:e_,[g.TaskPipelineName.FairEvalPipeline]:eT,[g.TaskPipelineName.FairGenerationPipeline]:ek,[g.TaskPipelineName.AirdaleGenerationPipeline]:eA,[g.TaskPipelineName.MiniLidarTask]:ec,[g.TaskPipelineName.DoordashSpecializationTask]:eC,[g.TaskPipelineName.LidarLinkingTask]:ea,[g.TaskPipelineName.LidarLinkingSplitCameraTask]:ea,[g.TaskPipelineName.LidarLinkingSplitTrackTask]:es,[g.TaskPipelineName.LidarLinkingBoxerAttributerTask]:el,[g.TaskPipelineName.LidarLinkingSparseDenseTask]:eu,[g.TaskPipelineName.LidarLinkingVideoSemsegTask]:ea,[g.TaskPipelineName.MiniLidarSpecializationTask]:ep,[g.TaskPipelineName.LidarSpecializationTask]:ef,[g.TaskPipelineName.ConsensusTask]:em,[g.TaskPipelineName.ResponseCollectionTask]:ee,[g.TaskPipelineName.BeeNERTask]:ey,[g.TaskPipelineName.BeeLidarTopdownTask]:eL,[g.TaskPipelineName.BeeStitchingLidarTopdownTask]:eL,[g.TaskPipelineName.BeeVideoTranscriptionTask]:ed,[g.TaskPipelineName.VideoAttributeConsensusTask]:eh,[g.TaskPipelineName.LidarStitchingTask]:eP,[g.TaskPipelineName.LidarTopdownTask]:eL,[g.TaskPipelineName.LidarTopdownUpdateTask]:eL,[g.TaskPipelineName.ImageCaptioningTask]:eI,[g.TaskPipelineName.TargetedReviewTask]:eF,[g.TaskPipelineName.FlamingoBulletsTask]:ew,[g.TaskPipelineName.CatalogTargetedReviewTask]:eE,[g.TaskPipelineName.ReviewOnlyTask]:ee,[g.TaskPipelineName.TranslationTask]:em,[g.TaskPipelineName.PassionfruitDtTask]:eR,[g.TaskPipelineName.LidarSampledDiscoveryTask]:eO,[g.TaskPipelineName.TwoDeeSpecializationTask]:eD,[g.TaskPipelineName.DocumentModelTask]:k.default.object(),[g.TaskPipelineName.DocumentTranscriptionTask]:eN,[g.TaskPipelineName.FreeformTextCollectionTask]:ee,[g.TaskPipelineName.VideoCollectedResponseTask]:ee,[g.TaskPipelineName.GenericDataCollectionTask]:ee,[g.TaskPipelineName.GenericDataCollectionV2Task]:U.genericDataCollectionTaskValidator,[g.TaskPipelineName.DelphiCategorizationTask]:ei,[g.TaskPipelineName.ConfigurableSpecializationTask]:eo,[g.TaskPipelineName.TestDefinedTask]:k.default.object(),[g.TaskPipelineName.CarperAIPipeline]:k.default.object(),[g.TaskPipelineName.CuboidIntoHumanKeypointTask]:A.cuboidIntoHumanKeypointTaskValidator,[g.TaskPipelineName.SimpleFlatMiniLidarTask]:x.simpleFlatMiniLidarTaskValidator,[g.TaskPipelineName.LidarFramelessTask]:P.lidarFramelessTaskValidator,[g.TaskPipelineName.LidarFramelessV2Task]:w.lidarFramelessV2TaskValidator,[g.TaskPipelineName.DummyMultisubtaskTask]:F.dummyMultisubtaskTaskValidator,[g.TaskPipelineName.DummyExperimentalSubprojectTask]:R.dummyExperimentalSubprojectTaskValidator,[g.TaskPipelineName.MultiSubtaskConsensusTask]:D.multiSubtaskConsensusTaskValidator,[g.TaskPipelineName.LidarCategorizationTask]:G.lidarCategorizationTaskValidator,[g.TaskPipelineName.LidarCategorizationStationaryDynamicTask]:K.lidarStationaryDynamicCategorizationTaskValidator,[g.TaskPipelineName.MiniLssTask]:B.miniLssTaskValidator,[g.TaskPipelineName.QuadrantLssTask]:W.quadrantLssTaskValidator,[g.TaskPipelineName.WayfairBoxReviewTask]:k.default.object(),[g.SubtaskPipelineName.Consensus]:eg,[g.SubtaskPipelineName.StandardSubtask]:en,[g.SubtaskPipelineName.RedactionSubtask]:er,[g.SubtaskPipelineName.ResponseCollectionSubtask]:en,[g.PreFinalizationPipelineName.BeeLSSUpsampling]:k.default.object(),[g.SubpipelineName.LidarTaskProcessing]:k.default.object(),[g.SubpipelineName.BeeLssPostProcessing]:k.default.object(),[g.SubpipelineName.FlamingoXrTechPostProcessing]:k.default.object(),[g.SubpipelineName.SensorFusionPostProcessing]:k.default.object(),[g.OrphanPipelineName.LidarPostProcessing]:k.default.object(),[g.OrphanPipelineName.LidarTaskProcessing]:k.default.object(),[g.OrphanPipelineName.TestDefinedTask]:k.default.object(),[g.TaskPipelineName.BulletsStandardTask]:et,[g.TaskPipelineName.LidarStationaryDynamicSeriesTask]:eG,[g.TaskPipelineName.XRTechTask]:k.default.object(),[g.TaskPipelineName.XRTechParallelTask]:k.default.object(),[g.TaskPipelineName.SensorFusionTask]:J.sensorFusionTaskValidator,[g.TaskPipelineName.LegoLssCustomizablePipeline]:Z.legoLssCustomizablePipelineValidator,[g.TaskPipelineName.DocumentTranscriptionInstantModelTask]:eB,[g.TaskPipelineName.ForgeAssetCuration]:em,[g.TaskPipelineName.RLHFStandardTask]:eS},ej=k.default.object().keys({autoflagParams:Y.autoflagParamsValidator.optional(),predictionsParams:$.predictionsParamsValidator.optional()});a.commonPipelineValidator=ej;let ez=k.default.array().items(k.default.object({modelKey:k.default.string().min(1).required(),taskDataPath:k.default.alternatives().conditional("s3",{is:k.default.required(),then:k.default.allow(null,k.default.string().empty()),otherwise:k.default.string().min(1).required()}),s3:k.default.alternatives().conditional("taskDataPath",{is:k.default.string().min(1).required(),then:k.default.allow(null),otherwise:k.default.object({uriPrefix:k.default.string().required(),taskKeyPath:k.default.string().required(),objectValuePath:k.default.string().required(),keySuffix:k.default.string().required().allow("")}).required()})}).unknown());a.validateTRModelConfig=o=>!ez.validate(o).error},603638:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.autoflagParamsValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({useAutoflag:g.default.boolean(),modelName:g.default.string().allow(""),linterName:g.default.string().allow("")});a.autoflagParamsValidator=k},749715:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.cuboidIntoHumanKeypointTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object();a.cuboidIntoHumanKeypointTaskValidator=k},313750:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.dummyExperimentalSubprojectTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({});a.dummyExperimentalSubprojectTaskValidator=k},711195:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.dummyMultisubtaskTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({});a.dummyMultisubtaskTaskValidator=k},466162:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.genericDataCollectionTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({numL0Reviews:g.default.number().integer().min(0),needsL1Review:g.default.boolean(),needsCorpReview:g.default.boolean(),needsTextCollectionReview:g.default.boolean().optional(),needsAnonymization:g.default.boolean().optional()});a.genericDataCollectionTaskValidator=k},75796:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.legoLssCustomizablePipelineValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({numL0Reviews:g.default.number().integer().min(0),needsL1Review:g.default.boolean(),needsCorpReview:g.default.boolean(),taxonomySplitParams:g.default.any().optional(),allLabelTaxonomy:g.default.array().items(g.default.object()).optional()});a.legoLssCustomizablePipelineValidator=k},393714:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.lidarCategorizationTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c},k=s(603638);let A=g.default.object().keys({needsPolygonMiniLidar:g.default.boolean().optional(),polygonMargin:g.default.number().optional(),polygonLabels:g.default.array().items(g.default.string()),numPolygonL0Reviews:g.default.number(),needsPolygonL1Review:g.default.boolean(),needsPolygonCorpReview:g.default.boolean(),numMiniLidarL0Reviews:g.default.number(),needsMiniLidarL1Review:g.default.boolean(),needsMiniLidarCorpReview:g.default.boolean(),numFinalL0Reviews:g.default.number(),needsFinalL1Review:g.default.boolean(),needsFinalCorpReview:g.default.boolean(),numCategorizationL0Reviews:g.default.number().integer().min(0),needsCategorizationL1Review:g.default.boolean(),needsCategorizationCorpReview:g.default.boolean(),autoflagParams:k.autoflagParamsValidator.optional(),numL0Reviews:g.default.number().integer().min(0),needsL1Review:g.default.boolean(),needsCorpReview:g.default.boolean(),taxonomySplitParams:g.default.any().optional(),finalRejectionLimit:g.default.any().optional(),needsDetailedCategorization:g.default.any().optional(),numDetailedCategorizationL0Reviews:g.default.any().optional(),needsDetailedCategorizationL1Review:g.default.any().optional(),needsDetailedCategorizationCorpReview:g.default.any().optional(),numConsensusAttempts:g.default.any().optional(),needsConsensusCorpReview:g.default.any().optional(),goodDataString:g.default.any().optional(),badDataString:g.default.any().optional(),badDataCategories:g.default.any().optional(),detailedBadDataCategories:g.default.any().optional(),mapBadDataToTags:g.default.any().optional(),attributes:g.default.any().optional(),useMLDifficultyCatModel:g.default.any().optional()});a.lidarCategorizationTaskValidator=A},102213:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.lidarFramelessTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({frameRateHz:g.default.number().integer().min(10),regularNumL0Reviews:g.default.number().integer().min(0).optional(),regularNeedsL1Review:g.default.boolean().optional(),regularNeedsCorpReview:g.default.boolean().optional(),miniNumL0Reviews:g.default.number().integer().min(0).optional(),miniNeedsL1Review:g.default.boolean().optional(),miniNeedsCorpReview:g.default.boolean().optional(),finalNumL0Reviews:g.default.number().integer().min(0).optional(),finalNeedsL1Review:g.default.boolean().optional(),finalNeedsCorpReview:g.default.boolean().optional()});a.lidarFramelessTaskValidator=k},643646:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.lidarFramelessV2TaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({regularNumL0Reviews:g.default.number().integer().min(0).optional(),regularNeedsL1Review:g.default.boolean().optional(),regularNeedsCorpReview:g.default.boolean().optional(),numCategorizationL0Reviews:g.default.number().integer().min(0).optional(),needsCategorizationL1Review:g.default.boolean().optional(),needsCategorizationCorpReview:g.default.boolean().optional(),needsDetailedCategorization:g.default.boolean().optional(),numDetailedCategorizationL0Reviews:g.default.number().integer().min(0).optional(),needsDetailedCategorizationL1Review:g.default.boolean().optional(),needsDetailedCategorizationCorpReview:g.default.boolean().optional(),goodDataString:g.default.string().optional(),badDataString:g.default.string().optional(),badDataCategories:g.default.array().items(g.default.string()).optional(),detailedBadDataCategories:g.default.array().items(g.default.string()).optional(),mapBadDataToTags:g.default.boolean().optional()});a.lidarFramelessV2TaskValidator=k},696722:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.lidarStationaryDynamicCategorizationTaskValidator=a.lidarCategorizationPerStageReviewValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c},k=s(603638);let A=g.default.object().keys({numL0Reviews:g.default.number().integer().min(0).optional(),needsL1Review:g.default.boolean().optional(),needsCorpReview:g.default.boolean().optional(),holdDeliverable:g.default.boolean().optional(),autoflagParams:k.autoflagParamsValidator.optional()});a.lidarCategorizationPerStageReviewValidator=A;let x=g.default.object().keys({stationaryVehicleStageParams:A.optional(),dynamicVehicleStageParams:A.optional(),otherStageParams:A.optional(),mergedStageParams:A.optional(),stationaryVehicleLabels:g.default.array().items(g.default.string()).optional(),dynamicVehicleLabels:g.default.array().items(g.default.string()).optional(),otherLabels:g.default.array().items(g.default.string()).optional(),numFinalL0Reviews:g.default.number().integer().min(0).required(),needsFinalL1Review:g.default.boolean().required(),needsFinalCorpReview:g.default.boolean().required(),finalRejectionLimit:g.default.number().integer().min(0).optional(),numCategorizationL0Reviews:g.default.number().integer().min(0).required(),needsCategorizationL1Review:g.default.boolean().required(),needsCategorizationCorpReview:g.default.boolean().required(),needsDetailedCategorization:g.default.boolean().required(),numDetailedCategorizationL0Reviews:g.default.number().integer().min(0).required(),needsDetailedCategorizationL1Review:g.default.boolean().required(),needsDetailedCategorizationCorpReview:g.default.boolean().required(),numConsensusAttempts:g.default.number().integer().min(0).optional(),needsConsensusCorpReview:g.default.boolean().optional(),goodDataString:g.default.string().optional(),badDataString:g.default.string().optional(),badDataCategories:g.default.array().items(g.default.string()).optional(),detailedBadDataCategories:g.default.array().items(g.default.string()).optional(),mapBadDataToTags:g.default.boolean().optional(),attributes:g.default.object().optional()});a.lidarStationaryDynamicCategorizationTaskValidator=x},704799:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.miniLssTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({downsampleResolution:1,chunkSize:1,contextRadius:1,numDownsampledL0Reviews:1,needsDownsampledL1Review:1,needsDownsampledCorpReview:1,numChunkedL0Reviews:1,needsChunkedL1Review:1,needsChunkedCorpReview:1,numFinalL0Reviews:1,needsFinalL1Review:1,needsFinalCorpReview:1,skipDownsampleStage:1});a.miniLssTaskValidator=k},844707:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.multiSubtaskConsensusTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({numAttempts:g.default.number().integer().min(2),maxTries:g.default.number().integer().min(1),numPreConsensusL0Reviews:g.default.number().integer().min(0),needsPreConsensusL1Review:g.default.boolean(),needsPreConsensusCorpReview:g.default.boolean(),numPostConsensusL0Reviews:g.default.number().integer().min(0),needsPostConsensusL1Review:g.default.boolean(),needsPostConsensusCorpReview:g.default.boolean(),sendFailedConsensusToQABeforeCustomer:g.default.boolean(),holdDeliverablePreConsensus:g.default.boolean().optional(),holdDeliverablePostConsensus:g.default.boolean().optional(),holdDeliverablePostQA:g.default.boolean().optional()});a.multiSubtaskConsensusTaskValidator=k},968700:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.quadrantLssTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c};let k=g.default.object().keys({numQuadrantL0Reviews:g.default.number().integer().min(0),needsQuadrantL1Review:g.default.boolean().optional(),needsQuadrantCorpReview:g.default.boolean().optional(),numMergedL0Reviews:g.default.number().integer().min(0),needsMergedL1Review:g.default.boolean().optional(),needsMergedCorpReview:g.default.boolean().optional()});a.quadrantLssTaskValidator=k},312388:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.sensorFusionTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c},k=s(696722);let A=g.default.object().keys({calibrateStageParams:k.lidarCategorizationPerStageReviewValidator.optional(),standardCuboidStageParams:k.lidarCategorizationPerStageReviewValidator.optional(),vehicleStageParams:k.lidarCategorizationPerStageReviewValidator.optional(),trafficObjectStageParams:k.lidarCategorizationPerStageReviewValidator.optional(),otherStageParams:k.lidarCategorizationPerStageReviewValidator.optional(),mergedStageParams:k.lidarCategorizationPerStageReviewValidator.optional(),vehicleLabels:g.default.array().items(g.default.string()).optional(),trafficObjectLabels:g.default.array().items(g.default.string()).optional(),skipLocalization:g.default.boolean().optional(),skipPostProcessingInPipeline:g.default.boolean().optional(),lidarTaskProcessingParams:g.default.object().keys({workflow:g.default.string().optional()}).optional(),numL0Reviews:g.default.number().integer().min(0),needsL1Review:g.default.boolean(),needsCorpReview:g.default.boolean()});a.sensorFusionTaskValidator=A},127627:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.simpleFlatMiniLidarTaskValidator=void 0;var c,g=(c=s(39300))&&c.__esModule?c:{default:c},k=s(309028);let A=g.default.object({vehicleStageParams:k.perStageReviewValidator.optional(),vehicleAttributeParams:k.perStageReviewValidator.optional(),pedStageParams:k.perStageReviewValidator.optional(),pedAttributeParams:k.perStageReviewValidator.optional(),otherStageParams:k.perStageReviewValidator.optional(),otherAttributeParams:k.perStageReviewValidator.optional(),mergedStageParams:k.perStageReviewValidator.optional(),pedLabels:g.default.array().items(g.default.string()).optional(),vehicleLabels:g.default.array().items(g.default.string()).optional(),otherLabels:g.default.array().items(g.default.string()).optional(),lidarTaskProcessingParams:g.default.any().optional()});a.simpleFlatMiniLidarTaskValidator=A},681286:function(o,a){"use strict";var s,c,g,k,A,x,P,w,F,R,D,G;Object.defineProperty(a,"__esModule",{value:!0}),a.BenchmarkTaskerStage=a.TaskerStage=a.ProjectMetricsGeneratorType=a.StandardProjectMetricLabels=a.StandardProjectMetric=a.ProjectMetricType=a.ProjectMetricFrequency=a.DEFAULT_COPY_IDS_MESSAGE=a.MAX_QUERY_LIMIT=a.MAX_COPY_IDS_SIZE=a.BATCH_SIZE=void 0,a.BATCH_SIZE=50,a.MAX_COPY_IDS_SIZE=50,a.MAX_QUERY_LIMIT=500,a.DEFAULT_COPY_IDS_MESSAGE="Nothing found. Sorry!",a.ProjectMetricFrequency=s,(P=s||(a.ProjectMetricFrequency=s={})).Week="week",P.Day="day",P.Hour="hour",a.ProjectMetricType=c,(w=c||(a.ProjectMetricType=c={})).Number="number",w.TimeSeries="time_series",w.Distribution="distribution",w.HeatMap="heat_map",w.Sankey="sankey",a.StandardProjectMetric=g,(F=g||(a.StandardProjectMetric=g={})).AttemptThroughput="attempt_throughput",F.BenchmarkByWorkerDistribution="benchmark_by_worker_distribution",F.ConsensusConfidenceDistribution="consensus_confidence_distribution",F.BenchmarkAccByWeek="benchmark_accuracy_by_week",F.BenchmarkAccByDay="benchmark_accuracy_by_day",F.CompletedTasksByWeek="completed_tasks_by_week",F.CompletedTasksByDay="completed_tasks_by_day",F.BenchmarkByReviewerDistribution="benchmark_by_reviewer_distribution",F.BenchmarkByAvgScoreDistribution="benchmark_by_avg_score_distribution",F.BenchmarkByAvgReviewerScoreDistribution="benchmark_by_avg_reviewer_score_distribution",F.PermissionedWorkerDistribution="permissioned_worker_distribution",F.SubtaskLatency="average_subtask_latency",F.BenchmarkDistribution="benchmark_distribution",F.BenchmarkCompletionDistribution="benchmark_completion_distribution",F.TimeSpentDistribution="subtask_time_spent_distribution",F.TaskerStages="tasker_stages",F.BenchmarkTaskerStages="benchmark_tasker_stages",F.PermissionedWorkersLastAttempt="permissioned_workers_last_attempt",F.AssignedWorkersLastOnline="assigned_workers_last_online",F.HourlyPay="hourly_pay",F.HourlyPayUnscaled="hourly_pay_unscaled",F.BenchmarkDisabling="benchmark_disabling",F.BenchmarkThroughput="benchmark_throughput",F.TaskerCountryDistribution="tasker_country_distribution",F.TaskAttemptTimeSpentDistribution="task_attempt_time_spent_distribution",F.SankeyRecentPipeline="sankey_recent_pipeline",F.AverageWorkerBenchmarkAccuracyDistribution="average_worker_benchmark_accuracy_distribution",F.HourlyPayByAverageBenchmarkAccuracy="hourly_pay_by_average_benchmark_accuracy",F.BurstyTierTaskers="bursty_tier_taskers",F.DistinctTaskersPerDay="distinct_taskers_per_day";let B={[g.AttemptThroughput]:"Throughput Stats",[g.SubtaskLatency]:"Average Subtask Latency",[g.BenchmarkAccByWeek]:"Project Evaluation Task Accuracies By Week",[g.BenchmarkAccByDay]:"Project Evaluation Task Accuracies By Day",[g.CompletedTasksByWeek]:"Completed Tasks By Week",[g.CompletedTasksByDay]:"Completed Tasks By Day",[g.BenchmarkByWorkerDistribution]:"Evaluation Task Accuracies By Tasker (Initial Phase)",[g.BenchmarkByReviewerDistribution]:"Evaluation Task Accuracies By Reviewer (Review Phase)",[g.BenchmarkByAvgScoreDistribution]:"Evaluation Task Accuracies By Task (Initial Phase)",[g.BenchmarkByAvgReviewerScoreDistribution]:"Evaluation Task Accuracies By Task (Review Phase)",[g.BenchmarkCompletionDistribution]:"Benchmark Completion Rate",[g.PermissionedWorkerDistribution]:"Workers on Project",[g.ConsensusConfidenceDistribution]:"Consensus Confidence Across Labels",[g.BenchmarkDistribution]:"Benchmark Distribution",[g.TimeSpentDistribution]:"Subtask Time Spent Distribution",[g.TaskerStages]:"Tasker Stages",[g.BenchmarkTaskerStages]:"Benchmark Tasker Stages",[g.PermissionedWorkersLastAttempt]:"Permissioned Worker's Last Attempts",[g.AssignedWorkersLastOnline]:"Assigned Worker's Time Since Last Online",[g.HourlyPay]:"Hourly Pay",[g.HourlyPayUnscaled]:"Hourly Pay - Unscaled",[g.BenchmarkDisabling]:"Benchmark Disabling",[g.BenchmarkThroughput]:"Benchmark Throughput",[g.TaskerCountryDistribution]:"Tasker Country Distribution",[g.TaskAttemptTimeSpentDistribution]:"Task Attempt Time Spent Distribution",[g.SankeyRecentPipeline]:"Recent Pipeline Activity",[g.AverageWorkerBenchmarkAccuracyDistribution]:"Average Worker BM Accuracies",[g.HourlyPayByAverageBenchmarkAccuracy]:"Hourly Pay by Average BM Accuracy",[g.BurstyTierTaskers]:"Count of Assigned Bursty Tier Taskers",[g.DistinctTaskersPerDay]:"Active Taskers Per Day"};a.StandardProjectMetricLabels=B,a.ProjectMetricsGeneratorType=k,(R=k||(a.ProjectMetricsGeneratorType=k={})).AttemptThroughputStats="throughput_stats",R.SubtaskCompletionStats="subtask_completion_stats",R.BenchmarkAccByWeek="benchmark_accuracy_by_week",R.BenchmarkAccByDay="benchmark_accuracy_by_day",R.CompletedTasksByWeek="completed_tasks_by_week",R.CompletedTasksByDay="completed_tasks_by_day",R.BenchmarkDistribution="benchmark_distribution",R.BenchmarkCompletionDistribution="benchmark_completion_distribution",R.BenchmarkByWorkerDistribution="benchmark_by_worker_distribution",R.ConsensusConfidenceDistribution="consensus_confidence_distribution",R.BenchmarkByReviewerDistribution="benchmark_by_reviewer_distribution",R.BenchmarkByAvgScoreDistribution="benchmark_by_avg_score_distribution",R.BenchmarkByAvgReviewerScoreDistribution="benchmark_by_avg_reviewer_score_distribution",R.PermissionedWorkerDistribution="permissioned_worker_distribution",R.TimeSpentDistribution="time_spent_distribution",R.TaskerStages="tasker_stages",R.BenchmarkTaskerStages="benchmark_tasker_stages",R.PermissionedWorkersLastAttempt="permissioned_workers_last_attempt",R.AssignedWorkersLastOnline="assigned_workers_last_online",R.HourlyPayStats="hourly_pay",R.HourlyPayUnscaledStats="hourly_pay_unscaled",R.BenchmarkDisablingStats="benchmark_disabling",R.BenchmarkThroughputStats="benchmark_throughput",R.TaskerCountryDistribution="tasker_country_distribution",R.TaskAttemptTimeSpentDistribution="task_attempt_time_spent_distribution",R.SankeyRecentPipelineStats="sankey_recent_pipeline_stats_v2",R.IncentivesHealth="incentives_health",R.BurstyTierTaskers="bursty_tier_taskers",R.DistinctTaskersPerDay="distinct_taskers_per_day",a.TaskerStage=A,(D=A||(a.TaskerStage=A={})).Permissioned="permissioned",D.Benchmark="benchmark",D.Attempt="attempt",a.BenchmarkTaskerStage=x,(G=x||(a.BenchmarkTaskerStage=x={})).Disabled="disabled",G.ZeroBenchmark="zero_benchmark",G.AtLeastOneBenchmark="at_least_one_benchmark",G.BelowConfigBenchmark="below_config_benchmark",G.AboveConfigBenchmark="above_config_benchmark",G.Attempt="attempt"},202466:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.extractWordsFromText=a.isValidObjectId=a.OBJECT_ID_REGEX=void 0;let s=/^[a-f\d]{24}$/i;a.OBJECT_ID_REGEX=s,a.isValidObjectId=o=>s.test(o),a.extractWordsFromText=(o,a)=>{if(!o||!a||0===a.length)return[];let s=RegExp(`(?<=\\b|_)(?:${a.join("|")})(?=\\b|_)`,"gi"),c=o.match(s)||[];return[...new Set(c.map(o=>o.toLowerCase()))]}},89916:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.SUPPORTED_PRETTY_PRINT_FORMATS=a.fullLanguageMap=a.LANGUAGE_OPTIONS=a.fileExtensionToLanguageTypeMap=a.FileLanguageType=void 0,a.FileLanguageType=s,(c=s||(a.FileLanguageType=s={})).Python="python",c.Java="java",c.CPP="cpp",c.CSharp="csharp",c.Javascript="javascript",c.Typescript="typescript",c.SQL="sql",c.Text="text",c.Swift="swift",c.Ruby="ruby",c.Go="go",c.PHP="php",c.Kotlin="kotlin",c.Dart="dart",c.Bash="bash",c.C="c",c.Scala="scala",c.JSON="json",c.None="";let g={".py":s.Python,".java":s.Java,".cpp":s.CPP,".cs":s.CSharp,".js":s.Javascript,".ts":s.Typescript,".sql":s.SQL,".swift":s.Swift,".rb":s.Ruby,".go":s.Go,".php":s.PHP,".kt":s.Kotlin,".dart":s.Dart,".bash":s.Bash,".c":s.C,".scala":s.Scala};a.fileExtensionToLanguageTypeMap=g;let k=[{id:s.Python,name:"Python"},{id:s.Javascript,name:"Javascript"},{id:s.Typescript,name:"Typescript"},{id:s.Java,name:"Java"},{id:s.CPP,name:"C++"},{id:s.CSharp,name:"C#"},{id:s.Swift,name:"Swift"},{id:s.Ruby,name:"Ruby"},{id:s.Go,name:"Go"},{id:s.PHP,name:"PHP"},{id:s.Kotlin,name:"Kotlin"},{id:s.Dart,name:"Dart"},{id:s.Bash,name:"Bash"},{id:s.C,name:"C"},{id:s.Scala,name:"Scala"}];a.LANGUAGE_OPTIONS=k,a.fullLanguageMap={javascript:"JavaScript",jsx:"React JSX",typescript:"TypeScript",tsx:"React TSX",html:"HTML",css:"CSS",python:"Python",java:"Java",csharp:"C#",cpp:"C++",kotlin:"Kotlin",sql:"SQL",swift:"Swift",go:"Go",ruby:"Ruby",php:"PHP",rust:"Rust",scala:"Scala",json:"JSON",yaml:"YAML",markdown:"Markdown",objectivec:"Objective-C",ocaml:"OCaml",haskell:"Haskell",erlang:"Erlang",dart:"Dart",bash:"Bash",text:"Text",lua:"Lua",c:"C",clojure:"Clojure",objectivecpp:"Objective-C++",perl:"Perl",julia:"Julia"};let A=[{id:s.JSON,name:"JSON"}];a.SUPPORTED_PRETTY_PRINT_FORMATS=A},716375:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"AreaGeofence",{enumerable:!0,get:function(){return w.AreaGeofence}}),Object.defineProperty(a,"VolumeGeofence",{enumerable:!0,get:function(){return w.VolumeGeofence}}),Object.defineProperty(a,"WhaleGeofence",{enumerable:!0,get:function(){return w.WhaleGeofence}}),Object.defineProperty(a,"Geofence",{enumerable:!0,get:function(){return w.Geofence}}),Object.defineProperty(a,"AttributeCondition",{enumerable:!0,get:function(){return w.AttributeCondition}}),Object.defineProperty(a,"ActualAttributeConditions",{enumerable:!0,get:function(){return w.ActualAttributeConditions}}),Object.defineProperty(a,"CategoricalAttribute",{enumerable:!0,get:function(){return w.CategoricalAttribute}}),Object.defineProperty(a,"NumericalAttribute",{enumerable:!0,get:function(){return w.NumericalAttribute}}),Object.defineProperty(a,"NumericalArrayAttribute",{enumerable:!0,get:function(){return w.NumericalArrayAttribute}}),Object.defineProperty(a,"LinkedAttribute",{enumerable:!0,get:function(){return w.LinkedAttribute}}),Object.defineProperty(a,"NERGlobalAttribute",{enumerable:!0,get:function(){return w.NERGlobalAttribute}}),Object.defineProperty(a,"AnnotationAttribute",{enumerable:!0,get:function(){return w.AnnotationAttribute}}),Object.defineProperty(a,"AnnotationAttributes",{enumerable:!0,get:function(){return w.AnnotationAttributes}}),Object.defineProperty(a,"AnnotationGeometry",{enumerable:!0,get:function(){return w.AnnotationGeometry2D}}),a.isBoxAnnotation=function(o){return!!o.geometry&&o.geometry===w.AnnotationGeometry2D.Box||"type"in o&&o.type===w.AnnotationGeometry2D.Box},a.isLinkableBoxAnnotation=function(o){return!!o.type&&o.type===w.AnnotationGeometry2D.Box},a.isLinkablePointAnnotation=function(o){return!!o.type&&o.type===w.AnnotationGeometry2D.Point},a.isLinkablePolygonAnnotation=function(o){return!!o.type&&o.type===w.AnnotationGeometry2D.Polygon},a.isPathAnnotation=function(o){return("geometry"in o&&!!o.geometry&&R.includes(o.geometry)||"type"in o&&R.includes(o.type))&&!!o.vertices},a.isPolygonAnnotation=function(o){return(!!o.geometry&&o.geometry===w.AnnotationGeometry2D.Polygon||"type"in o&&o.type===w.AnnotationGeometry2D.Polygon)&&!!o.vertices},a.isLineAnnotation=function(o){return(!!o.geometry&&o.geometry===w.AnnotationGeometry2D.Line||"type"in o&&o.type===w.AnnotationGeometry2D.Line)&&!!o.vertices},a.isPathImageAnnotation=function(o){return o.geometry===w.AnnotationGeometry2D.Line||o.geometry===w.AnnotationGeometry2D.Polygon},a.isPointAnnotation=function(o){return!!o.geometry&&o.geometry===w.AnnotationGeometry2D.Point||"type"in o&&o.type===w.AnnotationGeometry2D.Point},a.isCuboidAnnotation=function(o){return!!o.geometry&&o.geometry===w.AnnotationGeometry2D.Cuboid||"type"in o&&o.type===w.AnnotationGeometry2D.Cuboid},a.isFrontendOrBackendPathAnnotation=function(o){return isFrontendOrBackendPolygonAnnotation(o)||isFrontendOrBackendLineAnnotation(o)},a.isFrontendOrBackendPolygonAnnotation=isFrontendOrBackendPolygonAnnotation,a.isFrontendOrBackendLineAnnotation=isFrontendOrBackendLineAnnotation,a.isFrontendOrBackendPointAnnotation=function(o){let a;return"geometry"in o?a=o.geometry:"type"in o&&(a=o.type),a===w.AnnotationGeometry2D.Point&&"x"in o&&"y"in o},a.isFrontendOrBackendSpotterAnnotation=function(o){return[F.SPOTTER_POLYGON,F.SPOTTER_POINT].includes(o.label??"")},a.LinkNotPresent=a.GLOBAL_ATTRIBUTES_GRADER_ID=a.CuboidEdgeDesc=a.CuboidVertexDesc=a.KeyframeType=a.taskTypeToGeometry=a.geometryToVideoTaskType=a.geometryToTaskType=a.pathGeometries=void 0;var c,g,k,A,x,P,w=s(167469),F=s(143986);let R=[w.AnnotationGeometry2D.Line,w.AnnotationGeometry2D.Polygon];a.pathGeometries=R;let D={Polygon:w.TaskType.PolygonAnnotation,Point:w.TaskType.PointAnnotation,[w.AnnotationGeometry2D.Ellipse]:w.TaskType.EllipseAnnotation,[w.AnnotationGeometry2D.Point]:w.TaskType.PointAnnotation,[w.AnnotationGeometry2D.Box]:w.TaskType.Annotation,[w.AnnotationGeometry2D.Line]:w.TaskType.LineAnnotation,[w.AnnotationGeometry2D.Cuboid]:w.TaskType.CuboidAnnotation,[w.AnnotationGeometry2D.Polygon]:w.TaskType.PolygonAnnotation,[w.AnnotationGeometry2D.LidarCuboid]:w.TaskType.LidarAnnotation,[w.AnnotationGeometry2D.LidarPoint]:w.TaskType.LidarPointAnnotation};a.geometryToTaskType=D;let G={[w.AnnotationGeometry2D.Ellipse]:w.TaskType.EllipseAnnotation,[w.AnnotationGeometry2D.Point]:w.TaskType.PointAnnotation,[w.AnnotationGeometry2D.Box]:w.TaskType.VideoBoxAnnotation,[w.AnnotationGeometry2D.Line]:w.TaskType.LineAnnotation,[w.AnnotationGeometry2D.Cuboid]:w.TaskType.VideoCuboidAnnotation,[w.AnnotationGeometry2D.Polygon]:w.TaskType.VideoPolygonAnnotation};a.geometryToVideoTaskType=G;let B={[w.TaskType.PointAnnotation]:w.AnnotationGeometry2D.Point,[w.TaskType.LineAnnotation]:w.AnnotationGeometry2D.Line,[w.TaskType.Annotation]:w.AnnotationGeometry2D.Box,[w.TaskType.CuboidAnnotation]:w.AnnotationGeometry2D.Cuboid,[w.TaskType.PolygonAnnotation]:w.AnnotationGeometry2D.Polygon,[w.TaskType.VideoBoxAnnotation]:w.AnnotationGeometry2D.Box,[w.TaskType.VideoCuboidAnnotation]:w.AnnotationGeometry2D.Cuboid,[w.TaskType.VideoPolygonAnnotation]:w.AnnotationGeometry2D.Polygon,[w.TaskType.LidarAnnotation]:w.AnnotationGeometry2D.LidarCuboid,[w.TaskType.LidarPointAnnotation]:w.AnnotationGeometry2D.LidarPoint};function isFrontendOrBackendPolygonAnnotation(o){let a;return"geometry"in o?a=o.geometry:"type"in o&&(a=o.type),a===w.AnnotationGeometry2D.Polygon&&"vertices"in o}function isFrontendOrBackendLineAnnotation(o){let a;return"geometry"in o?a=o.geometry:"type"in o&&(a=o.type),a===w.AnnotationGeometry2D.Line&&"vertices"in o}a.taskTypeToGeometry=B,a.KeyframeType=A,(c=A||(a.KeyframeType=A={})).Start="start",c.Middle="middle",c.End="end",a.CuboidVertexDesc=x,(g=x||(a.CuboidVertexDesc=x={})).FaceTopLeft="face-topleft",g.FaceBottomLeft="face-bottomleft",g.FaceTopRight="face-topright",g.FaceBottomRight="face-bottomright",g.SideTopCorner="side-topcorner",g.SideBottomCorner="side-bottomcorner",a.CuboidEdgeDesc=P,(k=P||(a.CuboidEdgeDesc=P={})).FaceTop="face-top",k.FaceBottom="face-bottom",k.FaceLeft="face-left",k.FaceRight="face-right",k.SideTop="side-top",k.SideBottom="side-bottom",k.SideBack="side-back",a.GLOBAL_ATTRIBUTES_GRADER_ID="_global_attributes",a.LinkNotPresent="__LINK_NOT_PRESENT__"},492027:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createLineFromPoints=a.createEdgeFromPoints=a.getPointsFromLine=a.createLineFromEdges=a.isSharedDerivedPoint=a.isLayer2DerivedPoint=a.isLayer1DerivedPoint=a.hasDerivedVertices=a.hasLayer2Vertices=a.hasLayer1Vertices=a.isPrimitiveAnnotation=a.isDerivedAnnotation=a.isDerivedLayerPoint=a.CONSERVATIVE_DRZ_VERTEX_SPACIN_DECIMAL_PLACE=a.CONSERVATIVE_DRZ_VERTEX_SPACING=a.DEFAULT_PERCISION_DRZ_ALIGNMENT_DECIMAL_PLACE=a.DEFAULT_PERCISION_DRZ_ALIGNMENT=a.DERIVED_ANNOTATION_VERSION=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(308408);a.DERIVED_ANNOTATION_VERSION=2,a.DEFAULT_PERCISION_DRZ_ALIGNMENT=1e-5,a.DEFAULT_PERCISION_DRZ_ALIGNMENT_DECIMAL_PLACE=5,a.CONSERVATIVE_DRZ_VERTEX_SPACING=1e-7,a.CONSERVATIVE_DRZ_VERTEX_SPACIN_DECIMAL_PLACE=7,a.isDerivedLayerPoint=o=>!!o.layer1VertexId||!!o.layer2VertexId,a.isDerivedAnnotation=o=>!!o.metadata?.derivedMetadata,a.isPrimitiveAnnotation=o=>!!o.vertices?.some(isLayer1DerivedPoint);let hasLayer1Vertices=o=>k.isPathAnnotation(o)&&g.default.some(o.vertices,o=>isLayer1DerivedPoint(o));a.hasLayer1Vertices=hasLayer1Vertices;let hasLayer2Vertices=o=>k.isPathAnnotation(o)&&g.default.some(o.vertices,o=>isLayer2DerivedPoint(o));a.hasLayer2Vertices=hasLayer2Vertices,a.hasDerivedVertices=o=>hasLayer1Vertices(o)||hasLayer2Vertices(o);let isLayer1DerivedPoint=o=>!!o.layer1VertexId;a.isLayer1DerivedPoint=isLayer1DerivedPoint;let isLayer2DerivedPoint=o=>!!o.layer2VertexId;a.isLayer2DerivedPoint=isLayer2DerivedPoint,a.isSharedDerivedPoint=(o,a)=>{let s=g.default.round(o.x,5)===g.default.round(a.x,5),c=g.default.round(o.y,5)===g.default.round(a.y,5);return s&&c},a.createLineFromEdges=o=>({edges:o}),a.getPointsFromLine=o=>{let a=[];return o.edges.forEach((o,s)=>{0===s&&a.push(o.start),a.push(o.end)}),a};let createEdgeFromPoints=(o,a)=>({start:o,end:a});a.createEdgeFromPoints=createEdgeFromPoints,a.createLineFromPoints=o=>{let a=[];return o.forEach((s,c)=>{c!==o.length-1&&a.push(createEdgeFromPoints(s,o[c+1]))}),{edges:a}}},946305:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0})},308408:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c={},g=_interopRequireWildcard(s(716375));Object.keys(g).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===g[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return g[o]}}))});var k=_interopRequireWildcard(s(492027));Object.keys(k).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===k[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return k[o]}}))});var A=_interopRequireWildcard(s(946305));function _interopRequireWildcard(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}Object.keys(A).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===A[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return A[o]}}))})},880522:function(o,a){"use strict";var s,c,g,k;Object.defineProperty(a,"__esModule",{value:!0}),a.ChatPreProcessParamsStrategy=a.ChatPreProcessStrategy=void 0,a.ChatPreProcessStrategy=s,(g=s||(a.ChatPreProcessStrategy=s={})).None="none",g.BulbaExtensions="bulba_extensions",g.BulbaPromptHash="bulba_prompt_hash",g.FlamingoSFTInstruct="flamingo_sft_instruct",g.VertigoAgenticEvals="vertigo_agentic_evals",g.KratosEvals="kratos_evals",g.KratosMathEvals="kratos_math_evals",g.KratosCodeEvals="kratos_code_evals",g.KratosSafetyEvals="kratos_safety_evals",g.BardkickEvals="bardkick_evals",a.ChatPreProcessParamsStrategy=c,(k=c||(a.ChatPreProcessParamsStrategy=c={})).None="none",k.BulbaExtensions="bulba_extensions",k.BulbaExtensions3P="bulba_extensions_3p",k.LazarusRTLDetection="lazarus_rtl_detection",k.BardkickEvals="bardkick_evals"},938910:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ChatTaskFeatureConfigSchema=a.ModelConfigurationsModelsSchema=a.DeliveryBuilderConfigDisableSchema=a.DeliveryBuilderConfigCreateSchema=a.DeliveryBuilderConfigSchema=a.AutoCritiqueStepType=a.AutoCritiqueModel=a.ThrottleReviewLevels=a.InverseSpecializationType=a.IncentiveType=a.SpecializationType=a.MathToken=a.BulletListToken=a.ItalicToken=a.BoldToken=void 0;var c,g,k,A,x,P,w,F,R,D,G,B,W,z,V,U=s(880522),K=s(689510);a.BoldToken=F,(c=F||(a.BoldToken=F={})).UNDERSCORE="__",c.ASTERISK="**",a.ItalicToken=R,(g=R||(a.ItalicToken=R={})).UNDERSCORE="_",g.ASTERISK="*",a.BulletListToken=D,(k=D||(a.BulletListToken=D={})).DASH="-",k.ASTERISK="*",k.PLUS="+",a.MathToken=G,(A=G||(a.MathToken=G={})).DOLLARS="$$",A.BRACKETS="\\[",A.ESCAPED_BRACKETS="\\\\[",a.SpecializationType=B,(x=B||(a.SpecializationType=B={})).Vehicle="vehicle",x.Pedestrian="pedestrian",x.Sign="sign",x.Other="other",x.Polygon="polygon",a.IncentiveType=W,(W||(a.IncentiveType=W={})).HLE="hle";let Y={vehicle:B.Vehicle,pedestrian:B.Pedestrian,sign:B.Sign,other:B.Other,polygon:B.Polygon};a.InverseSpecializationType=Y,a.ThrottleReviewLevels=["Attempt","Normal","Level1","ReviewConsensus"],a.AutoCritiqueModel=z,(P=z||(a.AutoCritiqueModel=z={})).GPT4="gpt-4",P.GPT4Turbo="gpt-4-1106-preview",P.GPT35Turbo="gpt-3.5-turbo",P.GPT4oMini="gpt-4o-mini",P.GPT4Omni="gpt-4o",P.GPT01Preview="o1-preview";let $=K.z.object({model:K.z.nativeEnum(z),max_tokens:K.z.number().optional(),temperature:K.z.number().optional()}),X=K.z.object({enabled:K.z.boolean().optional(),promptTemplate:K.z.string().optional(),systemPrompt:K.z.string().optional(),overriddenModelParams:$.optional(),renameButton:K.z.string().optional()});a.AutoCritiqueStepType=V,(w=V||(a.AutoCritiqueStepType=V={})).modelResponseEditor="modelResponseEditor",w.modelResponseSelector="modelResponseSelector",w.textCollectionPerResponse="textCollectionPerResponse",w.textCollection="textCollection",w.prompt="prompt";let Z=K.z.object({taskDataPath:K.z.string(),isUrl:K.z.boolean().optional(),fileName:K.z.string().optional(),fileNamePath:K.z.string().optional()}),J=K.z.object({sphereEngineProjectId:K.z.string(),language:K.z.string(),name:K.z.string(),entryPoint:K.z.string(),scenario:K.z.string(),customFiles:K.z.array(Z).optional()}),ee=K.z.object({includeReviewLevels:K.z.array(K.z.number()),includeFields:K.z.array(K.z.string()),attemptCountLimit:K.z.number(),attemptCountLimitPerReviewLevel:K.z.boolean().optional(),excludeBotAttempts:K.z.boolean().optional()}),et=K.z.object({prefixOptions:K.z.object({hideFirstThreadPrefix:K.z.boolean().optional(),hideFirstTurnPrefix:K.z.boolean().optional()}).optional()}),er=K.z.object({stepsHiddenFromCustomer:K.z.array(K.z.string()).optional(),metadataHiddenFromCustomer:K.z.array(K.z.string()).optional(),metadataVisibleToCustomer:K.z.array(K.z.string()).optional(),isMetadataWhitelistMode:K.z.boolean().optional(),fieldsHiddenFromCustomer:K.z.array(K.z.object({stepId:K.z.string(),fieldId:K.z.string()})).optional(),hideStepsHiddenInAttemptLevel:K.z.boolean().optional(),transformationMethod:K.z.string().optional(),jsonataExpression:K.z.string().optional(),nodeSelectionPaths:K.z.array(K.z.object({sourcePath:K.z.string(),targetPath:K.z.string()})).optional(),customTypeScriptFormatterName:K.z.string().optional(),customTypeScriptFormatterConfig:K.z.string().optional(),includeAttempts:ee.optional(),includeAudits:K.z.boolean().optional(),pinnedTaxonomyVersion:K.z.number().optional(),formatterTaxonomyVersion:K.z.number().optional(),standardDeliveryCSVFormat:et.optional(),defaultFormatter:K.z.string().optional(),deliveryJSONSchemaId:K.z.string().optional()});a.DeliveryBuilderConfigSchema=er;let en=K.z.object({projectId:K.z.string(),datapackType:K.z.string().optional(),otsSubscriptionId:K.z.string().optional(),deliveryBuilderConfig:er});a.DeliveryBuilderConfigCreateSchema=en;let ei=K.z.object({_id:K.z.string(),disabled:K.z.boolean()});a.DeliveryBuilderConfigDisableSchema=ei;let eo=K.z.object({_id:K.z.string(),id:K.z.string().optional(),version:K.z.number(),distribution:K.z.number()}),ea=eo.extend({fallbackStrategy:K.z.string().optional(),fallbackEndpoint:eo.optional()}),es=K.z.record(K.z.string(),K.z.array(ea)).optional();a.ModelConfigurationsModelsSchema=es;let el=K.z.object({milkdownEditorConfig:K.z.object({enableExecutableCodeBlocks:K.z.boolean().optional(),enableMathPlugin:K.z.boolean().optional(),enableSingleDollarTextMath:K.z.boolean().optional(),mentionCandidates:K.z.array(K.z.any()).optional()}).optional(),editorConfig:K.z.object({enablePlaintextEditor:K.z.boolean().optional()}).optional(),htmlMarkdownConfig:K.z.object({enableInstructions:K.z.boolean().optional(),enablePromptPreviews:K.z.boolean().optional(),enableResponsePreviews:K.z.boolean().optional()}).optional(),generalMarkdownConfig:K.z.object({enableSoftLineBreaks:K.z.boolean().optional(),enableExecutableCodeMarkdown:K.z.boolean().optional(),autoRunExecutableCodeBlocks:K.z.boolean().optional()}).optional(),markdownSyntaxConfig:K.z.object({boldToken:K.z.nativeEnum(F),italicToken:K.z.nativeEnum(R),bulletListToken:K.z.nativeEnum(D),mathToken:K.z.nativeEnum(G)}).optional(),codingConfig:K.z.object({enableExecutableCodeMarkdown:K.z.boolean().optional(),customCodeEnvironments:K.z.array(J).optional(),autoRunExecutableCodeBlocks:K.z.boolean().optional(),defaultCode:K.z.boolean().optional()}).optional(),languageConfig:K.z.object({enableRightToLeftToggleInEditor:K.z.boolean().optional(),enableAutomaticLanguageDetection:K.z.boolean().optional()}).optional(),disablePasting:K.z.object({prompt:K.z.object({enabledReviewLevels:K.z.array(K.z.number()).optional()}),response:K.z.object({enabledReviewLevels:K.z.array(K.z.number()).optional()}),textCollectionFields:K.z.array(K.z.object({fieldId:K.z.string(),reviewLevels:K.z.array(K.z.number())})).optional(),disableAutoTyperTextRemoval:K.z.boolean().optional()}).optional(),disableCopying:K.z.object({prompt:K.z.object({enabledReviewLevels:K.z.array(K.z.number()).optional()}),responseSelector:K.z.object({enabledReviewLevels:K.z.array(K.z.number()).optional()})}).optional(),autoCritique:K.z.object({enforceCritique:K.z.boolean().optional(),prompt:X.optional(),enableSeverityBlocking:K.z.object({blockCriticalSeverity:K.z.boolean().optional(),regexToBlock:K.z.string().optional()}),excludeReviewLevels:K.z.array(K.z.number()).optional(),modelResponseEditor:X.optional(),modelResponseSelector:X.optional(),textCollectionPerResponse:X.optional(),textCollection:X.optional()}).optional(),chatPreProcess:K.z.object({strategy:K.z.nativeEnum(U.ChatPreProcessStrategy)}).optional(),chatPreProcessParams:K.z.object({strategy:K.z.nativeEnum(U.ChatPreProcessParamsStrategy),useScratchPad:K.z.boolean().optional(),useModelPrefix:K.z.boolean().optional()}).optional(),inlineFeedbackConfig:K.z.object({requireRatingComments:K.z.boolean().optional(),requireAddingAtLeastOneComment:K.z.boolean().optional()}).optional(),modelResponseConfig:K.z.object({enableOrderRandomization:K.z.boolean().optional(),alwaysShowResponseInPreview:K.z.boolean().optional()}).optional(),defaultLinterConfig:K.z.object({disableDefaultLinterGeneration:K.z.boolean().optional(),disableDefaultLinterGenerationReason:K.z.string().optional()}).optional(),deliveryBuilderConfig:er.optional(),allowSharing:K.z.boolean().optional(),enableWordCounter:K.z.boolean().optional(),enableFontSizeSelector:K.z.boolean().optional(),enableLanguageTool:K.z.boolean().optional(),enableEnrichedQMSFeedback:K.z.boolean().optional(),enableCodingUnitTestsGeneration:K.z.object({enableCodingUnitTestsGeneration:K.z.boolean().optional(),codeFieldId:K.z.string().optional(),useCodeFromMostRecentResponseEditor:K.z.boolean().optional(),unitTestsFieldId:K.z.string().optional(),numberOfTestCases:K.z.number().optional(),enableRunTests:K.z.boolean().optional(),enableRunHiddenTests:K.z.boolean().optional()}).optional(),grammarCheckerSteps:K.z.array(K.z.string()).optional(),enableFactChecker:K.z.boolean().optional(),inlineCopilotReferenceSource:K.z.enum(["serp","perplexity.ai","reference text"]).optional(),alwaysAddSystemPromptAsFirstMessage:K.z.boolean().optional(),runAutorater:K.z.boolean().optional(),chatliteEnableSaveWithoutRegeneration:K.z.boolean().optional(),externalAppUrls:K.z.array(K.z.object({appName:K.z.string(),defaultUrl:K.z.string().optional(),outlierUrl:K.z.string().optional(),dashboardUrl:K.z.string().optional(),localUrl:K.z.string().optional()})).optional(),enableTaxonomyAgent:K.z.boolean().optional(),chatliteUseReviewerAllStepsStepperAtReviewLevels:K.z.array(K.z.number()).optional()});a.ChatTaskFeatureConfigSchema=el},174844:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.mapReviewLevelToPayoutPartition=a.OptimizationStrategy=void 0;var c,g,k=s(599789);a.OptimizationStrategy=g,(c=g||(a.OptimizationStrategy=g={})).CentsPerTotalWork="centsPerTotalWork",c.CentsPerAttributedWork="centsPerAttributedWork",c.Default="default";let A={[k.ReviewLevel.Attempt]:k.PayoutPartition.Attempt,[k.ReviewLevel.Normal]:k.PayoutPartition.Level0,[k.ReviewLevel.Level1]:k.PayoutPartition.Level1,[k.ReviewLevel.Corp]:k.PayoutPartition.Level10,[k.ReviewLevel.Deliverable]:k.PayoutPartition.Level12};a.mapReviewLevelToPayoutPartition=A},857581:function(o,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0})},693435:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.CustomerBillingType=void 0,a.CustomerBillingType=s,(c=s||(a.CustomerBillingType=s={})).Enterprise="ENTERPRISE",c.Tableau="TABLEAU",c.OnDemand="ON_DEMAND"},763462:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c={},g=_interopRequireWildcard(s(857581));Object.keys(g).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===g[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return g[o]}}))});var k=_interopRequireWildcard(s(693435));Object.keys(k).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===k[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return k[o]}}))});var A=_interopRequireWildcard(s(334859));function _interopRequireWildcard(o){if(o&&o.__esModule)return o;var a={};if(null!=o){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(o,s):{};c.get||c.set?Object.defineProperty(a,s,c):a[s]=o[s]}}return a.default=o,a}Object.keys(A).forEach(function(o){!("default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(c,o))&&(o in a&&a[o]===A[o]||Object.defineProperty(a,o,{enumerable:!0,get:function(){return A[o]}}))})},334859:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.MODEL_AS_A_SERVICE_TASK_TYPES=a.CustomerDashboardType=void 0;var c,g,k=s(167469);a.CustomerDashboardType=g,(c=g||(a.CustomerDashboardType=g={})).Redash="REDASH",c.Tableau="TABLEAU",c.Internal="INTERNAL",c.CustomerMetrics="CUSTOMER_METRICS",c.ModelAsAService="MODEL_AS_A_SERVICE";let A=Object.freeze([k.TaskType.DocumentModel]);a.MODEL_AS_A_SERVICE_TASK_TYPES=A},565817:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.BarcodeScanner=void 0,a.BarcodeScanner=s,(c=s||(a.BarcodeScanner=s={})).Noop="noop",c.Dynamsoft="dynamsoft",c.DynamsoftUnlicensed="dynamsoft_unlicensed",c.ZBar="zbar"},536445:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.convertCoordinates=function(o){return o?{lat:o[1],lng:o[0]}:{lat:0,lng:0}},a.GeocontextComparison=void 0,a.GeocontextComparison=s,(c=s||(a.GeocontextComparison=s={})).GreaterThan=">",c.GreaterThanOrEqual=">=",c.LessThan="<",c.LessThanOrEqual="<=",c.Equal="=",c.NotEqual="!="},284015:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"IPipelineV3ManualInterventionPreviewJson",{enumerable:!0,get:function(){return k.IPipelineV3ManualInterventionPreviewJson}}),a.INamedObjectTypes=void 0;var c,g,k=s(167469);a.INamedObjectTypes=g,(c=g||(a.INamedObjectTypes=g={})).User="user",c.Project="project",c.Subtask="subtask",c.Task="task",c.PermissionGroup="permissionGroup",c.Course="course",c.TaskAttempt="taskAttempt",c.TaskReview="taskReview",c.TrainingAttempt="trainingAttempt",c.TrainingScenario="trainingScenario",c.IncompleteTaskAttempt="incompleteAttempt",c.Tag="Tag",c.Persona="Persona",c.ProjectSLAGroup="projectSLAGroup",c.ProjectCollection="projectCollection",c.PipelineV3ManualIntervention="pipelineV3ManualIntervention",c.AccountVerification="accountVerification",c.Redirect="redirect",c.WorkerTeam="workerTeam",c.Stage="stage",c.Substage="substage",c.Audience="audience",c.Qualification="qualification",c.QAOperation="qaOperation",c.OTSDeliveredBatch="otsDeliveredBatch",c.OTSDeliveredTask="otsDeliveredTask",c.OTSSubscription="otsSubscription",c.OTSTask="otsTask",c.OTSUploadBatch="otsUploadBatch",c.ModelRequestAndResponse="modelRequestAndResponse"},479348:function(o,a){"use strict";var s,c;Object.defineProperty(a,"__esModule",{value:!0}),a.FilterName=void 0,a.FilterName=s,(c=s||(a.FilterName=s={})).CountryFilter="country_ip_filter",c.WorkerAttemptCountFilter="worker_attempt_count_filter",c.MeanResponseFilter="mean_response_filter",c.StdDevFilter="stddev_filter",c.PearsonFilter="pearson_filter",c.OutlierFilter="outlier_filter",c.AnswerStreakFilter="answer_streak_filter",c.IntraAttemptFilter="intra_attempt_filter",c.BenchmarkScoreFilter="benchmark_score_filter",c.TaskerIPFilter="tasker_ip_filter",c.WorkerTagFilter="worker_tag_filter"},335855:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"NestedLabelChoice",{enumerable:!0,get:function(){return x.NestedLabelChoice}}),Object.defineProperty(a,"BaseLabelChoice",{enumerable:!0,get:function(){return x.BaseLabelChoice}}),Object.defineProperty(a,"LabelChoice",{enumerable:!0,get:function(){return x.LabelChoice}}),Object.defineProperty(a,"SingleLabelChoice",{enumerable:!0,get:function(){return x.SingleLabelChoice}}),Object.defineProperty(a,"EventChoice",{enumerable:!0,get:function(){return x.EventChoice}}),Object.defineProperty(a,"SingleEventChoice",{enumerable:!0,get:function(){return x.SingleEventChoice}}),a.getLabelChoiceHint=a.getLabelChoiceValue=a.getLabelChoiceDisplay=a.isNestedLabelChoice=a.ContextAttachmentType=void 0;var c,g,k,A=(c=s(298784))&&c.__esModule?c:{default:c},x=s(167469);a.ContextAttachmentType=k,(g=k||(a.ContextAttachmentType=k={})).SIMPLE_IMAGE="image",g.GIS_GROUND_PNG_V1="gis_ground_png_v1",g.GROUND_MAP="ground_map",g.LIDAR_CAMERA="lidar_camera",g.WORLD_CAMERA="world_camera",g.PIXEL_CAMERA="pixel_camera",g.GIS_PHOTOCOLOR_PNG_V1="gis_photocolor_png_v1",g.GIS_OPEN_STREET_MAP_DATA="gis_open_street_map_data",g.ADDITIONAL_VIDEO="additional_video",a.isNestedLabelChoice=o=>{let a=A.default.get(o,"subchoices");return A.default.isArray(a)&&!A.default.isEmpty(a)},a.getLabelChoiceDisplay=o=>"string"==typeof o?o:o.display||o.choice,a.getLabelChoiceValue=o=>A.default.isNil(o)?"":"string"==typeof o?o:o.choice,a.getLabelChoiceHint=o=>{if(!A.default.isNil(o)&&"string"!=typeof o)return o.hint}},940054:function(o,a){"use strict";var s,c,g,k,A,x;Object.defineProperty(a,"__esModule",{value:!0}),a.ChoiceParameterizationLevel=a.isParamsCategorizationV1=a.isParamsCategorizationV2=a.TaxonomyType=a.isNestedChoice=a.NumericTaxonomyConsolidationType=a.PUBLIC_PARAM_FIELDS=void 0,a.PUBLIC_PARAM_FIELDS=["attachment_type","attachment","allow_multiple","layers","responses_required","categories","category_ids","taxonomies","attachment_body"],a.NumericTaxonomyConsolidationType=s,(k=s||(a.NumericTaxonomyConsolidationType=s={})).AccuracyWeightedMean="accuracy_weighted_mean",k.ArithmeticMean="arithmetic_mean",k.GeometricMean="geometric_mean",k.HarmonicMean="harmonic_mean",k.Median="median",a.isNestedChoice=o=>"string"!=typeof o,a.TaxonomyType=c,(A=c||(a.TaxonomyType=c={})).Category="category",A.Number="number",A.NumberLinked="number_linked",a.isParamsCategorizationV2=o=>"taxonomies"in o,a.isParamsCategorizationV1=o=>"categories"in o,a.ChoiceParameterizationLevel=g,(x=g||(a.ChoiceParameterizationLevel=g={})).Required="Required",x.NotAllowed="NotAllowed",x.Allowed="Allowed"},116615:function(o,a){"use strict";var s,c,g,k,A,x,P,w,F,R,D;Object.defineProperty(a,"__esModule",{value:!0}),a.FieldType=a.FeaturePricingTier=a.FeaturePriority=a.ContentFlag=a.FeatureType=a.GeometryType=void 0,a.GeometryType=s,(P=s||(a.GeometryType=s={})).BoundingBox="box",P.Polygon="polygon",a.FeatureType=c,(w=c||(a.FeatureType=c={})).Text="text",w.Block="block",w.Group="group",w.Record="record",a.ContentFlag=g,(F=g||(a.ContentFlag=g={})).Line="line",F.Key="key",F.Value="value",F.Thead="thead",F.Tbody="tbody",F.Date="date",F.Money="money",F.Checkbox="checkbox",F.Region="region",F.Query="query",F.Span="span",a.FeaturePriority=k,(R=k||(a.FeaturePriority=k={})).P0="Most Critical",R.P1="Critical",R.default="Regular",a.FeaturePricingTier=A,(D=A||(a.FeaturePricingTier=A={})).Basic="Basic",D.Premium="Premium",a.FieldType=x,(x||(a.FieldType=x={})).Select="select"},939440:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"SensorFusionAnnotationType",{enumerable:!0,get:function(){return c.SensorFusionAnnotationType}}),Object.defineProperty(a,"SensorFusionAnnotationDef",{enumerable:!0,get:function(){return c.SensorFusionAnnotationDef}}),Object.defineProperty(a,"SensorFusionCuboidDefinition",{enumerable:!0,get:function(){return c.SensorFusionCuboidDefinition}}),Object.defineProperty(a,"SensorFusionSurfaceDefinition",{enumerable:!0,get:function(){return c.SensorFusionSurfaceDefinition}}),Object.defineProperty(a,"SensorFusionKeypointsDefinition",{enumerable:!0,get:function(){return c.SensorFusionKeypointsDefinition}}),Object.defineProperty(a,"SensorFusionAnchorDefinition",{enumerable:!0,get:function(){return c.SensorFusionAnchorDefinition}}),Object.defineProperty(a,"SensorFusionRule",{enumerable:!0,get:function(){return c.Rule}}),Object.defineProperty(a,"Permission",{enumerable:!0,get:function(){return c.Permission}}),Object.defineProperty(a,"PERMISSIONS",{enumerable:!0,get:function(){return c.PERMISSIONS}}),Object.defineProperty(a,"processRules",{enumerable:!0,get:function(){return c.processRules}}),Object.defineProperty(a,"RuleContext",{enumerable:!0,get:function(){return c.RuleContext}});var c=s(167469)},20325:function(o,a){"use strict";var s,c,g,k;Object.defineProperty(a,"__esModule",{value:!0}),a.PricingStrategy=a.BidStatus=void 0,a.BidStatus=s,(g=s||(a.BidStatus=s={})).Active="active",g.Inactive="inactive",a.PricingStrategy=c,(k=c||(a.PricingStrategy=c={})).SkipsLinear="skips_linear",k.SkipsExponential="skips_exponential",k.SkipsExponentialRateLimited="skips_exponential_rate_limited"},690253:function(o,a){"use strict";var s,c,g,k,A,x,P,w,F;Object.defineProperty(a,"__esModule",{value:!0}),a.QAAuditCheckpoint=a.QAAuditTagType=a.QAAuditCustomMetric=a.QAAuditArchiveReason=a.QAAuditStatus=void 0,a.QAAuditStatus=s,(x=s||(a.QAAuditStatus=s={})).Submitted="submitted",x.Completed="completed",x.Pending="pending",x.InProgress="in_progress",x.ReadyForReview="ready_for_review",x.ReadyForCompletion="ready_for_completion",a.QAAuditArchiveReason=c,(P=c||(a.QAAuditArchiveReason=c={})).Expired="expired",P.Other="other",a.QAAuditCustomMetric=g,(g||(a.QAAuditCustomMetric=g={})).BulletsAttributeInsights="bullets_attribute_insights",a.QAAuditTagType=k,(w=k||(a.QAAuditTagType=k={})).Attempter="attempter",w.Reviewer="reviewer",a.QAAuditCheckpoint=A,(F=A||(a.QAAuditCheckpoint=A={})).Creation="creation",F.ReadyForReview="ready_for_review",F.ReadyForCompletion="ready_for_completion",F.Completion="completion"},684065:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.REVIEW_LEVELS_TO_SERVE_IN_QUEUE_L4_REVIEW=a.REVIEWER_REVIEW_LEVELS=a.REVIEW_LEVELS_TO_SERVE_IN_QUEUE=void 0;var c=s(599789),g=s(167469);let k=[c.ReviewLevel.QIRLeadAuditor,c.ReviewLevel.QIRAuditor,c.ReviewLevel.CorpFlagged,c.ReviewLevel.Corp,c.ReviewLevel.Expedite,c.ReviewLevel.Level1,c.ReviewLevel.Normal,c.ReviewLevel.Attempt,c.ReviewLevel.ReviewConsensus];a.REVIEW_LEVELS_TO_SERVE_IN_QUEUE=k;let A=g.ReviewLevelOrder.filter(o=>o!==c.ReviewLevel.Attempt);a.REVIEWER_REVIEW_LEVELS=A;let x=[c.ReviewLevel.QIRLeadAuditor,c.ReviewLevel.QIRAuditor,c.ReviewLevel.CorpFlagged,c.ReviewLevel.Corp,c.ReviewLevel.Expedite,c.ReviewLevel.ReviewConsensus,c.ReviewLevel.Level1,c.ReviewLevel.Normal,c.ReviewLevel.Attempt];a.REVIEW_LEVELS_TO_SERVE_IN_QUEUE_L4_REVIEW=x},975840:function(o,a){"use strict";var s,c,g,k,A,x,P,w;a.D0=function(o){let a=F.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),s=RegExp(`${a}/queries/(\\d*)`);return o.match(s)?.[1]},a.DH=a.Dj=a.OW=void 0;let F="https://redash.scale.com";a.OW=s,(A=s||(a.OW=s={})).Query="query",A.Dashboard="dashboard",a.Dj=c,(x=c||(a.Dj=c={})).Query="query",x.Number="number",x.Dropdown="enum",x.Date="date",x.DateTime="datetime-local",x.DateTimeWithSeconds="datetime-with-seconds",x.DateRange="date-range",x.DateTimeRange="datetime-range",x.DateTimeRangeWithSeconds="datetime-range-with-seconds",(P=g||(g={})).CHART="CHART",P.TABLE="TABLE",P.COUNTER="COUNTER",a.DH=k,(w=k||(a.DH=k={}))[w.PENDING=1]="PENDING",w[w.STARTED=2]="STARTED",w[w.SUCCESS=3]="SUCCESS",w[w.FAILURE=4]="FAILURE",w[w.CANCELLED=5]="CANCELLED"},257868:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createEmpty=createEmpty,a.pick=function(o,a,s=1){let c=createEmpty(o,a.length*s);for(let g=0;g<a.length;g++)for(let k=0;k<s;k++)c[g*s+k]=o[a[g]*s+k];return c},a.concat=function(o){if(!o.length)return;let a=g.default.sum(o.map(o=>o.length)),s=createEmpty(o[0],a),c=0;return o.forEach(o=>{s.set(o,c),c+=o.length}),s},a.range=function(o,a){let s=new Uint32Array(a-o);for(let a=0;a<s.length;a++)s[a]=a+o;return s};var c,g=(c=s(298784))&&c.__esModule?c:{default:c};function createEmpty(o,a=0){let s=o.constructor;return new s(a)}},311311:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.addPathVertex=a.updatePathVertex=a.moveAndClampPolygon=a.getFragmentsFromVertices=a.addNewFragment=a.splitPointsByFragment=a.isMultiPolygon=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(136622);a.isMultiPolygon=o=>!g.default.isEmpty(o.multiple_polygon_vertices),a.splitPointsByFragment=(o,a)=>g.default.isNil(o)?[]:g.default.isEmpty(a)?[o]:g.default.reduce(a,(o,a)=>(o.push(a.vertices),o),[]),a.addNewFragment=(o,a)=>{let s=o.vertices,c=[...s,...a],g=[...o.multiple_polygon_vertices??[{vertices:s}],{vertices:a}],k={...o,vertices:c,multiple_polygon_vertices:g};return k};let getFragmentsFromVertices=(o,a)=>{if(g.default.isEmpty(a))return;let s=0,c=g.default.map(a,a=>{let c=o.slice(s,s+a.vertices.length);return s+=a.vertices.length,{vertices:c}});return c};a.getFragmentsFromVertices=getFragmentsFromVertices,a.moveAndClampPolygon=(o,a,s,c)=>{let g=o.vertices.map(o=>({...o,x:o.x+a,y:o.y+s}));return k.clampPolygonAnnotationVertices(g,c),{...o,vertices:g,multiple_polygon_vertices:getFragmentsFromVertices(g,o.multiple_polygon_vertices)}},a.updatePathVertex=(o,a,s)=>{let c=Object.assign([],o.vertices,{[a]:s});return{vertices:c,multiple_polygon_vertices:getFragmentsFromVertices(c,o.multiple_polygon_vertices)}},a.addPathVertex=(o,a,s)=>{let c=[...o.vertices.slice(0,a),s,...o.vertices.slice(a)];if(g.default.isEmpty(o.multiple_polygon_vertices))return{vertices:c};let k=[],A=a;return g.default.each(o.multiple_polygon_vertices,o=>{let a=o;A>=0&&A<=o.vertices.length&&(a={vertices:[...o.vertices.slice(0,A),s,...o.vertices.slice(A)]}),k.push(a),A-=o.vertices.length}),{vertices:c,multiple_polygon_vertices:k}}},260160:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getBoundingBox=getBoundingBox,a.getLineLength=getLineLength,a.getPolygonArea=function(o){if(o.length<4)return getLineLength(o);let a=new A.geom.GeometryFactory,s=a.createPolygon(a.createLinearRing(o.map(({x:o,y:a})=>new A.geom.Coordinate(o,a))),[]);return s.getArea()},a.standardizeExtremalPoints=function(o){if(!o||!o.vertices)return{};let a=[...o.vertices].sort((o,a)=>o.x-a.x),s=[...o.vertices].sort((o,a)=>o.y-a.y);return{top:s[0],bottom:s[s.length-1],left:a[0],right:a[a.length-1]}},a.extremalPointAnnotToBoxAnnot=function(o){if(!o)return o;let a=getBoundingBox(o.vertices),s=g.default.map(a,"x"),c=g.default.map(a,"y"),A=g.default.min(s),x=g.default.min(c),P=g.default.max(s),w=g.default.max(c),F={...o,height:w-x,width:P-A,top:x,left:A,vertices:a,type:k.AnnotationGeometry.ExtremalPoints};return F},a.getGeneralizedBoundingBox=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(308408),A=s(593539);function getBoundingBox(o){if(0===o.length)throw Error("Cannot find bounding box of empty array");let a=g.default.map(o,"x"),s=g.default.map(o,"y"),c=g.default.min(a),k=g.default.min(s),A=g.default.max(a),x=g.default.max(s);return[{x:c,y:k},{x:c,y:x},{x:A,y:x},{x:A,y:k}]}function getLineLength(o){if(o.length<2)throw Error("Cannot find distance of line with less than 3 vertices");let a=new A.geom.GeometryFactory,s=a.createLineString(o.map(({x:o,y:a})=>new A.geom.Coordinate(o,a)));return s.getLength()}a.getGeneralizedBoundingBox=o=>{let a=[];for(let s of o)if(k.isBoxAnnotation(s)){let o=s.x+s.width/2,c=s.y+s.height/2,g=Math.atan(s.height/s.width),k=Math.sqrt(s.width**2+s.height**2)/2,getPoint=a=>({x:o+k*Math.cos(a),y:c+k*Math.sin(a)});a.push(getPoint(g+(s.rotation??0))),a.push(getPoint(Math.PI-g+(s.rotation??0))),a.push(getPoint(Math.PI+g+(s.rotation??0))),a.push(getPoint(-g+(s.rotation??0)))}return getBoundingBox(a)}},136622:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.clampAnnotation=a.clampCuboidAnnotation=a.clampPolygonAnnotation=a.clampPolygonAnnotationVertices=a.clampBoxAnnotation=a.getHallucination=a.getAllHallucinations=a.getCuboidInterpolation=a.getLinearPrediction=a.getTranslationVector=a.getKeyFrames=void 0;var c,g=(c=s(298784))&&c.__esModule?c:{default:c},k=s(308408),A=s(43356),x=s(311311);let getKeyFrames=(o,a,s)=>{let c=g.default.map(o.frames,(o,a)=>({frame:o,frameIndex:a})),k=g.default.reject(c,s?({frame:o})=>!o||!o.keyframeType:({frame:o})=>!o).map(({frameIndex:o})=>o);return{left:g.default.filter(k,o=>o<a),right:g.default.filter(k,o=>o>a)}};a.getKeyFrames=getKeyFrames;let subtractVectors=(o,a)=>({x:o.x-a.x,y:o.y-a.y}),getTranslationVector=o=>{let{frameIndex:a,keyframe1Index:s,keyframe2Index:c,keyframe1:g,keyframe2:k}=o,{x:x,y:P}=A.getDims[g.geometry](g),{x:w,y:F}=A.getDims[k.geometry](k),R=subtractVectors({x:w,y:F},{x:x,y:P});return{x:R.x/(c-s)*(a-s),y:R.y/(c-s)*(a-s)}};a.getTranslationVector=getTranslationVector;let getLinearPrediction=(o,a,s,c,k)=>{let A=o.frames[a],x=o.frames[s];return A||x?x?A?k?g.default.cloneDeep(A):getInterpolation({frameIndex:c,keyframe1Index:a,keyframe2Index:s,keyframe1:A,keyframe2:x},o.geometry):g.default.cloneDeep(x):g.default.cloneDeep(A):null};a.getLinearPrediction=getLinearPrediction;let interpolate=(o,a,s,c,g)=>(g-c)/(s-a)*(o-a)+c,getInterpolation=(o,a)=>{switch(a){case k.AnnotationGeometry.Point:return getPointInterpolation(o);case k.AnnotationGeometry.Line:case k.AnnotationGeometry.Polygon:return getPolygonInterpolation(o);case k.AnnotationGeometry.Box:return getBoxInterpolation(o);case k.AnnotationGeometry.Ellipse:return getEllipseInterpolation(o);case k.AnnotationGeometry.Cuboid:return getCuboidInterpolation(o);default:return o.keyframe1}},getPointInterpolation=o=>{let{keyframe1:a}=o,s=getTranslationVector(o),c=g.default.cloneDeep(a);return c.x+=s.x,c.y+=s.y,c},getBoxInterpolation=o=>{let{frameIndex:a,keyframe1Index:s,keyframe2Index:c,keyframe1:k,keyframe2:A}=o,x=g.default.cloneDeep(k);return x.width=interpolate(a,s,c,k.width,A.width),x.height=interpolate(a,s,c,k.height,A.height),x.x=interpolate(a,s,c,k.x,A.x),x.y=interpolate(a,s,c,k.y,A.y),x},getPolygonInterpolation=o=>{let{keyframe1:a}=o,s=getTranslationVector(o),c=g.default.cloneDeep(a);return c.vertices=c.vertices.map(o=>({x:o.x+s.x,y:o.y+s.y})),c.multiple_polygon_vertices&&(c.multiple_polygon_vertices=x.getFragmentsFromVertices(c.vertices,c.multiple_polygon_vertices)),c},getCuboidInterpolation=o=>{let{frameIndex:a,keyframe1Index:s,keyframe2Index:c,keyframe1:k,keyframe2:A}=o,x=g.default.cloneDeep(k);return x.face.x1=interpolate(a,s,c,k.face.x1,A.face.x1),x.face.x2=interpolate(a,s,c,k.face.x2,A.face.x2),x.face.y1=interpolate(a,s,c,k.face.y1,A.face.y1),x.face.y2=interpolate(a,s,c,k.face.y2,A.face.y2),k.edge&&A.edge&&(x.edge={ex:interpolate(k.edge.ex,k.face.x1,k.face.x2,x.face.x1,x.face.x2),ey1:interpolate(k.edge.ey1,k.face.y1,k.face.y2,x.face.y1,x.face.y2),ey2:interpolate(k.edge.ey2,k.face.y1,k.face.y2,x.face.y1,x.face.y2)}),x};a.getCuboidInterpolation=getCuboidInterpolation;let getEllipseInterpolation=o=>{let{frameIndex:a,keyframe1Index:s,keyframe2Index:c,keyframe1:k,keyframe2:A}=o,x=g.default.cloneDeep(k);return x.width=interpolate(a,s,c,k.width,A.width),x.height=interpolate(a,s,c,k.height,A.height),x.center[0]=interpolate(a,s,c,k.center[0],A.center[0]),x.center[1]=interpolate(a,s,c,k.center[1],A.center[1]),x};a.getAllHallucinations=(o,a,s)=>{let c,A;let x=g.default.map(o.frames,o=>o?.keyframeType?o:void 0),P=g.default.map(x,(o,a)=>{let s=o?.keyframeType;if(!s)return c;c=s===k.KeyframeType.End?void 0:a}),w=g.default.map([...x].reverse(),(a,s)=>{let c=a?.keyframeType;if(!c)return A;A=c===k.KeyframeType.Start?void 0:o.frames.length-s-1}).reverse();return g.default.map(x,(g,k)=>{if(c=P[k],A=w[k],void 0!==c&&void 0!==A){let g=getLinearPrediction(o,c,A,k,s);return g&&(g={...g,...clampAnnotation(g,a),keyframeType:void 0}),g}})},a.getHallucination=(o,a,s,c,k)=>{let A=getKeyFrames(o,a),x=null;if(g.default.isEmpty(A.left)||g.default.isEmpty(A.right)){if(g.default.isEmpty(A.left)){if(!g.default.isEmpty(A.right)){let[s,c]=g.default.take(A.right,2);x=getLinearPrediction(o,s,c,a,k)}}else{let[s,c]=g.default.reverse(g.default.takeRight(A.left,2));x=getLinearPrediction(o,s,c,a,k)}}else{let s=g.default.last(A.left),c=g.default.first(A.right);x=getLinearPrediction(o,s,c,a,k)}return x&&(x={...x,...c?{keyframeType:void 0}:{},...clampAnnotation(x,s)}),x};let clampBoxAnnotation=(o,a)=>{if(!a)return o;let{x:s,y:c,width:k,height:A}=o,x=s+k,P=c+A;x=g.default.clamp(x,2,a.width),P=g.default.clamp(P,2,a.height);let w=g.default.clamp(s,0,a.width-2),F=g.default.clamp(c,0,a.height-2),R=x-w,D=P-F;return(R<2&&(w-=Math.floor((2-R)/2),R=2),D<2&&(F-=Math.floor((2-D)/2),D=2),0===R||0===D)?{...o,x:0,y:0,width:100,height:100}:{...o,x:w,y:F,width:R,height:D}};a.clampBoxAnnotation=clampBoxAnnotation;let clampPointAnnotation=(o,a)=>(o.x=g.default.clamp(o.x,0,a.width-0),o.y=g.default.clamp(o.y,0,a.height-0),o),clampPolygonAnnotationVertices=(o,a,s)=>{let c;let k=a?.width??Number.MAX_SAFE_INTEGER,A=a?.height??Number.MAX_SAFE_INTEGER,x=0,P=0;if(s)c=o=>{o.forEach(o=>{o.x=g.default.clamp(o.x,0,k),o.y=g.default.clamp(o.y,0,A)})};else{let a;a=Array.isArray(o)?o:g.default.concat([],...Object.values(o));let s=g.default.minBy(a,"x")?.x??0,w=g.default.maxBy(a,"x")?.x??k,F=g.default.minBy(a,"y")?.y??0,R=g.default.maxBy(a,"y")?.y??A;x=s>=0?g.default.clamp(w,0,k)-w:g.default.clamp(s,0,k)-s,P=F>=0?g.default.clamp(R,0,A)-R:g.default.clamp(F,0,A)-F,c=o=>{o.forEach(o=>{o.x+=x,o.y+=P})}}return Array.isArray(o)?c(o):Object.values(o).forEach(o=>c(o)),o};a.clampPolygonAnnotationVertices=clampPolygonAnnotationVertices;let clampLineAnnotation=(o,a)=>(clampPolygonAnnotationVertices(o.vertices,a),o),clampPolygonAnnotation=(o,a,s)=>(clampPolygonAnnotationVertices(o.vertices,a,s),o);a.clampPolygonAnnotation=clampPolygonAnnotation;let clampCuboidAnnotation=(o,a)=>{let s=[{x:o.face.x1,y:o.face.y1},{x:o.face.x1,y:o.face.y2},{x:o.face.x2,y:o.face.y1},{x:o.face.x2,y:o.face.y2}];o.edge&&s.push({x:o.edge.ex,y:o.edge.ey1},{x:o.edge.ex,y:o.edge.ey2},{x:o.edge.ex,y:o.edge.ey1},{x:o.edge.ex,y:o.edge.ey2});let c=clampPolygonAnnotationVertices(s,a),g=c[0].x,k=c[0].y,A=c[3].x,x=c[3].y;if(o.face={x1:g,x2:A,y1:k,y2:x},o.edge){let a=s[4].x,c=s[4].y,g=s[5].y;o.edge={ex:a,ey1:c,ey2:g}}return o};a.clampCuboidAnnotation=clampCuboidAnnotation;let clampAnnotation=(o,a)=>{switch(o.geometry){case k.AnnotationGeometry.Box:return clampBoxAnnotation(o,a);case k.AnnotationGeometry.Point:return clampPointAnnotation(o,a);case k.AnnotationGeometry.Line:return clampLineAnnotation(o,a);case k.AnnotationGeometry.Polygon:return clampPolygonAnnotation(o,a);case k.AnnotationGeometry.Cuboid:return clampCuboidAnnotation(o,a);default:return o}};a.clampAnnotation=clampAnnotation},132764:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(31928);function polygonArea(o){var a=0;if(o&&o.length>0){a+=Math.abs(ringArea(o[0]));for(var s=1;s<o.length;s++)a-=Math.abs(ringArea(o[s]))}return a}function ringArea(o){var a,s,c,g,k,A,x=0,P=o.length;if(P>2){for(A=0;A<P;A++)A===P-2?(c=P-2,g=P-1,k=0):A===P-1?(c=P-1,g=0,k=1):(c=A,g=A+1,k=A+2),a=o[c],s=o[g],x+=(rad(o[k][0])-rad(a[0]))*Math.sin(rad(s[1]));x=40680631590769*x/2}return x}function rad(o){return o*Math.PI/180}a.default=function(o){return c.geomReduce(o,function(o,a){return o+function(o){var a,s=0;switch(o.type){case"Polygon":return polygonArea(o.coordinates);case"MultiPolygon":for(a=0;a<o.coordinates.length;a++)s+=polygonArea(o.coordinates[a]);return s}return 0}(a)},0)}},903779:function(o,a){"use strict";function feature(o,a,s){void 0===s&&(s={});var c={type:"Feature"};return(0===s.id||s.id)&&(c.id=s.id),s.bbox&&(c.bbox=s.bbox),c.properties=a||{},c.geometry=o,c}function point(o,a,s){if(void 0===s&&(s={}),!o)throw Error("coordinates is required");if(!Array.isArray(o))throw Error("coordinates must be an Array");if(o.length<2)throw Error("coordinates must be at least 2 numbers long");if(!isNumber(o[0])||!isNumber(o[1]))throw Error("coordinates must contain numbers");return feature({type:"Point",coordinates:o},a,s)}function polygon(o,a,s){void 0===s&&(s={});for(var c=0;c<o.length;c++){var g=o[c];if(g.length<4)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var k=0;k<g[g.length-1].length;k++)if(g[g.length-1][k]!==g[0][k])throw Error("First and last Position are not equivalent.")}return feature({type:"Polygon",coordinates:o},a,s)}function lineString(o,a,s){if(void 0===s&&(s={}),o.length<2)throw Error("coordinates must be an array of two or more positions");return feature({type:"LineString",coordinates:o},a,s)}function featureCollection(o,a){void 0===a&&(a={});var s={type:"FeatureCollection"};return a.id&&(s.id=a.id),a.bbox&&(s.bbox=a.bbox),s.features=o,s}function multiLineString(o,a,s){return void 0===s&&(s={}),feature({type:"MultiLineString",coordinates:o},a,s)}function multiPoint(o,a,s){return void 0===s&&(s={}),feature({type:"MultiPoint",coordinates:o},a,s)}function multiPolygon(o,a,s){return void 0===s&&(s={}),feature({type:"MultiPolygon",coordinates:o},a,s)}function radiansToLength(o,s){void 0===s&&(s="kilometers");var c=a.factors[s];if(!c)throw Error(s+" units is invalid");return o*c}function lengthToRadians(o,s){void 0===s&&(s="kilometers");var c=a.factors[s];if(!c)throw Error(s+" units is invalid");return o/c}function radiansToDegrees(o){return 180*(o%(2*Math.PI))/Math.PI}function isNumber(o){return!isNaN(o)&&null!==o&&!Array.isArray(o)}Object.defineProperty(a,"__esModule",{value:!0}),a.earthRadius=6371008.8,a.factors={centimeters:100*a.earthRadius,centimetres:100*a.earthRadius,degrees:a.earthRadius/111325,feet:3.28084*a.earthRadius,inches:39.37*a.earthRadius,kilometers:a.earthRadius/1e3,kilometres:a.earthRadius/1e3,meters:a.earthRadius,metres:a.earthRadius,miles:a.earthRadius/1609.344,millimeters:1e3*a.earthRadius,millimetres:1e3*a.earthRadius,nauticalmiles:a.earthRadius/1852,radians:1,yards:1.0936*a.earthRadius},a.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/a.earthRadius,yards:1.0936133},a.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},a.feature=feature,a.geometry=function(o,a,s){switch(void 0===s&&(s={}),o){case"Point":return point(a).geometry;case"LineString":return lineString(a).geometry;case"Polygon":return polygon(a).geometry;case"MultiPoint":return multiPoint(a).geometry;case"MultiLineString":return multiLineString(a).geometry;case"MultiPolygon":return multiPolygon(a).geometry;default:throw Error(o+" is invalid")}},a.point=point,a.points=function(o,a,s){return void 0===s&&(s={}),featureCollection(o.map(function(o){return point(o,a)}),s)},a.polygon=polygon,a.polygons=function(o,a,s){return void 0===s&&(s={}),featureCollection(o.map(function(o){return polygon(o,a)}),s)},a.lineString=lineString,a.lineStrings=function(o,a,s){return void 0===s&&(s={}),featureCollection(o.map(function(o){return lineString(o,a)}),s)},a.featureCollection=featureCollection,a.multiLineString=multiLineString,a.multiPoint=multiPoint,a.multiPolygon=multiPolygon,a.geometryCollection=function(o,a,s){return void 0===s&&(s={}),feature({type:"GeometryCollection",geometries:o},a,s)},a.round=function(o,a){if(void 0===a&&(a=0),a&&!(a>=0))throw Error("precision must be a positive number");var s=Math.pow(10,a||0);return Math.round(o*s)/s},a.radiansToLength=radiansToLength,a.lengthToRadians=lengthToRadians,a.lengthToDegrees=function(o,a){return radiansToDegrees(lengthToRadians(o,a))},a.bearingToAzimuth=function(o){var a=o%360;return a<0&&(a+=360),a},a.radiansToDegrees=radiansToDegrees,a.degreesToRadians=function(o){return o%360*Math.PI/180},a.convertLength=function(o,a,s){if(void 0===a&&(a="kilometers"),void 0===s&&(s="kilometers"),!(o>=0))throw Error("length must be a positive number");return radiansToLength(lengthToRadians(o,a),s)},a.convertArea=function(o,s,c){if(void 0===s&&(s="meters"),void 0===c&&(c="kilometers"),!(o>=0))throw Error("area must be a positive number");var g=a.areaFactors[s];if(!g)throw Error("invalid original units");var k=a.areaFactors[c];if(!k)throw Error("invalid final units");return o/g*k},a.isNumber=isNumber,a.isObject=function(o){return!!o&&o.constructor===Object},a.validateBBox=function(o){if(!o)throw Error("bbox is required");if(!Array.isArray(o))throw Error("bbox must be an Array");if(4!==o.length&&6!==o.length)throw Error("bbox must be an Array of 4 or 6 numbers");o.forEach(function(o){if(!isNumber(o))throw Error("bbox must only contain numbers")})},a.validateId=function(o){if(!o)throw Error("id is required");if(-1===["string","number"].indexOf(typeof o))throw Error("id must be a number or a string")}},31928:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(903779);function coordEach(o,a,s){if(null!==o)for(var c,g,k,A,x,P,w,F,R=0,D=0,G=o.type,B="FeatureCollection"===G,W="Feature"===G,z=B?o.features.length:1,V=0;V<z;V++){x=(F=!!(w=B?o.features[V].geometry:W?o.geometry:o)&&"GeometryCollection"===w.type)?w.geometries.length:1;for(var U=0;U<x;U++){var K=0,Y=0;if(null!==(A=F?w.geometries[U]:w)){P=A.coordinates;var $=A.type;switch(R=s&&("Polygon"===$||"MultiPolygon"===$)?1:0,$){case null:break;case"Point":if(!1===a(P,D,V,K,Y))return!1;D++,K++;break;case"LineString":case"MultiPoint":for(c=0;c<P.length;c++){if(!1===a(P[c],D,V,K,Y))return!1;D++,"MultiPoint"===$&&K++}"LineString"===$&&K++;break;case"Polygon":case"MultiLineString":for(c=0;c<P.length;c++){for(g=0;g<P[c].length-R;g++){if(!1===a(P[c][g],D,V,K,Y))return!1;D++}"MultiLineString"===$&&K++,"Polygon"===$&&Y++}"Polygon"===$&&K++;break;case"MultiPolygon":for(c=0;c<P.length;c++){for(g=0,Y=0;g<P[c].length;g++){for(k=0;k<P[c][g].length-R;k++){if(!1===a(P[c][g][k],D,V,K,Y))return!1;D++}Y++}K++}break;case"GeometryCollection":for(c=0;c<A.geometries.length;c++)if(!1===coordEach(A.geometries[c],a,s))return!1;break;default:throw Error("Unknown Geometry Type")}}}}}function propEach(o,a){var s;switch(o.type){case"FeatureCollection":for(s=0;s<o.features.length&&!1!==a(o.features[s].properties,s);s++);break;case"Feature":a(o.properties,0)}}function featureEach(o,a){if("Feature"===o.type)a(o,0);else if("FeatureCollection"===o.type)for(var s=0;s<o.features.length&&!1!==a(o.features[s],s);s++);}function geomEach(o,a){var s,c,g,k,A,x,P,w,F,R,D=0,G="FeatureCollection"===o.type,B="Feature"===o.type,W=G?o.features.length:1;for(s=0;s<W;s++){for(g=0,x=G?o.features[s].geometry:B?o.geometry:o,w=G?o.features[s].properties:B?o.properties:{},F=G?o.features[s].bbox:B?o.bbox:void 0,R=G?o.features[s].id:B?o.id:void 0,A=(P=!!x&&"GeometryCollection"===x.type)?x.geometries.length:1;g<A;g++){if(null===(k=P?x.geometries[g]:x)){if(!1===a(null,D,w,F,R))return!1;continue}switch(k.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===a(k,D,w,F,R))return!1;break;case"GeometryCollection":for(c=0;c<k.geometries.length;c++)if(!1===a(k.geometries[c],D,w,F,R))return!1;break;default:throw Error("Unknown Geometry Type")}}D++}}function flattenEach(o,a){geomEach(o,function(o,s,g,k,A){var x,P=null===o?null:o.type;switch(P){case null:case"Point":case"LineString":case"Polygon":if(!1===a(c.feature(o,g,{bbox:k,id:A}),s,0))return!1;return}switch(P){case"MultiPoint":x="Point";break;case"MultiLineString":x="LineString";break;case"MultiPolygon":x="Polygon"}for(var w=0;w<o.coordinates.length;w++){var F={type:x,coordinates:o.coordinates[w]};if(!1===a(c.feature(F,g),s,w))return!1}})}function segmentEach(o,a){flattenEach(o,function(o,s,g){var k,A=0;if(o.geometry){var x=o.geometry.type;if("Point"!==x&&"MultiPoint"!==x){var P=0,w=0,F=0;if(!1===coordEach(o,function(x,R,D,G,B){if(void 0===k||s>P||G>w||B>F){k=x,P=s,w=G,F=B,A=0;return}if(!1===a(c.lineString([k,x],o.properties),s,g,B,A))return!1;A++,k=x}))return!1}}})}function lineEach(o,a){if(!o)throw Error("geojson is required");flattenEach(o,function(o,s,g){if(null!==o.geometry){var k=o.geometry.type,A=o.geometry.coordinates;switch(k){case"LineString":if(!1===a(o,s,g,0,0))return!1;break;case"Polygon":for(var x=0;x<A.length;x++)if(!1===a(c.lineString(A[x],o.properties),s,g,x))return!1}}})}a.coordAll=function(o){var a=[];return coordEach(o,function(o){a.push(o)}),a},a.coordEach=coordEach,a.coordReduce=function(o,a,s,c){var g=s;return coordEach(o,function(o,c,k,A,x){g=0===c&&void 0===s?o:a(g,o,c,k,A,x)},c),g},a.featureEach=featureEach,a.featureReduce=function(o,a,s){var c=s;return featureEach(o,function(o,g){c=0===g&&void 0===s?o:a(c,o,g)}),c},a.findPoint=function(o,a){if(a=a||{},!c.isObject(a))throw Error("options is invalid");var s,g=a.featureIndex||0,k=a.multiFeatureIndex||0,A=a.geometryIndex||0,x=a.coordIndex||0,P=a.properties;switch(o.type){case"FeatureCollection":g<0&&(g=o.features.length+g),P=P||o.features[g].properties,s=o.features[g].geometry;break;case"Feature":P=P||o.properties,s=o.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=o;break;default:throw Error("geojson is invalid")}if(null===s)return null;var w=s.coordinates;switch(s.type){case"Point":return c.point(w,P,a);case"MultiPoint":return k<0&&(k=w.length+k),c.point(w[k],P,a);case"LineString":return x<0&&(x=w.length+x),c.point(w[x],P,a);case"Polygon":return A<0&&(A=w.length+A),x<0&&(x=w[A].length+x),c.point(w[A][x],P,a);case"MultiLineString":return k<0&&(k=w.length+k),x<0&&(x=w[k].length+x),c.point(w[k][x],P,a);case"MultiPolygon":return k<0&&(k=w.length+k),A<0&&(A=w[k].length+A),x<0&&(x=w[k][A].length-x),c.point(w[k][A][x],P,a)}throw Error("geojson is invalid")},a.findSegment=function(o,a){if(a=a||{},!c.isObject(a))throw Error("options is invalid");var s,g=a.featureIndex||0,k=a.multiFeatureIndex||0,A=a.geometryIndex||0,x=a.segmentIndex||0,P=a.properties;switch(o.type){case"FeatureCollection":g<0&&(g=o.features.length+g),P=P||o.features[g].properties,s=o.features[g].geometry;break;case"Feature":P=P||o.properties,s=o.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=o;break;default:throw Error("geojson is invalid")}if(null===s)return null;var w=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return x<0&&(x=w.length+x-1),c.lineString([w[x],w[x+1]],P,a);case"Polygon":return A<0&&(A=w.length+A),x<0&&(x=w[A].length+x-1),c.lineString([w[A][x],w[A][x+1]],P,a);case"MultiLineString":return k<0&&(k=w.length+k),x<0&&(x=w[k].length+x-1),c.lineString([w[k][x],w[k][x+1]],P,a);case"MultiPolygon":return k<0&&(k=w.length+k),A<0&&(A=w[k].length+A),x<0&&(x=w[k][A].length-x-1),c.lineString([w[k][A][x],w[k][A][x+1]],P,a)}throw Error("geojson is invalid")},a.flattenEach=flattenEach,a.flattenReduce=function(o,a,s){var c=s;return flattenEach(o,function(o,g,k){c=0===g&&0===k&&void 0===s?o:a(c,o,g,k)}),c},a.geomEach=geomEach,a.geomReduce=function(o,a,s){var c=s;return geomEach(o,function(o,g,k,A,x){c=0===g&&void 0===s?o:a(c,o,g,k,A,x)}),c},a.lineEach=lineEach,a.lineReduce=function(o,a,s){var c=s;return lineEach(o,function(o,g,k,A){c=0===g&&void 0===s?o:a(c,o,g,k,A)}),c},a.propEach=propEach,a.propReduce=function(o,a,s){var c=s;return propEach(o,function(o,g){c=0===g&&void 0===s?o:a(c,o,g)}),c},a.segmentEach=segmentEach,a.segmentReduce=function(o,a,s){var c=s,g=!1;return segmentEach(o,function(o,k,A,x,P){c=!1===g&&void 0===s?o:a(c,o,k,A,x,P),g=!0}),c}},535885:function(o,a,s){"use strict";s.d(a,{i:function(){return beautifyKey},t:function(){return strReplaceAll}});var c=s(734051);let strReplaceAll=(o,a,s)=>o.split(a).join(s),g=(0,c.Map)(),textTransform=(o,a)=>{switch(a){case"ol":if("number"==typeof o)return o+1+".";break;case"upper":if("string"==typeof o)return o.toUpperCase();break;case"lower":if("string"==typeof o)return o.toLowerCase();break;case"upper-beauty":if("string"==typeof o)return beauty(o).toUpperCase();break;case"lower-beauty":if("string"==typeof o)return beauty(o).toLowerCase();break;case"beauty-text":if("string"==typeof o&&isNaN(1*o))return beauty(o);break;case"beauty-igno-lead":if("string"==typeof o){let a=0;do{if(null===new RegExp(/[.\-_]/g).exec(o[a]))break;a++}while(a<o.length);return o.slice(0,a)+beauty(o.slice(a))}}return o},beauty=o=>{if("string"!=typeof o)return o;let a=g.get(o);if(a)return a;let s=strReplaceAll(strReplaceAll(strReplaceAll(o,"_"," "),"."," "),"-"," ").replace(/  +/g," ").split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");return g=g.set(o,s),s},beautifyKey=(o,a=!0)=>a?"string"==typeof a?textTransform(o,a):beauty(o):o},680991:function(o,a,s){"use strict";s.d(a,{df:function(){return createMap},xw:function(){return createOrderedMap},oG:function(){return fromJSOrdered}});var c=s(734051);function fromJSOrdered(o){return c.Map.isMap(o)||c.OrderedMap.isOrderedMap(o)||c.List.isList(o),"object"!=typeof o||null===o?o:Array.isArray(o)?(0,c.Seq)(o).map(fromJSOrdered).toList():(0,c.Seq)(o).map(fromJSOrdered).toOrderedMap()}let createOrderedMap=(o={})=>new c.OrderedMap(fromJSOrdered(o)),createMap=(o={})=>new c.Map((0,c.fromJS)(o))},185174:function(o,a,s){"use strict";s.d(a,{E:function(){return getSchemaId}});let getSchemaId=o=>(null==o?void 0:o.get("$id"))||(null==o?void 0:o.get("id"))},23491:function(o,a,s){"use strict";s.d(a,{i2:function(){return c.i},PG:function(){return F.P},df:function(){return g.df},xw:function(){return g.xw},oG:function(){return g.oG},Gf:function(){return x.getDisplayName},EJ:function(){return k.E},Xy:function(){return x.isEqual},Fw:function(){return function isImmutableDeep(o,a=!0){return"object"!=typeof o||null===o?"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o&&(a=!1):A.List.isList(o)?(0,A.Seq)(o).forEach(o=>a=isImmutableDeep(o,a)):A.Map.isMap(o)?(0,A.Seq)(o).forEach(o=>a=isImmutableDeep(o,a)):A.Record.isRecord(o)?(0,A.Seq)(o).forEach(o=>a=isImmutableDeep(o,a)):a=!1,a}},gf:function(){return F.g},X$:function(){return x.memo},zb:function(){return P.mergeSchema},uo:function(){return w.moveItem},TD:function(){return R.TD},Nl:function(){return R.Nl},TC:function(){return R.TC},ju:function(){return D.schemaTypeToDistinct},db:function(){return G.d},tm:function(){return c.t},nj:function(){return W.n},Yx:function(){return B.useImmutable}});var c=s(535885),g=s(680991),k=s(185174),A=s(734051),x=s(947738),P=s(761845),w=s(727133),F=s(739353),R=s(285763),D=s(631190),G=s(652645),B=s(899625),W=s(502083)},947738:function(o,a,s){"use strict";s.r(a),s.d(a,{getDisplayName:function(){return getDisplayName},isEqual:function(){return isEqual},memo:function(){return memo}});var c=s(827378),g=s(734051);function getDisplayName(o){return o.displayName||o.name||"Anonymous"}let compare=(o,a)=>{if(g.List.isList(a)||g.Map.isMap(a)||g.Record.isRecord(a))return a.equals(o);if(Array.isArray(a));else if("object"==typeof a)return Object.is(o,a);return o===a},isEqual=(o,a)=>{let s=Object.keys(o),c=Object.keys(a);if(s.length!==c.length||!s.every(o=>c.includes(o)))return!1;for(let s in a)if(!compare(o[s],a[s]))return!1;return!0},memo=o=>{let a=c.memo(o,isEqual);return a.displayName=getDisplayName(o),a}},761845:function(o,a,s){"use strict";s.r(a),s.d(a,{mergeSchema:function(){return mergeSchema}});var c=s(734051);let mergeSchema=(o,a=(0,c.Map)())=>{a.get("properties")&&(o=o.get("properties")?o.update("properties",o=>o=o.merge(a.get("properties").map((a,s)=>o.get(s)?mergeSchema(o.get(s),a):a))):o.set("properties",a.get("properties"))),a.get("required")&&(o=o.get("required")?o.set("required",o.get("required").concat(a.get("required"))):o.set("required",a.get("required"))),a.get("enum")&&(o=o.update("enum",(o=(0,c.List)())=>o.concat(a.get("enum")).toSet().toList())),a.get("oneOf")&&(o=o.set("oneOf",o.get("oneOf")?o.get("oneOf").concat(a.get("oneOf")):a.get("oneOf")));let s=a;return s=s.deleteAll(["properties","required","enum"]),o=o.mergeDeep(s)}},727133:function(o,a,s){"use strict";s.r(a),s.d(a,{moveItem:function(){return moveItem}});var c=s(734051);let moveItem=(o,a,s)=>{if(!o||s<0||o.size<=s||a<0||o.size<=a)return o;if(c.List.isList(o)){let c=o.get(a);return o.splice(a,1).splice(s,0,c)}return o}},739353:function(o,a,s){"use strict";s.d(a,{P:function(){return checkNativeValidity},g:function(){return mapSchema}});let mapSchema=(o={},a)=>("number"==typeof a.get("minLength")&&(o.minLength=a.get("minLength")),"number"==typeof a.get("maxLength")&&(o.maxLength=a.get("maxLength")),"number"==typeof a.get("minimum")&&(o.min=a.get("minimum")),"number"==typeof a.get("maximum")&&(o.max=a.get("maximum")),"number"==typeof a.get("multipleOf")&&(o.step=a.get("multipleOf")),a.get("pattern")&&(o.pattern=a.get("pattern")),o),checkNativeValidity=(o,a)=>{if(o)for(let s in o.validity)"valid"!==s&&(a=!!a&&!o.validity[s]);return a}},285763:function(o,a,s){"use strict";s.d(a,{Nl:function(){return schemaTypeIsAny},TC:function(){return schemaTypeIsNumeric},TD:function(){return schemaTypeIs}});let schemaTypeIs=(o,a)=>!!(void 0!==o&&("string"==typeof o?o===a:o.includes(a))),schemaTypeIsNumeric=o=>schemaTypeIs(o,"number")||schemaTypeIs(o,"integer"),schemaTypeIsAny=(o,a)=>!!(void 0!==o&&("string"==typeof o?a.includes(o):a.reduce((a,s)=>a||o.includes(s),!1)))},631190:function(o,a,s){"use strict";s.r(a),s.d(a,{schemaTypeToDistinct:function(){return schemaTypeToDistinct}});var c=s(734051);let schemaTypeToDistinct=(o,a=["null"])=>{let s;if(!o)return s;if("string"==typeof o)s=o;else if(Array.isArray(o)&&1===o.length||"size"in o&&1===o.size)s=o.join();else{let g=o.reduce((o,s)=>a.includes(s)?o:o.push(s),(0,c.List)());1===g.size&&(s=g.join())}return s}},652645:function(o,a,s){"use strict";s.d(a,{d:function(){return sortScalarList}});let sortScalarList=o=>o.sort((o,a="")=>"string"==typeof o?o.localeCompare(a):"number"==typeof o?o>a:1)},502083:function(o,a,s){"use strict";s.d(a,{n:function(){return useDebounceValue}});var c=s(827378);let useDebounceValue=(o,a,s)=>{let g=c.useRef(void 0),[k,A]=c.useState({changed:!1,value:void 0});c.useEffect(()=>{window.clearTimeout(g.current),A({changed:!1,value:o})},[o,g]),c.useEffect(()=>{if(void 0!==k.value&&k.changed)return g.current=window.setTimeout(()=>{s(k.value)},a),()=>window.clearTimeout(g.current)},[k,A,a,g,s]);let x=c.useCallback(o=>{k.value!==o&&(window.clearTimeout(g.current),s(k.value))},[s,k]),P=c.useCallback(o=>{A({changed:!0,value:o})},[A]);return{bubbleBounce:x,bounceVal:k,setBounceVal:A,changeBounceVal:P}}},899625:function(o,a,s){"use strict";s.r(a),s.d(a,{useImmutable:function(){return useImmutable}});var c=s(827378),g=s(734051);function useImmutable(o){var a;let s=c.useRef(o);return((0,g.isImmutable)(s.current)||g.Record.isRecord(o))&&null!==(a=s.current)&&void 0!==a&&a.equals(o)||(s.current=o),s.current}},726992:function(o,a,s){"use strict";s.r(a),s.d(a,{default:function(){return isAfter}});var c=s(332825),g=s(685902);function isAfter(o,a){(0,g.Z)(2,arguments);var s=(0,c.default)(o),k=(0,c.default)(a);return s.getTime()>k.getTime()}},533637:function(o,a,s){"use strict";s.r(a),s.d(a,{default:function(){return Flatbush}});let FlatQueue=class FlatQueue{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(o,a){let s=this.length++;for(this.ids[s]=o,this.values[s]=a;s>0;){let o=s-1>>1,c=this.values[o];if(a>=c)break;this.ids[s]=this.ids[o],this.values[s]=c,s=o}this.ids[s]=o,this.values[s]=a}pop(){if(0===this.length)return;let o=this.ids[0];if(this.length--,this.length>0){let o=this.ids[0]=this.ids[this.length],a=this.values[0]=this.values[this.length],s=this.length>>1,c=0;for(;c<s;){let o=(c<<1)+1,s=o+1,g=this.ids[o],k=this.values[o],A=this.values[s];if(s<this.length&&A<k&&(o=s,g=this.ids[s],k=A),k>=a)break;this.ids[c]=g,this.values[c]=k,c=o}this.ids[c]=o,this.values[c]=a}return o}peek(){if(0!==this.length)return this.ids[0]}peekValue(){if(0!==this.length)return this.values[0]}};let c=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];let Flatbush=class Flatbush{static from(o){if(!(o instanceof ArrayBuffer))throw Error("Data must be an instance of ArrayBuffer.");let[a,s]=new Uint8Array(o,0,2);if(251!==a)throw Error("Data does not appear to be in a Flatbush format.");if(s>>4!=3)throw Error(`Got v${s>>4} data when expected v3.`);let[g]=new Uint16Array(o,2,1),[k]=new Uint32Array(o,4,1);return new Flatbush(k,g,c[15&s],o)}constructor(o,a=16,s=Float64Array,g){if(void 0===o)throw Error("Missing required argument: numItems.");if(isNaN(o)||o<=0)throw Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+a,2),65535);let k=o,A=k;this._levelBounds=[4*k];do A+=k=Math.ceil(k/this.nodeSize),this._levelBounds.push(4*A);while(1!==k);this.ArrayType=s||Float64Array,this.IndexArrayType=A<16384?Uint16Array:Uint32Array;let x=c.indexOf(this.ArrayType),P=4*A*this.ArrayType.BYTES_PER_ELEMENT;if(x<0)throw Error(`Unexpected typed array class: ${s}.`);g&&g instanceof ArrayBuffer?(this.data=g,this._boxes=new this.ArrayType(this.data,8,4*A),this._indices=new this.IndexArrayType(this.data,8+P,A),this._pos=4*A,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+P+A*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,4*A),this._indices=new this.IndexArrayType(this.data,8+P,A),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,48+x]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=o),this._queue=new FlatQueue}add(o,a,s,c){let g=this._pos>>2;return this._indices[g]=g,this._boxes[this._pos++]=o,this._boxes[this._pos++]=a,this._boxes[this._pos++]=s,this._boxes[this._pos++]=c,o<this.minX&&(this.minX=o),a<this.minY&&(this.minY=a),s>this.maxX&&(this.maxX=s),c>this.maxY&&(this.maxY=c),g}finish(){if(this._pos>>2!==this.numItems)throw Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}let o=this.maxX-this.minX,a=this.maxY-this.minY,s=new Uint32Array(this.numItems);for(let c=0;c<this.numItems;c++){let g=4*c,k=this._boxes[g++],A=this._boxes[g++],x=this._boxes[g++],P=this._boxes[g++],w=Math.floor(65535*((k+x)/2-this.minX)/o),F=Math.floor(65535*((A+P)/2-this.minY)/a);s[c]=function(o,a){let s=o^a,c=65535^s,g=65535^(o|a),k=o&(65535^a),A=s|c>>1,x=s>>1^s,P=g>>1^c&k>>1^g,w=s&g>>1^k>>1^k;s=A,c=x,g=P,k=w,A=s&s>>2^c&c>>2,x=s&c>>2^c&(s^c)>>2,P^=s&g>>2^c&k>>2,w^=c&g>>2^(s^c)&k>>2,s=A,c=x,g=P,k=w,A=s&s>>4^c&c>>4,x=s&c>>4^c&(s^c)>>4,P^=s&g>>4^c&k>>4,w^=c&g>>4^(s^c)&k>>4,s=A,c=x,g=P,P^=s&g>>8^c&(k=w)>>8,w^=c&g>>8^(s^c)&k>>8,s=P^P>>1;let F=o^a,R=(c=w^w>>1)|65535^(F|s);return((R=((R=((R=((R=(R|R<<8)&16711935)|R<<4)&252645135)|R<<2)&858993459)|R<<1)&1431655765)<<1|(F=((F=((F=((F=(F|F<<8)&16711935)|F<<4)&252645135)|F<<2)&858993459)|F<<1)&1431655765))>>>0}(w,F)}!function sort(o,a,s,c,g,k){if(Math.floor(c/k)>=Math.floor(g/k))return;let A=o[c+g>>1],x=c-1,P=g+1;for(;;){do x++;while(o[x]<A);do P--;while(o[P]>A);if(x>=P)break;!function(o,a,s,c,g){let k=o[c];o[c]=o[g],o[g]=k;let A=4*c,x=4*g,P=a[A],w=a[A+1],F=a[A+2],R=a[A+3];a[A]=a[x],a[A+1]=a[x+1],a[A+2]=a[x+2],a[A+3]=a[x+3],a[x]=P,a[x+1]=w,a[x+2]=F,a[x+3]=R;let D=s[c];s[c]=s[g],s[g]=D}(o,a,s,x,P)}sort(o,a,s,c,P,k),sort(o,a,s,P+1,g,k)}(s,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let o=0,a=0;o<this._levelBounds.length-1;o++){let s=this._levelBounds[o];for(;a<s;){let o=a,c=1/0,g=1/0,k=-1/0,A=-1/0;for(let o=0;o<this.nodeSize&&a<s;o++)c=Math.min(c,this._boxes[a++]),g=Math.min(g,this._boxes[a++]),k=Math.max(k,this._boxes[a++]),A=Math.max(A,this._boxes[a++]);this._indices[this._pos>>2]=o,this._boxes[this._pos++]=c,this._boxes[this._pos++]=g,this._boxes[this._pos++]=k,this._boxes[this._pos++]=A}}}search(o,a,s,c,g){if(this._pos!==this._boxes.length)throw Error("Data not yet indexed - call index.finish().");let k=this._boxes.length-4,A=[],x=[];for(;void 0!==k;){let P=Math.min(k+4*this.nodeSize,upperBound(k,this._levelBounds));for(let w=k;w<P;w+=4){let P=0|this._indices[w>>2];s<this._boxes[w]||c<this._boxes[w+1]||o>this._boxes[w+2]||a>this._boxes[w+3]||(k<4*this.numItems?(void 0===g||g(P))&&x.push(P):A.push(P))}k=A.pop()}return x}neighbors(o,a,s=1/0,c=1/0,g){if(this._pos!==this._boxes.length)throw Error("Data not yet indexed - call index.finish().");let k=this._boxes.length-4,A=this._queue,x=[],P=c*c;for(;void 0!==k;){let c=Math.min(k+4*this.nodeSize,upperBound(k,this._levelBounds));for(let s=k;s<c;s+=4){let c=0|this._indices[s>>2],x=axisDist(o,this._boxes[s],this._boxes[s+2]),P=axisDist(a,this._boxes[s+1],this._boxes[s+3]),w=x*x+P*P;k<4*this.numItems?(void 0===g||g(c))&&A.push(-c-1,w):A.push(c,w)}for(;A.length&&0>A.peek();){let o=A.peekValue();if(o>P||(x.push(-A.pop()-1),x.length===s))return A.clear(),x}k=A.pop()}return A.clear(),x}};function axisDist(o,a,s){return o<a?a-o:o<=s?0:o-s}function upperBound(o,a){let s=0,c=a.length-1;for(;s<c;){let g=s+c>>1;a[g]>o?c=g:s=g+1}return a[s]}},844955:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});let c=s(408116),g=s(202347),k=s(338834),A=s(785944),x=s(359207),P=s(370),w=s(343521);c.default.multiply;let F=Object.assign({},c.default,g.default,k.default,P.default,{random:x.default,fromRoots:w.default,allRoots:A.default});a.default=F},785944:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});let c=s(408116),g=s(202347),k=s(338834),{clip0:A,evaluate:x,differentiate:P,toCasStr:w}=c.default,{brent:F,quadraticRoots:R}=g.default,{rootMagnitudeUpperBound_fujiwara:D,positiveRootUpperBound_LMQ:G,positiveRootLowerBound_LMQ:B,negativeRootUpperBound_LMQ:W,negativeRootLowerBound_LMQ:z}=k.default,V=Number.POSITIVE_INFINITY;a.default=function allRoots(o,a=-V,s=+V){let c=(o=A(o)).length-1,rangeFilter=o=>o>=a&&o<=s;if(2===c)return R(o).filter(rangeFilter);if(c>2){let c,g;a===-V||s===+V?(c=a===-V?z(o):a,g=s===+V?G(o):s):(c=a,g=s);let k=allRoots(P(o),c,g).filter(rangeFilter);return k[0]!==c&&k.unshift(c),k[k.length-1]!==g&&k.push(g),function(o,a){let s,c=[],g=x(o),k=a[0];for(let o=1;o<a.length;o++){let A;let x=a[o],P=g(k),w=g(x);0==P*w?0===P?A=k:0===w&&o===a.length-1&&(A=x):P*w<0&&(A=F(g,k,x)),void 0!==A&&A!==s&&(c.push(A),s=A),k=x}return c}(o,k)}return 1===c?[-o[1]/o[0]].filter(rangeFilter):[]}},408116:function(o,a){"use strict";function subtract(o,a){let s=o.length-1,c=a.length-1,g=s-c,k=0,A=0;g>0?A=-g:g<0&&(k=+g);let x=Math.max(s,c),P=[];for(let s=0;s<x+1;s++){let c=o[s+k],g=a[s+A];P.push((c||0)-(g||0))}return clip0(P)}function differentiate(o){let a=[],s=o.length-1;for(let c=0;c<s;c++)a.push((s-c)*o[c]);return a}function multiply(o,a){let s=o.length-1,c=a.length-1,g=s+c,k=Array(g+1).fill(0);for(let A=0;A<s+1;A++)for(let x=0;x<c+1;x++)k[g-(A+x)]+=o[s-A]*a[c-x];return clip0(k)}function multiplyByConst(o,a){if(0===o)return[];let s=a.length-1,c=[];for(let g=0;g<s+1;g++)c.push(o*a[g]);return clip0(c)}function clip0(o){return 0!==o[0]?o:clip0(o.slice(1))}function maxCoefficient(o){let a=0;for(let s=0;s<o.length;s++){let c=Math.abs(o[s]);c>a&&(a=c)}return a}Object.defineProperty(a,"__esModule",{value:!0}),a.default={equal:function(o,a){if(o.length!==a.length)return!1;for(let s=0;s<o.length;s++)if(o[s]!==a[s])return!1;return!0},add:function(o,a){let s=o.length-1,c=a.length-1,g=s-c,k=0,A=0;g>0?A=-g:g<0&&(k=+g);let x=Math.max(s,c),P=[];for(let s=0;s<x+1;s++){let c=o[s+k],g=a[s+A];P.push((c||0)+(g||0))}return clip0(P)},subtract,multiplyByConst,negate:function(o){return multiplyByConst(-1,o)},differentiate,multiply,degree:function(o){return o.length-1},evaluate:function(o,a){function f(a){let s=o[0];for(let c=1;c<o.length;c++)s=o[c]+s*a;return s}return void 0===a?f:f(a)},evaluateAt0:function(o){return o[o.length-1]},signChanges:function(o){let a=o.length-1,s=0,c=Math.sign(o[0]);for(let g=1;g<a+1;g++){let a=Math.sign(o[g]);a!==c&&0!==a&&(s++,c=a)}return s},invert:function(o){return o.slice().reverse()},changeVariables:function(o,a,s){let c=o.length-1,g=[];for(let o=0;o<c+1;o++)g.push(Array(c+1).fill(0));g[0][0]=1;for(let o=1;o<=c;o++){g[0][o]=s*g[0][o-1];for(let c=1;c<=o;c++)g[c][o]=s*g[c][o-1]+a*g[c-1][o-1]}let k=Array(c+1).fill(0);for(let a=0;a<=c;a++){k[c-a]=0;for(let s=a;s<=c;s++){let A=g[a][s]*o[c-s];k[c-a]+=A}}return k},reflectAboutYAxis:function(o){let a=o.length-1,s=o.slice();for(let o=0;o<a+1;o++)o%2&&(s[o]=-s[o]);return s},sturmChain:function(o){let a=[];a.push(o),a.push(differentiate(o));let s=1;for(;a[s].length-1>0;){let o=function(o,a){o.length,a.length;let s=o[1]/o[0]-a[1]/a[0];return subtract(multiply(multiplyByConst(o[0]/a[0],a),[1,s]),o)}(a[s-1],a[s]);for(;a[s].length-o.length<1;)o.shift();a.push(o),s++}return a},clip:function clip(o,a){a=void 0===a?Number.EPSILON:a;let s=maxCoefficient(o);if(0===s)return[];if(Math.abs(o[0])>a*s)return o;let c=o.slice(1);for(;Math.abs(c[0])<a*s;)c=c.slice(1);return clip(c,a)},clip0,deflate:function(o,a){let s=o.length-1,c=[o[0]];for(let g=1;g<s;g++)c.push(o[g]+a*c[g-1]);return c},maxCoefficient,toCasStr:function(o){let a=o.length-1,s="";for(let c=0;c<a+1;c++){let g=o[c].toString();c===a?s+=g:c===a-1?s+="x*"+g+" + ":s+="x^"+(a-c).toString()+"*"+g+" + "}return s}}},370:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});let c=s(408116),{evaluate:g}=c.default;a.default={hornerErrorBound:function(o,a){let s=Number.EPSILON;return 2*(o.length-1)*s*function(o,a){let s=o.length-1,c=0;for(let g=0;g<s;g++)c+=Math.abs(o[g]*Math.pow(a,s-g));return c}(o,a)}}},343521:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});let c=s(408116),{multiply:g}=c.default;a.default=function(o){let a=[1];for(let s=0;s<o.length;s++)a=g(a,[1,-o[s]]);return a}},359207:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});let c=s(343521);function createArrFunction(o){return function(a,s,c,g,k=123456789,A=0){let x=[];for(let P=0;P<a;P++){let a=o(s,c,g,k,A),P=a.p;k=a.seed,x.push(P)}return x}}let g=createArrFunction(flatRoots),k=createArrFunction(flatCoefficients);function predictiveRandom(o){return(134775813*o+1)%4294967296}function randomArray(o,a,s,c=123456789,g=0){let k=[];for(let A=0;A<o;A++){let o=(c=predictiveRandom(c))/4294967296*(s-a)+a;c=function push(o,a,s,c){return o=predictiveRandom(o),a.push(s),o/4294967296<c&&(o=push(o,a,s,c)),o}(c,k,o,g)}return{vs:k=k.slice(0,o),seed:c}}function flatRoots(o,a=0,s=1,g=123456789,k=0){let A=randomArray(o,a,s,g,k);return g=A.seed,{p:c.default(A.vs),seed:g}}function flatCoefficients(o,a=-1,s=1,c=123456789){let g=randomArray(o,a=void 0===a?-1:a,s=void 0===s?1:s,c=void 0===c?123456789:c);return c=g.seed,{p:g.vs,seed:c}}a.default={flatRoots,flatRootsArr:g,flatCoefficients,flatCoefficientsArr:k}},338834:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});let c=s(408116),{invert:g,negate:k,reflectAboutYAxis:A}=c.default,x=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152];function positiveRootUpperBound_LMQ(o){let a=o.length-1;if(a<1)return 0;o[0]<0&&(o=k(o));let s=[];for(let o=0;o<a;o++)s.push(1);let c=0;for(let g=0;g<=a;g++){if(o[g]>=0)continue;let a=Number.POSITIVE_INFINITY,k=!1;for(let c=0;c<g;c++){let A;if(o[c]<=0)continue;let P=s[c];A=P>20?Math.pow(2,P):x[P];let w=Math.pow(-o[g]/(o[c]/A),1/(g-c));s[c]++,a>w&&(a=w),k=!0}k&&c<a&&(c=a)}return c}function positiveRootLowerBound_LMQ(o){let a=positiveRootUpperBound_LMQ(g(o));return 0===a?0:1/a}a.default={rootMagnitudeUpperBound_fujiwara:function(o){let a=o.length-1,s=o[0],c=[];for(let g=1;g<a;g++){let a=Math.pow(Math.abs(o[g]/s),1/g);c.push(a)}return c.push(Math.pow(Math.abs(o[a]/2*s),1/a)),2*Math.max.apply(void 0,c)},positiveRootUpperBound_LMQ,positiveRootLowerBound_LMQ,negativeRootUpperBound_LMQ:function(o){return-positiveRootLowerBound_LMQ(A(o))},negativeRootLowerBound_LMQ:function(o){return-positiveRootUpperBound_LMQ(A(o))},rootMagnitudeUpperBound_rouche:function(o){return o.length,1+1/o[0]*Math.max(...o.slice(1).map(o=>Math.abs(o)))}}},202347:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});let c=s(408116),{sturmChain:g,evaluate:k,signChanges:A}=c.default;a.default={quadraticRoots:function(o){let a,s,[c,g,k]=o,A=g*g-4*c*k;return A<0?[]:0===A?[-g/(2*c)]:(A=Math.sqrt(A),g>=0?(a=(-g-A)/(2*c),s=2*k/(-g-A)):(a=2*k/(-g+A),s=(-g+A)/(2*c)),a<s)?[a,s]:[s,a]},numRootsWithin:function(o,a,s){let c=g(o);k(o);let x=c.map(o=>k(o)(a)),P=c.map(o=>k(o)(s));return A(x)-A(P)},brent:function(o,a,s){let c,g;if(a===s)return a;let k=o(a),A=o(s);if(k*A>0)throw Error("Root not bracketed");if(Math.abs(k)<Math.abs(A)){c=a,a=s,s=c;let o=k;k=A,A=o}c=a;let x=!0;for(;;){let P,w=2*Number.EPSILON*Math.abs(s),F=o(c);if(k!==F&&A!==F){let o=k-F,g=k-A,x=A-F;P=((a*A*x-s*k*o)*F+c*k*g*A)/(g*o*x)}else P=s-A*((s-a)/(A-k));let R=(3*a+s)/4,D=Math.abs(s-c),G=Math.abs(P-s),B=Math.abs(c-g);!(P>R&&P<s||P<R&&P>s)||x&&(G>=D/2||D<w)||!x&&(G>=B/2||B<w)?(P=(a+s)/2,x=!0):x=!1;let W=o(P);if(g=c,c=s,k*W<0?s=P:a=P,Math.abs(k)<Math.abs(A)){let o=a;a=s,s=o}if(0===A)return s;if(0===W)return P;if(Math.abs(a-s)<=w)return s;k=o(a),A=o(s)}},bisection:function(o,a,s){if(a===s)return a;s<a&&([a,s]=[s,a]);let c=o(a),g=o(s);if(0===c)return a;if(0===g)return s;if(c*g>0)throw Error("Root not bracketed");for(;;){let g=a+(s-a)/2,k=o(g);if(0===k)return g;c*k<0?s=g:a=g;let A=2*Number.EPSILON*Math.abs(s);if(Math.abs(a-s)<=A)return s}}}},734051:function(o,a,s){"use strict";s.r(a),s.d(a,{Collection:function(){return Collection},Iterable:function(){return eZ},List:function(){return eF},Map:function(){return eM},OrderedMap:function(){return eD},OrderedSet:function(){return eK},Range:function(){return eV},Record:function(){return Record},Repeat:function(){return eX},Seq:function(){return en},Set:function(){return ej},Stack:function(){return eG},fromJS:function(){return fromJS},get:function(){return get},getIn:function(){return getIn},has:function(){return has},hasIn:function(){return hasIn},hash:function(){return hash},is:function(){return is},isAssociative:function(){return isAssociative},isCollection:function(){return isCollection},isImmutable:function(){return isImmutable},isIndexed:function(){return isIndexed},isKeyed:function(){return isKeyed},isOrdered:function(){return isOrdered},isValueObject:function(){return isValueObject},merge:function(){return merge$1},mergeDeep:function(){return mergeDeep},mergeDeepWith:function(){return mergeDeepWith},mergeWith:function(){return mergeWith$1},remove:function(){return remove},removeIn:function(){return removeIn},set:function(){return set},setIn:function(){return setIn},update:function(){return update},updateIn:function(){return updateIn},version:function(){return eQ}});var c,g,k,A,x,P,w,F,R,D,G="delete",B={};function MakeRef(){return{value:!1}}function SetRef(o){o&&(o.value=!0)}function OwnerID(){}function ensureSize(o){return void 0===o.size&&(o.size=o.__iterate(returnTrue)),o.size}function wrapIndex(o,a){if("number"!=typeof a){var s=a>>>0;if(""+s!==a||4294967295===s)return NaN;a=s}return a<0?ensureSize(o)+a:a}function returnTrue(){return!0}function wholeSlice(o,a,s){return(0===o&&!isNeg(o)||void 0!==s&&o<=-s)&&(void 0===a||void 0!==s&&a>=s)}function resolveIndex(o,a,s){return void 0===o?s:isNeg(o)?a===1/0?a:0|Math.max(0,a+o):void 0===a||a===o?o:0|Math.min(a,o)}function isNeg(o){return o<0||0===o&&1/o==-1/0}var W="@@__IMMUTABLE_ITERABLE__@@";function isCollection(o){return!!(o&&o[W])}var z="@@__IMMUTABLE_KEYED__@@";function isKeyed(o){return!!(o&&o[z])}var V="@@__IMMUTABLE_INDEXED__@@";function isIndexed(o){return!!(o&&o[V])}function isAssociative(o){return isKeyed(o)||isIndexed(o)}var Collection=function(o){return isCollection(o)?o:en(o)},U=function(o){function KeyedCollection(o){return isKeyed(o)?o:ei(o)}return o&&(KeyedCollection.__proto__=o),KeyedCollection.prototype=Object.create(o&&o.prototype),KeyedCollection.prototype.constructor=KeyedCollection,KeyedCollection}(Collection),K=function(o){function IndexedCollection(o){return isIndexed(o)?o:eo(o)}return o&&(IndexedCollection.__proto__=o),IndexedCollection.prototype=Object.create(o&&o.prototype),IndexedCollection.prototype.constructor=IndexedCollection,IndexedCollection}(Collection),Y=function(o){function SetCollection(o){return isCollection(o)&&!isAssociative(o)?o:ea(o)}return o&&(SetCollection.__proto__=o),SetCollection.prototype=Object.create(o&&o.prototype),SetCollection.prototype.constructor=SetCollection,SetCollection}(Collection);Collection.Keyed=U,Collection.Indexed=K,Collection.Set=Y;var $="@@__IMMUTABLE_SEQ__@@";function isSeq(o){return!!(o&&o[$])}var X="@@__IMMUTABLE_RECORD__@@";function isRecord(o){return!!(o&&o[X])}function isImmutable(o){return isCollection(o)||isRecord(o)}var Z="@@__IMMUTABLE_ORDERED__@@";function isOrdered(o){return!!(o&&o[Z])}var J="function"==typeof Symbol&&Symbol.iterator,ee="@@iterator",et=J||ee,Iterator=function(o){this.next=o};function iteratorValue(o,a,s,c){var g=0===o?a:1===o?s:[a,s];return c?c.value=g:c={value:g,done:!1},c}function iteratorDone(){return{value:void 0,done:!0}}function isIterator(o){return o&&"function"==typeof o.next}function getIterator(o){var a=getIteratorFn(o);return a&&a.call(o)}function getIteratorFn(o){var a=o&&(J&&o[J]||o[ee]);if("function"==typeof a)return a}Iterator.prototype.toString=function(){return"[Iterator]"},Iterator.KEYS=0,Iterator.VALUES=1,Iterator.ENTRIES=2,Iterator.prototype.inspect=Iterator.prototype.toSource=function(){return this.toString()},Iterator.prototype[et]=function(){return this};var er=Object.prototype.hasOwnProperty;function isArrayLike(o){return!!Array.isArray(o)||"string"==typeof o||o&&"object"==typeof o&&Number.isInteger(o.length)&&o.length>=0&&(0===o.length?1===Object.keys(o).length:o.hasOwnProperty(o.length-1))}var en=function(o){function Seq(o){return null==o?emptySequence():isImmutable(o)?o.toSeq():function(o){var a=maybeIndexedSeqFromValue(o);if(a)return a;if("object"==typeof o)return new el(o);throw TypeError("Expected Array or collection object of values, or keyed object: "+o)}(o)}return o&&(Seq.__proto__=o),Seq.prototype=Object.create(o&&o.prototype),Seq.prototype.constructor=Seq,Seq.prototype.toSeq=function(){return this},Seq.prototype.toString=function(){return this.__toString("Seq {","}")},Seq.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},Seq.prototype.__iterate=function(o,a){var s=this._cache;if(s){for(var c=s.length,g=0;g!==c;){var k=s[a?c-++g:g++];if(!1===o(k[1],k[0],this))break}return g}return this.__iterateUncached(o,a)},Seq.prototype.__iterator=function(o,a){var s=this._cache;if(s){var c=s.length,g=0;return new Iterator(function(){if(g===c)return iteratorDone();var k=s[a?c-++g:g++];return iteratorValue(o,k[0],k[1])})}return this.__iteratorUncached(o,a)},Seq}(Collection),ei=function(o){function KeyedSeq(o){return null==o?emptySequence().toKeyedSeq():isCollection(o)?isKeyed(o)?o.toSeq():o.fromEntrySeq():isRecord(o)?o.toSeq():keyedSeqFromValue(o)}return o&&(KeyedSeq.__proto__=o),KeyedSeq.prototype=Object.create(o&&o.prototype),KeyedSeq.prototype.constructor=KeyedSeq,KeyedSeq.prototype.toKeyedSeq=function(){return this},KeyedSeq}(en),eo=function(o){function IndexedSeq(o){return null==o?emptySequence():isCollection(o)?isKeyed(o)?o.entrySeq():o.toIndexedSeq():isRecord(o)?o.toSeq().entrySeq():indexedSeqFromValue(o)}return o&&(IndexedSeq.__proto__=o),IndexedSeq.prototype=Object.create(o&&o.prototype),IndexedSeq.prototype.constructor=IndexedSeq,IndexedSeq.of=function(){return IndexedSeq(arguments)},IndexedSeq.prototype.toIndexedSeq=function(){return this},IndexedSeq.prototype.toString=function(){return this.__toString("Seq [","]")},IndexedSeq}(en),ea=function(o){function SetSeq(o){return(isCollection(o)&&!isAssociative(o)?o:eo(o)).toSetSeq()}return o&&(SetSeq.__proto__=o),SetSeq.prototype=Object.create(o&&o.prototype),SetSeq.prototype.constructor=SetSeq,SetSeq.of=function(){return SetSeq(arguments)},SetSeq.prototype.toSetSeq=function(){return this},SetSeq}(en);en.isSeq=isSeq,en.Keyed=ei,en.Set=ea,en.Indexed=eo,en.prototype[$]=!0;var es=function(o){function ArraySeq(o){this._array=o,this.size=o.length}return o&&(ArraySeq.__proto__=o),ArraySeq.prototype=Object.create(o&&o.prototype),ArraySeq.prototype.constructor=ArraySeq,ArraySeq.prototype.get=function(o,a){return this.has(o)?this._array[wrapIndex(this,o)]:a},ArraySeq.prototype.__iterate=function(o,a){for(var s=this._array,c=s.length,g=0;g!==c;){var k=a?c-++g:g++;if(!1===o(s[k],k,this))break}return g},ArraySeq.prototype.__iterator=function(o,a){var s=this._array,c=s.length,g=0;return new Iterator(function(){if(g===c)return iteratorDone();var k=a?c-++g:g++;return iteratorValue(o,k,s[k])})},ArraySeq}(eo),el=function(o){function ObjectSeq(o){var a=Object.keys(o);this._object=o,this._keys=a,this.size=a.length}return o&&(ObjectSeq.__proto__=o),ObjectSeq.prototype=Object.create(o&&o.prototype),ObjectSeq.prototype.constructor=ObjectSeq,ObjectSeq.prototype.get=function(o,a){return void 0===a||this.has(o)?this._object[o]:a},ObjectSeq.prototype.has=function(o){return er.call(this._object,o)},ObjectSeq.prototype.__iterate=function(o,a){for(var s=this._object,c=this._keys,g=c.length,k=0;k!==g;){var A=c[a?g-++k:k++];if(!1===o(s[A],A,this))break}return k},ObjectSeq.prototype.__iterator=function(o,a){var s=this._object,c=this._keys,g=c.length,k=0;return new Iterator(function(){if(k===g)return iteratorDone();var A=c[a?g-++k:k++];return iteratorValue(o,A,s[A])})},ObjectSeq}(ei);el.prototype[Z]=!0;var eu=function(o){function CollectionSeq(o){this._collection=o,this.size=o.length||o.size}return o&&(CollectionSeq.__proto__=o),CollectionSeq.prototype=Object.create(o&&o.prototype),CollectionSeq.prototype.constructor=CollectionSeq,CollectionSeq.prototype.__iterateUncached=function(o,a){if(a)return this.cacheResult().__iterate(o,a);var s,c=getIterator(this._collection),g=0;if(isIterator(c))for(;!(s=c.next()).done&&!1!==o(s.value,g++,this););return g},CollectionSeq.prototype.__iteratorUncached=function(o,a){if(a)return this.cacheResult().__iterator(o,a);var s=getIterator(this._collection);if(!isIterator(s))return new Iterator(iteratorDone);var c=0;return new Iterator(function(){var a=s.next();return a.done?a:iteratorValue(o,c++,a.value)})},CollectionSeq}(eo);function emptySequence(){return c||(c=new es([]))}function keyedSeqFromValue(o){var a=Array.isArray(o)?new es(o):getIteratorFn(o)?new eu(o):void 0;if(a)return a.fromEntrySeq();if("object"==typeof o)return new el(o);throw TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+o)}function indexedSeqFromValue(o){var a=maybeIndexedSeqFromValue(o);if(a)return a;throw TypeError("Expected Array or collection object of values: "+o)}function maybeIndexedSeqFromValue(o){return isArrayLike(o)?new es(o):getIteratorFn(o)?new eu(o):void 0}var ed="@@__IMMUTABLE_MAP__@@";function isMap(o){return!!(o&&o[ed])}function isOrderedMap(o){return isMap(o)&&isOrdered(o)}function isValueObject(o){return!!(o&&"function"==typeof o.equals&&"function"==typeof o.hashCode)}function is(o,a){if(o===a||o!=o&&a!=a)return!0;if(!o||!a)return!1;if("function"==typeof o.valueOf&&"function"==typeof a.valueOf){if((o=o.valueOf())===(a=a.valueOf())||o!=o&&a!=a)return!0;if(!o||!a)return!1}return!!(isValueObject(o)&&isValueObject(a)&&o.equals(a))}var ec="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(o,a){var s=65535&(o|=0),c=65535&(a|=0);return s*c+((o>>>16)*c+s*(a>>>16)<<16>>>0)|0};function smi(o){return o>>>1&1073741824|3221225471&o}var ep=Object.prototype.valueOf;function hash(o){switch(typeof o){case"boolean":return o?1108378657:1108378656;case"number":return function(o){if(o!=o||o===1/0)return 0;var a=0|o;for(a!==o&&(a^=4294967295*o);o>4294967295;)o/=4294967295,a^=o;return smi(a)}(o);case"string":var a,s;return o.length>eb?(void 0===(s=eT[a=o])&&(s=hashString(a),e_===ev&&(e_=0,eT={}),e_++,eT[a]=s),s):hashString(o);case"object":case"function":if(null===o)return 1108378658;if("function"==typeof o.hashCode)return smi(o.hashCode(o));return o.valueOf!==ep&&"function"==typeof o.valueOf&&(o=o.valueOf(o)),function(o){var a;if(em&&void 0!==(a=g.get(o))||void 0!==(a=o[ey])||!eh&&(void 0!==(a=o.propertyIsEnumerable&&o.propertyIsEnumerable[ey])||void 0!==(a=function(o){if(o&&o.nodeType>0)switch(o.nodeType){case 1:return o.uniqueID;case 9:return o.documentElement&&o.documentElement.uniqueID}}(o))))return a;if(a=++eg,1073741824&eg&&(eg=0),em)g.set(o,a);else if(void 0!==ef&&!1===ef(o))throw Error("Non-extensible objects are not allowed as keys.");else if(eh)Object.defineProperty(o,ey,{enumerable:!1,configurable:!1,writable:!1,value:a});else if(void 0!==o.propertyIsEnumerable&&o.propertyIsEnumerable===o.constructor.prototype.propertyIsEnumerable)o.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},o.propertyIsEnumerable[ey]=a;else if(void 0!==o.nodeType)o[ey]=a;else throw Error("Unable to set a non-enumerable property on object.");return a}(o);case"undefined":return 1108378659;default:if("function"==typeof o.toString)return hashString(o.toString());throw Error("Value type "+typeof o+" cannot be hashed.")}}function hashString(o){for(var a=0,s=0;s<o.length;s++)a=31*a+o.charCodeAt(s)|0;return smi(a)}var ef=Object.isExtensible,eh=function(){try{return Object.defineProperty({},"@",{}),!0}catch(o){return!1}}(),em="function"==typeof WeakMap;em&&(g=new WeakMap);var eg=0,ey="__immutablehash__";"function"==typeof Symbol&&(ey=Symbol(ey));var eb=16,ev=255,e_=0,eT={},ek=function(o){function ToKeyedSequence(o,a){this._iter=o,this._useKeys=a,this.size=o.size}return o&&(ToKeyedSequence.__proto__=o),ToKeyedSequence.prototype=Object.create(o&&o.prototype),ToKeyedSequence.prototype.constructor=ToKeyedSequence,ToKeyedSequence.prototype.get=function(o,a){return this._iter.get(o,a)},ToKeyedSequence.prototype.has=function(o){return this._iter.has(o)},ToKeyedSequence.prototype.valueSeq=function(){return this._iter.valueSeq()},ToKeyedSequence.prototype.reverse=function(){var o=this,a=reverseFactory(this,!0);return this._useKeys||(a.valueSeq=function(){return o._iter.toSeq().reverse()}),a},ToKeyedSequence.prototype.map=function(o,a){var s=this,c=mapFactory(this,o,a);return this._useKeys||(c.valueSeq=function(){return s._iter.toSeq().map(o,a)}),c},ToKeyedSequence.prototype.__iterate=function(o,a){var s=this;return this._iter.__iterate(function(a,c){return o(a,c,s)},a)},ToKeyedSequence.prototype.__iterator=function(o,a){return this._iter.__iterator(o,a)},ToKeyedSequence}(ei);ek.prototype[Z]=!0;var eA=function(o){function ToIndexedSequence(o){this._iter=o,this.size=o.size}return o&&(ToIndexedSequence.__proto__=o),ToIndexedSequence.prototype=Object.create(o&&o.prototype),ToIndexedSequence.prototype.constructor=ToIndexedSequence,ToIndexedSequence.prototype.includes=function(o){return this._iter.includes(o)},ToIndexedSequence.prototype.__iterate=function(o,a){var s=this,c=0;return a&&ensureSize(this),this._iter.__iterate(function(g){return o(g,a?s.size-++c:c++,s)},a)},ToIndexedSequence.prototype.__iterator=function(o,a){var s=this,c=this._iter.__iterator(1,a),g=0;return a&&ensureSize(this),new Iterator(function(){var k=c.next();return k.done?k:iteratorValue(o,a?s.size-++g:g++,k.value,k)})},ToIndexedSequence}(eo),eS=function(o){function ToSetSequence(o){this._iter=o,this.size=o.size}return o&&(ToSetSequence.__proto__=o),ToSetSequence.prototype=Object.create(o&&o.prototype),ToSetSequence.prototype.constructor=ToSetSequence,ToSetSequence.prototype.has=function(o){return this._iter.includes(o)},ToSetSequence.prototype.__iterate=function(o,a){var s=this;return this._iter.__iterate(function(a){return o(a,a,s)},a)},ToSetSequence.prototype.__iterator=function(o,a){var s=this._iter.__iterator(1,a);return new Iterator(function(){var a=s.next();return a.done?a:iteratorValue(o,a.value,a.value,a)})},ToSetSequence}(ea),ex=function(o){function FromEntriesSequence(o){this._iter=o,this.size=o.size}return o&&(FromEntriesSequence.__proto__=o),FromEntriesSequence.prototype=Object.create(o&&o.prototype),FromEntriesSequence.prototype.constructor=FromEntriesSequence,FromEntriesSequence.prototype.entrySeq=function(){return this._iter.toSeq()},FromEntriesSequence.prototype.__iterate=function(o,a){var s=this;return this._iter.__iterate(function(a){if(a){validateEntry(a);var c=isCollection(a);return o(c?a.get(1):a[1],c?a.get(0):a[0],s)}},a)},FromEntriesSequence.prototype.__iterator=function(o,a){var s=this._iter.__iterator(1,a);return new Iterator(function(){for(;;){var a=s.next();if(a.done)return a;var c=a.value;if(c){validateEntry(c);var g=isCollection(c);return iteratorValue(o,g?c.get(0):c[0],g?c.get(1):c[1],a)}}})},FromEntriesSequence}(ei);function flipFactory(o){var a=makeSequence(o);return a._iter=o,a.size=o.size,a.flip=function(){return o},a.reverse=function(){var a=o.reverse.apply(this);return a.flip=function(){return o.reverse()},a},a.has=function(a){return o.includes(a)},a.includes=function(a){return o.has(a)},a.cacheResult=cacheResultThrough,a.__iterateUncached=function(a,s){var c=this;return o.__iterate(function(o,s){return!1!==a(s,o,c)},s)},a.__iteratorUncached=function(a,s){if(2===a){var c=o.__iterator(a,s);return new Iterator(function(){var o=c.next();if(!o.done){var a=o.value[0];o.value[0]=o.value[1],o.value[1]=a}return o})}return o.__iterator(1===a?0:1,s)},a}function mapFactory(o,a,s){var c=makeSequence(o);return c.size=o.size,c.has=function(a){return o.has(a)},c.get=function(c,g){var k=o.get(c,B);return k===B?g:a.call(s,k,c,o)},c.__iterateUncached=function(c,g){var k=this;return o.__iterate(function(o,g,A){return!1!==c(a.call(s,o,g,A),g,k)},g)},c.__iteratorUncached=function(c,g){var k=o.__iterator(2,g);return new Iterator(function(){var g=k.next();if(g.done)return g;var A=g.value,x=A[0];return iteratorValue(c,x,a.call(s,A[1],x,o),g)})},c}function reverseFactory(o,a){var s=this,c=makeSequence(o);return c._iter=o,c.size=o.size,c.reverse=function(){return o},o.flip&&(c.flip=function(){var a=flipFactory(o);return a.reverse=function(){return o.flip()},a}),c.get=function(s,c){return o.get(a?s:-1-s,c)},c.has=function(s){return o.has(a?s:-1-s)},c.includes=function(a){return o.includes(a)},c.cacheResult=cacheResultThrough,c.__iterate=function(s,c){var g=this,k=0;return c&&ensureSize(o),o.__iterate(function(o,A){return s(o,a?A:c?g.size-++k:k++,g)},!c)},c.__iterator=function(c,g){var k=0;g&&ensureSize(o);var A=o.__iterator(2,!g);return new Iterator(function(){var o=A.next();if(o.done)return o;var x=o.value;return iteratorValue(c,a?x[0]:g?s.size-++k:k++,x[1],o)})},c}function filterFactory(o,a,s,c){var g=makeSequence(o);return c&&(g.has=function(c){var g=o.get(c,B);return g!==B&&!!a.call(s,g,c,o)},g.get=function(c,g){var k=o.get(c,B);return k!==B&&a.call(s,k,c,o)?k:g}),g.__iterateUncached=function(g,k){var A=this,x=0;return o.__iterate(function(o,k,P){if(a.call(s,o,k,P))return x++,g(o,c?k:x-1,A)},k),x},g.__iteratorUncached=function(g,k){var A=o.__iterator(2,k),x=0;return new Iterator(function(){for(;;){var k=A.next();if(k.done)return k;var P=k.value,w=P[0],F=P[1];if(a.call(s,F,w,o))return iteratorValue(g,c?w:x++,F,k)}})},g}function sliceFactory(o,a,s,c){var g,k=o.size;if(wholeSlice(a,s,k))return o;var A=resolveIndex(a,k,0),x=resolveIndex(s,k,k);if(A!=A||x!=x)return sliceFactory(o.toSeq().cacheResult(),a,s,c);var P=x-A;P==P&&(g=P<0?0:P);var w=makeSequence(o);return w.size=0===g?g:o.size&&g||void 0,!c&&isSeq(o)&&g>=0&&(w.get=function(a,s){return(a=wrapIndex(this,a))>=0&&a<g?o.get(a+A,s):s}),w.__iterateUncached=function(a,s){var k=this;if(0===g)return 0;if(s)return this.cacheResult().__iterate(a,s);var x=0,P=!0,w=0;return o.__iterate(function(o,s){if(!(P&&(P=x++<A)))return w++,!1!==a(o,c?s:w-1,k)&&w!==g}),w},w.__iteratorUncached=function(a,s){if(0!==g&&s)return this.cacheResult().__iterator(a,s);if(0===g)return new Iterator(iteratorDone);var k=o.__iterator(a,s),x=0,P=0;return new Iterator(function(){for(;x++<A;)k.next();if(++P>g)return iteratorDone();var o=k.next();return c||1===a||o.done?o:0===a?iteratorValue(a,P-1,void 0,o):iteratorValue(a,P-1,o.value[1],o)})},w}function skipWhileFactory(o,a,s,c){var g=makeSequence(o);return g.__iterateUncached=function(g,k){var A=this;if(k)return this.cacheResult().__iterate(g,k);var x=!0,P=0;return o.__iterate(function(o,k,w){if(!(x&&(x=a.call(s,o,k,w))))return P++,g(o,c?k:P-1,A)}),P},g.__iteratorUncached=function(g,k){var A=this;if(k)return this.cacheResult().__iterator(g,k);var x=o.__iterator(2,k),P=!0,w=0;return new Iterator(function(){do{if((o=x.next()).done){if(c||1===g)return o;if(0===g)return iteratorValue(g,w++,void 0,o);return iteratorValue(g,w++,o.value[1],o)}var o,k,F,R=o.value;k=R[0],F=R[1],P&&(P=a.call(s,F,k,A))}while(P);return 2===g?o:iteratorValue(g,k,F,o)})},g}function flattenFactory(o,a,s){var c=makeSequence(o);return c.__iterateUncached=function(g,k){if(k)return this.cacheResult().__iterate(g,k);var A=0,x=!1;return function flatDeep(o,P){o.__iterate(function(o,k){return(!a||P<a)&&isCollection(o)?flatDeep(o,P+1):(A++,!1===g(o,s?k:A-1,c)&&(x=!0)),!x},k)}(o,0),A},c.__iteratorUncached=function(c,g){if(g)return this.cacheResult().__iterator(c,g);var k=o.__iterator(c,g),A=[],x=0;return new Iterator(function(){for(;k;){var o=k.next();if(!1!==o.done){k=A.pop();continue}var P=o.value;if(2===c&&(P=P[1]),!((!a||A.length<a)&&isCollection(P)))return s?o:iteratorValue(c,x++,P,o);A.push(k),k=P.__iterator(c,g)}return iteratorDone()})},c}function sortFactory(o,a,s){a||(a=defaultComparator);var c=isKeyed(o),g=0,k=o.toSeq().map(function(a,c){return[c,a,g++,s?s(a,c,o):a]}).valueSeq().toArray();return k.sort(function(o,s){return a(o[3],s[3])||o[2]-s[2]}).forEach(c?function(o,a){k[a].length=2}:function(o,a){k[a]=o[1]}),c?ei(k):isIndexed(o)?eo(k):ea(k)}function maxFactory(o,a,s){if(a||(a=defaultComparator),s){var c=o.toSeq().map(function(a,c){return[a,s(a,c,o)]}).reduce(function(o,s){return maxCompare(a,o[1],s[1])?s:o});return c&&c[0]}return o.reduce(function(o,s){return maxCompare(a,o,s)?s:o})}function maxCompare(o,a,s){var c=o(s,a);return 0===c&&s!==a&&(null==s||s!=s)||c>0}function zipWithFactory(o,a,s,c){var g=makeSequence(o),k=new es(s).map(function(o){return o.size});return g.size=c?k.max():k.min(),g.__iterate=function(o,a){for(var s,c=this.__iterator(1,a),g=0;!(s=c.next()).done&&!1!==o(s.value,g++,this););return g},g.__iteratorUncached=function(o,g){var k=s.map(function(o){return o=Collection(o),getIterator(g?o.reverse():o)}),A=0,x=!1;return new Iterator(function(){var s;return(x||(s=k.map(function(o){return o.next()}),x=c?s.every(function(o){return o.done}):s.some(function(o){return o.done})),x)?iteratorDone():iteratorValue(o,A++,a.apply(null,s.map(function(o){return o.value})))})},g}function reify(o,a){return o===a?o:isSeq(o)?a:o.constructor(a)}function validateEntry(o){if(o!==Object(o))throw TypeError("Expected [K, V] tuple: "+o)}function collectionClass(o){return isKeyed(o)?U:isIndexed(o)?K:Y}function makeSequence(o){return Object.create((isKeyed(o)?ei:isIndexed(o)?eo:ea).prototype)}function cacheResultThrough(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):en.prototype.cacheResult.call(this)}function defaultComparator(o,a){return void 0===o&&void 0===a?0:void 0===o?1:void 0===a?-1:o>a?1:o<a?-1:0}function arrCopy(o,a){a=a||0;for(var s=Math.max(0,o.length-a),c=Array(s),g=0;g<s;g++)c[g]=o[g+a];return c}function invariant(o,a){if(!o)throw Error(a)}function assertNotInfinite(o){invariant(o!==1/0,"Cannot perform this action with an infinite size.")}function coerceKeyPath(o){if(isArrayLike(o)&&"string"!=typeof o)return o;if(isOrdered(o))return o.toArray();throw TypeError("Invalid keyPath: expected Ordered Collection or Array: "+o)}function isPlainObj(o){return o&&("function"!=typeof o.constructor||"Object"===o.constructor.name)}function isDataStructure(o){return"object"==typeof o&&(isImmutable(o)||Array.isArray(o)||isPlainObj(o))}function quoteString(o){try{return"string"==typeof o?JSON.stringify(o):String(o)}catch(a){return JSON.stringify(o)}}function has(o,a){return isImmutable(o)?o.has(a):isDataStructure(o)&&er.call(o,a)}function get(o,a,s){return isImmutable(o)?o.get(a,s):has(o,a)?"function"==typeof o.get?o.get(a):o[a]:s}function shallowCopy(o){if(Array.isArray(o))return arrCopy(o);var a={};for(var s in o)er.call(o,s)&&(a[s]=o[s]);return a}function remove(o,a){if(!isDataStructure(o))throw TypeError("Cannot update non-data-structure value: "+o);if(isImmutable(o)){if(!o.remove)throw TypeError("Cannot update immutable value without .remove() method: "+o);return o.remove(a)}if(!er.call(o,a))return o;var s=shallowCopy(o);return Array.isArray(s)?s.splice(a,1):delete s[a],s}function set(o,a,s){if(!isDataStructure(o))throw TypeError("Cannot update non-data-structure value: "+o);if(isImmutable(o)){if(!o.set)throw TypeError("Cannot update immutable value without .set() method: "+o);return o.set(a,s)}if(er.call(o,a)&&s===o[a])return o;var c=shallowCopy(o);return c[a]=s,c}function updateIn(o,a,s,c){c||(c=s,s=void 0);var g=function updateInDeeply(o,a,s,c,g,k){var A=a===B;if(c===s.length){var x=A?g:a,P=k(x);return P===x?a:P}if(!A&&!isDataStructure(a))throw TypeError("Cannot update within non-data-structure value in path ["+s.slice(0,c).map(quoteString)+"]: "+a);var w=s[c],F=A?B:get(a,w,B),R=updateInDeeply(F===B?o:isImmutable(F),F,s,c+1,g,k);return R===F?a:R===B?remove(a,w):set(A?o?emptyMap():{}:a,w,R)}(isImmutable(o),o,coerceKeyPath(a),0,s,c);return g===B?s:g}function setIn(o,a,s){return updateIn(o,a,B,function(){return s})}function setIn$1(o,a){return setIn(this,o,a)}function removeIn(o,a){return updateIn(o,a,function(){return B})}function deleteIn(o){return removeIn(this,o)}function update(o,a,s,c){return updateIn(o,[a],s,c)}function update$1(o,a,s){return 1==arguments.length?o(this):update(this,o,a,s)}function updateIn$1(o,a,s){return updateIn(this,o,a,s)}function merge(){for(var o=[],a=arguments.length;a--;)o[a]=arguments[a];return mergeIntoKeyedWith(this,o)}function mergeWith(o){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];if("function"!=typeof o)throw TypeError("Invalid merger function: "+o);return mergeIntoKeyedWith(this,a,o)}function mergeIntoKeyedWith(o,a,s){for(var c=[],g=0;g<a.length;g++){var k=U(a[g]);0!==k.size&&c.push(k)}return 0===c.length?o:0!==o.toSeq().size||o.__ownerID||1!==c.length?o.withMutations(function(o){for(var a=s?function(a,c){update(o,c,B,function(o){return o===B?a:s(o,a,c)})}:function(a,s){o.set(s,a)},g=0;g<c.length;g++)c[g].forEach(a)}):o.constructor(c[0])}function merge$1(o){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];return mergeWithSources(o,a)}function mergeWith$1(o,a){for(var s=[],c=arguments.length-2;c-- >0;)s[c]=arguments[c+2];return mergeWithSources(a,s,o)}function mergeDeep(o){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];return mergeDeepWithSources(o,a)}function mergeDeepWith(o,a){for(var s=[],c=arguments.length-2;c-- >0;)s[c]=arguments[c+2];return mergeDeepWithSources(a,s,o)}function mergeDeepWithSources(o,a,s){return mergeWithSources(o,a,function deepMerger(o,a,c){return isDataStructure(o)&&isDataStructure(a)?mergeWithSources(o,[a],deepMerger):s?s(o,a,c):a})}function mergeWithSources(o,a,s){if(!isDataStructure(o))throw TypeError("Cannot merge into non-data-structure value: "+o);if(isImmutable(o))return"function"==typeof s&&o.mergeWith?o.mergeWith.apply(o,[s].concat(a)):o.merge?o.merge.apply(o,a):o.concat.apply(o,a);for(var c=Array.isArray(o),g=o,k=c?K:U,A=c?function(a){g===o&&(g=shallowCopy(g)),g.push(a)}:function(a,c){var k=er.call(g,c),A=k&&s?s(g[c],a,c):a;k&&A===g[c]||(g===o&&(g=shallowCopy(g)),g[c]=A)},x=0;x<a.length;x++)k(a[x]).forEach(A);return g}function mergeDeep$1(){for(var o=[],a=arguments.length;a--;)o[a]=arguments[a];return mergeDeepWithSources(this,o)}function mergeDeepWith$1(o){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];return mergeDeepWithSources(this,a,o)}function mergeIn(o){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];return updateIn(this,o,emptyMap(),function(o){return mergeWithSources(o,a)})}function mergeDeepIn(o){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];return updateIn(this,o,emptyMap(),function(o){return mergeDeepWithSources(o,a)})}function withMutations(o){var a=this.asMutable();return o(a),a.wasAltered()?a.__ensureOwner(this.__ownerID):this}function asMutable(){return this.__ownerID?this:this.__ensureOwner(new OwnerID)}function asImmutable(){return this.__ensureOwner()}function wasAltered(){return this.__altered}eA.prototype.cacheResult=ek.prototype.cacheResult=eS.prototype.cacheResult=ex.prototype.cacheResult=cacheResultThrough;var eM=function(o){function Map(a){return null==a?emptyMap():isMap(a)&&!isOrdered(a)?a:emptyMap().withMutations(function(s){var c=o(a);assertNotInfinite(c.size),c.forEach(function(o,a){return s.set(a,o)})})}return o&&(Map.__proto__=o),Map.prototype=Object.create(o&&o.prototype),Map.prototype.constructor=Map,Map.of=function(){for(var o=[],a=arguments.length;a--;)o[a]=arguments[a];return emptyMap().withMutations(function(a){for(var s=0;s<o.length;s+=2){if(s+1>=o.length)throw Error("Missing value for key: "+o[s]);a.set(o[s],o[s+1])}})},Map.prototype.toString=function(){return this.__toString("Map {","}")},Map.prototype.get=function(o,a){return this._root?this._root.get(0,void 0,o,a):a},Map.prototype.set=function(o,a){return updateMap(this,o,a)},Map.prototype.remove=function(o){return updateMap(this,o,B)},Map.prototype.deleteAll=function(o){var a=Collection(o);return 0===a.size?this:this.withMutations(function(o){a.forEach(function(a){return o.remove(a)})})},Map.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):emptyMap()},Map.prototype.sort=function(o){return eD(sortFactory(this,o))},Map.prototype.sortBy=function(o,a){return eD(sortFactory(this,a,o))},Map.prototype.map=function(o,a){return this.withMutations(function(s){s.forEach(function(c,g){s.set(g,o.call(a,c,g,s))})})},Map.prototype.__iterator=function(o,a){return new eP(this,o,a)},Map.prototype.__iterate=function(o,a){var s=this,c=0;return this._root&&this._root.iterate(function(a){return c++,o(a[1],a[0],s)},a),c},Map.prototype.__ensureOwner=function(o){return o===this.__ownerID?this:o?makeMap(this.size,this._root,o,this.__hash):0===this.size?emptyMap():(this.__ownerID=o,this.__altered=!1,this)},Map}(U);eM.isMap=isMap;var eC=eM.prototype;eC[ed]=!0,eC[G]=eC.remove,eC.removeAll=eC.deleteAll,eC.setIn=setIn$1,eC.removeIn=eC.deleteIn=deleteIn,eC.update=update$1,eC.updateIn=updateIn$1,eC.merge=eC.concat=merge,eC.mergeWith=mergeWith,eC.mergeDeep=mergeDeep$1,eC.mergeDeepWith=mergeDeepWith$1,eC.mergeIn=mergeIn,eC.mergeDeepIn=mergeDeepIn,eC.withMutations=withMutations,eC.wasAltered=wasAltered,eC.asImmutable=asImmutable,eC["@@transducer/init"]=eC.asMutable=asMutable,eC["@@transducer/step"]=function(o,a){return o.set(a[0],a[1])},eC["@@transducer/result"]=function(o){return o.asImmutable()};var ArrayMapNode=function(o,a){this.ownerID=o,this.entries=a};ArrayMapNode.prototype.get=function(o,a,s,c){for(var g=this.entries,k=0,A=g.length;k<A;k++)if(is(s,g[k][0]))return g[k][1];return c},ArrayMapNode.prototype.update=function(o,a,s,c,g,k,A){for(var x=g===B,P=this.entries,w=0,F=P.length;w<F&&!is(c,P[w][0]);w++);var R=w<F;if(R?P[w][1]===g:x)return this;if(SetRef(A),(x||!R)&&SetRef(k),!x||1!==P.length){if(!R&&!x&&P.length>=eL)return function(o,a,s,c){o||(o=new OwnerID);for(var g=new ValueNode(o,hash(s),[s,c]),k=0;k<a.length;k++){var A=a[k];g=g.update(o,0,void 0,A[0],A[1])}return g}(o,P,c,g);var D=o&&o===this.ownerID,G=D?P:arrCopy(P);return(R?x?w===F-1?G.pop():G[w]=G.pop():G[w]=[c,g]:G.push([c,g]),D)?(this.entries=G,this):new ArrayMapNode(o,G)}};var BitmapIndexedNode=function(o,a,s){this.ownerID=o,this.bitmap=a,this.nodes=s};BitmapIndexedNode.prototype.get=function(o,a,s,c){void 0===a&&(a=hash(s));var g=1<<((0===o?a:a>>>o)&31),k=this.bitmap;return(k&g)==0?c:this.nodes[popCount(k&g-1)].get(o+5,a,s,c)},BitmapIndexedNode.prototype.update=function(o,a,s,c,g,k,A){void 0===s&&(s=hash(c));var x=(0===a?s:s>>>a)&31,P=1<<x,w=this.bitmap,F=(w&P)!=0;if(!F&&g===B)return this;var R=popCount(w&P-1),D=this.nodes,G=F?D[R]:void 0,W=updateNode(G,o,a+5,s,c,g,k,A);if(W===G)return this;if(!F&&W&&D.length>=eI)return function(o,a,s,c,g){for(var k=0,A=Array(32),x=0;0!==s;x++,s>>>=1)A[x]=1&s?a[k++]:void 0;return A[c]=g,new HashArrayMapNode(o,k+1,A)}(o,D,w,x,W);if(F&&!W&&2===D.length&&isLeafNode(D[1^R]))return D[1^R];if(F&&W&&1===D.length&&isLeafNode(W))return W;var z=o&&o===this.ownerID,V=F?W?w:w^P:w|P,U=F?W?setAt(D,R,W,z):function(o,a,s){var c=o.length-1;if(s&&a===c)return o.pop(),o;for(var g=Array(c),k=0,A=0;A<c;A++)A===a&&(k=1),g[A]=o[A+k];return g}(D,R,z):function(o,a,s,c){var g=o.length+1;if(c&&a+1===g)return o[a]=s,o;for(var k=Array(g),A=0,x=0;x<g;x++)x===a?(k[x]=s,A=-1):k[x]=o[x+A];return k}(D,R,W,z);return z?(this.bitmap=V,this.nodes=U,this):new BitmapIndexedNode(o,V,U)};var HashArrayMapNode=function(o,a,s){this.ownerID=o,this.count=a,this.nodes=s};HashArrayMapNode.prototype.get=function(o,a,s,c){void 0===a&&(a=hash(s));var g=(0===o?a:a>>>o)&31,k=this.nodes[g];return k?k.get(o+5,a,s,c):c},HashArrayMapNode.prototype.update=function(o,a,s,c,g,k,A){void 0===s&&(s=hash(c));var x=(0===a?s:s>>>a)&31,P=g===B,w=this.nodes,F=w[x];if(P&&!F)return this;var R=updateNode(F,o,a+5,s,c,g,k,A);if(R===F)return this;var D=this.count;if(F){if(!R&&--D<eE)return function(o,a,s,c){for(var g=0,k=0,A=Array(s),x=0,P=1,w=a.length;x<w;x++,P<<=1){var F=a[x];void 0!==F&&x!==c&&(g|=P,A[k++]=F)}return new BitmapIndexedNode(o,g,A)}(o,w,D,x)}else D++;var G=o&&o===this.ownerID,W=setAt(w,x,R,G);return G?(this.count=D,this.nodes=W,this):new HashArrayMapNode(o,D,W)};var HashCollisionNode=function(o,a,s){this.ownerID=o,this.keyHash=a,this.entries=s};HashCollisionNode.prototype.get=function(o,a,s,c){for(var g=this.entries,k=0,A=g.length;k<A;k++)if(is(s,g[k][0]))return g[k][1];return c},HashCollisionNode.prototype.update=function(o,a,s,c,g,k,A){void 0===s&&(s=hash(c));var x=g===B;if(s!==this.keyHash)return x?this:(SetRef(A),SetRef(k),mergeIntoNode(this,o,a,s,[c,g]));for(var P=this.entries,w=0,F=P.length;w<F&&!is(c,P[w][0]);w++);var R=w<F;if(R?P[w][1]===g:x)return this;if(SetRef(A),(x||!R)&&SetRef(k),x&&2===F)return new ValueNode(o,this.keyHash,P[1^w]);var D=o&&o===this.ownerID,G=D?P:arrCopy(P);return(R?x?w===F-1?G.pop():G[w]=G.pop():G[w]=[c,g]:G.push([c,g]),D)?(this.entries=G,this):new HashCollisionNode(o,this.keyHash,G)};var ValueNode=function(o,a,s){this.ownerID=o,this.keyHash=a,this.entry=s};ValueNode.prototype.get=function(o,a,s,c){return is(s,this.entry[0])?this.entry[1]:c},ValueNode.prototype.update=function(o,a,s,c,g,k,A){var x=g===B,P=is(c,this.entry[0]);if(P?g===this.entry[1]:x)return this;if(SetRef(A),x){SetRef(k);return}return P?o&&o===this.ownerID?(this.entry[1]=g,this):new ValueNode(o,this.keyHash,[c,g]):(SetRef(k),mergeIntoNode(this,o,a,hash(c),[c,g]))},ArrayMapNode.prototype.iterate=HashCollisionNode.prototype.iterate=function(o,a){for(var s=this.entries,c=0,g=s.length-1;c<=g;c++)if(!1===o(s[a?g-c:c]))return!1},BitmapIndexedNode.prototype.iterate=HashArrayMapNode.prototype.iterate=function(o,a){for(var s=this.nodes,c=0,g=s.length-1;c<=g;c++){var k=s[a?g-c:c];if(k&&!1===k.iterate(o,a))return!1}},ValueNode.prototype.iterate=function(o,a){return o(this.entry)};var eP=function(o){function MapIterator(o,a,s){this._type=a,this._reverse=s,this._stack=o._root&&mapIteratorFrame(o._root)}return o&&(MapIterator.__proto__=o),MapIterator.prototype=Object.create(o&&o.prototype),MapIterator.prototype.constructor=MapIterator,MapIterator.prototype.next=function(){for(var o=this._type,a=this._stack;a;){var s=a.node,c=a.index++,g=void 0;if(s.entry){if(0===c)return mapIteratorValue(o,s.entry)}else if(s.entries){if(c<=(g=s.entries.length-1))return mapIteratorValue(o,s.entries[this._reverse?g-c:c])}else if(c<=(g=s.nodes.length-1)){var k=s.nodes[this._reverse?g-c:c];if(k){if(k.entry)return mapIteratorValue(o,k.entry);a=this._stack=mapIteratorFrame(k,a)}continue}a=this._stack=this._stack.__prev}return iteratorDone()},MapIterator}(Iterator);function mapIteratorValue(o,a){return iteratorValue(o,a[0],a[1])}function mapIteratorFrame(o,a){return{node:o,index:0,__prev:a}}function makeMap(o,a,s,c){var g=Object.create(eC);return g.size=o,g._root=a,g.__ownerID=s,g.__hash=c,g.__altered=!1,g}function emptyMap(){return k||(k=makeMap(0))}function updateMap(o,a,s){if(o._root){var c,g,k=MakeRef(),A=MakeRef();if(c=updateNode(o._root,o.__ownerID,0,void 0,a,s,k,A),!A.value)return o;g=o.size+(k.value?s===B?-1:1:0)}else{if(s===B)return o;g=1,c=new ArrayMapNode(o.__ownerID,[[a,s]])}return o.__ownerID?(o.size=g,o._root=c,o.__hash=void 0,o.__altered=!0,o):c?makeMap(g,c):emptyMap()}function updateNode(o,a,s,c,g,k,A,x){return o?o.update(a,s,c,g,k,A,x):k===B?o:(SetRef(x),SetRef(A),new ValueNode(a,c,[g,k]))}function isLeafNode(o){return o.constructor===ValueNode||o.constructor===HashCollisionNode}function mergeIntoNode(o,a,s,c,g){if(o.keyHash===c)return new HashCollisionNode(a,c,[o.entry,g]);var k,A=(0===s?o.keyHash:o.keyHash>>>s)&31,x=(0===s?c:c>>>s)&31,P=A===x?[mergeIntoNode(o,a,s+5,c,g)]:(k=new ValueNode(a,c,g),A<x?[o,k]:[k,o]);return new BitmapIndexedNode(a,1<<A|1<<x,P)}function popCount(o){return o-=o>>1&1431655765,o=(o=(858993459&o)+(o>>2&858993459))+(o>>4)&252645135,o+=o>>8,127&(o+=o>>16)}function setAt(o,a,s,c){var g=c?o:arrCopy(o);return g[a]=s,g}var eL=8,eI=16,eE=8,ew="@@__IMMUTABLE_LIST__@@";function isList(o){return!!(o&&o[ew])}var eF=function(o){function List(a){var s=emptyList();if(null==a)return s;if(isList(a))return a;var c=o(a),g=c.size;return 0===g?s:(assertNotInfinite(g),g>0&&g<32)?makeList(0,g,5,null,new VNode(c.toArray())):s.withMutations(function(o){o.setSize(g),c.forEach(function(a,s){return o.set(s,a)})})}return o&&(List.__proto__=o),List.prototype=Object.create(o&&o.prototype),List.prototype.constructor=List,List.of=function(){return this(arguments)},List.prototype.toString=function(){return this.__toString("List [","]")},List.prototype.get=function(o,a){if((o=wrapIndex(this,o))>=0&&o<this.size){var s=listNodeFor(this,o+=this._origin);return s&&s.array[31&o]}return a},List.prototype.set=function(o,a){return function(o,a,s){if((a=wrapIndex(o,a))!=a)return o;if(a>=o.size||a<0)return o.withMutations(function(o){a<0?setListBounds(o,a).set(0,s):setListBounds(o,0,a+1).set(a,s)});a+=o._origin;var c=o._tail,g=o._root,k=MakeRef();return(a>=getTailOffset(o._capacity)?c=updateVNode(c,o.__ownerID,0,a,s,k):g=updateVNode(g,o.__ownerID,o._level,a,s,k),k.value)?o.__ownerID?(o._root=g,o._tail=c,o.__hash=void 0,o.__altered=!0,o):makeList(o._origin,o._capacity,o._level,g,c):o}(this,o,a)},List.prototype.remove=function(o){return this.has(o)?0===o?this.shift():o===this.size-1?this.pop():this.splice(o,1):this},List.prototype.insert=function(o,a){return this.splice(o,0,a)},List.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=5,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):emptyList()},List.prototype.push=function(){var o=arguments,a=this.size;return this.withMutations(function(s){setListBounds(s,0,a+o.length);for(var c=0;c<o.length;c++)s.set(a+c,o[c])})},List.prototype.pop=function(){return setListBounds(this,0,-1)},List.prototype.unshift=function(){var o=arguments;return this.withMutations(function(a){setListBounds(a,-o.length);for(var s=0;s<o.length;s++)a.set(s,o[s])})},List.prototype.shift=function(){return setListBounds(this,1)},List.prototype.concat=function(){for(var a=arguments,s=[],c=0;c<arguments.length;c++){var g=a[c],k=o("string"!=typeof g&&getIteratorFn(g)?g:[g]);0!==k.size&&s.push(k)}return 0===s.length?this:0!==this.size||this.__ownerID||1!==s.length?this.withMutations(function(o){s.forEach(function(a){return a.forEach(function(a){return o.push(a)})})}):this.constructor(s[0])},List.prototype.setSize=function(o){return setListBounds(this,0,o)},List.prototype.map=function(o,a){var s=this;return this.withMutations(function(c){for(var g=0;g<s.size;g++)c.set(g,o.call(a,c.get(g),g,c))})},List.prototype.slice=function(o,a){var s=this.size;return wholeSlice(o,a,s)?this:setListBounds(this,resolveIndex(o,s,0),resolveIndex(a,s,s))},List.prototype.__iterator=function(o,a){var s=a?this.size:0,c=iterateList(this,a);return new Iterator(function(){var g=c();return g===eO?iteratorDone():iteratorValue(o,a?--s:s++,g)})},List.prototype.__iterate=function(o,a){for(var s,c=a?this.size:0,g=iterateList(this,a);(s=g())!==eO&&!1!==o(s,a?--c:c++,this););return c},List.prototype.__ensureOwner=function(o){return o===this.__ownerID?this:o?makeList(this._origin,this._capacity,this._level,this._root,this._tail,o,this.__hash):0===this.size?emptyList():(this.__ownerID=o,this.__altered=!1,this)},List}(K);eF.isList=isList;var eR=eF.prototype;eR[ew]=!0,eR[G]=eR.remove,eR.merge=eR.concat,eR.setIn=setIn$1,eR.deleteIn=eR.removeIn=deleteIn,eR.update=update$1,eR.updateIn=updateIn$1,eR.mergeIn=mergeIn,eR.mergeDeepIn=mergeDeepIn,eR.withMutations=withMutations,eR.wasAltered=wasAltered,eR.asImmutable=asImmutable,eR["@@transducer/init"]=eR.asMutable=asMutable,eR["@@transducer/step"]=function(o,a){return o.push(a)},eR["@@transducer/result"]=function(o){return o.asImmutable()};var VNode=function(o,a){this.array=o,this.ownerID=a};VNode.prototype.removeBefore=function(o,a,s){if(s===a?1<<a:0===this.array.length)return this;var c,g=s>>>a&31;if(g>=this.array.length)return new VNode([],o);var k=0===g;if(a>0){var A=this.array[g];if((c=A&&A.removeBefore(o,a-5,s))===A&&k)return this}if(k&&!c)return this;var x=editableVNode(this,o);if(!k)for(var P=0;P<g;P++)x.array[P]=void 0;return c&&(x.array[g]=c),x},VNode.prototype.removeAfter=function(o,a,s){if(s===(a?1<<a:0)||0===this.array.length)return this;var c,g=s-1>>>a&31;if(g>=this.array.length)return this;if(a>0){var k=this.array[g];if((c=k&&k.removeAfter(o,a-5,s))===k&&g===this.array.length-1)return this}var A=editableVNode(this,o);return A.array.splice(g+1),c&&(A.array[g]=c),A};var eO={};function iterateList(o,a){var s=o._origin,c=o._capacity,g=getTailOffset(c),k=o._tail;return function iterateNodeOrLeaf(o,A,x){var P,w,F,R,D,G,B;return 0===A?(P=x===g?k&&k.array:o&&o.array,w=x>s?0:s-x,(F=c-x)>32&&(F=32),function(){if(w===F)return eO;var o=a?--F:w++;return P&&P[o]}):(D=o&&o.array,G=x>s?0:s-x>>A,(B=(c-x>>A)+1)>32&&(B=32),function(){for(;;){if(R){var o=R();if(o!==eO)return o;R=null}if(G===B)return eO;var s=a?--B:G++;R=iterateNodeOrLeaf(D&&D[s],A-5,x+(s<<A))}})}(o._root,o._level,0)}function makeList(o,a,s,c,g,k,A){var x=Object.create(eR);return x.size=a-o,x._origin=o,x._capacity=a,x._level=s,x._root=c,x._tail=g,x.__ownerID=k,x.__hash=A,x.__altered=!1,x}function emptyList(){return A||(A=makeList(0,0,5))}function updateVNode(o,a,s,c,g,k){var A,x=c>>>s&31,P=o&&x<o.array.length;if(!P&&void 0===g)return o;if(s>0){var w=o&&o.array[x],F=updateVNode(w,a,s-5,c,g,k);return F===w?o:((A=editableVNode(o,a)).array[x]=F,A)}return P&&o.array[x]===g?o:(k&&SetRef(k),A=editableVNode(o,a),void 0===g&&x===A.array.length-1?A.array.pop():A.array[x]=g,A)}function editableVNode(o,a){return a&&o&&a===o.ownerID?o:new VNode(o?o.array.slice():[],a)}function listNodeFor(o,a){if(a>=getTailOffset(o._capacity))return o._tail;if(a<1<<o._level+5){for(var s=o._root,c=o._level;s&&c>0;)s=s.array[a>>>c&31],c-=5;return s}}function setListBounds(o,a,s){void 0!==a&&(a|=0),void 0!==s&&(s|=0);var c=o.__ownerID||new OwnerID,g=o._origin,k=o._capacity,A=g+a,x=void 0===s?k:s<0?k+s:g+s;if(A===g&&x===k)return o;if(A>=x)return o.clear();for(var P=o._level,w=o._root,F=0;A+F<0;)w=new VNode(w&&w.array.length?[void 0,w]:[],c),P+=5,F+=1<<P;F&&(A+=F,g+=F,x+=F,k+=F);for(var R=getTailOffset(k),D=getTailOffset(x);D>=1<<P+5;)w=new VNode(w&&w.array.length?[w]:[],c),P+=5;var G=o._tail,B=D<R?listNodeFor(o,x-1):D>R?new VNode([],c):G;if(G&&D>R&&A<k&&G.array.length){for(var W=w=editableVNode(w,c),z=P;z>5;z-=5){var V=R>>>z&31;W=W.array[V]=editableVNode(W.array[V],c)}W.array[R>>>5&31]=G}if(x<k&&(B=B&&B.removeAfter(c,0,x)),A>=D)A-=D,x-=D,P=5,w=null,B=B&&B.removeBefore(c,0,A);else if(A>g||D<R){for(F=0;w;){var U=A>>>P&31;if(U!==D>>>P&31)break;U&&(F+=(1<<P)*U),P-=5,w=w.array[U]}w&&A>g&&(w=w.removeBefore(c,P,A-F)),w&&D<R&&(w=w.removeAfter(c,P,D-F)),F&&(A-=F,x-=F)}return o.__ownerID?(o.size=x-A,o._origin=A,o._capacity=x,o._level=P,o._root=w,o._tail=B,o.__hash=void 0,o.__altered=!0,o):makeList(A,x,P,w,B)}function getTailOffset(o){return o<32?0:o-1>>>5<<5}var eD=function(o){function OrderedMap(o){return null==o?emptyOrderedMap():isOrderedMap(o)?o:emptyOrderedMap().withMutations(function(a){var s=U(o);assertNotInfinite(s.size),s.forEach(function(o,s){return a.set(s,o)})})}return o&&(OrderedMap.__proto__=o),OrderedMap.prototype=Object.create(o&&o.prototype),OrderedMap.prototype.constructor=OrderedMap,OrderedMap.of=function(){return this(arguments)},OrderedMap.prototype.toString=function(){return this.__toString("OrderedMap {","}")},OrderedMap.prototype.get=function(o,a){var s=this._map.get(o);return void 0!==s?this._list.get(s)[1]:a},OrderedMap.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):emptyOrderedMap()},OrderedMap.prototype.set=function(o,a){return updateOrderedMap(this,o,a)},OrderedMap.prototype.remove=function(o){return updateOrderedMap(this,o,B)},OrderedMap.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},OrderedMap.prototype.__iterate=function(o,a){var s=this;return this._list.__iterate(function(a){return a&&o(a[1],a[0],s)},a)},OrderedMap.prototype.__iterator=function(o,a){return this._list.fromEntrySeq().__iterator(o,a)},OrderedMap.prototype.__ensureOwner=function(o){if(o===this.__ownerID)return this;var a=this._map.__ensureOwner(o),s=this._list.__ensureOwner(o);return o?makeOrderedMap(a,s,o,this.__hash):0===this.size?emptyOrderedMap():(this.__ownerID=o,this._map=a,this._list=s,this)},OrderedMap}(eM);function makeOrderedMap(o,a,s,c){var g=Object.create(eD.prototype);return g.size=o?o.size:0,g._map=o,g._list=a,g.__ownerID=s,g.__hash=c,g}function emptyOrderedMap(){return x||(x=makeOrderedMap(emptyMap(),emptyList()))}function updateOrderedMap(o,a,s){var c,g,k=o._map,A=o._list,x=k.get(a),P=void 0!==x;if(s===B){if(!P)return o;A.size>=32&&A.size>=2*k.size?(c=(g=A.filter(function(o,a){return void 0!==o&&x!==a})).toKeyedSeq().map(function(o){return o[0]}).flip().toMap(),o.__ownerID&&(c.__ownerID=g.__ownerID=o.__ownerID)):(c=k.remove(a),g=x===A.size-1?A.pop():A.set(x,void 0))}else if(P){if(s===A.get(x)[1])return o;c=k,g=A.set(x,[a,s])}else c=k.set(a,A.size),g=A.set(A.size,[a,s]);return o.__ownerID?(o.size=c.size,o._map=c,o._list=g,o.__hash=void 0,o):makeOrderedMap(c,g)}eD.isOrderedMap=isOrderedMap,eD.prototype[Z]=!0,eD.prototype[G]=eD.prototype.remove;var eN="@@__IMMUTABLE_STACK__@@";function isStack(o){return!!(o&&o[eN])}var eG=function(o){function Stack(o){return null==o?emptyStack():isStack(o)?o:emptyStack().pushAll(o)}return o&&(Stack.__proto__=o),Stack.prototype=Object.create(o&&o.prototype),Stack.prototype.constructor=Stack,Stack.of=function(){return this(arguments)},Stack.prototype.toString=function(){return this.__toString("Stack [","]")},Stack.prototype.get=function(o,a){var s=this._head;for(o=wrapIndex(this,o);s&&o--;)s=s.next;return s?s.value:a},Stack.prototype.peek=function(){return this._head&&this._head.value},Stack.prototype.push=function(){var o=arguments;if(0==arguments.length)return this;for(var a=this.size+arguments.length,s=this._head,c=arguments.length-1;c>=0;c--)s={value:o[c],next:s};return this.__ownerID?(this.size=a,this._head=s,this.__hash=void 0,this.__altered=!0,this):makeStack(a,s)},Stack.prototype.pushAll=function(a){if(0===(a=o(a)).size)return this;if(0===this.size&&isStack(a))return a;assertNotInfinite(a.size);var s=this.size,c=this._head;return(a.__iterate(function(o){s++,c={value:o,next:c}},!0),this.__ownerID)?(this.size=s,this._head=c,this.__hash=void 0,this.__altered=!0,this):makeStack(s,c)},Stack.prototype.pop=function(){return this.slice(1)},Stack.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):emptyStack()},Stack.prototype.slice=function(a,s){if(wholeSlice(a,s,this.size))return this;var c,g=resolveIndex(a,this.size,0);if(resolveIndex(s,c=this.size,c)!==this.size)return o.prototype.slice.call(this,a,s);for(var k=this.size-g,A=this._head;g--;)A=A.next;return this.__ownerID?(this.size=k,this._head=A,this.__hash=void 0,this.__altered=!0,this):makeStack(k,A)},Stack.prototype.__ensureOwner=function(o){return o===this.__ownerID?this:o?makeStack(this.size,this._head,o,this.__hash):0===this.size?emptyStack():(this.__ownerID=o,this.__altered=!1,this)},Stack.prototype.__iterate=function(o,a){var s=this;if(a)return new es(this.toArray()).__iterate(function(a,c){return o(a,c,s)},a);for(var c=0,g=this._head;g&&!1!==o(g.value,c++,this);)g=g.next;return c},Stack.prototype.__iterator=function(o,a){if(a)return new es(this.toArray()).__iterator(o,a);var s=0,c=this._head;return new Iterator(function(){if(c){var a=c.value;return c=c.next,iteratorValue(o,s++,a)}return iteratorDone()})},Stack}(K);eG.isStack=isStack;var eB=eG.prototype;function makeStack(o,a,s,c){var g=Object.create(eB);return g.size=o,g._head=a,g.__ownerID=s,g.__hash=c,g.__altered=!1,g}function emptyStack(){return P||(P=makeStack(0))}eB[eN]=!0,eB.shift=eB.pop,eB.unshift=eB.push,eB.unshiftAll=eB.pushAll,eB.withMutations=withMutations,eB.wasAltered=wasAltered,eB.asImmutable=asImmutable,eB["@@transducer/init"]=eB.asMutable=asMutable,eB["@@transducer/step"]=function(o,a){return o.unshift(a)},eB["@@transducer/result"]=function(o){return o.asImmutable()};var eW="@@__IMMUTABLE_SET__@@";function isSet(o){return!!(o&&o[eW])}function isOrderedSet(o){return isSet(o)&&isOrdered(o)}function deepEqual(o,a){if(o===a)return!0;if(!isCollection(a)||void 0!==o.size&&void 0!==a.size&&o.size!==a.size||void 0!==o.__hash&&void 0!==a.__hash&&o.__hash!==a.__hash||isKeyed(o)!==isKeyed(a)||isIndexed(o)!==isIndexed(a)||isOrdered(o)!==isOrdered(a))return!1;if(0===o.size&&0===a.size)return!0;var s=!isAssociative(o);if(isOrdered(o)){var c=o.entries();return a.every(function(o,a){var g=c.next().value;return g&&is(g[1],o)&&(s||is(g[0],a))})&&c.next().done}var g=!1;if(void 0===o.size){if(void 0===a.size)"function"==typeof o.cacheResult&&o.cacheResult();else{g=!0;var k=o;o=a,a=k}}var A=!0,x=a.__iterate(function(a,c){if(s?!o.has(a):g?!is(a,o.get(c,B)):!is(o.get(c,B),a))return A=!1,!1});return A&&o.size===x}function mixin(o,a){var keyCopier=function(s){o.prototype[s]=a[s]};return Object.keys(a).forEach(keyCopier),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(a).forEach(keyCopier),o}function toJS(o){if(!o||"object"!=typeof o)return o;if(!isCollection(o)){if(!isDataStructure(o))return o;o=en(o)}if(isKeyed(o)){var a={};return o.__iterate(function(o,s){a[s]=toJS(o)}),a}var s=[];return o.__iterate(function(o){s.push(toJS(o))}),s}var ej=function(o){function Set(a){return null==a?emptySet():isSet(a)&&!isOrdered(a)?a:emptySet().withMutations(function(s){var c=o(a);assertNotInfinite(c.size),c.forEach(function(o){return s.add(o)})})}return o&&(Set.__proto__=o),Set.prototype=Object.create(o&&o.prototype),Set.prototype.constructor=Set,Set.of=function(){return this(arguments)},Set.fromKeys=function(o){return this(U(o).keySeq())},Set.intersect=function(o){return(o=Collection(o).toArray()).length?ez.intersect.apply(Set(o.pop()),o):emptySet()},Set.union=function(o){return(o=Collection(o).toArray()).length?ez.union.apply(Set(o.pop()),o):emptySet()},Set.prototype.toString=function(){return this.__toString("Set {","}")},Set.prototype.has=function(o){return this._map.has(o)},Set.prototype.add=function(o){return updateSet(this,this._map.set(o,o))},Set.prototype.remove=function(o){return updateSet(this,this._map.remove(o))},Set.prototype.clear=function(){return updateSet(this,this._map.clear())},Set.prototype.map=function(o,a){var s=this,c=[],g=[];return this.forEach(function(k){var A=o.call(a,k,k,s);A!==k&&(c.push(k),g.push(A))}),this.withMutations(function(o){c.forEach(function(a){return o.remove(a)}),g.forEach(function(a){return o.add(a)})})},Set.prototype.union=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return 0===(a=a.filter(function(o){return 0!==o.size})).length?this:0!==this.size||this.__ownerID||1!==a.length?this.withMutations(function(s){for(var c=0;c<a.length;c++)o(a[c]).forEach(function(o){return s.add(o)})}):this.constructor(a[0])},Set.prototype.intersect=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(0===a.length)return this;a=a.map(function(a){return o(a)});var c=[];return this.forEach(function(o){a.every(function(a){return a.includes(o)})||c.push(o)}),this.withMutations(function(o){c.forEach(function(a){o.remove(a)})})},Set.prototype.subtract=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(0===a.length)return this;a=a.map(function(a){return o(a)});var c=[];return this.forEach(function(o){a.some(function(a){return a.includes(o)})&&c.push(o)}),this.withMutations(function(o){c.forEach(function(a){o.remove(a)})})},Set.prototype.sort=function(o){return eK(sortFactory(this,o))},Set.prototype.sortBy=function(o,a){return eK(sortFactory(this,a,o))},Set.prototype.wasAltered=function(){return this._map.wasAltered()},Set.prototype.__iterate=function(o,a){var s=this;return this._map.__iterate(function(a){return o(a,a,s)},a)},Set.prototype.__iterator=function(o,a){return this._map.__iterator(o,a)},Set.prototype.__ensureOwner=function(o){if(o===this.__ownerID)return this;var a=this._map.__ensureOwner(o);return o?this.__make(a,o):0===this.size?this.__empty():(this.__ownerID=o,this._map=a,this)},Set}(Y);ej.isSet=isSet;var ez=ej.prototype;function updateSet(o,a){return o.__ownerID?(o.size=a.size,o._map=a,o):a===o._map?o:0===a.size?o.__empty():o.__make(a)}function makeSet(o,a){var s=Object.create(ez);return s.size=o?o.size:0,s._map=o,s.__ownerID=a,s}function emptySet(){return w||(w=makeSet(emptyMap()))}ez[eW]=!0,ez[G]=ez.remove,ez.merge=ez.concat=ez.union,ez.withMutations=withMutations,ez.asImmutable=asImmutable,ez["@@transducer/init"]=ez.asMutable=asMutable,ez["@@transducer/step"]=function(o,a){return o.add(a)},ez["@@transducer/result"]=function(o){return o.asImmutable()},ez.__empty=emptySet,ez.__make=makeSet;var eV=function(o){function Range(o,a,s){if(!(this instanceof Range))return new Range(o,a,s);if(invariant(0!==s,"Cannot step a Range by 0"),o=o||0,void 0===a&&(a=1/0),s=void 0===s?1:Math.abs(s),a<o&&(s=-s),this._start=o,this._end=a,this._step=s,this.size=Math.max(0,Math.ceil((a-o)/s-1)+1),0===this.size){if(F)return F;F=this}}return o&&(Range.__proto__=o),Range.prototype=Object.create(o&&o.prototype),Range.prototype.constructor=Range,Range.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},Range.prototype.get=function(o,a){return this.has(o)?this._start+wrapIndex(this,o)*this._step:a},Range.prototype.includes=function(o){var a=(o-this._start)/this._step;return a>=0&&a<this.size&&a===Math.floor(a)},Range.prototype.slice=function(o,a){var s;return wholeSlice(o,a,this.size)?this:(o=resolveIndex(o,this.size,0),(a=resolveIndex(a,s=this.size,s))<=o)?new Range(0,0):new Range(this.get(o,this._end),this.get(a,this._end),this._step)},Range.prototype.indexOf=function(o){var a=o-this._start;if(a%this._step==0){var s=a/this._step;if(s>=0&&s<this.size)return s}return -1},Range.prototype.lastIndexOf=function(o){return this.indexOf(o)},Range.prototype.__iterate=function(o,a){for(var s=this.size,c=this._step,g=a?this._start+(s-1)*c:this._start,k=0;k!==s&&!1!==o(g,a?s-++k:k++,this);)g+=a?-c:c;return k},Range.prototype.__iterator=function(o,a){var s=this.size,c=this._step,g=a?this._start+(s-1)*c:this._start,k=0;return new Iterator(function(){if(k===s)return iteratorDone();var A=g;return g+=a?-c:c,iteratorValue(o,a?s-++k:k++,A)})},Range.prototype.equals=function(o){return o instanceof Range?this._start===o._start&&this._end===o._end&&this._step===o._step:deepEqual(this,o)},Range}(eo);function getIn(o,a,s){for(var c=coerceKeyPath(a),g=0;g!==c.length;)if((o=get(o,c[g++],B))===B)return s;return o}function getIn$1(o,a){return getIn(this,o,a)}function hasIn(o,a){return getIn(o,a,B)!==B}function toObject(){assertNotInfinite(this.size);var o={};return this.__iterate(function(a,s){o[s]=a}),o}Collection.isIterable=isCollection,Collection.isKeyed=isKeyed,Collection.isIndexed=isIndexed,Collection.isAssociative=isAssociative,Collection.isOrdered=isOrdered,Collection.Iterator=Iterator,mixin(Collection,{toArray:function(){assertNotInfinite(this.size);var o=Array(this.size||0),a=isKeyed(this),s=0;return this.__iterate(function(c,g){o[s++]=a?[g,c]:c}),o},toIndexedSeq:function(){return new eA(this)},toJS:function(){return toJS(this)},toKeyedSeq:function(){return new ek(this,!0)},toMap:function(){return eM(this.toKeyedSeq())},toObject:toObject,toOrderedMap:function(){return eD(this.toKeyedSeq())},toOrderedSet:function(){return eK(isKeyed(this)?this.valueSeq():this)},toSet:function(){return ej(isKeyed(this)?this.valueSeq():this)},toSetSeq:function(){return new eS(this)},toSeq:function(){return isIndexed(this)?this.toIndexedSeq():isKeyed(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return eG(isKeyed(this)?this.valueSeq():this)},toList:function(){return eF(isKeyed(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(o,a){return 0===this.size?o+a:o+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+a},concat:function(){for(var o=[],a=arguments.length;a--;)o[a]=arguments[a];return reify(this,function(o,a){var s=isKeyed(o),c=[o].concat(a).map(function(o){return isCollection(o)?s&&(o=U(o)):o=s?keyedSeqFromValue(o):indexedSeqFromValue(Array.isArray(o)?o:[o]),o}).filter(function(o){return 0!==o.size});if(0===c.length)return o;if(1===c.length){var g=c[0];if(g===o||s&&isKeyed(g)||isIndexed(o)&&isIndexed(g))return g}var k=new es(c);return s?k=k.toKeyedSeq():isIndexed(o)||(k=k.toSetSeq()),(k=k.flatten(!0)).size=c.reduce(function(o,a){if(void 0!==o){var s=a.size;if(void 0!==s)return o+s}},0),k}(this,o))},includes:function(o){return this.some(function(a){return is(a,o)})},entries:function(){return this.__iterator(2)},every:function(o,a){assertNotInfinite(this.size);var s=!0;return this.__iterate(function(c,g,k){if(!o.call(a,c,g,k))return s=!1,!1}),s},filter:function(o,a){return reify(this,filterFactory(this,o,a,!0))},find:function(o,a,s){var c=this.findEntry(o,a);return c?c[1]:s},forEach:function(o,a){return assertNotInfinite(this.size),this.__iterate(a?o.bind(a):o)},join:function(o){assertNotInfinite(this.size),o=void 0!==o?""+o:",";var a="",s=!0;return this.__iterate(function(c){s?s=!1:a+=o,a+=null!=c?c.toString():""}),a},keys:function(){return this.__iterator(0)},map:function(o,a){return reify(this,mapFactory(this,o,a))},reduce:function(o,a,s){return reduce(this,o,a,s,arguments.length<2,!1)},reduceRight:function(o,a,s){return reduce(this,o,a,s,arguments.length<2,!0)},reverse:function(){return reify(this,reverseFactory(this,!0))},slice:function(o,a){return reify(this,sliceFactory(this,o,a,!0))},some:function(o,a){return!this.every(not(o),a)},sort:function(o){return reify(this,sortFactory(this,o))},values:function(){return this.__iterator(1)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(o,a){return ensureSize(o?this.toSeq().filter(o,a):this)},countBy:function(o,a){var s,c;return s=this,c=eM().asMutable(),s.__iterate(function(g,k){c.update(o.call(a,g,k,s),0,function(o){return o+1})}),c.asImmutable()},equals:function(o){return deepEqual(this,o)},entrySeq:function(){var o=this;if(o._cache)return new es(o._cache);var a=o.toSeq().map(entryMapper).toIndexedSeq();return a.fromEntrySeq=function(){return o.toSeq()},a},filterNot:function(o,a){return this.filter(not(o),a)},findEntry:function(o,a,s){var c=s;return this.__iterate(function(s,g,k){if(o.call(a,s,g,k))return c=[g,s],!1}),c},findKey:function(o,a){var s=this.findEntry(o,a);return s&&s[0]},findLast:function(o,a,s){return this.toKeyedSeq().reverse().find(o,a,s)},findLastEntry:function(o,a,s){return this.toKeyedSeq().reverse().findEntry(o,a,s)},findLastKey:function(o,a){return this.toKeyedSeq().reverse().findKey(o,a)},first:function(o){return this.find(returnTrue,null,o)},flatMap:function(o,a){var s,c;return reify(this,(s=this,c=collectionClass(s),s.toSeq().map(function(g,k){return c(o.call(a,g,k,s))}).flatten(!0)))},flatten:function(o){return reify(this,flattenFactory(this,o,!0))},fromEntrySeq:function(){return new ex(this)},get:function(o,a){return this.find(function(a,s){return is(s,o)},void 0,a)},getIn:getIn$1,groupBy:function(o,a){return function(o,a,s){var c=isKeyed(o),g=(isOrdered(o)?eD():eM()).asMutable();o.__iterate(function(k,A){g.update(a.call(s,k,A,o),function(o){return(o=o||[]).push(c?[A,k]:k),o})});var k=collectionClass(o);return g.map(function(a){return reify(o,k(a))}).asImmutable()}(this,o,a)},has:function(o){return this.get(o,B)!==B},hasIn:function(o){return hasIn(this,o)},isSubset:function(o){return o="function"==typeof o.includes?o:Collection(o),this.every(function(a){return o.includes(a)})},isSuperset:function(o){return(o="function"==typeof o.isSubset?o:Collection(o)).isSubset(this)},keyOf:function(o){return this.findKey(function(a){return is(a,o)})},keySeq:function(){return this.toSeq().map(keyMapper).toIndexedSeq()},last:function(o){return this.toSeq().reverse().first(o)},lastKeyOf:function(o){return this.toKeyedSeq().reverse().keyOf(o)},max:function(o){return maxFactory(this,o)},maxBy:function(o,a){return maxFactory(this,a,o)},min:function(o){return maxFactory(this,o?neg(o):defaultNegComparator)},minBy:function(o,a){return maxFactory(this,a?neg(a):defaultNegComparator,o)},rest:function(){return this.slice(1)},skip:function(o){return 0===o?this:this.slice(Math.max(0,o))},skipLast:function(o){return 0===o?this:this.slice(0,-Math.max(0,o))},skipWhile:function(o,a){return reify(this,skipWhileFactory(this,o,a,!0))},skipUntil:function(o,a){return this.skipWhile(not(o),a)},sortBy:function(o,a){return reify(this,sortFactory(this,a,o))},take:function(o){return this.slice(0,Math.max(0,o))},takeLast:function(o){return this.slice(-Math.max(0,o))},takeWhile:function(o,a){var s,c;return reify(this,(s=this,(c=makeSequence(s)).__iterateUncached=function(c,g){var k=this;if(g)return this.cacheResult().__iterate(c,g);var A=0;return s.__iterate(function(s,g,x){return o.call(a,s,g,x)&&++A&&c(s,g,k)}),A},c.__iteratorUncached=function(c,g){var k=this;if(g)return this.cacheResult().__iterator(c,g);var A=s.__iterator(2,g),x=!0;return new Iterator(function(){if(!x)return iteratorDone();var s=A.next();if(s.done)return s;var g=s.value,P=g[0],w=g[1];return o.call(a,w,P,k)?2===c?s:iteratorValue(c,P,w,s):(x=!1,iteratorDone())})},c))},takeUntil:function(o,a){return this.takeWhile(not(o),a)},update:function(o){return o(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function(o){if(o.size===1/0)return 0;var a,s,c=isOrdered(o),g=isKeyed(o),k=c?1:0;return a=o.__iterate(g?c?function(o,a){k=31*k+hashMerge(hash(o),hash(a))|0}:function(o,a){k=k+hashMerge(hash(o),hash(a))|0}:c?function(o){k=31*k+hash(o)|0}:function(o){k=k+hash(o)|0}),s=ec(s=k,3432918353),s=ec(s<<15|s>>>-15,461845907),s=((s=ec(s<<13|s>>>-13,5))+3864292196|0)^a,s=ec(s^s>>>16,2246822507),s=smi((s=ec(s^s>>>13,3266489909))^s>>>16)}(this))}});var eq=Collection.prototype;eq[W]=!0,eq[et]=eq.values,eq.toJSON=eq.toArray,eq.__toStringMapper=quoteString,eq.inspect=eq.toSource=function(){return this.toString()},eq.chain=eq.flatMap,eq.contains=eq.includes,mixin(U,{flip:function(){return reify(this,flipFactory(this))},mapEntries:function(o,a){var s=this,c=0;return reify(this,this.toSeq().map(function(g,k){return o.call(a,[k,g],c++,s)}).fromEntrySeq())},mapKeys:function(o,a){var s=this;return reify(this,this.toSeq().flip().map(function(c,g){return o.call(a,c,g,s)}).flip())}});var eU=U.prototype;eU[z]=!0,eU[et]=eq.entries,eU.toJSON=toObject,eU.__toStringMapper=function(o,a){return quoteString(a)+": "+quoteString(o)},mixin(K,{toKeyedSeq:function(){return new ek(this,!1)},filter:function(o,a){return reify(this,filterFactory(this,o,a,!1))},findIndex:function(o,a){var s=this.findEntry(o,a);return s?s[0]:-1},indexOf:function(o){var a=this.keyOf(o);return void 0===a?-1:a},lastIndexOf:function(o){var a=this.lastKeyOf(o);return void 0===a?-1:a},reverse:function(){return reify(this,reverseFactory(this,!1))},slice:function(o,a){return reify(this,sliceFactory(this,o,a,!1))},splice:function(o,a){var s=arguments.length;if(a=Math.max(a||0,0),0===s||2===s&&!a)return this;o=resolveIndex(o,o<0?this.count():this.size,0);var c=this.slice(0,o);return reify(this,1===s?c:c.concat(arrCopy(arguments,2),this.slice(o+a)))},findLastIndex:function(o,a){var s=this.findLastEntry(o,a);return s?s[0]:-1},first:function(o){return this.get(0,o)},flatten:function(o){return reify(this,flattenFactory(this,o,!1))},get:function(o,a){return(o=wrapIndex(this,o))<0||this.size===1/0||void 0!==this.size&&o>this.size?a:this.find(function(a,s){return s===o},void 0,a)},has:function(o){return(o=wrapIndex(this,o))>=0&&(void 0!==this.size?this.size===1/0||o<this.size:-1!==this.indexOf(o))},interpose:function(o){var a,s;return reify(this,(a=this,(s=makeSequence(a)).size=a.size&&2*a.size-1,s.__iterateUncached=function(s,c){var g=this,k=0;return a.__iterate(function(a){return(!k||!1!==s(o,k++,g))&&!1!==s(a,k++,g)},c),k},s.__iteratorUncached=function(s,c){var g,k=a.__iterator(1,c),A=0;return new Iterator(function(){return(!g||A%2)&&(g=k.next()).done?g:A%2?iteratorValue(s,A++,o):iteratorValue(s,A++,g.value,g)})},s))},interleave:function(){var o=[this].concat(arrCopy(arguments)),a=zipWithFactory(this.toSeq(),eo.of,o),s=a.flatten(!0);return a.size&&(s.size=a.size*o.length),reify(this,s)},keySeq:function(){return eV(0,this.size)},last:function(o){return this.get(-1,o)},skipWhile:function(o,a){return reify(this,skipWhileFactory(this,o,a,!1))},zip:function(){var o=[this].concat(arrCopy(arguments));return reify(this,zipWithFactory(this,defaultZipper,o))},zipAll:function(){var o=[this].concat(arrCopy(arguments));return reify(this,zipWithFactory(this,defaultZipper,o,!0))},zipWith:function(o){var a=arrCopy(arguments);return a[0]=this,reify(this,zipWithFactory(this,o,a))}});var eH=K.prototype;function reduce(o,a,s,c,g,k){return assertNotInfinite(o.size),o.__iterate(function(o,k,A){g?(g=!1,s=o):s=a.call(c,s,o,k,A)},k),s}function keyMapper(o,a){return a}function entryMapper(o,a){return[a,o]}function not(o){return function(){return!o.apply(this,arguments)}}function neg(o){return function(){return-o.apply(this,arguments)}}function defaultZipper(){return arrCopy(arguments)}function defaultNegComparator(o,a){return o<a?1:o>a?-1:0}function hashMerge(o,a){return o^a+2654435769+(o<<6)+(o>>2)|0}eH[V]=!0,eH[Z]=!0,mixin(Y,{get:function(o,a){return this.has(o)?o:a},includes:function(o){return this.has(o)},keySeq:function(){return this.valueSeq()}}),Y.prototype.has=eq.includes,Y.prototype.contains=Y.prototype.includes,mixin(ei,U.prototype),mixin(eo,K.prototype),mixin(ea,Y.prototype);var eK=function(o){function OrderedSet(o){return null==o?emptyOrderedSet():isOrderedSet(o)?o:emptyOrderedSet().withMutations(function(a){var s=Y(o);assertNotInfinite(s.size),s.forEach(function(o){return a.add(o)})})}return o&&(OrderedSet.__proto__=o),OrderedSet.prototype=Object.create(o&&o.prototype),OrderedSet.prototype.constructor=OrderedSet,OrderedSet.of=function(){return this(arguments)},OrderedSet.fromKeys=function(o){return this(U(o).keySeq())},OrderedSet.prototype.toString=function(){return this.__toString("OrderedSet {","}")},OrderedSet}(ej);eK.isOrderedSet=isOrderedSet;var eY=eK.prototype;function makeOrderedSet(o,a){var s=Object.create(eY);return s.size=o?o.size:0,s._map=o,s.__ownerID=a,s}function emptyOrderedSet(){return R||(R=makeOrderedSet(emptyOrderedMap()))}eY[Z]=!0,eY.zip=eH.zip,eY.zipWith=eH.zipWith,eY.__empty=emptyOrderedSet,eY.__make=makeOrderedSet;var Record=function(o,a){var s,RecordType=function(g){var k=this;if(g instanceof RecordType)return g;if(!(this instanceof RecordType))return new RecordType(g);if(!s){s=!0;var A=Object.keys(o),x=c._indices={};c._name=a,c._keys=A,c._defaultValues=o;for(var P=0;P<A.length;P++){var w=A[P];x[w]=P,c[w]?"object"==typeof console&&console.warn&&console.warn("Cannot define "+recordName(this)+' with property "'+w+'" since that property name is part of the Record API.'):function(o,a){try{Object.defineProperty(o,a,{get:function(){return this.get(a)},set:function(o){invariant(this.__ownerID,"Cannot set on an immutable record."),this.set(a,o)}})}catch(o){}}(c,w)}}this.__ownerID=void 0,this._values=eF().withMutations(function(o){o.setSize(k._keys.length),U(g).forEach(function(a,s){o.set(k._indices[s],a===k._defaultValues[s]?void 0:a)})})},c=RecordType.prototype=Object.create(e$);return c.constructor=RecordType,a&&(RecordType.displayName=a),RecordType};Record.prototype.toString=function(){for(var o,a=recordName(this)+" { ",s=this._keys,c=0,g=s.length;c!==g;c++)o=s[c],a+=(c?", ":"")+o+": "+quoteString(this.get(o));return a+" }"},Record.prototype.equals=function(o){return this===o||o&&this._keys===o._keys&&recordSeq(this).equals(recordSeq(o))},Record.prototype.hashCode=function(){return recordSeq(this).hashCode()},Record.prototype.has=function(o){return this._indices.hasOwnProperty(o)},Record.prototype.get=function(o,a){if(!this.has(o))return a;var s=this._indices[o],c=this._values.get(s);return void 0===c?this._defaultValues[o]:c},Record.prototype.set=function(o,a){if(this.has(o)){var s=this._values.set(this._indices[o],a===this._defaultValues[o]?void 0:a);if(s!==this._values&&!this.__ownerID)return makeRecord(this,s)}return this},Record.prototype.remove=function(o){return this.set(o)},Record.prototype.clear=function(){var o=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:makeRecord(this,o)},Record.prototype.wasAltered=function(){return this._values.wasAltered()},Record.prototype.toSeq=function(){return recordSeq(this)},Record.prototype.toJS=function(){return toJS(this)},Record.prototype.entries=function(){return this.__iterator(2)},Record.prototype.__iterator=function(o,a){return recordSeq(this).__iterator(o,a)},Record.prototype.__iterate=function(o,a){return recordSeq(this).__iterate(o,a)},Record.prototype.__ensureOwner=function(o){if(o===this.__ownerID)return this;var a=this._values.__ensureOwner(o);return o?makeRecord(this,a,o):(this.__ownerID=o,this._values=a,this)},Record.isRecord=isRecord,Record.getDescriptiveName=recordName;var e$=Record.prototype;function makeRecord(o,a,s){var c=Object.create(Object.getPrototypeOf(o));return c._values=a,c.__ownerID=s,c}function recordName(o){return o.constructor.displayName||o.constructor.name||"Record"}function recordSeq(o){return keyedSeqFromValue(o._keys.map(function(a){return[a,o.get(a)]}))}e$[X]=!0,e$[G]=e$.remove,e$.deleteIn=e$.removeIn=deleteIn,e$.getIn=getIn$1,e$.hasIn=eq.hasIn,e$.merge=merge,e$.mergeWith=mergeWith,e$.mergeIn=mergeIn,e$.mergeDeep=mergeDeep$1,e$.mergeDeepWith=mergeDeepWith$1,e$.mergeDeepIn=mergeDeepIn,e$.setIn=setIn$1,e$.update=update$1,e$.updateIn=updateIn$1,e$.withMutations=withMutations,e$.asMutable=asMutable,e$.asImmutable=asImmutable,e$[et]=e$.entries,e$.toJSON=e$.toObject=eq.toObject,e$.inspect=e$.toSource=function(){return this.toString()};var eX=function(o){function Repeat(o,a){if(!(this instanceof Repeat))return new Repeat(o,a);if(this._value=o,this.size=void 0===a?1/0:Math.max(0,a),0===this.size){if(D)return D;D=this}}return o&&(Repeat.__proto__=o),Repeat.prototype=Object.create(o&&o.prototype),Repeat.prototype.constructor=Repeat,Repeat.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},Repeat.prototype.get=function(o,a){return this.has(o)?this._value:a},Repeat.prototype.includes=function(o){return is(this._value,o)},Repeat.prototype.slice=function(o,a){var s=this.size;return wholeSlice(o,a,s)?this:new Repeat(this._value,resolveIndex(a,s,s)-resolveIndex(o,s,0))},Repeat.prototype.reverse=function(){return this},Repeat.prototype.indexOf=function(o){return is(this._value,o)?0:-1},Repeat.prototype.lastIndexOf=function(o){return is(this._value,o)?this.size:-1},Repeat.prototype.__iterate=function(o,a){for(var s=this.size,c=0;c!==s&&!1!==o(this._value,a?s-++c:c++,this););return c},Repeat.prototype.__iterator=function(o,a){var s=this,c=this.size,g=0;return new Iterator(function(){return g===c?iteratorDone():iteratorValue(o,a?c-++g:g++,s._value)})},Repeat.prototype.equals=function(o){return o instanceof Repeat?is(this._value,o._value):deepEqual(o)},Repeat}(eo);function fromJS(o,a){return function fromJSWith(o,a,s,c,g,k){var A=Array.isArray(s)?eo:isPlainObj(s)?ei:null;if(A){if(~o.indexOf(s))throw TypeError("Cannot convert circular structure to Immutable");o.push(s),g&&""!==c&&g.push(c);var x=a.call(k,c,A(s).map(function(c,k){return fromJSWith(o,a,c,k,g,s)}),g&&g.slice());return o.pop(),g&&g.pop(),x}return s}([],a||defaultConverter,o,"",a&&a.length>2?[]:void 0,{"":o})}function defaultConverter(o,a){return isKeyed(a)?a.toMap():a.toList()}var eQ="4.0.0-rc.11",eZ=Collection;a.default={version:eQ,Collection:Collection,Iterable:Collection,Seq:en,Map:eM,OrderedMap:eD,List:eF,Stack:eG,Set:ej,OrderedSet:eK,Record:Record,Range:eV,Repeat:eX,is:is,fromJS:fromJS,hash:hash,isImmutable:isImmutable,isCollection:isCollection,isKeyed:isKeyed,isIndexed:isIndexed,isAssociative:isAssociative,isOrdered:isOrdered,isValueObject:isValueObject,isSeq:isSeq,isList:isList,isMap:isMap,isOrderedMap:isOrderedMap,isStack:isStack,isSet:isSet,isOrderedSet:isOrderedSet,isRecord:isRecord,get:get,getIn:getIn,has:has,hasIn:hasIn,merge:merge$1,mergeDeep:mergeDeep,mergeWith:mergeWith$1,mergeDeepWith:mergeDeepWith,remove:remove,removeIn:removeIn,set:set,setIn:setIn,update:update,updateIn:updateIn}},650580:function(o,a,s){var c=s(728579),g=s(467213),k=c.DEFAULT_COMPARATOR,A=c.reverseComparator;function consume(o,a,s,c){for(var k,A,x=c,P=new o(c);x>0;)k=s[--x],0!==x&&(A=s[0],s[0]=k,function(o,a,s,c){for(var k,A=c,x=a[c],P=2*c+1;P<s;)(k=P+1)<s&&o(a[P],a[k])>=0&&(P=k),a[c]=a[P],P=2*(c=P)+1;a[c]=x,g.siftDown(o,a,A,c)}(a,s,--c,0),k=A),P[x]=k;return P}function FixedReverseHeap(o,a,s){if(2==arguments.length&&(s=a,a=null),this.ArrayClass=o,this.capacity=s,this.items=new o(s),this.clear(),this.comparator=a||k,"number"!=typeof s&&s<=0)throw Error("mnemonist/FixedReverseHeap.constructor: capacity should be a number > 0.");if("function"!=typeof this.comparator)throw Error("mnemonist/FixedReverseHeap.constructor: given comparator should be a function.");this.comparator=A(this.comparator)}FixedReverseHeap.prototype.clear=function(){this.size=0},FixedReverseHeap.prototype.push=function(o){return this.size<this.capacity?(this.items[this.size]=o,g.siftDown(this.comparator,this.items,0,this.size),this.size++):this.comparator(o,this.items[0])>0&&g.replace(this.comparator,this.items,o),this.size},FixedReverseHeap.prototype.peek=function(){return this.items[0]},FixedReverseHeap.prototype.consume=function(){var o=consume(this.ArrayClass,this.comparator,this.items,this.size);return this.size=0,o},FixedReverseHeap.prototype.toArray=function(){return consume(this.ArrayClass,this.comparator,this.items.slice(0,this.size),this.size)},FixedReverseHeap.prototype.inspect=function(){var o=this.toArray();return Object.defineProperty(o,"constructor",{value:FixedReverseHeap,enumerable:!1}),o},"undefined"!=typeof Symbol&&(FixedReverseHeap.prototype[Symbol.for("nodejs.util.inspect.custom")]=FixedReverseHeap.prototype.inspect),o.exports=FixedReverseHeap},467213:function(o,a,s){var c=s(848210),g=s(728579),k=s(413118),A=g.DEFAULT_COMPARATOR,x=g.reverseComparator;function siftDown(o,a,s,c){for(var g,k,A=a[c];c>s;){if(0>o(A,k=a[g=c-1>>1])){a[c]=k,c=g;continue}break}a[c]=A}function siftUp(o,a,s){for(var c,g=a.length,k=s,A=a[s],x=2*s+1;x<g;)(c=x+1)<g&&o(a[x],a[c])>=0&&(x=c),a[s]=a[x],x=2*(s=x)+1;a[s]=A,siftDown(o,a,k,s)}function push(o,a,s){a.push(s),siftDown(o,a,0,a.length-1)}function pop(o,a){var s=a.pop();if(0!==a.length){var c=a[0];return a[0]=s,siftUp(o,a,0),c}return s}function replace(o,a,s){if(0===a.length)throw Error("mnemonist/heap.replace: cannot pop an empty heap.");var c=a[0];return a[0]=s,siftUp(o,a,0),c}function pushpop(o,a,s){var c;return 0!==a.length&&0>o(a[0],s)&&(c=a[0],a[0]=s,s=c,siftUp(o,a,0)),s}function heapify(o,a){for(var s=a.length>>1;--s>=0;)siftUp(o,a,s)}function consume(o,a){for(var s=a.length,c=0,g=Array(s);c<s;)g[c++]=pop(o,a);return g}function Heap(o){if(this.clear(),this.comparator=o||A,"function"!=typeof this.comparator)throw Error("mnemonist/Heap.constructor: given comparator should be a function.")}function MaxHeap(o){if(this.clear(),this.comparator=o||A,"function"!=typeof this.comparator)throw Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=x(this.comparator)}Heap.prototype.clear=function(){this.items=[],this.size=0},Heap.prototype.push=function(o){return push(this.comparator,this.items,o),++this.size},Heap.prototype.peek=function(){return this.items[0]},Heap.prototype.pop=function(){return 0!==this.size&&this.size--,pop(this.comparator,this.items)},Heap.prototype.replace=function(o){return replace(this.comparator,this.items,o)},Heap.prototype.pushpop=function(o){return pushpop(this.comparator,this.items,o)},Heap.prototype.consume=function(){return this.size=0,consume(this.comparator,this.items)},Heap.prototype.toArray=function(){return consume(this.comparator,this.items.slice())},Heap.prototype.inspect=function(){var o=this.toArray();return Object.defineProperty(o,"constructor",{value:Heap,enumerable:!1}),o},"undefined"!=typeof Symbol&&(Heap.prototype[Symbol.for("nodejs.util.inspect.custom")]=Heap.prototype.inspect),MaxHeap.prototype=Heap.prototype,Heap.from=function(o,a){var s,c=new Heap(a);return s=k.isArrayLike(o)?o.slice():k.toArray(o),heapify(c.comparator,s),c.items=s,c.size=s.length,c},MaxHeap.from=function(o,a){var s,c=new MaxHeap(a);return s=k.isArrayLike(o)?o.slice():k.toArray(o),heapify(c.comparator,s),c.items=s,c.size=s.length,c},Heap.siftUp=siftUp,Heap.siftDown=siftDown,Heap.push=push,Heap.pop=pop,Heap.replace=replace,Heap.pushpop=pushpop,Heap.heapify=heapify,Heap.consume=consume,Heap.nsmallest=function(o,a,s){2==arguments.length&&(s=a,a=o,o=A);var g,P,w,F,R=x(o),D=1/0;if(1===a){if(k.isArrayLike(s)){for(g=0,P=s.length;g<P;g++)w=s[g],(D===1/0||0>o(w,D))&&(D=w);return(F=new s.constructor(1))[0]=D,F}return c(s,function(a){(D===1/0||0>o(a,D))&&(D=a)}),[D]}if(k.isArrayLike(s)){if(a>=s.length)return s.slice().sort(o);for(heapify(R,F=s.slice(0,a)),g=a,P=s.length;g<P;g++)R(s[g],F[0])>0&&replace(R,F,s[g]);return F.sort(o)}var G=k.guessLength(s);return null!==G&&G<a&&(a=G),F=Array(a),g=0,c(s,function(o){g<a?F[g]=o:(g===a&&heapify(R,F),R(o,F[0])>0&&replace(R,F,o)),g++}),F.length>g&&(F.length=g),F.sort(o)},Heap.nlargest=function(o,a,s){2==arguments.length&&(s=a,a=o,o=A);var g,P,w,F,R=x(o),D=-1/0;if(1===a){if(k.isArrayLike(s)){for(g=0,P=s.length;g<P;g++)w=s[g],(D===-1/0||o(w,D)>0)&&(D=w);return(F=new s.constructor(1))[0]=D,F}return c(s,function(a){(D===-1/0||o(a,D)>0)&&(D=a)}),[D]}if(k.isArrayLike(s)){if(a>=s.length)return s.slice().sort(R);for(F=s.slice(0,a),heapify(o,F),g=a,P=s.length;g<P;g++)o(s[g],F[0])>0&&replace(o,F,s[g]);return F.sort(R)}var G=k.guessLength(s);return null!==G&&G<a&&(a=G),F=Array(a),g=0,c(s,function(s){g<a?F[g]=s:(g===a&&heapify(o,F),o(s,F[0])>0&&replace(o,F,s)),g++}),F.length>g&&(F.length=g),F.sort(R)},Heap.MinHeap=Heap,Heap.MaxHeap=MaxHeap,o.exports=Heap},138385:function(o,a,s){var c=s(413118),g=s(800670),k=s(728579).createTupleComparator,A=s(650580),x=s(412295).O;function squaredDistanceAxes(o,a,s,c){var g,k,A=0;for(g=0;g<o;g++)A+=(k=a[g][s]-c[g])*k;return A}function buildTree(o,a,s,c){for(var k,A,P,w,F,R,D,G,B=c.length,W=g.getPointerArray(B+1),z=new W(B),V=new W(B),U=new W(B),K=[[0,0,s.length,-1,0]],Y=0;0!==K.length;)G=(k=K.pop())[0],R=k[1],D=k[2],A=k[3],P=k[4],x(a[G],s,R,D),B=D-R,F=s[w=R+(B>>>1)],z[Y]=F,A>-1&&(0===P?V[A]=Y+1:U[A]=Y+1),G=(G+1)%o,w!==R&&w!==D-1&&K.push([G,w+1,D,Y,1]),w!==R&&K.push([G,R,w,Y,0]),Y++;return{axes:a,labels:c,pivots:z,lefts:V,rights:U}}function KDTree(o,a){this.dimensions=o,this.visited=0,this.axes=a.axes,this.labels=a.labels,this.pivots=a.pivots,this.lefts=a.lefts,this.rights=a.rights,this.size=this.labels.length}KDTree.prototype.nearestNeighbor=function(o){var a=1/0,s=null,c=this.dimensions,g=this.axes,k=this.pivots,A=this.lefts,x=this.rights,P=0;return!function recurse(w,F){P++;var R=A[F],D=x[F],G=k[F],B=squaredDistanceAxes(c,g,G,o);if(!(B<a)||(s=G,a=B,0!==B)){var W=g[w][G]-o[w];w=(w+1)%c,W>0?0!==R&&recurse(w,R-1):0!==D&&recurse(w,D-1),W*W<a&&(W>0?0!==D&&recurse(w,D-1):0!==R&&recurse(w,R-1))}}(0,0),this.visited=P,this.labels[s]};var P=k(3),w=k(2);KDTree.prototype.kNearestNeighbors=function(o,a){if(o<=0)throw Error("mnemonist/kd-tree.kNearestNeighbors: k should be a positive number.");if(1===(o=Math.min(o,this.size)))return[this.nearestNeighbor(a)];var s=new A(Array,P,o),c=this.dimensions,g=this.axes,k=this.pivots,x=this.lefts,w=this.rights,F=0;(function recurse(A,P){var R=x[P],D=w[P],G=k[P],B=squaredDistanceAxes(c,g,G,a);s.push([B,F++,G]);var W=a[A],z=g[A][G],V=W-z;A=(A+1)%c,W<z?0!==R&&recurse(A,R-1):0!==D&&recurse(A,D-1),(V*V<s.peek()[0]||s.size<o)&&(W<z?0!==D&&recurse(A,D-1):0!==R&&recurse(A,R-1))})(0,0),this.visited=F;for(var R=s.consume(),D=0;D<R.length;D++)R[D]=this.labels[R[D][2]];return R},KDTree.prototype.linearKNearestNeighbors=function(o,a){if(o<=0)throw Error("mnemonist/kd-tree.kNearestNeighbors: k should be a positive number.");o=Math.min(o,this.size);var s,c,g,k=new A(Array,w,o);for(s=0,c=this.size;s<c;s++)g=squaredDistanceAxes(this.dimensions,this.axes,this.pivots[s],a),k.push([g,s]);var x=k.consume();for(s=0;s<x.length;s++)x[s]=this.labels[this.pivots[x[s][1]]];return x},KDTree.prototype.inspect=function(){var o,a,s,c=new Map;for(c.dimensions=this.dimensions,Object.defineProperty(c,"constructor",{value:KDTree,enumerable:!1}),o=0;o<this.size;o++){for(a=0,s=Array(this.dimensions);a<this.dimensions;a++)s[a]=this.axes[a][o];c.set(this.labels[o],s)}return c},"undefined"!=typeof Symbol&&(KDTree.prototype[Symbol.for("nodejs.util.inspect.custom")]=KDTree.prototype.inspect),KDTree.from=function(o,a){var s=function(o,a){var s,c,k,A,x=a.length,P=Array(o),w=Array(x),F=new(g.getPointerArray(x))(x),R=!0;for(s=0;s<o;s++){for(c=0,A=new Float64Array(x);c<x;c++)k=a[c],A[c]=k[1][s],R&&(w[c]=k[0],F[c]=c);R=!1,P[s]=A}return{axes:P,ids:F,labels:w}}(a,c.toArray(o)),k=buildTree(a,s.axes,s.ids,s.labels);return new KDTree(a,k)},KDTree.fromAxes=function(o,a){a||(a=g.indices(o[0].length));var s=o.length,c=buildTree(o.length,o,g.indices(a.length),a);return new KDTree(s,c)},o.exports=KDTree},412295:function(o,a){var s=new Float64Array(64),c=new Float64Array(64);a.O=function(o,a,g,k){var A,x,P,w,F,R;for(s[0]=g,c[0]=k,x=0;x>=0;)if((P=s[x])<(w=c[x]-1)){for(A=o[F=a[P]];P<w;){for(;o[a[w]]>=A&&P<w;)w--;for(P<w&&(a[P++]=a[w]);o[a[P]]<=A&&P<w;)P++;P<w&&(a[w--]=a[P])}a[P]=F,s[x+1]=P+1,c[x+1]=c[x],c[x++]=P,c[x]-s[x]>c[x-1]-s[x-1]&&(R=s[x],s[x]=s[x-1],s[x-1]=R,R=c[x],c[x]=c[x-1],c[x-1]=R)}else x--;return a}},540742:function(o,a,s){var c=s(800670);function StaticDisjointSet(o){var a=c.getPointerArray(o),s=c.getPointerArray(Math.log2(o));this.size=o,this.dimension=o,this.parents=new a(o),this.ranks=new s(o);for(var g=0;g<o;g++)this.parents[g]=g}StaticDisjointSet.prototype.find=function(o){for(var a,s,c=o;a=this.parents[c],c!==a;)c=a;for(;(s=this.parents[o])!==c;)this.parents[o]=c,o=s;return c},StaticDisjointSet.prototype.union=function(o,a){var s=this.find(o),c=this.find(a);if(s===c)return this;this.dimension--;var g=this.ranks[o],k=this.ranks[a];return g<k?this.parents[s]=c:g>k?this.parents[c]=s:(this.parents[c]=s,this.ranks[s]++),this},StaticDisjointSet.prototype.connected=function(o,a){return this.find(o)===this.find(a)},StaticDisjointSet.prototype.mapping=function(){for(var o,a=c.getPointerArray(this.dimension),s={},g=new a(this.size),k=0,A=0,x=this.parents.length;A<x;A++)void 0===s[o=this.find(A)]?(g[A]=k,s[o]=k++):g[A]=s[o];return g},StaticDisjointSet.prototype.compile=function(){for(var o,a={},s=Array(this.dimension),c=0,g=0,k=this.parents.length;g<k;g++)void 0===a[o=this.find(g)]?(s[c]=[g],a[o]=c++):s[a[o]].push(g);return s},StaticDisjointSet.prototype.inspect=function(){var o=this.compile();return Object.defineProperty(o,"constructor",{value:StaticDisjointSet,enumerable:!1}),o},"undefined"!=typeof Symbol&&(StaticDisjointSet.prototype[Symbol.for("nodejs.util.inspect.custom")]=StaticDisjointSet.prototype.inspect),o.exports=StaticDisjointSet},728579:function(o,a){a.DEFAULT_COMPARATOR=function(o,a){return o<a?-1:o>a?1:0},a.DEFAULT_REVERSE_COMPARATOR=function(o,a){return o<a?1:o>a?-1:0},a.reverseComparator=function(o){return function(a,s){return o(s,a)}},a.createTupleComparator=function(o){return 2===o?function(o,a){return o[0]<a[0]?-1:o[0]>a[0]?1:o[1]<a[1]?-1:o[1]>a[1]?1:0}:function(a,s){for(var c=0;c<o;){if(a[c]<s[c])return -1;if(a[c]>s[c])return 1;c++}return 0}}},413118:function(o,a,s){var c=s(848210),g=s(800670);function guessLength(o){return"number"==typeof o.length?o.length:"number"==typeof o.size?o.size:void 0}a.isArrayLike=function(o){return Array.isArray(o)||g.isTypedArray(o)},a.guessLength=guessLength,a.toArray=function(o){var a=guessLength(o),s="number"==typeof a?Array(a):[],g=0;return c(o,function(o){s[g++]=o}),s},a.toArrayWithIndices=function(o){var a=guessLength(o),s="number"==typeof a?g.getPointerArray(a):Array,k="number"==typeof a?Array(a):[],A="number"==typeof a?new s(a):[],x=0;return c(o,function(o){k[x]=o,A[x]=x++}),[k,A]}},800670:function(o,a){a.getPointerArray=function(o){var a=o-1;if(a<=255)return Uint8Array;if(a<=65535)return Uint16Array;if(a<=4294967295)return Uint32Array;throw Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},a.getSignedPointerArray=function(o){var a=o-1;return a<=127?Int8Array:a<=32767?Int16Array:a<=2147483647?Int32Array:Float64Array},a.getNumberType=function(o){return o===(0|o)?-1===Math.sign(o)?o<=127&&o>=-128?Int8Array:o<=32767&&o>=-32768?Int16Array:Int32Array:o<=255?Uint8Array:o<=65535?Uint16Array:Uint32Array:Float64Array};var s={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};a.getMinimalRepresentation=function(o,c){var g,k,A,x,P,w=null,F=0;for(x=0,P=o.length;x<P;x++)A=c?c(o[x]):o[x],(g=s[(k=a.getNumberType(A)).name])>F&&(F=g,w=k);return w},a.isTypedArray=function(o){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(o)},a.concat=function(){var o,a,s,c=0;for(o=0,s=arguments.length;o<s;o++)c+=arguments[o].length;var g=new arguments[0].constructor(c);for(o=0,a=0;o<s;o++)g.set(arguments[o],a),a+=arguments[o].length;return g},a.indices=function(o){for(var s=new(a.getPointerArray(o))(o),c=0;c<o;c++)s[c]=c;return s}},289624:function(o){var a=parseInt(Number.MAX_SAFE_INTEGER/2)||67108864*67108864;function Munkres(){this.C=null,this.row_covered=[],this.col_covered=[],this.n=0,this.Z0_r=0,this.Z0_c=0,this.marked=null,this.path=null}function computeMunkres(o,a){return new Munkres().compute(o,a)}Munkres.prototype.pad_matrix=function(o,a){a=a||0;var s,c=0,g=o.length;for(s=0;s<g;++s)o[s].length>c&&(c=o[s].length);g=c>g?c:g;var k=[];for(s=0;s<g;++s){for(var A=(o[s]||[]).slice();g>A.length;)A.push(a);k.push(A)}return k},Munkres.prototype.compute=function(o,a){(a=a||{}).padValue=a.padValue||0,this.C=this.pad_matrix(o,a.padValue),this.n=this.C.length,this.original_length=o.length,this.original_width=o[0].length;for(var s=[];s.length<this.n;)s.push(!1);this.row_covered=s.slice(),this.col_covered=s.slice(),this.Z0_r=0,this.Z0_c=0,this.path=this.__make_matrix(2*this.n,0),this.marked=this.__make_matrix(this.n,0);for(var c=1,g={1:this.__step1,2:this.__step2,3:this.__step3,4:this.__step4,5:this.__step5,6:this.__step6};;){var k=g[c];if(!k)break;c=k.apply(this)}for(var A=[],x=0;x<this.original_length;++x)for(var P=0;P<this.original_width;++P)1==this.marked[x][P]&&A.push([x,P]);return A},Munkres.prototype.__make_matrix=function(o,a){for(var s=[],c=0;c<o;++c){s[c]=[];for(var g=0;g<o;++g)s[c][g]=a}return s},Munkres.prototype.__step1=function(){for(var o=0;o<this.n;++o)for(var a=Math.min.apply(Math,this.C[o]),s=0;s<this.n;++s)this.C[o][s]-=a;return 2},Munkres.prototype.__step2=function(){for(var o=0;o<this.n;++o)for(var a=0;a<this.n;++a)if(0===this.C[o][a]&&!this.col_covered[a]&&!this.row_covered[o]){this.marked[o][a]=1,this.col_covered[a]=!0,this.row_covered[o]=!0;break}return this.__clear_covers(),3},Munkres.prototype.__step3=function(){for(var o=0,a=0;a<this.n;++a)for(var s=0;s<this.n;++s)1==this.marked[a][s]&&!1==this.col_covered[s]&&(this.col_covered[s]=!0,++o);return o>=this.n?7:4},Munkres.prototype.__step4=function(){for(var o=-1,a=-1,s=-1;;){var c=this.__find_a_zero();if(o=c[0],a=c[1],o<0)return 6;if(this.marked[o][a]=2,!((s=this.__find_star_in_row(o))>=0))return this.Z0_r=o,this.Z0_c=a,5;a=s,this.row_covered[o]=!0,this.col_covered[a]=!1}},Munkres.prototype.__step5=function(){var o=0;this.path[o][0]=this.Z0_r,this.path[o][1]=this.Z0_c;for(var a=!1;!a;){var s=this.__find_star_in_col(this.path[o][1]);if(s>=0?(o++,this.path[o][0]=s,this.path[o][1]=this.path[o-1][1]):a=!0,!a){var c=this.__find_prime_in_row(this.path[o][0]);o++,this.path[o][0]=this.path[o-1][0],this.path[o][1]=c}}return this.__convert_path(this.path,o),this.__clear_covers(),this.__erase_primes(),3},Munkres.prototype.__step6=function(){for(var o=this.__find_smallest(),a=0;a<this.n;++a)for(var s=0;s<this.n;++s)this.row_covered[a]&&(this.C[a][s]+=o),this.col_covered[s]||(this.C[a][s]-=o);return 4},Munkres.prototype.__find_smallest=function(){for(var o=a,s=0;s<this.n;++s)for(var c=0;c<this.n;++c)this.row_covered[s]||this.col_covered[c]||!(o>this.C[s][c])||(o=this.C[s][c]);return o},Munkres.prototype.__find_a_zero=function(){for(var o=0;o<this.n;++o)for(var a=0;a<this.n;++a)if(0===this.C[o][a]&&!this.row_covered[o]&&!this.col_covered[a])return[o,a];return[-1,-1]},Munkres.prototype.__find_star_in_row=function(o){for(var a=0;a<this.n;++a)if(1==this.marked[o][a])return a;return -1},Munkres.prototype.__find_star_in_col=function(o){for(var a=0;a<this.n;++a)if(1==this.marked[a][o])return a;return -1},Munkres.prototype.__find_prime_in_row=function(o){for(var a=0;a<this.n;++a)if(2==this.marked[o][a])return a;return -1},Munkres.prototype.__convert_path=function(o,a){for(var s=0;s<=a;++s)this.marked[o[s][0]][o[s][1]]=1==this.marked[o[s][0]][o[s][1]]?0:1},Munkres.prototype.__clear_covers=function(){for(var o=0;o<this.n;++o)this.row_covered[o]=!1,this.col_covered[o]=!1},Munkres.prototype.__erase_primes=function(){for(var o=0;o<this.n;++o)for(var a=0;a<this.n;++a)2==this.marked[o][a]&&(this.marked[o][a]=0)},computeMunkres.version="1.2.2",computeMunkres.format_matrix=function(o){var a,s,c=[];for(a=0;a<o.length;++a)for(s=0;s<o[a].length;++s){var g=String(o[a][s]).length;(!c[s]||g>=c[s])&&(c[s]=g)}var k="";for(a=0;a<o.length;++a){for(s=0;s<o[a].length;++s){for(var A=String(o[a][s]);A.length<c[s];)A=" "+A;k+=A,s!=o[a].length-1&&(k+=" ")}a!=o[a].length-1&&(k+="\n")}return k},computeMunkres.make_cost_matrix=function(o,a){if(!a){var s,c,g=-1/0;for(s=0;s<o.length;++s)for(c=0;c<o[s].length;++c)o[s][c]>g&&(g=o[s][c]);a=function(o){return g-o}}var k=[];for(s=0;s<o.length;++s){var A=o[s];for(c=0,k[s]=[];c<A.length;++c)k[s][c]=a(o[s][c])}return k},computeMunkres.Munkres=Munkres,o.exports&&(o.exports=computeMunkres)},848210:function(o,a,s){var c=s(971694),g=c.ARRAY_BUFFER_SUPPORT,k=c.SYMBOL_SUPPORT;o.exports=function(o,a){var s,c,A,x,P;if(!o)throw Error("obliterator/forEach: invalid iterable.");if("function"!=typeof a)throw Error("obliterator/forEach: expecting a callback.");if(Array.isArray(o)||g&&ArrayBuffer.isView(o)||"string"==typeof o||"[object Arguments]"===o.toString()){for(A=0,x=o.length;A<x;A++)a(o[A],A);return}if("function"==typeof o.forEach){o.forEach(a);return}if(k&&Symbol.iterator in o&&"function"!=typeof o.next&&(o=o[Symbol.iterator]()),"function"==typeof o.next){for(s=o,A=0;!0!==(P=s.next()).done;)a(P.value,A),A++;return}for(c in o)o.hasOwnProperty(c)&&a(o[c],c)}},971694:function(o,a){a.ARRAY_BUFFER_SUPPORT="undefined"!=typeof ArrayBuffer,a.SYMBOL_SUPPORT="undefined"!=typeof Symbol},373291:function(o,a,s){/*
 * @copyright 2016 Sean Connelly (@voidqk), http://syntheti.cc
 * @license MIT
 * @preserve Project Home: https://github.com/voidqk/polybooljs
 */var c,g=s(681009),k=s(521835),A=s(567671),x=s(689048),P=s(900571),w=s(693928),F=!1,R=k();function operate(o,a,s){var g=c.segments(o),k=c.segments(a),A=s(c.combine(g,k));return c.polygon(A)}c={buildLog:function(o){return!0===o?F=g():!1===o&&(F=!1),!1!==F&&F.list},epsilon:function(o){return R.epsilon(o)},segments:function(o){var a=A(!0,R,F);return o.regions.forEach(a.addRegion),{segments:a.calculate(o.inverted),inverted:o.inverted}},combine:function(o,a){return{combined:A(!1,R,F).calculate(o.segments,o.inverted,a.segments,a.inverted),inverted1:o.inverted,inverted2:a.inverted}},selectUnion:function(o){return{segments:P.union(o.combined,F),inverted:o.inverted1||o.inverted2}},selectIntersect:function(o){return{segments:P.intersect(o.combined,F),inverted:o.inverted1&&o.inverted2}},selectDifference:function(o){return{segments:P.difference(o.combined,F),inverted:o.inverted1&&!o.inverted2}},selectDifferenceRev:function(o){return{segments:P.differenceRev(o.combined,F),inverted:!o.inverted1&&o.inverted2}},selectXor:function(o){return{segments:P.xor(o.combined,F),inverted:o.inverted1!==o.inverted2}},polygon:function(o){return{regions:x(o.segments,R,F),inverted:o.inverted}},polygonFromGeoJSON:function(o){return w.toPolygon(c,o)},polygonToGeoJSON:function(o){return w.fromPolygon(c,R,o)},union:function(o,a){return operate(o,a,c.selectUnion)},intersect:function(o,a){return operate(o,a,c.selectIntersect)},difference:function(o,a){return operate(o,a,c.selectDifference)},differenceRev:function(o,a){return operate(o,a,c.selectDifferenceRev)},xor:function(o,a){return operate(o,a,c.selectXor)}},"object"==typeof window&&(window.PolyBool=c),o.exports=c},681009:function(o){o.exports=function(){var o,a=0,s=!1;function push(a,s){return o.list.push({type:a,data:s?JSON.parse(JSON.stringify(s)):void 0}),o}return o={list:[],segmentId:function(){return a++},checkIntersection:function(o,a){return push("check",{seg1:o,seg2:a})},segmentChop:function(o,a){return push("div_seg",{seg:o,pt:a}),push("chop",{seg:o,pt:a})},statusRemove:function(o){return push("pop_seg",{seg:o})},segmentUpdate:function(o){return push("seg_update",{seg:o})},segmentNew:function(o,a){return push("new_seg",{seg:o,primary:a})},segmentRemove:function(o){return push("rem_seg",{seg:o})},tempStatus:function(o,a,s){return push("temp_status",{seg:o,above:a,below:s})},rewind:function(o){return push("rewind",{seg:o})},status:function(o,a,s){return push("status",{seg:o,above:a,below:s})},vert:function(a){return a===s?o:(s=a,push("vert",{x:a}))},log:function(o){return"string"!=typeof o&&(o=JSON.stringify(o,!1,"  ")),push("log",{txt:o})},reset:function(){return push("reset")},selected:function(o){return push("selected",{segs:o})},chainStart:function(o){return push("chain_start",{seg:o})},chainRemoveHead:function(o,a){return push("chain_rem_head",{index:o,pt:a})},chainRemoveTail:function(o,a){return push("chain_rem_tail",{index:o,pt:a})},chainNew:function(o,a){return push("chain_new",{pt1:o,pt2:a})},chainMatch:function(o){return push("chain_match",{index:o})},chainClose:function(o){return push("chain_close",{index:o})},chainAddHead:function(o,a){return push("chain_add_head",{index:o,pt:a})},chainAddTail:function(o,a){return push("chain_add_tail",{index:o,pt:a})},chainConnect:function(o,a){return push("chain_con",{index1:o,index2:a})},chainReverse:function(o){return push("chain_rev",{index:o})},chainJoin:function(o,a){return push("chain_join",{index1:o,index2:a})},done:function(){return push("done")}}}},521835:function(o){o.exports=function(o){"number"!=typeof o&&(o=1e-10);var a={epsilon:function(a){return"number"==typeof a&&(o=a),o},pointAboveOrOnLine:function(a,s,c){var g=s[0],k=s[1],A=c[0],x=c[1],P=a[0];return(A-g)*(a[1]-k)-(x-k)*(P-g)>=-o},pointBetween:function(a,s,c){var g=a[1]-s[1],k=c[0]-s[0],A=a[0]-s[0],x=c[1]-s[1],P=A*k+g*x;return!(P<o)&&!(P-(k*k+x*x)>-o)},pointsSameX:function(a,s){return Math.abs(a[0]-s[0])<o},pointsSameY:function(a,s){return Math.abs(a[1]-s[1])<o},pointsSame:function(o,s){return a.pointsSameX(o,s)&&a.pointsSameY(o,s)},pointsCompare:function(o,s){return a.pointsSameX(o,s)?a.pointsSameY(o,s)?0:o[1]<s[1]?-1:1:o[0]<s[0]?-1:1},pointsCollinear:function(a,s,c){var g=a[0]-s[0],k=a[1]-s[1],A=s[0]-c[0];return Math.abs(g*(s[1]-c[1])-A*k)<o},linesIntersect:function(a,s,c,g){var k=s[0]-a[0],A=s[1]-a[1],x=g[0]-c[0],P=g[1]-c[1],w=k*P-A*x;if(Math.abs(w)<o)return!1;var F=a[0]-c[0],R=a[1]-c[1],D=(x*R-P*F)/w,G=(k*R-A*F)/w,B={alongA:0,alongB:0,pt:[a[0]+D*k,a[1]+D*A]};return D<=-o?B.alongA=-2:D<o?B.alongA=-1:D-1<=-o?B.alongA=0:D-1<o?B.alongA=1:B.alongA=2,G<=-o?B.alongB=-2:G<o?B.alongB=-1:G-1<=-o?B.alongB=0:G-1<o?B.alongB=1:B.alongB=2,B},pointInsideRegion:function(a,s){for(var c=a[0],g=a[1],k=s[s.length-1][0],A=s[s.length-1][1],x=!1,P=0;P<s.length;P++){var w=s[P][0],F=s[P][1];F-g>o!=A-g>o&&(k-w)*(g-F)/(A-F)+w-c>o&&(x=!x),k=w,A=F}return x}};return a}},693928:function(o){o.exports={toPolygon:function(o,a){function GeoPoly(a){if(a.length<=0)return o.segments({inverted:!1,regions:[]});function LineString(a){var s=a.slice(0,a.length-1);return o.segments({inverted:!1,regions:[s]})}for(var s=LineString(a[0]),c=1;c<a.length;c++)s=o.selectDifference(o.combine(s,LineString(a[c])));return s}if("Polygon"===a.type)return o.polygon(GeoPoly(a.coordinates));if("MultiPolygon"===a.type){for(var s=o.segments({inverted:!1,regions:[]}),c=0;c<a.coordinates.length;c++)s=o.selectUnion(o.combine(s,GeoPoly(a.coordinates[c])));return o.polygon(s)}throw Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(o,a,s){function regionInsideRegion(o,s){return a.pointInsideRegion([(o[0][0]+o[1][0])*.5,(o[0][1]+o[1][1])*.5],s)}function newNode(o){return{region:o,children:[]}}s=o.polygon(o.segments(s));for(var c=newNode(null),g=0;g<s.regions.length;g++){var k=s.regions[g];k.length<3||function addChild(o,a){for(var s=0;s<o.children.length;s++){var c=o.children[s];if(regionInsideRegion(a,c.region)){addChild(c,a);return}}for(var g=newNode(a),s=0;s<o.children.length;s++){var c=o.children[s];regionInsideRegion(c.region,a)&&(g.children.push(c),o.children.splice(s,1),s--)}o.children.push(g)}(c,k)}function forceWinding(o,a){for(var s=0,c=o[o.length-1][0],g=o[o.length-1][1],k=[],A=0;A<o.length;A++){var x=o[A][0],P=o[A][1];k.push([x,P]),s+=P*c-x*g,c=x,g=P}return s<0!==a&&k.reverse(),k.push([k[0][0],k[0][1]]),k}for(var A=[],g=0;g<c.children.length;g++)!function addExterior(o){var a=[forceWinding(o.region,!1)];A.push(a);for(var s=0;s<o.children.length;s++)a.push(function(o){for(var a=0;a<o.children.length;a++)addExterior(o.children[a]);return forceWinding(o.region,!0)}(o.children[s]))}(c.children[g]);return A.length<=0?{type:"Polygon",coordinates:[]}:1==A.length?{type:"Polygon",coordinates:A[0]}:{type:"MultiPolygon",coordinates:A}}}},567671:function(o,a,s){var c=s(159186);o.exports=function(o,a,s){function segmentCopy(o,a,c){return{id:s?s.segmentId():-1,start:o,end:a,myFill:{above:c.myFill.above,below:c.myFill.below},otherFill:null}}var g=c.create();function eventAdd(o,s){g.insertBefore(o,function(c){var g,k,A,x,P,w;return g=o.isStart,k=o.pt,A=c.isStart,x=c.pt,P=c.other.pt,(0!==(w=a.pointsCompare(k,x))?w:a.pointsSame(s,P)?0:g!==A?g?1:-1:a.pointAboveOrOnLine(s,A?x:P,A?P:x)?1:-1)<0})}function eventAddSegment(o,a){var s,g,k=(eventAdd(s=c.node({isStart:!0,pt:o.start,seg:o,primary:a,other:null,status:null}),o.end),s);return g=c.node({isStart:!1,pt:o.end,seg:o,primary:a,other:k,status:null}),k.other=g,eventAdd(g,k.pt),k}function eventDivide(o,a){var c=segmentCopy(a,o.seg.end,o.seg);return s&&s.segmentChop(o.seg,a),o.other.remove(),o.seg.end=a,o.other.pt=a,eventAdd(o.other,o.pt),eventAddSegment(c,o.primary)}function calculate(k,A){var x=c.create();function checkIntersection(o,c){var g=o.seg,k=c.seg,A=g.start,x=g.end,P=k.start,w=k.end;s&&s.checkIntersection(g,k);var F=a.linesIntersect(A,x,P,w);if(!1===F){if(!a.pointsCollinear(A,x,P)||a.pointsSame(A,w)||a.pointsSame(x,P))return!1;var R=a.pointsSame(A,P),D=a.pointsSame(x,w);if(R&&D)return c;var G=!R&&a.pointBetween(A,P,w),B=!D&&a.pointBetween(x,P,w);if(R)return B?eventDivide(c,x):eventDivide(o,w),c;G&&(D||(B?eventDivide(c,x):eventDivide(o,w)),eventDivide(c,A))}else 0===F.alongA&&(-1===F.alongB?eventDivide(o,P):0===F.alongB?eventDivide(o,F.pt):1===F.alongB&&eventDivide(o,w)),0===F.alongB&&(-1===F.alongA?eventDivide(c,A):0===F.alongA?eventDivide(c,F.pt):1===F.alongA&&eventDivide(c,x));return!1}for(var P=[];!g.isEmpty();){var w=g.getHead();if(s&&s.vert(w.pt[0]),w.isStart){s&&s.segmentNew(w.seg,w.primary);var F,R,D=function(o){return x.findTransition(function(s){return function(o,s){var c=o.seg.start,g=o.seg.end,k=s.seg.start,A=s.seg.end;return a.pointsCollinear(c,k,A)?a.pointsCollinear(g,k,A)?1:a.pointAboveOrOnLine(g,k,A)?1:-1:a.pointAboveOrOnLine(c,k,A)?1:-1}(o,s.ev)>0})}(w),G=D.before?D.before.ev:null,B=D.after?D.after.ev:null;s&&s.tempStatus(w.seg,!!G&&G.seg,!!B&&B.seg);var W=function(){if(G){var o=checkIntersection(w,G);if(o)return o}return!!B&&checkIntersection(w,B)}();if(W&&(o?(F=null===w.seg.myFill.below||w.seg.myFill.above!==w.seg.myFill.below)&&(W.seg.myFill.above=!W.seg.myFill.above):W.seg.otherFill=w.seg.myFill,s&&s.segmentUpdate(W.seg),w.other.remove(),w.remove()),g.getHead()!==w){s&&s.rewind(w.seg);continue}o?(F=null===w.seg.myFill.below||w.seg.myFill.above!==w.seg.myFill.below,B?w.seg.myFill.below=B.seg.myFill.above:w.seg.myFill.below=k,F?w.seg.myFill.above=!w.seg.myFill.below:w.seg.myFill.above=w.seg.myFill.below):null===w.seg.otherFill&&(R=B?w.primary===B.primary?B.seg.otherFill.above:B.seg.myFill.above:w.primary?A:k,w.seg.otherFill={above:R,below:R}),s&&s.status(w.seg,!!G&&G.seg,!!B&&B.seg),w.other.status=D.insert(c.node({ev:w}))}else{var z=w.status;if(null===z)throw Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(x.exists(z.prev)&&x.exists(z.next)&&checkIntersection(z.prev.ev,z.next.ev),s&&s.statusRemove(z.ev.seg),z.remove(),!w.primary){var V=w.seg.myFill;w.seg.myFill=w.seg.otherFill,w.seg.otherFill=V}P.push(w.seg)}g.getHead().remove()}return s&&s.done(),P}return o?{addRegion:function(o){for(var c,g=o[o.length-1],k=0;k<o.length;k++){c=g,g=o[k];var A,x,P=a.pointsCompare(c,g);0!==P&&eventAddSegment((A=P<0?c:g,x=P<0?g:c,{id:s?s.segmentId():-1,start:A,end:x,myFill:{above:null,below:null},otherFill:null}),!0)}},calculate:function(o){return calculate(o,!1)}}:{calculate:function(o,a,s,c){return o.forEach(function(o){eventAddSegment(segmentCopy(o.start,o.end,o),!0)}),s.forEach(function(o){eventAddSegment(segmentCopy(o.start,o.end,o),!1)}),calculate(a,c)}}}},159186:function(o){o.exports={create:function(){var o={root:{root:!0,next:null},exists:function(a){return null!==a&&a!==o.root},isEmpty:function(){return null===o.root.next},getHead:function(){return o.root.next},insertBefore:function(a,s){for(var c=o.root,g=o.root.next;null!==g;){if(s(g)){a.prev=g.prev,a.next=g,g.prev.next=a,g.prev=a;return}c=g,g=g.next}c.next=a,a.prev=c,a.next=null},findTransition:function(a){for(var s=o.root,c=o.root.next;null!==c&&!a(c);)s=c,c=c.next;return{before:s===o.root?null:s,after:c,insert:function(o){return o.prev=s,o.next=c,s.next=o,null!==c&&(c.prev=o),o}}}};return o},node:function(o){return o.prev=null,o.next=null,o.remove=function(){o.prev.next=o.next,o.next&&(o.next.prev=o.prev),o.prev=null,o.next=null},o}}},689048:function(o){o.exports=function(o,a,s){var c=[],g=[];return o.forEach(function(o){var k=o.start,A=o.end;if(a.pointsSame(k,A)){console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");return}s&&s.chainStart(o);var x={index:0,matches_head:!1,matches_pt1:!1},P={index:0,matches_head:!1,matches_pt1:!1},w=x;function setMatch(o,a,s){return(w.index=o,w.matches_head=a,w.matches_pt1=s,w===x)?(w=P,!1):(w=null,!0)}for(var F=0;F<c.length;F++){var R=c[F],D=R[0];R[1];var G=R[R.length-1];if(R[R.length-2],a.pointsSame(D,k)){if(setMatch(F,!0,!0))break}else if(a.pointsSame(D,A)){if(setMatch(F,!0,!1))break}else if(a.pointsSame(G,k)){if(setMatch(F,!1,!0))break}else if(a.pointsSame(G,A)&&setMatch(F,!1,!1))break}if(w===x){c.push([k,A]),s&&s.chainNew(k,A);return}if(w===P){s&&s.chainMatch(x.index);var B=x.index,W=x.matches_pt1?A:k,z=x.matches_head,R=c[B],V=z?R[0]:R[R.length-1],U=z?R[1]:R[R.length-2],K=z?R[R.length-1]:R[0],Y=z?R[R.length-2]:R[1];if(a.pointsCollinear(U,V,W)&&(z?(s&&s.chainRemoveHead(x.index,W),R.shift()):(s&&s.chainRemoveTail(x.index,W),R.pop()),V=U),a.pointsSame(K,W)){c.splice(B,1),a.pointsCollinear(Y,K,V)&&(z?(s&&s.chainRemoveTail(x.index,V),R.pop()):(s&&s.chainRemoveHead(x.index,V),R.shift())),s&&s.chainClose(x.index),g.push(R);return}z?(s&&s.chainAddHead(x.index,W),R.unshift(W)):(s&&s.chainAddTail(x.index,W),R.push(W));return}function reverseChain(o){s&&s.chainReverse(o),c[o].reverse()}function appendChain(o,g){var k=c[o],A=c[g],x=k[k.length-1],P=k[k.length-2],w=A[0],F=A[1];a.pointsCollinear(P,x,w)&&(s&&s.chainRemoveTail(o,x),k.pop(),x=P),a.pointsCollinear(x,w,F)&&(s&&s.chainRemoveHead(g,w),A.shift()),s&&s.chainJoin(o,g),c[o]=k.concat(A),c.splice(g,1)}var $=x.index,X=P.index;s&&s.chainConnect($,X);var Z=c[$].length<c[X].length;x.matches_head?P.matches_head?Z?(reverseChain($),appendChain($,X)):(reverseChain(X),appendChain(X,$)):appendChain(X,$):P.matches_head?appendChain($,X):Z?(reverseChain($),appendChain(X,$)):(reverseChain(X),appendChain($,X))}),g}},900571:function(o){function select(o,a,s){var c=[];return o.forEach(function(o){var g=(o.myFill.above?8:0)+(o.myFill.below?4:0)+(o.otherFill&&o.otherFill.above?2:0)+(o.otherFill&&o.otherFill.below?1:0);0!==a[g]&&c.push({id:s?s.segmentId():-1,start:o.start,end:o.end,myFill:{above:1===a[g],below:2===a[g]},otherFill:null})}),s&&s.selected(c),c}o.exports={union:function(o,a){return select(o,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],a)},intersect:function(o,a){return select(o,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],a)},difference:function(o,a){return select(o,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],a)},differenceRev:function(o,a){return select(o,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],a)},xor:function(o,a){return select(o,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],a)}}},527352:function(o,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=s(268748),g=[],freeNode=function(o){return g.push(o)},freeAllNode=function(o){o&&(freeNode(o),isLeaf(o)||o.children.forEach(freeAllNode))},allowNode=function(o){var a=g.pop();return a?(a.children=o,a.height=1,a.leaf=!0,a.minX=1/0,a.minY=1/0,a.minZ=1/0,a.maxX=-1/0,a.maxY=-1/0,a.maxZ=-1/0):a={children:o,height:1,leaf:!0,minX:1/0,minY:1/0,minZ:1/0,maxX:-1/0,maxY:-1/0,maxZ:-1/0},a},k=[],allowDistNode=function(o,a){var s=k.pop();return s?(s.dist=o,s.node=a):s={dist:o,node:a},s},isLeaf=function(o){return o.leaf},isLeafChild=function(o,a){return o.leaf},findItem=function(o,a,s){if(!s)return a.indexOf(o);for(var c=0;c<a.length;c++)if(s(o,a[c]))return c;return -1},calcBBox=function(o){distBBox(o,0,o.children.length,o)},distBBox=function(o,a,s,c){var g=c;g?(g.minX=1/0,g.minY=1/0,g.minZ=1/0,g.maxX=-1/0,g.maxY=-1/0,g.maxZ=-1/0):g=allowNode([]);for(var k=a;k<s;k++)extend(g,o.children[k]);return g},extend=function(o,a){return o.minX=Math.min(o.minX,a.minX),o.minY=Math.min(o.minY,a.minY),o.minZ=Math.min(o.minZ,a.minZ),o.maxX=Math.max(o.maxX,a.maxX),o.maxY=Math.max(o.maxY,a.maxY),o.maxZ=Math.max(o.maxZ,a.maxZ),o},bboxVolume=function(o){return(o.maxX-o.minX)*(o.maxY-o.minY)*(o.maxZ-o.minZ)},bboxMargin=function(o){return o.maxX-o.minX+(o.maxY-o.minY)+(o.maxZ-o.minZ)},enlargedVolume=function(o,a){var s=Math.min(o.minX,a.minX),c=Math.min(o.minY,a.minY),g=Math.min(o.minZ,a.minZ);return(Math.max(o.maxX,a.maxX)-s)*(Math.max(o.maxY,a.maxY)-c)*(Math.max(o.maxZ,a.maxZ)-g)},intersectionVolume=function(o,a){var s=Math.max(o.minX,a.minX),c=Math.max(o.minY,a.minY),g=Math.max(o.minZ,a.minZ);return Math.max(0,Math.min(o.maxX,a.maxX)-s)*Math.max(0,Math.min(o.maxY,a.maxY)-c)*Math.max(0,Math.min(o.maxZ,a.maxZ)-g)},contains=function(o,a){return o.minX<=a.minX&&o.minY<=a.minY&&o.minZ<=a.minZ&&a.maxX<=o.maxX&&a.maxY<=o.maxY&&a.maxZ<=o.maxZ};a.intersects=function(o,a){return a.minX<=o.maxX&&a.minY<=o.maxY&&a.minZ<=o.maxZ&&a.maxX>=o.minX&&a.maxY>=o.minY&&a.maxZ>=o.minZ},a.boxRayIntersects=function(o,a,s,c,g,k,A){var x=(o.minX-a)*g,P=(o.maxX-a)*g,w=(o.minY-s)*k,F=(o.maxY-s)*k,R=(o.minZ-c)*A,D=(o.maxZ-c)*A,G=Math.max(0,Math.min(x,P),Math.min(w,F),Math.min(R,D));return Math.min(Math.max(x,P),Math.max(w,F),Math.max(R,D))>=G?G:1/0};var multiSelect=function(o,a,s,g,k){for(var A,x=[a,s];x.length;)(s=x.pop())-(a=x.pop())<=g||(c(o,A=a+Math.ceil((s-a)/g/2)*g,a,s,k),x.push(a,A,A,s))},compareMinX=function(o,a){return o.minX-a.minX},compareMinY=function(o,a){return o.minY-a.minY},compareMinZ=function(o,a){return o.minZ-a.minZ},A=function(){function RBush3D(o){void 0===o&&(o=16),this.maxEntries=Math.max(o,8),this.minEntries=Math.max(4,Math.ceil(.4*this.maxEntries)),this.clear()}return RBush3D.alloc=function(){return this.pool.pop()||new this},RBush3D.free=function(o){o.clear(),this.pool.push(o)},RBush3D.prototype.search=function(o){var s=this.data,c=[];if(!a.intersects(o,s))return c;for(var g=[];s;){for(var k=0,A=s.children.length;k<A;k++){var x=s.children[k];a.intersects(o,x)&&(isLeafChild(s,x)?c.push(x):contains(o,x)?this._all(x,c):g.push(x))}s=g.pop()}return c},RBush3D.prototype.collides=function(o){var s=this.data;if(!a.intersects(o,s))return!1;for(var c=[];s;){for(var g=0,k=s.children.length;g<k;g++){var A=s.children[g];if(a.intersects(o,A)){if(isLeafChild(s,A)||contains(o,A))return!0;c.push(A)}}s=c.pop()}return!1},RBush3D.prototype.raycastInv=function(o,s,c,g,A,x,P){void 0===P&&(P=1/0);var w,F=this.data;if(g===1/0&&A===1/0&&x===1/0||a.boxRayIntersects(F,o,s,c,g,A,x)===1/0)return allowDistNode(1/0,void 0);for(var R=[allowDistNode(0,F)],swap=function(o,a){var s=R[o];R[o]=R[a],R[a]=s},D=P;R.length&&R[0].dist<D;){F=function(){var o=R[0],a=R.length-1;R[0]=R[a],R.length=a;for(var s=0;;){var c=s<<1|1;if(c>=a)break;var g=c+1;if(g<a&&R[g].dist<R[c].dist&&(c=g),R[s].dist<R[c].dist)break;swap(s,c),s=c}return k.push(o),o.node}();for(var G=0,B=F.children.length;G<B;G++){var W=F.children[G],z=a.boxRayIntersects(W,o,s,c,g,A,x);if(isLeafChild(F,W)){if(z<D){if(0===z)return allowDistNode(z,W);D=z,w=W}}else!function(o,a){var s=R.length;for(R.push(allowDistNode(o,a));s>0;){var c=s-1>>1;if(R[c].dist<=R[s].dist)break;swap(s,c),s=c}}(z,W)}}return allowDistNode(D<P?D:1/0,w)},RBush3D.prototype.raycast=function(o,a,s,c,g,k,A){return void 0===A&&(A=1/0),this.raycastInv(o,a,s,1/c,1/g,1/k,A)},RBush3D.prototype.all=function(){return this._all(this.data,[])},RBush3D.prototype.load=function(o){if(!(o&&o.length))return this;if(o.length<this.minEntries){for(var a=0,s=o.length;a<s;a++)this.insert(o[a]);return this}var c=this.build(o.slice(),0,o.length-1,0);if(this.data.children.length){if(this.data.height===c.height)this.splitRoot(this.data,c);else{if(this.data.height<c.height){var g=this.data;this.data=c,c=g}this._insert(c,this.data.height-c.height-1,!0)}}else this.data=c;return this},RBush3D.prototype.insert=function(o){return o&&this._insert(o,this.data.height-1),this},RBush3D.prototype.clear=function(){return this.data&&freeAllNode(this.data),this.data=allowNode([]),this},RBush3D.prototype.remove=function(o,a){if(!o)return this;for(var s,c,g=this.data,k=0,A=!1,x=[],P=[];g||x.length;){if(g||(g=x.pop(),k=P.pop(),c=x[x.length-1],A=!0),isLeaf(g)&&-1!==(s=findItem(o,g.children,a))){g.children.splice(s,1),x.push(g),this.condense(x);break}!A&&!isLeaf(g)&&contains(g,o)?(x.push(g),P.push(k),k=0,c=g,g=g.children[0]):c?(k++,g=c.children[k],A=!1):g=void 0}return this},RBush3D.prototype.toJSON=function(){return this.data},RBush3D.prototype.fromJSON=function(o){return freeAllNode(this.data),this.data=o,this},RBush3D.prototype.build=function(o,a,s,c){var g,k=s-a+1,A=this.maxEntries;if(k<=A)return calcBBox(g=allowNode(o.slice(a,s+1))),g;c||(c=Math.ceil(Math.log(k)/Math.log(A)),A=Math.ceil(k/Math.pow(A,c-1))),(g=allowNode([])).leaf=!1,g.height=c;var x=Math.ceil(k/A),P=x*Math.ceil(Math.pow(A,2/3)),w=x*Math.ceil(Math.pow(A,1/3));multiSelect(o,a,s,w,compareMinX);for(var F=a;F<=s;F+=w){var R=Math.min(F+w-1,s);multiSelect(o,F,R,P,compareMinY);for(var D=F;D<=R;D+=P){var G=Math.min(D+P-1,R);multiSelect(o,D,G,x,compareMinZ);for(var B=D;B<=G;B+=x){var W=Math.min(B+x-1,G);g.children.push(this.build(o,B,W,c-1))}}}return calcBBox(g),g},RBush3D.prototype._all=function(o,a){for(var s=[];o;)isLeaf(o)?a.push.apply(a,o.children):s.push.apply(s,o.children),o=s.pop();return a},RBush3D.prototype.chooseSubtree=function(o,a,s,c){for(;c.push(a),!isLeaf(a)&&c.length-1!==s;){g=k=1/0;for(var g,k,A,x=0,P=a.children.length;x<P;x++){var w=a.children[x],F=bboxVolume(w),R=enlargedVolume(o,w)-F;R<k?(k=R,g=F<g?F:g,A=w):R===k&&F<g&&(g=F,A=w)}a=A||a.children[0]}return a},RBush3D.prototype.split=function(o,a){var s=o[a],c=s.children.length,g=this.minEntries;this.chooseSplitAxis(s,g,c);var k=this.chooseSplitIndex(s,g,c),A=allowNode(s.children.splice(k,s.children.length-k));A.height=s.height,A.leaf=s.leaf,calcBBox(s),calcBBox(A),a?o[a-1].children.push(A):this.splitRoot(s,A)},RBush3D.prototype.splitRoot=function(o,a){this.data=allowNode([o,a]),this.data.height=o.height+1,this.data.leaf=!1,calcBBox(this.data)},RBush3D.prototype.chooseSplitIndex=function(o,a,s){for(var c,g=1/0,k=1/0,A=a;A<=s-a;A++){var x=distBBox(o,0,A),P=distBBox(o,A,s),w=intersectionVolume(x,P),F=bboxVolume(x)+bboxVolume(P);w<g?(g=w,c=A,k=F<k?F:k):w===g&&F<k&&(k=F,c=A)}return c},RBush3D.prototype.chooseSplitAxis=function(o,a,s){var c=this.allDistMargin(o,a,s,compareMinX),g=this.allDistMargin(o,a,s,compareMinY),k=this.allDistMargin(o,a,s,compareMinZ);c<g&&c<k?o.children.sort(compareMinX):g<c&&g<k&&o.children.sort(compareMinY)},RBush3D.prototype.allDistMargin=function(o,a,s,c){o.children.sort(c);for(var g=distBBox(o,0,a),k=distBBox(o,s-a,s),A=bboxMargin(g)+bboxMargin(k),x=a;x<s-a;x++){var P=o.children[x];extend(g,P),A+=bboxMargin(g)}for(var x=s-a-1;x>=a;x--){var P=o.children[x];extend(k,P),A+=bboxMargin(k)}return A},RBush3D.prototype.adjustParentBBoxes=function(o,a,s){for(var c=s;c>=0;c--)extend(a[c],o)},RBush3D.prototype.condense=function(o){for(var a=o.length-1,s=void 0;a>=0;a--)0===o[a].children.length?a>0?((s=o[a-1].children).splice(s.indexOf(o[a]),1),freeNode(o[a])):this.clear():calcBBox(o[a])},RBush3D.prototype._insert=function(o,a,s){var c=[],g=this.chooseSubtree(o,this.data,a,c);for(g.children.push(o),extend(g,o);a>=0;)if(c[a].children.length>this.maxEntries)this.split(c,a),a--;else break;this.adjustParentBBoxes(o,c,a)},RBush3D.pool=[],RBush3D}();a.RBush3D=A},268748:function(o){o.exports=function(){"use strict";function swap(o,a,s){var c=o[a];o[a]=o[s],o[s]=c}function defaultCompare(o,a){return o<a?-1:o>a?1:0}return function(o,a,s,c,g){!function quickselectStep(o,a,s,c,g){for(;c>s;){if(c-s>600){var k=c-s+1,A=a-s+1,x=Math.log(k),P=.5*Math.exp(2*x/3),w=.5*Math.sqrt(x*P*(k-P)/k)*(A-k/2<0?-1:1),F=Math.max(s,Math.floor(a-A*P/k+w)),R=Math.min(c,Math.floor(a+(k-A)*P/k+w));quickselectStep(o,a,F,R,g)}var D=o[a],G=s,B=c;for(swap(o,s,a),g(o[c],D)>0&&swap(o,s,c);G<B;){for(swap(o,G,B),G++,B--;0>g(o[G],D);)G++;for(;g(o[B],D)>0;)B--}0===g(o[s],D)?swap(o,s,B):swap(o,++B,c),B<=a&&(s=B+1),a<=B&&(c=B-1)}}(o,a,s||0,c||o.length-1,g||defaultCompare)}}()},555956:function(o,a){"use strict";var Statistics=function(o,a,s={}){this.data=void 0,this.columns=void 0,this.valueMaps=void 0,this.storedResults=void 0,this.lastUpdated=void 0,this.validScales=["nominal","ordinal","interval","metric"],this.zTable=void 0,this.factorials=[1,1,2,6,24,120,720,5040,40320,362880,3628800,39916800,479001600,6227020800,87178291200,1307674368e3,20922789888e3,355687428096e3,6402373705728e3,0x1b02b9306890000,243290200817664e4,0x46e7261f127a0000],this.defaultOptions={epsilon:1e-5,excludeColumns:["ID","id"],incompleteBetaIterations:40,incompleteGammaIterations:80,maxBarnardsN:200,spougeConstant:40,suppressWarnings:!1,zTableIterations:25},this.init=function(o,a,s={}){for(var c in void 0===o&&this.errorMessage("No data was supplied."),this.defaultOptions){var g="object"==typeof s&&this.has(s,c)&&this.has(this.defaultOptions,c)?s[c]:this.defaultOptions[c];Object.defineProperty(this,c,{value:g,writable:!1})}return void 0!==o&&this.updateData(o,a),this},this.updateData=function(o,a){this.addData(o),"object"==typeof a&&this.assignValueMap(a),o.constructor===Array&&"object"!=typeof a&&(this.errorMessage("It is strongly encouraged to initalise statistics.js with a variable table that defines the scale of measurement of each variable (e.g. nominal, metric.). All variables will be assumed as nominal and subsequent analyses will likely be flawed."),defineColumns.apply(this))},this.addData=function(o){try{let a=typeof o;if(!("string"===a||"object"===a)||null===o)throw"Input variable data is neither an object nor a JSON encoded string. The variable type is "+a+". The data could not be properly imported.";return"string"===a&&(o=JSON.parse(o)),this.data=this.data?this.data.concat(o):o,this.lastUpdated=Date.now(),!0}catch(o){return this.errorMessage(o)}},this.addRow=function(o){if(void 0===o)return this.errorMessage("Add Row: No data was given.");let a=void 0!==this.data?this.data:[];return a.push(o),this.data=a,this.lastUpdated=Date.now(),!0},this.removeRow=function(o,a=!1){if(void 0===o)return this.errorMessage("Remove row: No index was given.");let s=this.data,c=this.has(this.columns,"id")||this.has(this.columns,"ID");if(a&&c){let o=-1;for(;-1===o&&0<s.length;)(this.has(s[0],"id")&&s[0].id===a||this.has(s[0],"ID")&&s[0].ID===a)&&(o=0);s.splice(0,1)}else{if(a&&!c&&this.errorMessage('Remove row: There is no column "id" or "ID". The index '+o+" will be treated as the number of the row, starting at 0."),o>s.length-1)return this.errorMessage("Remove row: The stored data has only "+s.length+" rows and index "+o+" is too large. Indexes start at 0.");s.splice(o,1)}return this.data=s,this.lastUpdated=Date.now(),!0},this.reset=function(){try{return this.data=void 0,this.storedResults=void 0,this.lastUpdated=Date.now(),!0}catch(o){this.errorMessage(o.message)}},this.assignValueMap=function(o){let a={},s={};for(var c in o){if(!this.has(o,c)||this.excludeColumns.indexOf(c)>-1)continue;let g=o[c],k=g,A;if("object"==typeof g&&this.has(g,"scale")&&(this.has(g,"valueMap")&&(A=g.valueMap),k=g.scale),void 0===A&&("nominal"===k||"ordinal"===k)&&(A=this.getUniqueValues(this.data.map(o=>o[c]))),void 0!==A&&(s[c]=A),this.validScales.indexOf(k)>-1)a[c]=k;else{a[c]="nominal";let o='"'+k+'" scale for variable "'+c+'" is invalid. It was assumed as nominal. Valid scales of measurement include: '+this.validScales.join(", ");this.errorMessage(o)}}this.columns=a,this.valueMaps=s,this.sanitizeColumns()};var defineColumns=function(){let o={},a=["th","st","nd","rd"];for(var s=0;s<this.data.length;s++)if("object"!=typeof this.data[s]){let o=s%100,c=s+(a[(o-20)%10]||a[o]||"th");this.errorMessage("The "+c+" row was ignored because it is not an object.")}else for(var c in Object.keys(this.data[s]))!c in o&&(o[c]="nominal");this.columns=o,this.lastUpdated=Date.now()};this.sanitizeColumns=function(){let o=this.columns,a=this.data;for(var s=0;s<a.length;s++){let g=a[s];for(var c in o){let k=g[c],A=k;switch(o[c]){case"metric":case"interval":A=this.isNumeric(k)?k:NaN;break;case"ordinal":if(void 0!==this.valueMaps){let o=this.valueMaps[c];void 0!==o&&(A=o.indexOf(k))}}a[s][c]=A}}this.data=a,this.lastUpdated=Date.now()},this.setScale=function(o,a){return void 0===a?(this.errorMessage("This method needs to be called with valid values for both the variable and the scale of measurement to set."),!1):this.has(this.columns,o)?-1===this.validScales.indexOf(a)?(this.errorMessage('"'+a+'" is not a valid scale of measurement. Valid scales include: '+this.validScales.join(", ")),!1):(this.columns[o]=a,!0):(this.errorMessage('There is no variable "'+o+'" defined.'),!1)},this.getScale=function(o){if(void 0!==o&&this.has(this.columns,o))return this.columns[o]},this.getValueMap=function(o){if(void 0!==o&&this.has(this.columns,o))return this.valueMaps[o]},this.applyValueMap=function(o,a){let s=this.getValueMap(o);if("ordinal"===this.getScale(o)&&void 0!==s)return"undefined"===a&&(a=this.getColumn(o)),a.map(o=>s[o])},this.checkLastUpdated=function(o,a){return!!(""!==o&&this.has(this.columns,o))&&void 0!==o&&void 0!==a&&(void 0===this.storedResults||void 0===this.storedResults[o]||void 0===this.storedResults[o][a]||void 0===this.storedResults[o][a].lastUpdated||this.storedResults[o][a].lastUpdated<this.lastUpdated)},this.updateStatistics=function(o,a,s){if(void 0!==o&&void 0!==a&&void 0!==s){var c={value:s,lastUpdated:Date.now()};void 0===this.storedResults?this.storedResults={column:{parameter:c}}:void 0===this.storedResults[o]?this.storedResults[o]={parameter:c}:this.storedResults[o][a]=c}},this.getStatistics=function(o,a){if(void 0!==o&&void 0!==a&&this.has(this.columns,o)&&void 0!==this.storedResults[o][a].value)return this.storedResults[o][a].value},this.getColumn=function(o){return void 0===o?this.errorMessage("Get column: No column to sort was specified."):this.has(this.columns,o)?this.data.map(a=>a[o]):this.errorMessage('Get column: The column "'+o+'" was not found.')},this.sortColumn=function(o,a="asc"){return void 0===o?this.errorMessage("Sort column: No column to sort was specified."):this.has(this.columns,o)?this.sort(this.getColumn(o),a):this.errorMessage('Sort column: The column "'+o+'" was not found.')},this.sortDataByColumn=function(o,{data:a=this.data,order:s="asc",changeOriginal:c=!1}={}){var g,k;return a!==this.data||void 0!==o&&this.has(this.columns,o)?a===this.data||this.has(a[0],o)?(g=c?a:this.deepCopy(a),k=this,g.sort(function(a,c){return k.isNumeric(a[o])&&k.isNumeric(c[o])?("asc"===s?1:-1)*(a[o]-c[o]):0})):this.errorMessage('Sort data by column: The column "'+o+'" does not exist.'):this.errorMessage("Sort data by column: No column was specified or this column does not exist.")},this.sort=function(o,a="asc"){var s,c;return void 0===o?this.errorMessage("Sort: No values given."):o.constructor!==Array||0===o.length?this.errorMessage("Sort: No array or an empty array of values was given."):(s=this.deepCopy(o),c=this,s.sort((o,s)=>c.isNumeric(o)&&c.isNumeric(s)?("asc"===a?1:-1)*(o-s):0))},this.getUniqueValues=function(o){if(void 0===o)return this.errorMessage("Get unique values: No values given.");let a=this.validateInput(o,"nominal","get unique values");if(!1!==a)return this.sort(a.data.filter((o,s)=>a.data.indexOf(o)===s))},this.reduceToPairs=function(o,a){if(void 0===a||void 0===o)return this.errorMessage("This method requires two variables to be compared.");let s=this.validateInput(o,"nominal");if(!1===s)return;let c=this.validateInput(a,"nominal");if(!1===c)return;let g=s.length>=c.length?s.length:c.length,k=[],A=[],x=[],P="string"==typeof o?o:"first",w="string"==typeof a?a:"second";for(var F=0;F<g;F++){let o=s.data[F],a=c.data[F];if(!isNaN(o)&&!isNaN(a)){k.push(o),A.push(a);let s={};s[P]=o,s[w]=a,x.push(s)}}return{length:k.length,missings:g-k.length,valuesFirst:k,valuesSecond:A,valuesCombined:x}},this.validateInput=function(o,a="metric",s=""){let c={};if("string"!=typeof o&&(o.constructor!==Array||o.constructor===Array&&0==o.length))return this.errorMessage("No properly formatted data was supplied. Specify a column by its name (string) or supply an array of values."),!1;if("string"==typeof o&&""!==o)c.data=this.getColumn(o),c.scale=this.getScale(o),c.length=c.data.length;else{if(o.constructor!==Array||!(o.length>0)||!1===this.validateData(o,a))return!1;c.data=o,c.scale=a,c.length=c.data.length}if(0==c.length)return this.errorMessage("The supplied data or the data of the supplied column contains no values."),!1;if(!isScaleAtLeast.apply(this,[c.scale,a])){let o=this.validScales.slice(this.validScales.indexOf(a)).join(", "),g=""!==s?s.charAt(0).toUpperCase()+s.slice(1):"This statistical method";return g+=" is only defined for these scales of measurement: "+o+". The scale of the supplied data is "+c.scale+".",this.errorMessage(g),!1}return c},this.validateData=function(a,s="metric"){if(void 0===a||o.constructor!==Array)return this.errorMessage("Validate data: Specify an array storing the values to be validated.");if("nominal"===s)return!0;for(var c=0;c<a.length;c++)if(!this.isNumeric(a[c]))return this.errorMessage("Validate data: The supplied data contains non-numeric values: "+a[c]+" at index "+c),!1;return!0},this.isNumeric=function(o){return void 0!==o?!Array.isArray(o)&&!isNaN(parseFloat(o))&&isFinite(o):void 0};var isScaleAtLeast=function(o,a){return this.validScales.indexOf(o)>=this.validScales.indexOf(a)};return this.errorMessage=function(o){if(!this.suppressWarnings)try{throw TypeError("string"==typeof o?o:o.message)}catch(o){console.error("statistics.js: "+o.message)}},this.has=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},this.deepCopy=function(o){let a=Array.isArray(o)?[]:{};for(let s in o){let c=o[s];a[s]="object"==typeof c?this.deepCopy(c):c}return a},Statistics.prototype.assignRanks=function(o,{data:a=this.data,order:s="asc",handleTiedValues:c="mean",returnFrequencies:g=!1}={}){if(void 0===o)return this.errorMessage("Assign ranks: You need to specify a column to be ranked.");let k=this.deepCopy(this.sortDataByColumn(o,{data:a,order:s,changeOriginal:!1})),A={};for(var x=0;x<k.length;x++){let a=k[x][o];A[a]=A[a]?A[a]+1:1}let P=0,w=[];for(var x=0;x<k.length;x++){let a=k[x][o],s=x+1,g="rank-"+o;1===A[a]?P=0:"mean"===c?(P++,s=x+A[a]/2-P+1.5):"random"===c&&(0===w.length&&(w=Array.from(Array(A[a]),(o,a)=>a+x+1)),s=w[Math.floor(Math.random()*w.length)],w.splice(w.indexOf(s),1)),P==A[a]&&(P=0),k[x][g]=s}return g?{data:k,frequencies:A}:k},Statistics.prototype.contingencyTable=function(o,a){if(void 0===a)return this.errorMessage("A contingency table requires two columns to analyze.");if(!this.has(this.columns,o))return this.errorMessage('There is no variable "'+o+'" defined.');if(!this.has(this.columns,a))return this.errorMessage('There is no variable "'+a+'" defined.');let s=this.getScale(o),c=this.getScale(a);if(!("nominal"===s||"ordinal"===s)||!("nominal"===c||"ordinal"===c))return this.errorMessage("Both variables need to be nominal for. They are "+s+" and "+c+".");let g=this.getValueMap(o),k=this.getValueMap(a);if(void 0===g||void 0===k)return this.errorMessage("Contingency table: There are no valid values.");let A={total:{total:0}},x=this.data;for(var P=0;P<x.length;P++){let s=x[P][o],c=x[P][a];void 0===A[s]&&(A[s]={total:0}),A[s][c]=void 0!==A[s][c]?A[s][c]+1:1,A.total[s]=void 0!==A.total[s]?A.total[s]+1:1,A.total[c]=void 0!==A.total[c]?A.total[c]+1:1,A[s].total++,A.total.total++}let w={detailled:A};return g.length<=2&&k.length<=2&&(w.a=A[g[0]][k[0]]||0,w.b=A[g[0]][k[1]]||0,w.c=A[g[1]][k[0]]||0,w.d=A[g[1]][k[1]]||0),w},this.showData=function(o){if("string"==typeof o&&this.has(this.columns,o))"ordinal"===this.getScale(o)?console.log(this.applyValueMap(o)):console.log(this.getColumn(o));else if(void 0===o){let o=this.valueMaps,c=this.data;if(void 0!==o){for(var a in o)if(this.has(o,a)&&void 0!==o[a]&&"ordinal"===this.getScale(a))for(var s=0;s<c.length;s++)c[s][a]=o[a][c[s][a]]}console.table(c)}else console.log(o)},this.scatterPlot=function(o=this.data,{canvas:a=null,xAxis:s=null,yAxis:c=null,width:g=null,height:k=null,dotRadius:A=4,showGrid:x=!1,minNumberXMarks:P=8,minNumberYMarks:w=8,background:F="#FFFFFF",dotColor:R="#000000",gridColor:D="#CCCCCC",axisColor:G="#000000"}={}){if(void 0===o)return this.errorMessage("Scatter plot: No data given.");if(o.constructor!==Array||0===o.length)return this.errorMessage("Scotter plot: Data is not an array or empty.");if(P<=0||w<=0)return this.errorMessage("Scotter plot: The number of line to plot must be larger than 0.");let B=typeof o[0];if("object"===B&&(!s||!c))return this.errorMessage("Scatter plot: The variables for the x and y axes need to be supplied.");let W={},z=1/0,V=-1/0,U=1/0,K=-1/0;for(var Y=0;Y<o.length;Y++){let a=[],g,k;if("number"===B||o[0].constructor===Array){if(!this.isNumeric(o[Y]))continue;g=Y,k=o[Y]}else if("object"===B){if(!this.has(o[Y],s)||!this.has(o[Y],c)||!this.isNumeric(o[Y][s])||!this.isNumeric(o[Y][c]))continue;g=o[Y][s],k=o[Y][c]}this.has(W,g)&&(a=W[g]),a.push(k),W[g]=a,g>V&&(V=g),g<z&&(z=g),k>K&&(K=k),k<U&&(U=k)}z/V<.1&&(z=0),U/K<.1&&(U=0),null===a&&(a=document.createElement("canvas"));let $=a.getContext("2d"),X=g?.1*g:.1*(V-z);for(var Z in(g=(g?g-2*X:V-z)+2*A)<400&&(g=400),(k=(k?k-2*X:K-U)+2*A)<400&&(k=400),X<40&&(X=40),a.width=g,a.height=k,$.fillStyle="transparent",$.fillRect(0,0,g,k),$.fillStyle=R,W)for(var J=0;J<W[Z].length;J++){let o=(Z-z)*(g-A)/(V-z),a=k-(W[Z][J]-U)*(k-A)/(K-U)-A;$.fillRect(o,a,A,A)}let drawLine=function(o,a,s,c,g,k=G){o.strokeStyle=k,o.beginPath(),o.moveTo(Math.floor(a),Math.floor(s)),o.lineTo(Math.floor(c),Math.floor(g)),o.stroke(),o.strokeStyle=G},ee=document.createElement("canvas"),et=ee.getContext("2d"),er=g+2*X-2*A,en=k+2*X-2*A;ee.width=er,ee.height=en,et.fillStyle=F,et.fillRect(0,0,er,en),et.fillStyle=G,et.font=.2*X+"px Arial",et.textAlign="center",et.textBaseline="middle";let ei=Math.round((V-z)/P),eo=ei>=1?Math.pow(10,parseInt(ei).toString().length-1):.01,ea=0,es=0,el=0;if((ei=Math.round(ei/eo)*eo)>0)for(var Y=0;Y<P||ea<=V&&es<=g-2*X;Y++)(es=.5*X+((ea=Math.round(z/eo)*eo+Y*ei)-z)*(g-A)/(V-z))>er-.5*X||es<.5*X||(drawLine(et,es,en-.4*X,es,en-.6*X),x&&drawLine(et,es,en-.6*X,es,.5*X,D),et.fillText(ea,es,en-.2*X));let eu=(K-U)/w,ed=eu>=1?Math.pow(10,parseInt(eu).toString().length-1):.01;if(ea=0,(eu=Math.round(eu/ed)*ed)>0)for(var Y=0;Y<w||ea<=K&&el<=k-2*X;Y++)(el=1.5*X-2*A+k-((ea=Math.round(U/ed)*ed+Y*eu)-U)*(k-A)/(K-U))>en-.5*X||el<.5*X||(drawLine(et,.4*X,el,.6*X,el),x&&drawLine(et,.6*X,el,g+X-2*A,el,D),et.fillText(ea,.2*X,el));return drawLine(et,.5*X,en-.5*X,er-X,en-.5*X),drawLine(et,.5*X,en-.5*X,.5*X,.5*X),et.drawImage(a,.5*X-.5*A,1.5*X-1.5*A),$.drawImage(ee,0,0,g,k),a},this.init(o,a,s)};o.exports&&(a=o.exports=Statistics),a.Statistics=Statistics,Statistics.prototype.mean=function(o){return void 0!==o?this.arithmeticMean(o):void 0},Statistics.prototype.arithmeticMean=function(o){if(void 0===o)return this.errorMessage("Arithmetic mean: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"mean"))return this.getStatistics(o,"mean");let a=this.validateInput(o,"interval","arithmetic mean");if(!1===a)return;let s=this.sumExact(a.data)/a.length;return"string"==typeof o&&this.updateStatistics(o,"mean",s),s},Statistics.prototype.geometricMean=function(o){if(void 0===o)return this.errorMessage("Geometric mean: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"geometricMean"))return this.getStatistics(o,"geometricMean");let a=this.validateInput(o,"metric","geometric mean");if(!1===a)return;let s,c=!1;return s=a.data.reduce((o,a)=>a>0?o*a:(c=!0,o),1),!c&&a.length>0?s=Math.pow(s,1/a.length):(this.errorMessage("Geometric mean is not defined because the data contains non-positive values."),s=void 0),"string"==typeof o&&this.updateStatistics(o,"geometricMean",s),s},Statistics.prototype.harmonicMean=function(o){if(void 0===o)return this.errorMessage("Harmonic mean: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"harmonicMean"))return this.getStatistics(o,"harmonicMean");let a=this.validateInput(o,"metric","harmonicMean");if(!1===a)return;let s=!1,c=!1,g=a.data.reduce((o,a)=>a<0?(c=!0,0):0!==a?o+1/a:(s=!0,0),0);return g=s?0:a.length/g,g=c?void 0:g,"string"==typeof o&&this.updateStatistics(o,"harmonicMean",g),g},Statistics.prototype.rootMeanSquare=function(o){if(void 0===o)return this.errorMessage("Root mean square: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"rootMeanSquare"))return this.getStatistics(o,"rootMeanSquare");let a=this.validateInput(o,"interval","root mean square");if(!1===a)return;let s=Math.sqrt(a.data.reduce((o,a)=>o+a*a,0)/a.length);return"string"==typeof o&&this.updateStatistics(o,"rootMeanSquare",s),s},Statistics.prototype.cubicMean=function(o){if(void 0===o)return this.errorMessage("Cubic mean: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"cubicMean"))return this.getStatistics(o,"cubicMean");let a=this.validateInput(o,"interval","cubic mean");if(!1===a)return;let s=a.data.reduce((o,a)=>o+a*a*a,0);return s=s>=0&&a.length>0?Math.pow(s/a.length,1/3):void 0,"string"==typeof o&&this.updateStatistics(o,"cubicMean",s),s},Statistics.prototype.winsorisedMean=function(o,a=.2){if(void 0===o)return this.errorMessage("Winsorised mean: No data was supplied.");if(a<0||a>.5)return this.errorMessage("winsorisedMean should be called with a percentage value within the range of [0, 0.5].");if(.5===a)return this.median(o);let s=this.validateInput(o,"interval","Winsorised (truncated) mean");if(!1===s)return;let c=Math.floor(s.length*a),g=this.sort(s.data).slice(c,s.length-c);return g=Array(c).fill(g[0]).concat(g).concat(Array(c).fill(g[g.length-1])),this.sumExact(g)/s.length},Statistics.prototype.gastwirthCohenMean=function(o,{alpha:a=.25,lambda:s=.25}={}){if(void 0===o)return this.errorMessage("Gastwirth-Cohen mean: No data was supplied.");if(!1===this.validateInput(o,"ordinal","Gastwirth-Cohen Mean"))return;if(!this.isNumeric(a)||a<0||a>.5)return this.errorMessage("Gastwirth-Cohen mean should be called with an alpha value within the range of [0, 0.5].");if(!this.isNumeric(s)||s<0||s>.5)return this.errorMessage("Gastwirth-Cohen mean should be called with a lambda value within the range of [0, 0.5].");let c=this.quantile(o,a),g=this.quantile(o,1-a),k=this.median(o),A;return void 0!==c&&void 0!==g&&void 0!==k&&(A=s*(c+g)+(1-2*s)*k),A},Statistics.prototype.midRange=function(o){if(void 0===o)return this.errorMessage("Mid-range: No data was supplied.");if(!1===this.validateInput(o,"interval","mid-range"))return;let a=this.minimum(o),s=this.maximum(o);return void 0!==a&&void 0!==s?.5*(a+s):void 0},Statistics.prototype.median=function(o){if(void 0===o)return this.errorMessage("Median: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"median"))return this.getStatistics(o,"median");let a=this.quantile(o,.5);return"string"==typeof o&&this.updateStatistics(o,"median",a),a},Statistics.prototype.mode=function(o){if(void 0===o)return this.errorMessage("Mode: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"mode"))return this.getStatistics(o,"mode");let a=this.validateInput(o,"nominal","mode");if(!1===a)return;let s=a.data,c=[],g=[s[0]],k=1;for(var A=1;A<a.length;A++){let o=s[A];c[o]=null==c[o]?1:c[o]+1,c[o]>k?(g=[o],k=c[o]):c[o]===k&&g.push(o)}return 1===g.length&&(g=g[0]),"string"==typeof o&&this.updateStatistics(o,"mode",g),g},Statistics.prototype.minimum=function(o){if(void 0===o)return this.errorMessage("Minimum: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"minimum"))return this.getStatistics(o,"minimum");let a=this.validateInput(o,"ordinal","minimum");if(!1===a)return;let s=1/0,c=a.length;for(;c--;)a.data[c]<s&&(s=a.data[c]);return"string"==typeof o&&this.updateStatistics(o,"minimum",s),s},Statistics.prototype.maximum=function(o){if(void 0===o)return this.errorMessage("Maximum: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"maximum"))return this.getStatistics(o,"maximum");let a=this.validateInput(o,"ordinal","maximum");if(!1===a)return;let s=-1/0,c=a.length;for(;c--;)a.data[c]>s&&(s=a.data[c]);return"string"==typeof o&&this.updateStatistics(o,"maximum",s),s},Statistics.prototype.range=function(o){let a,s;if(void 0===o)return this.errorMessage("Range: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"range"))return this.getStatistics(o,"range");if("string"==typeof o&&"nominal"===this.getScale(o)){if(!1===(a=this.validateInput(o,"nominal","range")))return;s=this.getUniqueValues(a.data)}else{if(!1===(a=this.validateInput(o,"ordinal","range")))return;let c=this.sort(a.data);s=c[a.length-1]-c[0]}return"string"==typeof o&&this.updateStatistics(o,"range",s),s},Statistics.prototype.variance=function(o,a=!0){if(void 0===o)return this.errorMessage("Variance: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"variance"))return this.getStatistics(o,"variance");let s=this.validateInput(o,"interval","variance");if(!1===s)return;if(s.length<2)return this.errorMessage("The data supplied to compute variance needs to contain at least two datasets.");let c=0;if(this.isNumeric(a)){for(var g=0;g<s.length;g++)c+=Math.pow(a-s.data[g],2);c/=s.length-1}else{let o=0,k=0;for(var g=0;g<s.length;g++){o+=1;let a=s.data[g]-k;k+=a/o,c+=a*(s.data[g]-k)}a&&o>1?c/=o-1:!a&&o>0?c/=o:c=void 0}return"string"==typeof o&&this.updateStatistics(o,"variance",c),c},Statistics.prototype.standardDeviation=function(o,a=!0){if(void 0===o)return this.errorMessage("Standard deviation: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"standardDeviation"))return this.getStatistics(o,"standardDeviation");let s=this.validateInput(o,"interval","standard deviation");if(!1===s)return;if(s.length<2)return this.errorMessage("The data supplied to compute standardDeviation needs to contain at least two datasets.");let c=Math.sqrt(this.variance(o,a));return"string"==typeof o&&this.updateStatistics(o,"standardDeviation",c),c},Statistics.prototype.coefficientOfVariation=function(o,a){if(void 0===o)return this.errorMessage("Coefficient of variation: No data was supplied.");let s=this.validateInput(o,"interval","coefficient of variation");if(!1===s)return;let c=this.standardDeviation(s.data),g=void 0===a?this.mean(s.data):a;return void 0!==c&&void 0!==g&&0!==g?c/g:void 0},Statistics.prototype.indexOfDispersion=function(o,a){if(void 0===o)return this.errorMessage("Index of dispersion: No data was supplied.");let s=this.validateInput(o,"interval","coefficient of variation");if(!1===s)return;let c=this.variance(s.data),g=void 0===a?this.mean(s.data):a;return void 0!==c&&void 0!==g&&0!==g?c/g:void 0},Statistics.prototype.geometricStandardDeviation=function(o){if(void 0===o)return this.errorMessage("Geomtric standard deviation: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"geometricStandardDeviation"))return this.getStatistics(o,"geometricStandardDeviation");let a=this.validateInput(o,"interval","geometric standard deviation");if(!1===a)return;let s=a.length,c=this.geometricMean(o),g=0,k=!1;for(var A=0;A<s;A++)a.data[A]<=0?k=!0:g+=Math.pow(Math.log(a.data[A]/c),2);return g=k?void 0:Math.exp(Math.sqrt(g/s)),"string"==typeof o&&this.updateStatistics(o,"geometricStandardDeviation",g),g},Statistics.prototype.medianAbsoluteDeviation=function(o){if(void 0===o)return this.errorMessage("Median absolute deviation: No data was supplied.");let a=this.validateInput(o,"interval","median absolute deviation");if(!1===a)return;let s=a.data,c=this.median(s);if(void 0!==c)return s=s.map(o=>Math.abs(o-c)),this.median(s)},Statistics.prototype.cumulativeFrequency=function(o,a){if(void 0===o)return this.errorMessage("Cumulative frequency: No data was supplied.");if(void 0===a||!this.isNumeric(a)){this.errorMessage("You need to specify a boundary for the cumulative frequency analysis that is either an integer or a floating point number.");return}let s=this.validateInput(o,"ordinal","cumulative frequency analysis");if(!1===s)return;let c=this.sort(s.data),g=0;for(;a>=c[g];)g++;return g},Statistics.prototype.frequencies=function(o){if(void 0===o)return this.errorMessage("Frequencies: No data was supplied.");let a=this.validateInput(o,"nominal","frequencies");if(!1===a)return;let s=a.data,c={},g=[];for(var k=0;k<a.length;k++){let o=s[k];null==c[o]?(g.push(o),c[o]=1):c[o]++}return(g=g.sort((o,a)=>c[a]-c[o])).map(o=>({value:o,absolute:c[o],relative:c[o]/a.length}))},Statistics.prototype.quantile=function(o,a=.5){if(void 0===o)return this.errorMessage("Quantile: No data was supplied.");if(!this.isNumeric(a)||a<0||a>1)return this.errorMessage("Quantiles should be called with a percentage value within the range of [0, 1].");let s=this.validateInput(o,"ordinal","quantile");if(!1===s)return;let c=a*s.length,g=this.sort(s.data);return c%1==0?.5*(g[c]+g[c-1]):g[Math.floor(c)]},Statistics.prototype.quartiles=function(o){if(void 0===o)return this.errorMessage("Quartiles: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"quartiles"))return this.getStatistics(o,"quartiles");let a=[this.quantile(o,.25),this.quantile(o,.75)];return void 0!==a[0]&&void 0!==a[1]?(this.updateStatistics(o,"quartiles",a),a):void 0},Statistics.prototype.interQuartileRange=function(o){if(void 0===o)return this.errorMessage("Interquartile range: No data was supplied.");let a=this.validateInput(o,"interval","interquartile range");if(!1===a)return;let s=this.quartiles(a.data);return void 0!==s?s[1]-s[0]:void 0},Statistics.prototype.skewness=function(o,a=!1){if(void 0===o)return this.errorMessage("Skewness: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"skewness"))return this.getStatistics(o,"skewness");let s=this.validateInput(o,"ordinal","skewness");if(!1===s||s.length<2)return;let c=this.mean(o),g=this.standardDeviation(o,!1),k=0;for(var A=0;A<s.length;A++)k+=Math.pow(s.data[A]-c,3);let x=k/Math.pow(g,3);return x*=a?s.length/((s.length-1)*(s.length-2)):1/s.length,"string"==typeof o&&this.updateStatistics(o,"skewness",x),x},Statistics.prototype.kurtosis=function(o){if(void 0===o)return this.errorMessage("Kurtosis: No data was supplied.");if("string"==typeof o&&!1===this.checkLastUpdated(o,"kurtosis"))return this.getStatistics(o,"kurtosis");let a=this.validateInput(o,"ordinal","kurtosis");if(!1===a||a.length<2)return;let s=this.mean(o),c=this.standardDeviation(o),g=0;for(var k=0;k<a.length;k++)g+=Math.pow(a.data[k]-s,4);let A=g/(a.length*Math.pow(c,4));return"string"==typeof o&&this.updateStatistics(o,"kurtosis",A),A},Statistics.prototype.excessKurtosis=function(o){if(void 0===o)return this.errorMessage("Excess kurtosis: No data was supplied.");let a=this.kurtosis(o);return void 0!==a?a-3:void 0},Statistics.prototype.sum=function(o){return void 0===o?this.errorMessage("Sum: No data given."):("string"==typeof o&&this.has(this.columns,o)&&(o=this.getColumn(o)),0!=o.length)?o.reduce((o,a)=>this.isNumeric(a)?o+a:o,0):void 0},Statistics.prototype.sumExact=function(o){if(void 0===o)return this.errorMessage("Sum exact: No data given.");if("string"==typeof o&&this.has(this.columns,o)&&(o=this.getColumn(o)),0==o.length)return;let a=0,s=0;for(var c=0;c<o.length;c++){let g=this.isNumeric(o[c])?o[c]:0,k=a+(g-=s);s=k-a-g,a=k}return a},Statistics.prototype.product=function(o){return void 0===o?this.errorMessage("Product: No data given."):("string"==typeof o&&this.has(this.columns,o)&&(o=this.getColumn(o)),0===o.length)?1:o.reduce((o,a)=>this.isNumeric(a)?o*a:o,1)},Statistics.prototype.factorial=function(o){return this.isNumeric(o)&&!Number.isInteger(o)?this.gamma(o):void 0!==this.factorials[o]?this.factorials[o]:this.computeFactorial(o)},Statistics.prototype.computeFactorial=function(o){if(void 0===o||!this.isNumeric(o)||o<0)return;if(void 0!==this.factorials[o])return this.factorials[o];if(!Number.isInteger(o))return this.gamma(o);let a=1,s=1;for(;o>s;)a*=++s,void 0===this.factorials[s]&&(this.factorials[s]=a);return a},Statistics.prototype.binomialCoefficient=function(o=1,a=1){if(o<a||a<0)return this.errorMessage("The binomial coefficient is only defined for n and k with n ≥ k ≥ 0. N is "+o+" and k is "+a+".");if(!Number.isInteger(o)||!Number.isInteger(a))return this.errorMessage("The binomial coefficient is only defined for integers n and k.");let s=[];for(var c=1;c<=a;c++)s.push((o+1-c)/c);return this.product(s)},Statistics.prototype.gamma=function(o,a=!1){if(void 0!==o&&this.isNumeric(o)&&!(o<0))return Number.isInteger(o)&&void 0!==this.factorials[o-1]?this.factorials[o-1]:a?this.gammaSpouge(o):this.gammaStirling(o)},Statistics.prototype.gammaSpouge=function(o){if(void 0===o||!this.isNumeric(o)||o<0)return;if(Number.isInteger(o)&&void 0!==this.factorials[o-1])return this.factorials[o-1];let a=this.spougeConstant,s=Math.pow(o+a,o+.5),c=1,g=Math.sqrt(2*Math.PI);s*=Math.exp(-o-a),s/=o;for(var k=1;k<a;k++)g+=Math.pow(a-k,k-.5)*Math.exp(a-k)/c/++o,c*=-k;return g*s},Statistics.prototype.gammaStirling=function(o){if(void 0===o||!this.isNumeric(o)||o<0)return;if(Number.isInteger(o)&&void 0!==this.factorials[o-1])return this.factorials[o-1];let a=1/(10*o);return Math.pow(a=((a=1/(12*o-a))+o)*.36787944117144233,o)*Math.sqrt(6.283185307179586/o)},Statistics.prototype.incompleteGamma=function(o,a){if(void 0===a)return this.errorMessage("The incomplete lower gamma function is only defined for two numeric variables s and x.");if(!this.isNumeric(o)||!this.isNumeric(a))return this.errorMessage("The incomplete lower gamma function is only defined for numeric variables s and x.");if(a<0)return this.errorMessage("The incomplete lower gamma function is defined for x > 0.");let s=this.incompleteGammaIterations,c=1;for(var g=0;g<s;g++){let k=s-g;c=a+(k-o)/(1+k/c)}return this.gamma(o,!0)-Math.exp(-a)*Math.pow(a,o)/c},Statistics.prototype.regularisedGamma=function(o,a){return void 0===a?this.errorMessage("The regularised lower gamma function is only defined for two numeric variables s and x."):this.isNumeric(o)&&this.isNumeric(a)?a<0?this.errorMessage("The regularised lower gamma function is defined for x > 0."):this.incompleteGamma(o,a)/this.gamma(o,!0):this.errorMessage("The regularised lower gamma function is only defined for numeric variables s and x.")},Statistics.prototype.beta=function(o,a){return void 0===a?this.errorMessage("The beta function is only defined for two numeric variables a and b."):this.isNumeric(o)&&this.isNumeric(a)?o<=0||a<=0?this.errorMessage("The beta function is defined for a and b with a > 0 and b > 0."):Number.isInteger(o)&&Number.isInteger(a)&&o>0&&a>0?this.factorial(o-1)*this.factorial(a-1)/this.factorial(o+a-1):this.gamma(o,!0)*this.gamma(a,!0)/this.gamma(o+a,!0):this.errorMessage("The beta function is only defined for numeric variables a and b.")},Statistics.prototype.incompleteBeta=function(o,a,s){if(void 0===s)return this.errorMessage("The incomplete beta function is only defined for two numeric variables a and b.");if(!this.isNumeric(o)||!this.isNumeric(a)||!this.isNumeric(s))return this.errorMessage("The incomplete beta function is only defined for numeric variables x, a and b.");if(o<0||o>1)return this.errorMessage("The incomplete beta function is defined for x ≥ 0 and x ≦ 1.");if(a<=0||s<=0)return this.errorMessage("The incomplete beta function is defined for a and b with a > 0 and b > 0.");if(1==o)return this.beta(a,s);let c=Math.pow(o,a)*Math.pow(1-o,s)/a,g=this.incompleteBetaIterations,k=1;for(var A=0;A<g;A++)k=1+function(o,a,s,c){if(o%2==0){let g=.5*o;return g*(s-g)*c/((a+2*g-1)*(a+2*g))}{let g=.5*o-.5;return-(a+g)*(a+s+g)*c/((a+2*g)*(a+2*g+1))}}(g-A,a,s,o)/k;return c/k},Statistics.prototype.regularisedBeta=function(o,a,s){if(void 0===s)return this.errorMessage("The regularised beta function is only defined for two numeric variables a and b.");if(!this.isNumeric(o)||!this.isNumeric(a)||!this.isNumeric(s))return this.errorMessage("The regularised beta function is only defined for numeric variables x, a and b.");if(o>1||o<0)return this.errorMessage("The regularised beta function is defined for x ≥ 0 and x ≦ 1.");if(a<=0||s<=0)return this.errorMessage("The regularised beta function is defined for a and b with a > 0 and b > 0.");if(!Number.isInteger(a)||!Number.isInteger(s))return this.incompleteBeta(o,a,s)/this.beta(a,s);let c=this.epsilon+1,g=a,k=0;for(;c>=this.epsilon;)k+=c=this.binomialCoefficient(s+g-1,g)*Math.pow(o,g),g++;return k*Math.pow(1-o,s)},Statistics.prototype.covariance=function(o,a,s=!0){if(void 0===a)return this.errorMessage("Covariance requires two variables to be compared.");let c=this.validateInput(o,"interval","covariance");if(!1===c)return;let g=this.validateInput(a,"interval","covariance");if(!1===g)return;let k=this.reduceToPairs(c.data,g.data);if(0===k.length)return;let A=this.mean(k.valuesFirst),x=this.mean(k.valuesSecond),P=0;for(var w=0;w<k.length;w++)P+=(k.valuesFirst[w]-A)*(k.valuesSecond[w]-x);return s&&k.length>1?P/=k.length-1:!s&&k.length>0?P/=k.length:P=void 0,{covariance:P,missings:k.missings}},Statistics.prototype.correlationCoefficient=function(o,a){if(void 0===a)return this.errorMessage("Pearson correlation coefficient requires two variables to be compared.");let s=this.validateInput(o,"interval","Pearson correlation coefficient");if(!1===s)return;let c=this.validateInput(a,"interval","Pearson correlation coefficient");if(!1===c)return;let g=s.length>=c.length?s.length:c.length,k=s.data,A=c.data,x=[],P=0,w=0;for(var F=0;F<g;F++){let o=k[F],a=A[F];isNaN(o)||isNaN(a)||(P+=o,w+=a,x.push([o,a]))}let R=g-x.length;if(0===(g=x.length))return;P/=g,w/=g;let D=0,G=0,B=0;for(var F=0;F<g;F++){let o=x[F][0]-P,a=x[F][1]-w;D+=o*a,G+=o*o,B+=a*a}return{correlationCoefficient:G>0&&B>0?D/Math.sqrt(G*B):0,missings:R}},Statistics.prototype.spearmansRho=function(o,a,s=!1){if(void 0===a)return this.errorMessage("Spearman's Rho requires two variables to be compared.");if(!1===this.validateInput(o,"ordinal","Spearman's Rho")||!1===this.validateInput(a,"ordinal","Spearman's Rho"))return;let c=this.reduceToPairs(o,a),g=c.length;if(0===g)return;let k=this.assignRanks(o,{data:c.valuesCombined,returnFrequencies:!0,order:"desc"}),A=k.frequencies,x=(k=this.assignRanks(a,{data:k.data,returnFrequencies:!0,order:"desc"})).frequencies,P=6*(k=k.data).reduce((s,c)=>s+Math.pow(c["rank-"+o]-c["rank-"+a],2),0);if(s){let o=Object.values(A).reduce((o,a)=>o+Math.pow(a,3)-a),a=Object.values(x).reduce((o,a)=>o+Math.pow(a,3)-a);P=(Math.pow(g,3)-g-.5*o-.5*a-P)/Math.sqrt((Math.pow(g,3)-g-o)*(Math.pow(g,3)-g-a))}else P=1-P/(Math.pow(g,3)-g);let w=g-2,F=Math.sqrt((w-1)/1.06)*this.fisherTransformation(P),R=1-this.normalCumulativeValue(Math.abs(F)),D=P*Math.sqrt(w/(1-P*P)),G=1-this.studentsTCumulativeValue(Math.abs(D),w);return{rho:P,significanceNormal:{zScore:F,pOneTailed:R,pTwoTailed:2*R},significanceStudent:{degreesOfFreedom:w,tStatistic:D,pOneTailed:G,pTwoTailed:2*G},missings:c.missings}},Statistics.prototype.kendallsTau=function(o,a){if(void 0===a)return this.errorMessage("Kendall's Tau requires two columns to analyze.");if(!1===this.validateInput(o,"ordinal","Kendall's Tau")||!1===this.validateInput(a,"ordinal","Kendall's Tau"))return;let s=this.reduceToPairs(o,a),c=s.length,g=s.valuesCombined,k=0,A=0,x={},P={};for(var w=0;w<c-1;w++)for(var F=w+1;F<c;F++){let s=g[w][o],c=g[F][o],R=g[w][a],D=g[F][a];s===c?R===D||(x[R]=this.has(x,R)?x[R]+1:1):R===D?P[R]=this.has(P,R)?P[R]+1:1:Math.sign(s-c)===Math.sign(R-D)?k+=1:A+=1}let R=k-A,D=Object.keys(x).length+Object.keys(P).length===0?2*R/(c*(c-1)):void 0,G=3*R/Math.sqrt(.5*c*(c-1)*(2*c+5)),B=this.normalCumulativeValue(-Math.abs(G)),W=2<s.length?2:s.length,z=D,V=G,U=B;if(void 0===D){z=R/Math.sqrt((k+A+Object.keys(x).length)*(k+A+Object.keys(P).length));let o=0,a=0,s=0,g=0,w=0;for(var K in x)o+=K*(K-1)*(2*K+5),s+=K*(K-1),g+=K*(K-1)*(K-2);for(var K in P)a+=K*(K-1)*(2*K+5),g+=K*(K-1)/(2*c*(c-1)),w+=K*(K-1)*(K-2)/(9*c*(c-1)*(c-2));V=R/Math.sqrt(V=((V=c*(c-1)*(2*c+5))-o-a)/18+s*g+0*w),U=this.normalCumulativeValue(-Math.abs(V))}let Y=void 0!==D?{tauB:D,z:G,pOneTailed:B,pTwoTailed:2*B}:{tauB:z,z:V,pOneTailed:U,pTwoTailed:2*U};return{a:void 0!==D?{tauA:D,z:G,pOneTailed:B,pTwoTailed:2*B}:void 0,b:Y,c:{tauC:2*W*R/(c*c*(W-1))},missings:s.missings}},Statistics.prototype.goodmanKruskalsGamma=function(o,a){if(void 0===a)return this.errorMessage("Goodman and Kruskal's Gamma requires two columns to analyze.");if(!1===this.validateInput(o,"ordinal","Goodman and Kruskal's Gamma")||!1===this.validateInput(a,"ordinal","Goodman and Kruskal's Gamma"))return;let s=this.reduceToPairs(o,a),c=s.valuesCombined,g=s.length,k=0,A=0;for(var x=0;x<g-1;x++)for(var P=x+1;P<g;P++){let s=c[x][o],g=c[P][o],w=c[x][a],F=c[P][a];s!==g&&w!==F&&(Math.sign(s-g)===Math.sign(w-F)?k+=1:A+=1)}let w=(k-A)/(k+A),F=w*Math.sqrt((k+A)/(g*(1-w*w))),R=1-this.studentsTCumulativeValue(Math.abs(F),g-2);return{gamma:w,tStatistic:F,pOneTailed:R,pTwoTailed:2*R,missings:s.missings}},Statistics.prototype.fisherTransformation=function(o){return void 0===o||!this.isNumeric(o)||o<-1||o>1?this.errorMessage("Fisher transformation is only defined for a Pearson correlation coefficient within the interval of [-1, 1]."):Math.atanh(o)||.5*Math.log((1+o)/(1-o))},Statistics.prototype.linearRegression=function(o,a){if(void 0===a)return this.errorMessage("Linear regression requires two columns to compare.");let s=this.validateInput(o,"interval","linear regression");if(!1===s)return;let c=this.validateInput(a,"interval","linear regression");if(!1===c)return;let g=this.reduceToPairs(s.data,c.data),k=g.valuesFirst,A=g.valuesSecond,x=(g.missings,g.length);if(0===x)return;let P=this.mean(k),w=this.mean(A),F=0,R=0,D=0;for(var G=0;G<x;G++){let o=k[G]-P,a=A[G]-w;D+=o*a,F+=o*o,R+=a*a}if(0===F||0===R)return;let B=D/F,W=D/R,z=D/Math.sqrt(F*R),V=z*z,U=180*Math.acos(z)/Math.PI;return U>90&&(U=180-U),{regressionFirst:{beta1:w-B*P,beta2:B},regressionSecond:{beta1:P-W*w,beta2:W},coefficientOfDetermination:V,coefficientOfDeterminationCorrected:x>2?1-(1-V)*(x-1)/(x-2):void 0,correlationCoefficient:z,phi:U}},Statistics.prototype.normalProbabilityDensity=function(o,a=0,s=1){return void 0===o?this.errorMessage("Normal probability density: no x is given."):s<=0?this.errorMessage("Normal probability density: variance must be larger than 0."):Math.exp(-Math.pow(o-a,2)/(2*s))/Math.sqrt(2*Math.PI*s)},Statistics.prototype.normalDistribution=function(o=0,a=1){if(a<=0)return this.errorMessage("Normal distribution: variance must be larger than 0.");let s=0,c=1,g={};for(;c>=this.epsilon&&!((c=this.normalProbabilityDensity(o+s,o,a))<this.epsilon);)g[(o+s).toFixed(2)]=c,g[(o-s).toFixed(2)]=c,s+=.01;return g},Statistics.prototype.normalCumulativeValue=function(o){if(void 0===o)return this.errorMessage("Normal cumulative value: no z is given.");let a=o,s=o;for(var c=1;c<this.zTableIterations;c++)s*=o*o/(2*c+1),a+=s;return Math.round((.5+a/Math.sqrt(2*Math.PI)*Math.exp(-.5*o*o))*1e5)/1e5},Statistics.prototype.normalCumulativeDistribution=function(){let o=this.zTable;if(void 0===o){o={};for(var a=0;a<=4.09;a+=.01)o[(Math.round(100*a)/100).toFixed(2)]=this.normalCumulativeValue(a);this.zTable=o}return o},Statistics.prototype.binomialProbabilityMass=function(o,a=10,s=.5){return void 0===o?this.errorMessage("Binomial probability mass: the required argument k was not given."):o<0||!Number.isInteger(o)?this.errorMessage("Binomial probability mass: k must be a non-negative integer."):a<0||!Number.isInteger(a)?this.errorMessage("Binomial probability mass: n must be a non-negative integer."):s<0||s>1?this.errorMessage("Binomial probability mass: The probability must lie within the range of [0, 1]."):this.binomialCoefficient(a,o)*Math.pow(s,o)*Math.pow(1-s,a-o)},Statistics.prototype.binomialDistribution=function(o=10,a=.5){if(o<0||!Number.isInteger(o))return this.errorMessage("Binomial distribution: n must be a non-negative integer.");if(a<0||a>1)return this.errorMessage("Binomial distribution: The probability must lie within the range of [0, 1].");let s=0,c=0,g=[],k=1;for(;s<=o;)g.push(c=k*Math.pow(a,s)*Math.pow(1-a,o-s)),k=k*(o+1-++s)/s;return g},Statistics.prototype.binomialCumulativeValue=function(o,a=10,s=.5){return void 0===o?this.errorMessage("Binomial cumulative distribution value: the required argument k was not given."):o<0||!Number.isInteger(o)?this.errorMessage("Binomial cumulative distribution value: k must be a non-negative integer."):a<0||!Number.isInteger(a)?this.errorMessage("Binomial cumulative distribution value: n must be a non-negative integer."):s<0||s>1?this.errorMessage("Binomial cumulative distribution value: The probability must lie within the range of [0, 1]."):this.regularisedBeta(1-s,a-o,o+1)},Statistics.prototype.binomialCumulativeDistribution=function(o=10,a=.5){if(o<0||!Number.isInteger(o))return this.errorMessage("Binomial cumulative distribution: n must be a non-negative integer.");if(a<0||a>1)return this.errorMessage("Binomial cumulative distribution: The probability must lie within the range of [0, 1].");let s=this.binomialDistribution(o,a),c=0;return s.map(function(o){return c=this.sumExact([c,o])},this)},Statistics.prototype.poissonProbabilityMass=function(o,a=1){if(void 0===o||!Number.isInteger(o))return this.errorMessage("Poisson probability mass: the required argument k must be an integer.");if(o<0||a<=0)return this.errorMessage("Poisson probability mass: Both k and lambda must be larger than 0.");if(!(o>10))return Math.exp(-a)*Math.pow(a,o)/this.factorial(o);{let c=1;for(var s=1;s<=o;s++)c*=a*Math.exp(-a/o)/s;return c}},Statistics.prototype.poissonDistribution=function(o=1){if(o<=0)return this.errorMessage("Poisson distribution: Lambda must be larger than 0.");let a=0,s=0,c=[];for(;s<1-this.epsilon;){let g=this.poissonProbabilityMass(a,o);c.push(g),s+=g,a++}return c},Statistics.prototype.poissonCumulativeValue=function(o,a=1){if(void 0===o||!Number.isInteger(o))return this.errorMessage("Poisson cumulative distribution: The number of cumulative events k must be supplied.");if(o<0||a<=0)return this.errorMessage("Poisson distribution: Both k and lambda must be larger than 0.");let s=this.poissonDistribution(a);return o<s.length-1?this.sumExact(s.slice(0,o+1)):1},Statistics.prototype.poissonCumulativeDistribution=function(o=1){if(o<=0)return this.errorMessage("Poisson distribution: lambda must be larger than 0.");let a=this.poissonDistribution(o),s=0;return a.map(function(o){return s=this.sumExact([s,o])},this)},Statistics.prototype.studentsTProbabilityDensity=function(o,a){return void 0===a?this.errorMessage("Student's t-distribution probability density: no value for degrees of freedom (df) given."):a<=0?this.errorMessage("Student's t-distribution probability density: degrees of freedom (df) must be larger than 0."):Math.pow(1+o*o/a,-.5*(a+1))/(Math.sqrt(a)*this.beta(.5,.5*a))},Statistics.prototype.studentsTDistribution=function(o){if(void 0===o)return this.errorMessage("Student's t-distribution: no value for degrees of freedom (df) given.");if(o<=0)return this.errorMessage("Student's t-distribution: degrees of freedom (df) must be larger than 0.");let a=0,s=1,c={};for(;s>=this.epsilon&&!((s=this.studentsTProbabilityDensity(a,o))<this.epsilon);)c[a.toFixed(2)]=s,c[(-a).toFixed(2)]=s,a+=.01;return c},Statistics.prototype.studentsTCumulativeValue=function(o,a){return void 0===a?this.errorMessage("Student's cumulative t-distribution value: no value for degrees of freedom (df) given."):a<=0?this.errorMessage("Student's cumulative t-distribution value: degrees of freedom (df) must be larger than 0."):o<=0?.5*this.regularisedBeta(a/(o*o+a),.5*a,.5):.5+.5*this.regularisedBeta(o*o/(o*o+a),.5,.5*a)},Statistics.prototype.studentsTCumulativeDistribution=function(o){if(void 0===o)return this.errorMessage("Student's cumulative t-distribution: no value for degrees of freedom (df) given.");if(o<=0)return this.errorMessage("Student's cumulative t-distribution: degrees of freedom (df) must be larger than 0.");let a=0,s=0,c=-.1,g={};for(;s<=1-this.epsilon&&!(c>=(s=this.studentsTCumulativeValue(a,o)));)g[a.toFixed(2)]=s,g[(-a).toFixed(2)]=s,c=s,a+=.01;return g},Statistics.prototype.chiSquaredProbabilityDensity=function(o,a){return void 0===a?this.errorMessage("Chi squared distribution probability density: no value for degrees of freedom (df) given."):a<=0?this.errorMessage("Chi squared distribution probability density: degrees of freedom (df) must be larger than 0."):o<=0?0:Math.pow(o,.5*a-1)*Math.exp(-.5*o)/(Math.pow(2,.5*a)*this.gamma(.5*a,!0))},Statistics.prototype.chiSquaredDistribution=function(o){if(void 0===o)return this.errorMessage("Chi squared distribution: no value for degrees of freedom (df) given.");if(o<=0)return this.errorMessage("Chi squared distribution: degrees of freedom (df) must be larger than 0.");let a=.01,s=1,c={"0.00":0};for(;(o<=2&&s>=this.epsilon||o>2&&a<=o-2||o>2&&s>=this.epsilon)&&(!((s=this.chiSquaredProbabilityDensity(a,o))<this.epsilon)||!(a>=o-2)||!(o>2));)c[a.toFixed(2)]=s,a+=.01;return c},Statistics.prototype.chiSquaredCumulativeValue=function(o,a){return void 0===a?this.errorMessage("Chi squared cumulative distribution value: no value for degrees of freedom (df) given."):a<=0?this.errorMessage("Chi squared cumulative distribution value: degrees of freedom (df) must be larger than 0."):o<=0?0:this.regularisedGamma(.5*a,.5*o)},Statistics.prototype.chiSquaredCumulativeDistribution=function(o){if(void 0===o)return this.errorMessage("Chi squared cumulative distribution: no value for degrees of freedom (df) given.");if(o<=0)return this.errorMessage("Chi squared cumulative distribution: degrees of freedom (df) must be larger than 0.");let a=.01,s=0,c={"0.00":0};for(;s<=1-this.epsilon&&!((s=this.chiSquaredCumulativeValue(a,o))>=1-this.epsilon);)s>0&&(c[a.toFixed(2)]=s),a+=.01;return c},Statistics.prototype.barnardsTest=function(o,a){if(void 0===a)return this.errorMessage("Barnard's test: No data was supplied.");let s=this.contingencyTable(o,a,"Barnard's test");if(void 0===s)return;let{a:c,b:g,c:k,d:A}=s,x=c+g+k+A;if(x>this.maxBarnardsN)return this.errorMessage("Barnard's test is a resource-intensive method, relative to the total number of datasets to analyze. There are "+x+" datasets in the supplied data, exceeding the maxinum of "+this.maxBarnardsN+'. You can change this number by changing the "maxBarnardsN" option (be cautious).');var P=(c+g)/x;P=P*(1-P)*(1/(c+k)+1/(g+A)),isNaN(P=(g/(g+A)-c/(c+k))/Math.sqrt(P))&&(P=0);let w=[];for(var F=0;F<1;F=this.sumExact([F,.001])){let o=0;for(var R=0;R<=c+k;R++)for(var D=0;D<=g+A;D++){let a=(R+D)/x;if(a=a*(1-a)*(1/(c+k)+1/(g+A)),!isNaN(a=(R/(c+k)-D/(g+A))/Math.sqrt(a))&&Math.abs(a)>=Math.abs(P)){let a=this.binomialCoefficient(c+k,R)*this.binomialCoefficient(g+A,D);a*=Math.pow(F,R+D)*Math.pow(1-F,x-R-D),o+=isNaN(a)?0:a}}w.push({nuisance:F,significance:o})}return{wald:P,nuisance:(w=this.sortDataByColumn("significance",{data:w,order:"desc"}))[0].nuisance,pOneTailed:.5*w[0].significance,pTwoTailed:w[0].significance}},Statistics.prototype.binomialTest=function(o,a,s=.5){if(void 0===a)return this.errorMessage("Binomial test requires the data to test and a value which is hypotethised to be observed with a probability of alpha.");if(s<0||s>1)return this.errorMessage("Binomial test is only defined for probabilities alpha with alpha ≥ 0 and alpha ≦ 1.");let c=this.getScale(o);if("interval"===c||"metric"===c)return this.errorMessage("Binomial test is only defined for data of nominal or ordinal dichotomic scale.");let g=this.validateInput(o,"nominal","binomial test");if(!1===g)return;let k=this.getUniqueValues(g.data);if(k.length>2)return this.errorMessage("Binomial test is only defined for dichotomic data. The supplied data has "+k.length+" unique values.");if(2===k.length&&0>k.indexOf(a))return this.errorMessage('The value "'+a+'" was not found in the supplied data.');let A=g.data.filter(function(o){return o===a}).length,x=this.binomialProbabilityMass(A,g.length,s),P=this.binomialCumulativeValue(A-1,g.length,s),w=1-P-x;return{pExactly:x,pFewer:P,pAtMost:P+x,pMore:w,pAtLeast:w+x}},Statistics.prototype.signTest=function(o,a){if(void 0===a)return this.errorMessage("Sign test: No data was supplied.");let s=this.validateInput(o,"ordinal","sign test"),c=this.validateInput(a,"ordinal","sign test");if(!1===s||!1===c||0===s.length||0===c.length)return;let g=this.reduceToPairs(s.data,c.data),k=(g.missings,g.length),A=g.valuesFirst,x=g.valuesSecond,P=0;for(var w=0;w<k;w++)A[w]>x[w]&&(P+=1);let F=this.binomialProbabilityMass(P,k),R=this.binomialCumulativeValue(P-1,k),D=1-R-F;return{positives:P,pExactly:F,pFewer:R,pAtMost:R+F,pMore:D,pAtLeast:D+F}},Statistics.prototype.fishersExactTest=function(o,a){if(void 0===a)return this.errorMessage("Fisher's exact test requires two columns to analyze.");let s=this.contingencyTable(o,a,"Fisher's exact test");if(void 0===s)return;let{a:c,b:g,c:k,d:A}=s;return this.binomialCoefficient(c+g,c)*this.binomialCoefficient(k+A,k)/this.binomialCoefficient(c+g+k+A,c+k)},Statistics.prototype.mannWhitneyU=function(o,a){if(void 0===a)return this.errorMessage("Mann-Whitney-U test requires two columns to analyze.");let s=this.validateInput(o,"nominal","Mann-Whitney-U test"),c=this.validateInput(a,"ordinal","Mann-Whitney-U test");if(!1===s||!1===c||0===s.length||0===c.length)return;this.sort(c.data);let g=this.getUniqueValues(s.data);if(2!==g.length)return this.errorMessage('The Mann-Whitney-U test requires the independent variable to have exactly two unique values. Variable "'+independentValue+'" has '+g.length+" different values: "+s.data.join(", "));let k=this.assignRanks(a),A=k.reduce((s,c)=>c[o]===g[0]?s+c["rank-"+a]:s,0),x=k.reduce((a,s)=>s[o]===g[0]?a+1:a,0),P=k.reduce((s,c)=>c[o]===g[1]?s+c["rank-"+a]:s,0),w=k.reduce((a,s)=>s[o]===g[1]?a+1:a,0),F=Math.min(x*(.5*x+w+.5)-A,w*(.5*w+x+.5)-P),R=(F-.5*x*w)/Math.sqrt(x*w*(x+w+1)/12),D=1-this.normalCumulativeValue(Math.abs(R));return{MannWhitneyU:F,zScore:R,pOneTailed:D,pTwoTailed:2*D}},Statistics.prototype.chiSquaredTest=function(o,a){let s;if(void 0===a)return this.errorMessage("Chi Squared Test: You need to specify two variables, either of nominal or ordinal scale.");let c=this.getScale(o),g=this.getScale(a);if("ordinal"!==c&&"nominal"!==c||"ordinal"!==g&&"nominal"!==g)return this.errorMessage("Chi Squared Test: Both variables need to be either of nominal or ordinal scale.");let k=this.contingencyTable(o,a);if(void 0===k)return this.errorMessage("Chi Squared Test: Failed to create a contingency table. Please make sure your data is prepared correctly.");let A=(k=k.detailled).total.total,x=0,P=Object.keys(k).length-1;for(var w in P=(P-1)*(Object.keys(k.total).length-P-2),k)if(this.has(k,w)&&"total"!==w){let o=k[w].total;for(var F in k[w])if(this.has(k[w],F)&&"total"!==F){let a=o*k.total[F]/A;x+=Math.pow(k[w][F]-a,2)/a}}return s=x<0||P<1?0:1-this.chiSquaredCumulativeValue(x,P),{PearsonChiSquared:x,degreesOfFreedom:P,significance:s}},Statistics.prototype.studentsTTestOneSample=function(o,a){if(void 0===a||!this.isNumeric(a))return this.errorMessage("Student's t-test (one sample) requires data and the mean for which the null hypothesis should hold true.");let s=this.validateInput(o,"interval","student's t-test (one sample)");if(!1===s||0===s.length)return;let c=this.mean(s.data),g=this.standardDeviation(s.data),k=Math.sqrt(s.length)*(c-a)/g,A=s.length-1,x=this.studentsTCumulativeValue(Math.abs(k),A);return x>.5&&(x=1-x),{tStatistic:k,degreesOfFreedom:A,pOneSided:x,pTwoSided:2*x}},Statistics.prototype.studentsTTestTwoSamples=function(o,a,{nullHypothesisDifference:s=0,dependent:c=!1}={}){if(void 0===a)return this.errorMessage("Student's t-test (two sample) requires data for two columns and the difference of their means for which the null hypothesis should hold true.");let g=this.validateInput(o,"interval","student's t-test (two sample)"),k=this.validateInput(a,"interval","student's t-test (two sample)");if(!1===g||!1===k)return;let A=g.length,x=k.length,P={},w,F;if(0===A||0===x)return;if(c){let o=this.reduceToPairs(g.data,k.data),a=o.valuesFirst,c=o.valuesSecond,x=0,D=0;for(var R=0;R<o.length;R++)D+=a[R]-c[R];D/=o.length;for(var R=0;R<o.length;R++)x+=Math.pow(a[R]-c[R]-D,2);P={tStatistic:w=Math.sqrt(A)*(D-s)/(x=Math.sqrt(x/(o.length-1))),degreesOfFreedom:F=o.length-1,missings:o.missings}}else P={tStatistic:w=(this.mean(g.data)-this.mean(k.data)-s)/Math.sqrt(((A-1)*this.variance(g.data)+(x-1)*this.variance(k.data))/(A+x-2))*Math.sqrt(A*x/(A+x)),degreesOfFreedom:F=A+x-2};let D=this.studentsTCumulativeValue(w,F);return D>.5&&(D=1-D),P.pOneSided=D,P.pTwoSided=2*D,P},Statistics.prototype.gaussianError=function(o){if(void 0===o||!this.isNumeric(o))return this.errorMessage("Gaussian Error Function: No valid value for x supplied. X needs to be numeric.");let a=1/(1+.5*Math.abs(o)),s=-o*o-1.26551223+1.00002368*a+.37409196*a*a+.09678418*Math.pow(a,3)-.18628806*Math.pow(a,4)+.27886807*Math.pow(a,5)-1.13520398*Math.pow(a,6)+1.48851587*Math.pow(a,7)-.82215223*Math.pow(a,8)+.17087277*Math.pow(a,9);return s=Math.exp(s)*a,o>=0?1-s:s-1},Statistics.prototype.inverseGaussianError=function(o){if(void 0===o||!this.isNumeric(o))return this.errorMessage("Inverse Gaussian Error Function: No valid value for x supplied. X needs to be numeric.");if(o>1)return this.errorMessage("Inverse Gaussian Error Function: x can not be larger than 1.");if(o<-1)return this.errorMessage("Inverse Gaussian Error Function: x can not be smaller than -1.");var a,s=-Math.log((1-o)*(1+o));return s<5?(s-=2.5,a=Number(343273939e-15)+Number(281022636e-16)*s,a=Number(-.0000035233877)+a*s,a=1.50140941+(a=.246640727+(a=-.00417768164+(a=-.00125372503+(a=21858087e-11+(a=Number(-.00000439150654)+a*s)*s)*s)*s)*s)*s):a=2.83297682+(a=1.00167406+(a=.00943887047+(a=-.0076224613+(a=.00573950773+(a=-.00367342844+(a=.00134934322+(a=100950558e-12-200214257e-12*(s=Math.sqrt(s)-3))*s)*s)*s)*s)*s)*s)*s,(a*o).toFixed(7)},Statistics.prototype.probit=function(o){return void 0!==o&&this.isNumeric(o)?o<0||o>1?this.errorMessage("Probit is only defined for quantiles p with 1 ≥ p ≥ 0."):0===o?-1/0:1===o?1/0:Math.sqrt(2)*this.inverseGaussianError(2*o-1):this.errorMessage("Probit: No valid value for quantile supplied. quantile needs to be numeric.")},Statistics.prototype.fisherYatesShuffle=function(o,a=Math.random){if(void 0===o)return this.errorMessage("Fisher-Yates shuffle: No data given.");let s=this.validateInput(o,"nominal","");if(!1===s)return;let c=s.data,g=s.length,k,A;for(;g;)A=Math.floor(a()*g--),k=c[g],c[g]=c[A],c[A]=k;return c},Statistics.prototype.xorshift=function(o,a=0){if(void 0===o||o.constructor!==Array||4!==o.length)return this.errorMessage("Xorshift needs to be seeded with an array consisting of four numbers.");if(!Number.isInteger(a)||a<0)return this.errorMessage("Xorshift: startIndex must be a non-negative integer.");let s=0,c=4,g=new Uint32Array(64);g[0]=o[0],g[1]=o[1],g[2]=o[2],g[3]=o[3];let bufferFlood=function(o,a,s){for(var c=a;c<s;c++){let a=(o[0]^o[0]<<11)>>>0;o[0]=o[1],o[1]=o[2],o[2]=o[3],o[3]=((o[3]^o[3]>>>19)>>>0^(a^a>>>8)>>>0)>>>0,o[c]=o[3]}return o};this.next=function(o=!0){let a=g[c];return s+=1,c++>=64&&(c=4,bufferFlood(g,4,64)),o?a/4294967296:a},g=bufferFlood(g,4,64);for(var k=0;k<a;k++)this.next()},Statistics.prototype.boxMuller=function(o=0,a=1,{randomSourceA:s=Math.random,randomSourceB:c=Math.random}={}){let g=0,k=0,A=0,x=0;do g=s(),A+=1;while((g<=0||g>=1)&&A<50);do k=c(),x+=1;while((k<=0||k>=1)&&x<50);for(;g<=0||g>=1;)g=Math.random();for(;k<=0||k>=1;)k=Math.random();return Math.sqrt(-2*Math.log(g))*Math.cos(2*Math.PI*k)*a+o},Statistics.prototype.ziggurat=function(o=0,a=1){let s=123456789,c=[128],g=[128],k=[128],residueVariator=function(o,a){let s,A;for(;;){if(s=o*c[a],0===a){for(s=-(.29047645161474317*Math.log(uniformInteger())),A=-Math.log(uniformInteger());A+A<s*s;)s=-(.29047645161474317*Math.log(uniformInteger())),A=-Math.log(uniformInteger());return o>0?3.442619855899+s:-3.442619855899-s}if(g[a]+uniformInteger()*(g[a-1]-g[a])<Math.exp(-.5*s*s))return s;if(a=127&(o=generateInteger()),Math.abs(o)<k[a])return o*c[a]}},generateInteger=function(){let o=s,a=s;return a^=a<<13,a^=a>>>17,a^=a<<5,s=a,o+a|0},uniformInteger=function(){return .5*(1+-(generateInteger()/2147483648))};(function(){s^=new Date().getTime();let o=3.442619855899,a=3.442619855899,A=.00991256303526217/Math.exp(-5.925815736115027);k[0]=Math.floor(2147483648*o/A),k[1]=0,c[0]=A/2147483648,c[127]=o/2147483648,g[0]=1,g[127]=Math.exp(-.5*o*o);for(var x=126;x>=1;x--)o=Math.sqrt(-2*Math.log(.00991256303526217/o+Math.exp(-.5*o*o))),k[x+1]=Math.floor(2147483648*o/a),a=o,g[x]=Math.exp(-.5*o*o),c[x]=o/2147483648})(),this.next=function(){let s=generateInteger(),g=127&s;return(Math.abs(s)<k[g]?s*c[g]:residueVariator(s,g))*a+o}}},658637:function(o,a,s){"use strict";s.d(a,{B:function(){return HTTPError},Z:function(){return apiFetch}});var c=s(298784),g=s(459025),k=s(784200);let A=["redirect_to","spoof"];async function authFetch(o,a={}){a.headers=a.headers||{};let{loginUrl:s,invalidateCache:c,redirectOnUnauthorized:g}=a;delete a.loginUrl,delete a.invalidateCache,delete a.redirectOnUnauthorized,c&&(a.cache="reload");let k=await fetch(o,a);if(k&&401===k.status&&g){let o=s||"/login",a={redirect_url:window.location.pathname+window.location.search,clear:"1"},c=new URL(window.location.href,window.location.origin);Object.assign(a,Object.fromEntries(Object.entries(c.searchParams).filter(([o])=>A.includes(o))));let g=new URL(o,window.location.origin);Object.assign(g.searchParams,a),window.location.replace(g.toString());return}return k}let HTTPError=class HTTPError extends Error{constructor({url:o,text:a,status:s,response:c,userErrorMessage:g}){super(a),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userErrorMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.url=o,this.response=c,this.status=s,this.userErrorMessage=g}};function shouldFormatJSON(o){return(o.headers.get("content-type")||"").startsWith("application/json")}let x=k.ZP.object({error:k.ZP.string(),status_code:k.ZP.number()});async function apiFetch(o,a={}){let s=window.location.href;s.match(/\/corp($|\/)/g)&&(a.loginUrl="/corp/login"),a.headers=a.headers||{},a.headers["X-CSRF-Token"]=g.get("_csrf")??"blank",!a.body||a.body instanceof FormData||a.headers["Content-Type"]||(a.body=JSON.stringify(a.body),a.headers["Content-Type"]="application/json");let k=new URL(o,window.location.origin);a.query&&!c.isEmpty(a.query)&&Object.assign(k.searchParams,a.query),delete a.query;let A=a.userErrorMessage;delete a.userErrorMessage;let P=k.toString(),w=await authFetch(P,a);if(!w.ok&&!a.allowedStatusCodes?.includes(w.status)){let o,a;if(shouldFormatJSON(w))try{o=await w.json()}catch(o){}if(o){let a=x.safeParse(o);if(a.success)throw new HTTPError({url:P,text:a.data.error,status:w.status,response:o,userErrorMessage:A})}else a=await w.text();throw new HTTPError({url:P,text:a||w.statusText,status:w.status,response:o,userErrorMessage:A})}return a.binary?w.blob():shouldFormatJSON(w)?w.json():w.text()}},867881:function(o,a,s){"use strict";s.d(a,{d:function(){return F},f:function(){return M}});var c=s(827378),g=s(262506),k=s(955098),A=s(34945),x=s(506463),P=s(851858);let w=(0,c.createContext)(null);function M(){let[o,a]=(0,c.useState)([]);return[o.length>0?o.join(" "):void 0,(0,c.useMemo)(()=>function(o){let s=(0,P.z)(o=>(a(a=>[...a,o]),()=>a(a=>{let s=a.slice(),c=s.indexOf(o);return -1!==c&&s.splice(c,1),s}))),g=(0,c.useMemo)(()=>({register:s,slot:o.slot,name:o.name,props:o.props}),[s,o.slot,o.name,o.props]);return c.createElement(w.Provider,{value:g},o.children)},[a])]}let F=Object.assign((0,k.yV)(function(o,a){let s=(0,g.M)(),{id:P=`headlessui-description-${s}`,...F}=o,R=function f(){let o=(0,c.useContext)(w);if(null===o){let o=Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(o,f),o}return o}(),D=(0,x.T)(a);(0,A.e)(()=>R.register(P),[P,R.register]);let G={ref:D,...R.props,id:P};return(0,k.sY)({ourProps:G,theirProps:F,slot:R.slot||{},defaultTag:"p",name:R.name||"Description"})}),{})},601076:function(o,a,s){"use strict";s.d(a,{O:function(){return E}});var c=s(827378),g=s(729238);function E(o,a,s,k){let A=(0,g.E)(s);(0,c.useEffect)(()=>{function r(o){A.current(o)}return(o=null!=o?o:window).addEventListener(a,r,k),()=>o.removeEventListener(a,r,k)},[o,a,k])}},580318:function(o,a,s){"use strict";s.d(a,{N:function(){return A},l:function(){return n}});var c,g=s(827378),k=s(729238),A=((c=A||{})[c.Forwards=0]="Forwards",c[c.Backwards=1]="Backwards",c);function n(){var o;let a,s=(0,g.useRef)(0);return o="keydown",a=(0,k.E)(o=>{"Tab"===o.key&&(s.current=o.shiftKey?1:0)}),(0,g.useEffect)(()=>{function t(o){a.current(o)}return window.addEventListener(o,t,!0),()=>window.removeEventListener(o,t,!0)},[o,!0]),s}},534946:function(o,a,s){"use strict";s.d(a,{q:function(){return m}});var c=s(827378),g=s(851858);function m(o,a){let s=(0,c.useRef)([]),k=(0,g.z)(o);(0,c.useEffect)(()=>{let o=[...s.current];for(let[c,g]of a.entries())if(s.current[c]!==g){let c=k(a,o);return s.current=a,c}},[k,...a])}},681966:function(o,a,s){"use strict";function t(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function n(){return t()||/Android/gi.test(window.navigator.userAgent)}s.d(a,{gn:function(){return t},tq:function(){return n}})},696491:function(o,a,s){"use strict";s.d(a,{h:function(){return useQueries}});var c=s(827378),g=s(219526),k=s(503174),A=s(897178),x=s(272057),P=s(252623);let QueriesObserver=class QueriesObserver extends P.l{constructor(o,a){super(),this.client=o,this.queries=[],this.result=[],this.observers=[],this.observersMap={},a&&this.setQueries(a)}onSubscribe(){1===this.listeners.length&&this.observers.forEach(o=>{o.subscribe(a=>{this.onUpdate(o,a)})})}onUnsubscribe(){this.listeners.length||this.destroy()}destroy(){this.listeners=[],this.observers.forEach(o=>{o.destroy()})}setQueries(o,a){this.queries=o,A.V.batch(()=>{let o=this.observers,s=this.findMatchingObservers(this.queries);s.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions,a));let c=s.map(o=>o.observer),g=Object.fromEntries(c.map(o=>[o.options.queryHash,o])),A=c.map(o=>o.getCurrentResult()),x=c.some((a,s)=>a!==o[s]);(o.length!==c.length||x)&&(this.observers=c,this.observersMap=g,this.result=A,this.hasListeners()&&((0,k.e5)(o,c).forEach(o=>{o.destroy()}),(0,k.e5)(c,o).forEach(o=>{o.subscribe(a=>{this.onUpdate(o,a)})}),this.notify()))})}getCurrentResult(){return this.result}getQueries(){return this.observers.map(o=>o.getCurrentQuery())}getObservers(){return this.observers}getOptimisticResult(o){return this.findMatchingObservers(o).map(o=>o.observer.getOptimisticResult(o.defaultedQueryOptions))}findMatchingObservers(o){let a=this.observers,s=o.map(o=>this.client.defaultQueryOptions(o)),c=s.flatMap(o=>{let s=a.find(a=>a.options.queryHash===o.queryHash);return null!=s?[{defaultedQueryOptions:o,observer:s}]:[]}),g=c.map(o=>o.defaultedQueryOptions.queryHash),k=s.filter(o=>!g.includes(o.queryHash)),A=a.filter(o=>!c.some(a=>a.observer===o)),getObserver=o=>{let a=this.client.defaultQueryOptions(o),s=this.observersMap[a.queryHash];return null!=s?s:new x.z(this.client,a)},P=k.map((o,a)=>{if(o.keepPreviousData){let s=A[a];if(void 0!==s)return{defaultedQueryOptions:o,observer:s}}return{defaultedQueryOptions:o,observer:getObserver(o)}});return c.concat(P).sort((o,a)=>s.indexOf(o.defaultedQueryOptions)-s.indexOf(a.defaultedQueryOptions))}onUpdate(o,a){let s=this.observers.indexOf(o);-1!==s&&(this.result=(0,k.Rc)(this.result,s,a),this.notify())}notify(){A.V.batch(()=>{this.listeners.forEach(o=>{o(this.result)})})}};var w=s(594977),F=s(909320),R=s(252574),D=s(432929),G=s(66480);function useQueries({queries:o,context:a}){let s=(0,w.NL)({context:a}),k=(0,F.S)(),x=c.useMemo(()=>o.map(o=>{let a=s.defaultQueryOptions(o);return a._optimisticResults=k?"isRestoring":"optimistic",a}),[o,s,k]),[P]=c.useState(()=>new QueriesObserver(s,x)),B=P.getOptimisticResult(x);(0,g.$)(c.useCallback(o=>k?()=>void 0:P.subscribe(A.V.batchCalls(o)),[P,k]),()=>P.getCurrentResult(),()=>P.getCurrentResult()),c.useEffect(()=>{P.setQueries(x,{listeners:!1})},[x,P]);let W=(0,R._)();x.forEach(o=>{(0,D.pf)(o,W),(0,G.Fb)(o)}),(0,D.JN)(W);let z=B.some((o,a)=>(0,G.SB)(x[a],o,k)),V=z?B.flatMap((o,a)=>{let s=x[a],c=P.getObservers()[a];if(s&&c){if((0,G.SB)(s,o,k))return(0,G.j8)(s,c,W);(0,G.Z$)(o,k)&&(0,G.j8)(s,c,W)}return[]}):[];if(V.length>0)throw Promise.all(V);let U=B.find((o,a)=>{var s,c;return(0,D.KJ)({result:o,errorResetBoundary:W,useErrorBoundary:null!=(s=null==(c=x[a])?void 0:c.useErrorBoundary)&&s,query:P.getQueries()[a]})});if(null!=U&&U.error)throw U.error;return B}},986910:function(o,a,s){"use strict";s.d(a,{Am:function(){return Q},Ix:function(){return P}});var c=s(827378),g=s(138944);let u=o=>"number"==typeof o&&!isNaN(o),d=o=>"string"==typeof o,p=o=>"function"==typeof o,m=o=>d(o)||p(o)?o:null,f=o=>(0,c.isValidElement)(o)||d(o)||p(o)||u(o);function h(o){let{enter:a,exit:s,appendPosition:g=!1,collapse:k=!0,collapseDuration:A=300}=o;return function(o){let{children:x,position:P,preventExitTransition:w,done:F,nodeRef:R,isIn:D}=o,G=g?`${a}--${P}`:a,B=g?`${s}--${P}`:s,W=(0,c.useRef)(0);return(0,c.useLayoutEffect)(()=>{let o=R.current,a=G.split(" "),n=s=>{s.target===R.current&&(o.dispatchEvent(new Event("d")),o.removeEventListener("animationend",n),o.removeEventListener("animationcancel",n),0===W.current&&"animationcancel"!==s.type&&o.classList.remove(...a))};o.classList.add(...a),o.addEventListener("animationend",n),o.addEventListener("animationcancel",n)},[]),(0,c.useEffect)(()=>{let o=R.current,e=()=>{o.removeEventListener("animationend",e),k?function(o,a,s){void 0===s&&(s=300);let{scrollHeight:c,style:g}=o;requestAnimationFrame(()=>{g.minHeight="initial",g.height=c+"px",g.transition=`all ${s}ms`,requestAnimationFrame(()=>{g.height="0",g.padding="0",g.margin="0",setTimeout(a,s)})})}(o,F,A):F()};D||(w?e():(W.current=1,o.className+=` ${B}`,o.addEventListener("animationend",e)))},[D]),c.createElement(c.Fragment,null,x)}}function y(o,a){return{content:o.content,containerId:o.props.containerId,id:o.props.toastId,theme:o.props.theme,type:o.props.type,data:o.props.data||{},isLoading:o.props.isLoading,icon:o.props.icon,status:a}}let k={list:new Map,emitQueue:new Map,on(o,a){return this.list.has(o)||this.list.set(o,[]),this.list.get(o).push(a),this},off(o,a){if(a){let s=this.list.get(o).filter(o=>o!==a);return this.list.set(o,s),this}return this.list.delete(o),this},cancelEmit(o){let a=this.emitQueue.get(o);return a&&(a.forEach(clearTimeout),this.emitQueue.delete(o)),this},emit(o){this.list.has(o)&&this.list.get(o).forEach(a=>{let s=setTimeout(()=>{a(...[].slice.call(arguments,1))},0);this.emitQueue.has(o)||this.emitQueue.set(o,[]),this.emitQueue.get(o).push(s)})}},T=o=>{let{theme:a,type:s,...g}=o;return c.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===a?"currentColor":`var(--toastify-icon-color-${s})`,...g})},A={info:function(o){return c.createElement(T,{...o},c.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(o){return c.createElement(T,{...o},c.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(o){return c.createElement(T,{...o},c.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(o){return c.createElement(T,{...o},c.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return c.createElement("div",{className:"Toastify__spinner"})}};function I(o){return o.targetTouches&&o.targetTouches.length>=1?o.targetTouches[0].clientX:o.clientX}function b(o){return o.targetTouches&&o.targetTouches.length>=1?o.targetTouches[0].clientY:o.clientY}function L(o){let{closeToast:a,theme:s,ariaLabel:g="close"}=o;return c.createElement("button",{className:`Toastify__close-button Toastify__close-button--${s}`,type:"button",onClick:o=>{o.stopPropagation(),a(o)},"aria-label":g},c.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},c.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function O(o){let{delay:a,isRunning:s,closeToast:k,type:A="default",hide:x,className:P,style:w,controlledProgress:F,progress:R,rtl:D,isIn:G,theme:B}=o,W=x||F&&0===R,z={...w,animationDuration:`${a}ms`,animationPlayState:s?"running":"paused",opacity:W?0:1};F&&(z.transform=`scaleX(${R})`);let V=(0,g.default)("Toastify__progress-bar",F?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${B}`,`Toastify__progress-bar--${A}`,{"Toastify__progress-bar--rtl":D}),U=p(P)?P({rtl:D,type:A,defaultClassName:V}):(0,g.default)(V,P);return c.createElement("div",{role:"progressbar","aria-hidden":W?"true":"false","aria-label":"notification timer",className:U,style:z,[F&&R>=1?"onTransitionEnd":"onAnimationEnd"]:F&&R<1?null:()=>{G&&k()}})}let N=o=>{let{isRunning:a,preventExitTransition:s,toastRef:k,eventHandlers:A}=function(o){let[a,s]=(0,c.useState)(!1),[g,k]=(0,c.useState)(!1),A=(0,c.useRef)(null),x=(0,c.useRef)({start:0,x:0,y:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,boundingRect:null,didMove:!1}).current,P=(0,c.useRef)(o),{autoClose:w,pauseOnHover:F,closeToast:R,onClick:D,closeOnClick:G}=o;function v(a){if(o.draggable){"touchstart"===a.nativeEvent.type&&a.nativeEvent.preventDefault(),x.didMove=!1,document.addEventListener("mousemove",_),document.addEventListener("mouseup",L),document.addEventListener("touchmove",_),document.addEventListener("touchend",L);let s=A.current;x.canCloseOnClick=!0,x.canDrag=!0,x.boundingRect=s.getBoundingClientRect(),s.style.transition="",x.x=I(a.nativeEvent),x.y=b(a.nativeEvent),"x"===o.draggableDirection?(x.start=x.x,x.removalDistance=s.offsetWidth*(o.draggablePercent/100)):(x.start=x.y,x.removalDistance=s.offsetHeight*(80===o.draggablePercent?1.5*o.draggablePercent:o.draggablePercent/100))}}function T(a){if(x.boundingRect){let{top:s,bottom:c,left:g,right:k}=x.boundingRect;"touchend"!==a.nativeEvent.type&&o.pauseOnHover&&x.x>=g&&x.x<=k&&x.y>=s&&x.y<=c?C():E()}}function E(){s(!0)}function C(){s(!1)}function _(s){let c=A.current;x.canDrag&&c&&(x.didMove=!0,a&&C(),x.x=I(s),x.y=b(s),x.delta="x"===o.draggableDirection?x.x-x.start:x.y-x.start,x.start!==x.x&&(x.canCloseOnClick=!1),c.style.transform=`translate${o.draggableDirection}(${x.delta}px)`,c.style.opacity=""+(1-Math.abs(x.delta/x.removalDistance)))}function L(){document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",L),document.removeEventListener("touchmove",_),document.removeEventListener("touchend",L);let a=A.current;if(x.canDrag&&x.didMove&&a){if(x.canDrag=!1,Math.abs(x.delta)>x.removalDistance)return k(!0),void o.closeToast();a.style.transition="transform 0.2s, opacity 0.2s",a.style.transform=`translate${o.draggableDirection}(0)`,a.style.opacity="1"}}(0,c.useEffect)(()=>{P.current=o}),(0,c.useEffect)(()=>(A.current&&A.current.addEventListener("d",E,{once:!0}),p(o.onOpen)&&o.onOpen((0,c.isValidElement)(o.children)&&o.children.props),()=>{let o=P.current;p(o.onClose)&&o.onClose((0,c.isValidElement)(o.children)&&o.children.props)}),[]),(0,c.useEffect)(()=>(o.pauseOnFocusLoss&&(document.hasFocus()||C(),window.addEventListener("focus",E),window.addEventListener("blur",C)),()=>{o.pauseOnFocusLoss&&(window.removeEventListener("focus",E),window.removeEventListener("blur",C))}),[o.pauseOnFocusLoss]);let B={onMouseDown:v,onTouchStart:v,onMouseUp:T,onTouchEnd:T};return w&&F&&(B.onMouseEnter=C,B.onMouseLeave=E),G&&(B.onClick=o=>{D&&D(o),x.canCloseOnClick&&R()}),{playToast:E,pauseToast:C,isRunning:a,preventExitTransition:g,toastRef:A,eventHandlers:B}}(o),{closeButton:x,children:P,autoClose:w,onClick:F,type:R,hideProgressBar:D,closeToast:G,transition:B,position:W,className:z,style:V,bodyClassName:U,bodyStyle:K,progressClassName:Y,progressStyle:$,updateId:X,role:Z,progress:J,rtl:ee,toastId:et,deleteToast:er,isIn:en,isLoading:ei,iconOut:eo,closeOnClick:ea,theme:es}=o,el=(0,g.default)("Toastify__toast",`Toastify__toast-theme--${es}`,`Toastify__toast--${R}`,{"Toastify__toast--rtl":ee},{"Toastify__toast--close-on-click":ea}),eu=p(z)?z({rtl:ee,position:W,type:R,defaultClassName:el}):(0,g.default)(el,z),ed=!!J||!w,ec={closeToast:G,type:R,theme:es},ep=null;return!1===x||(ep=p(x)?x(ec):(0,c.isValidElement)(x)?(0,c.cloneElement)(x,ec):L(ec)),c.createElement(B,{isIn:en,done:er,position:W,preventExitTransition:s,nodeRef:k},c.createElement("div",{id:et,onClick:F,className:eu,...A,style:V,ref:k},c.createElement("div",{...en&&{role:Z},className:p(U)?U({type:R}):(0,g.default)("Toastify__toast-body",U),style:K},null!=eo&&c.createElement("div",{className:(0,g.default)("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!ei})},eo),c.createElement("div",null,P)),ep,c.createElement(O,{...X&&!ed?{key:`pb-${X}`}:{},rtl:ee,theme:es,delay:w,isRunning:a,isIn:en,closeToast:G,hide:D,type:R,style:$,className:Y,controlledProgress:ed,progress:J||0})))},M=function(o,a){return void 0===a&&(a=!1),{enter:`Toastify--animate Toastify__${o}-enter`,exit:`Toastify--animate Toastify__${o}-exit`,appendPosition:a}},x=h(M("bounce",!0)),P=(h(M("slide",!0)),h(M("zoom")),h(M("flip")),(0,c.forwardRef)((o,a)=>{let{getToastToRender:s,containerRef:x,isToastActive:P}=function(o){let[,a]=(0,c.useReducer)(o=>o+1,0),[s,g]=(0,c.useState)([]),x=(0,c.useRef)(null),P=(0,c.useRef)(new Map).current,T=o=>-1!==s.indexOf(o),w=(0,c.useRef)({toastKey:1,displayedToast:0,count:0,queue:[],props:o,containerId:null,isToastActive:T,getToast:o=>P.get(o)}).current;function I(o){let{containerId:a}=o,{limit:s}=w.props;!s||a&&w.containerId!==a||(w.count-=w.queue.length,w.queue=[])}function b(o){g(a=>null==o?[]:a.filter(a=>a!==o))}function _(){let{toastContent:o,toastProps:a,staleId:s}=w.queue.shift();O(o,a,s)}function L(o,s){var g,F;let{delay:R,staleId:D,...G}=s;if(!f(o)||!x.current||w.props.enableMultiContainer&&G.containerId!==w.props.containerId||P.has(G.toastId)&&null==G.updateId)return;let{toastId:B,updateId:W,data:z}=G,{props:V}=w,L=()=>b(B),U=null==W;U&&w.count++;let K={...V,style:V.toastStyle,key:w.toastKey++,...G,toastId:B,updateId:W,data:z,closeToast:L,isIn:!1,className:m(G.className||V.toastClassName),bodyClassName:m(G.bodyClassName||V.bodyClassName),progressClassName:m(G.progressClassName||V.progressClassName),autoClose:!G.isLoading&&(g=G.autoClose,F=V.autoClose,!1===g||u(g)&&g>0?g:F),deleteToast(){let o=y(P.get(B),"removed");P.delete(B),k.emit(4,o);let s=w.queue.length;if(w.count=null==B?w.count-w.displayedToast:w.count-1,w.count<0&&(w.count=0),s>0){let o=null==B?w.props.limit:1;if(1===s||1===o)w.displayedToast++,_();else{let a=o>s?s:o;w.displayedToast=a;for(let o=0;o<a;o++)_()}}else a()}};K.iconOut=function(o){let{theme:a,type:s,isLoading:g,icon:k}=o,x=null,P={theme:a,type:s};return!1===k||(p(k)?x=k(P):(0,c.isValidElement)(k)?x=(0,c.cloneElement)(k,P):d(k)||u(k)?x=k:g?x=A.spinner():s in A&&(x=A[s](P))),x}(K),p(G.onOpen)&&(K.onOpen=G.onOpen),p(G.onClose)&&(K.onClose=G.onClose),K.closeButton=V.closeButton,!1===G.closeButton||f(G.closeButton)?K.closeButton=G.closeButton:!0===G.closeButton&&(K.closeButton=!f(V.closeButton)||V.closeButton);let Y=o;(0,c.isValidElement)(o)&&!d(o.type)?Y=(0,c.cloneElement)(o,{closeToast:L,toastProps:K,data:z}):p(o)&&(Y=o({closeToast:L,toastProps:K,data:z})),V.limit&&V.limit>0&&w.count>V.limit&&U?w.queue.push({toastContent:Y,toastProps:K,staleId:D}):u(R)?setTimeout(()=>{O(Y,K,D)},R):O(Y,K,D)}function O(o,a,s){let{toastId:c}=a;s&&P.delete(s);let A={content:o,props:a};P.set(c,A),g(o=>[...o,c].filter(o=>o!==s)),k.emit(4,y(A,null==A.props.updateId?"added":"updated"))}return(0,c.useEffect)(()=>(w.containerId=o.containerId,k.cancelEmit(3).on(0,L).on(1,o=>x.current&&b(o)).on(5,I).emit(2,w),()=>{P.clear(),k.emit(3,w)}),[]),(0,c.useEffect)(()=>{w.props=o,w.isToastActive=T,w.displayedToast=s.length}),{getToastToRender:function(a){let s=new Map,c=Array.from(P.values());return o.newestOnTop&&c.reverse(),c.forEach(o=>{let{position:a}=o.props;s.has(a)||s.set(a,[]),s.get(a).push(o)}),Array.from(s,o=>a(o[0],o[1]))},containerRef:x,isToastActive:T}}(o),{className:w,style:F,rtl:R,containerId:D}=o;return(0,c.useEffect)(()=>{a&&(a.current=x.current)},[]),c.createElement("div",{ref:x,className:"Toastify",id:D},s((o,a)=>{let s=a.length?{...F}:{...F,pointerEvents:"none"};return c.createElement("div",{className:function(o){let a=(0,g.default)("Toastify__toast-container",`Toastify__toast-container--${o}`,{"Toastify__toast-container--rtl":R});return p(w)?w({position:o,rtl:R,defaultClassName:a}):(0,g.default)(a,m(w))}(o),style:s,key:`container-${o}`},a.map((o,s)=>{let{content:g,props:k}=o;return c.createElement(N,{...k,isIn:P(k.toastId),style:{...k.style,"--nth":s+1,"--len":a.length},key:`toast-${k.key}`},g)}))}))}));P.displayName="ToastContainer",P.defaultProps={position:"top-right",transition:x,autoClose:5e3,closeButton:L,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,draggable:!0,draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};let w,F=new Map,R=[],D=1;function H(o,a){return F.size>0?k.emit(0,o,a):R.push({content:o,options:a}),a.toastId}function S(o,a){return{...a,type:a&&a.type||o,toastId:a&&(d(a.toastId)||u(a.toastId))?a.toastId:""+D++}}function q(o){return(a,s)=>H(a,S(o,s))}function Q(o,a){return H(o,S("default",a))}Q.loading=(o,a)=>H(o,S("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...a})),Q.promise=function(o,a,s){let c,{pending:g,error:k,success:A}=a;g&&(c=d(g)?Q.loading(g,s):Q.loading(g.render,{...s,...g}));let x={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null,delay:100},l=(o,a,g)=>{if(null==a)return void Q.dismiss(c);let k={type:o,...x,...s,data:g},A=d(a)?{render:a}:a;return c?Q.update(c,{...k,...A}):Q(A.render,{...k,...A}),g},P=p(o)?o():o;return P.then(o=>l("success",A,o)).catch(o=>l("error",k,o)),P},Q.success=q("success"),Q.info=q("info"),Q.error=q("error"),Q.warning=q("warning"),Q.warn=Q.warning,Q.dark=(o,a)=>H(o,S("default",{theme:"dark",...a})),Q.dismiss=o=>{F.size>0?k.emit(1,o):R=R.filter(a=>null!=o&&a.options.toastId!==o)},Q.clearWaitingQueue=function(o){return void 0===o&&(o={}),k.emit(5,o)},Q.isActive=o=>{let a=!1;return F.forEach(s=>{s.isToastActive&&s.isToastActive(o)&&(a=!0)}),a},Q.update=function(o,a){void 0===a&&(a={}),setTimeout(()=>{let s=function(o,a){let{containerId:s}=a,c=F.get(s||w);return c&&c.getToast(o)}(o,a);if(s){let{props:c,content:g}=s,k={...c,...a,toastId:a.toastId||o,updateId:""+D++};k.toastId!==o&&(k.staleId=o);let A=k.render||g;delete k.render,H(A,k)}},0)},Q.done=o=>{Q.update(o,{progress:1})},Q.onChange=o=>(k.on(4,o),()=>{k.off(4,o)}),Q.POSITION={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},Q.TYPE={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},k.on(2,o=>{w=o.containerId||o,F.set(w,o),R.forEach(o=>{k.emit(0,o.content,o.options)}),R=[]}).on(3,o=>{F.delete(o.containerId||o),0===F.size&&k.off(0).off(1).off(5)})}}]);