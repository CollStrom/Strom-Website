"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42095],{406566:function(e,t,n){n.d(t,{A:function(){return CorruptionSummary},Z:function(){return CorruptionWarningModal}});var i=n(824246),o=n(674721),a=n.n(o),r=n(298784),s=n.n(r),c=n(827378),d=n(208528),l=n(60042),u=n.n(l),p=n(792739),f=n(467659),m=n(910912),h=n(596956),y=n(165168),b=n(795115),g=n(599789),x=n(167469),S=n(567230);let T={[g.BasicLidarCorruptions.BasicLabel]:"Labels / Attributes",[g.BasicLidarCorruptions.BasicAttribute]:"Labels / Attributes",[g.BasicLidarCorruptions.BasicRecall]:"Missing / Unnecessary Cuboids",[g.BasicLidarCorruptions.BasicRecallPedestrian]:"Missing Pedestrian Cuboids",[g.BasicLidarCorruptions.BasicZ]:"Cuboids Don't Touch the Ground",[g.BasicLidarCorruptions.BasicPosition]:"Position, Cuboids are Not Centered",[g.BasicLidarCorruptions.BasicSize]:"Sizing, Missing Points",[g.BasicLidarCorruptions.BasicMissingKeyframe]:"Position / Sizing at Each Frame",[g.BasicLidarCorruptions.BasicParkedAttribute]:"Stationary Vehicle Not Parked",[g.BasicVideoCorruptions.Height]:"Box Sizing",[g.BasicVideoCorruptions.SingleFrameSize]:"Box Sizing",[g.BasicVideoCorruptions.GroupedAttribute]:"Labels / Attributes",[g.BasicVideoCorruptions.Attribute]:"Labels / Attributes",[g.BasicVideoCorruptions.GlobalPathAttributeText]:"Annotation Path Attribute",[g.BasicLidarSegCorruptions.Label]:"Incorrect Instance Labels",[g.BasicLidarSegCorruptions.Instance]:"Instances Must be Unique",[g.BasicTextCollectionCorruptions.RemoveCategory]:"Missing Categories",[g.BasicTextCollectionCorruptions.RemoveItem]:"Missing Items",[g.BasicTextCollectionCorruptions.RemovePrice]:"Incorrect Prices",[g.BasicTextCollectionCorruptions.RemoveExtra]:"Missing Extras",[g.BasicTextCollectionCorruptions.RemoveOption]:"Missing Options",[g.BasicTextCollectionCorruptions.MutatePrice]:"Incorrect Prices",[g.BasicTextCollectionCorruptions.RemoveModel]:"Missing Model",[g.BasicTextCollectionCorruptions.MutateProductDescription]:"Incorrect Description",[g.BasicTextCollectionCorruptions.MutateUPC]:"Incorrect UPC",[g.BasicSemsegCorruptions.Label]:"Incorrect Labels",[g.BasicImageCorruptions.Missing]:"Missing Annotation",[g.BasicImageCorruptions.Extraneous]:"Extraneous Annotation",[g.BasicDocumentCorruptions.Typo]:"Incorrect Labels"},k=(0,f.aQ)("/feedback"),A=(0,f.aQ)("/activity");function CorruptionWarningModal(e){let{corruptionAccuracy:t=-1,improvedAccuracyCorruptionTypes:n=[],lowAccuracyCorruptionTypes:o=[],taskType:r}=e,[s,c]=(0,d.Z)(!1),[l,u]=(0,d.Z)(!0),p=o.length>0;return(0,i.jsxs)(y.u_,{contentLabel:"CorruptionWarning",maxWidth:"500px",isOpen:l,children:[(0,i.jsxs)(S.kn,{children:[(0,i.jsx)(S.pH,{icon:p?"lightbulb-exclamation":"badge-check",color:p?"#000000":"#19B629"}),p?"Your last review had quality issues":"Your last review had high quality"]}),(0,i.jsx)(S.Ys,{children:(0,i.jsx)(CorruptionSummary,{corruptionAccuracy:t,improvedAccuracyCorruptionTypes:n,lowAccuracyCorruptionTypes:o,taskType:r})}),(0,i.jsxs)(S.tu,{children:[(0,i.jsx)("div",{className:"jsx-9ffbd012d7916494 checkbox",children:(0,i.jsxs)(h.__,{style:{display:"flex",alignItems:"center",height:"100%"},children:[(0,i.jsx)(h.o2,{checked:s,onChange:c}),(0,i.jsx)("span",{className:"jsx-9ffbd012d7916494 guidelines",children:"I agree to the reviewing guidelines"})]})}),(0,i.jsx)("div",{className:"jsx-9ffbd012d7916494 submit",children:(0,i.jsx)(m.Z,{type:"primary",disabled:p&&!s,onClick:u,style:{width:"100%"},children:"Begin Task"})})]}),(0,i.jsx)(a(),{id:"9ffbd012d7916494",children:".checkbox.jsx-9ffbd012d7916494{-webkit-box-flex:1;-webkit-flex:1 0 68%;-moz-box-flex:1;-ms-flex:1 0 68%;flex:1 0 68%;margin-right:2%}.guidelines.jsx-9ffbd012d7916494{margin-left:5px;display:inline-block}.submit.jsx-9ffbd012d7916494{-webkit-box-flex:1;-webkit-flex:1 0 30%;-moz-box-flex:1;-ms-flex:1 0 30%;flex:1 0 30%}"})]})}function CorruptionSummary(e){let{corruptionAccuracy:t=-1,improvedAccuracyCorruptionTypes:n=[],lowAccuracyCorruptionTypes:o=[],postReviewSubmission:r=!1,taskType:s}=e;(0,c.useEffect)(()=>{!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.map(e=>({type:e,feedback:"failed"})),i=t.map(e=>({type:e,feedback:"improved"})),o=[...n,...i];b.c.track("Corruption Warning Modal Loaded",{corruptions:o})}(o,n)},[o,n]);let d=o.length>0,l=n.length>0,u=s===x.TaskType.LidarAnnotation;return(0,i.jsxs)("div",{className:"jsx-8c73455c55b7821f",children:[!d&&(0,i.jsx)("div",{className:"jsx-8c73455c55b7821f message",children:"Good job passing our automatic quality checks in this review!"}),d&&(0,i.jsx)(CorruptionSummaryAccuracyCategories,{corruptionTypes:o}),l&&(0,i.jsx)(CorruptionSummaryAccuracyCategories,{corruptionTypes:n,isImprovement:!0}),(0,i.jsx)(CorruptionSummarySupport,{postReviewSubmission:r,hasQualityIssues:d}),r&&t>=0&&u&&(0,i.jsx)(CorruptionSummaryPayout,{corruptionAccuracy:t}),(0,i.jsx)(a(),{id:"8c73455c55b7821f",children:".message.jsx-8c73455c55b7821f{padding-bottom:10px}"})]})}function CorruptionSummaryAccuracyCategories(e){let{corruptionTypes:t,isImprovement:n=!1}=e;return(0,i.jsx)(CorruptionSummarySection,{title:n?"Improvement":"Issues",icon:"clipboard-check",children:(0,i.jsxs)(c.Fragment,{children:[s().compact(t.map(e=>T[e])).map(e=>(0,i.jsx)("span",{className:"jsx-a53807d08bc41796 "+(u()("tag",n?"tag--improvement":"tag--issue")||""),children:e},e)),(0,i.jsx)(a(),{id:"a53807d08bc41796",children:".tag.jsx-a53807d08bc41796{-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;display:inline-block;margin:8px 8px 8px 0;padding:8px;white-space:nowrap}.tag--improvement.jsx-a53807d08bc41796{background-color:#d9eeff}.tag--issue.jsx-a53807d08bc41796{background-color:#fbd0cf}"})]})})}function CorruptionSummarySupport(e){let{hasQualityIssues:t,postReviewSubmission:n}=e;return(0,i.jsx)(CorruptionSummarySection,{title:"Support",icon:"lightbulb",children:(0,i.jsxs)(c.Fragment,{children:[t&&!n&&(0,i.jsx)("div",{className:"jsx-178e30db1f9bbdd5 support-reminder",children:"Remember to pay attention to these quality issues. We will let you know after submitting if you are improving!"}),t?(0,i.jsxs)("div",{className:"jsx-178e30db1f9bbdd5",children:["If quality issues continue in future tasks, you will be removed as a Reviewer. We recommend reviewing task instructions and courses to improve your skills, visiting the"," ",(0,i.jsx)("a",{href:k,className:"jsx-178e30db1f9bbdd5",children:"feedback center"})," and your"," ",(0,i.jsx)("a",{href:A,className:"jsx-178e30db1f9bbdd5",children:"task log"}),", and using Slack to ask questions."]}):(0,i.jsxs)("div",{className:"jsx-178e30db1f9bbdd5",children:["Keep improving your skills by reviewing task instructions and courses, visiting the"," ",(0,i.jsx)("a",{href:k,className:"jsx-178e30db1f9bbdd5",children:"feedback center"})," and your"," ",(0,i.jsx)("a",{href:A,className:"jsx-178e30db1f9bbdd5",children:"task log"}),", and using Slack to ask questions."]}),(0,i.jsx)(a(),{id:"178e30db1f9bbdd5",children:".support-reminder.jsx-178e30db1f9bbdd5{padding-bottom:10px}"})]})})}function CorruptionSummaryPayout(e){let{corruptionAccuracy:t=-1}=e;if(t<0)return null;let n="Your payout will not be immediately affected, but if our manual quality checks reveal that your quality is low, your pay may be reduced and you may be demoted to an attempter.";return 100===t?n="You will receive a $1 bonus for this review.":t<50&&(n="Your payout for this review will be reduced by 50%."),(0,i.jsx)(CorruptionSummarySection,{title:"Payout",icon:"badge-dollar",children:n})}function CorruptionSummarySection(e){let{icon:t,title:n,children:o}=e;return(0,i.jsxs)("div",{className:"jsx-bd6792ab18570ebb section",children:[(0,i.jsxs)("div",{className:"jsx-bd6792ab18570ebb section-title",children:[(0,i.jsx)(p.FontAwesomeIcon,{icon:t})," ",(0,i.jsx)("div",{className:"jsx-bd6792ab18570ebb section-title__title",children:n})]}),(0,i.jsx)("div",{className:"jsx-bd6792ab18570ebb section-children",children:o}),(0,i.jsx)(a(),{id:"bd6792ab18570ebb",children:".section.jsx-bd6792ab18570ebb{color:#000}.section.jsx-bd6792ab18570ebb:not(:last-child){padding-bottom:10px}.section-title.jsx-bd6792ab18570ebb{-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;font-size:14px;font-weight:bold;padding-bottom:2px}.section-title__title.jsx-bd6792ab18570ebb{margin-left:11px}.section-children.jsx-bd6792ab18570ebb{font-size:14px;padding:1px}"})]})}},132821:function(e,t,n){n.d(t,{fq:function(){return r},Qz:function(){return SendTaskButton},HA:function(){return SendTaskModal},a5:function(){return a},oS:function(){return M},I8:function(){return sendTypeToReviewOutcome}});var i,o,a,r,s=n(824246),c=n(674721),d=n.n(c),l=n(827378),u=n(208528),p=n(298784),f=n.n(p),m=n(959807),h=n.n(m),y=n(50682),b=n.n(y),g=n(792739),x=n(648628),S=n.n(x),T=n(106860),k=n(910912),A=n(596956),w=n(165168),v=n(210918),C=n(5575),j=n(599789),_=n(167469),E=n(567230),I=n(406566),N=n(266301),R=n(837553),P=n(481296),O=n(642830),B=n(784200);let FetchSmeStatus=e=>{var t,n;let i=B.z.array(B.z.string()),o=(0,R.mV)("sme-worker-id",{userId:e},{name:"sme-worker-id",enabled:!1}),a=(null==o?void 0:null===(t=o.payload)||void 0===t?void 0:t.value)?null==o?void 0:null===(n=o.payload)||void 0===n?void 0:n.value:"";if(a)try{let t=i.parse(JSON.parse(a));return t.includes(e)}catch(e){}return!1};function sendTypeToReviewOutcome(e){switch(e){case 1:return j.TaskReviewOutcome.Accepted;case 3:return j.TaskReviewOutcome.Fixed;case 2:case 4:case 5:return j.TaskReviewOutcome.Rejected;default:return}}(i=a||(a={}))[i.Submit=0]="Submit",i[i.Approve=1]="Approve",i[i.Reject=2]="Reject",i[i.ApproveWithChanges=3]="ApproveWithChanges",i[i.SendBackToQueue=4]="SendBackToQueue",i[i.SendBackToQueueWithChanges=5]="SendBackToQueueWithChanges",i[i.Continue=6]="Continue",(o=r||(r={}))[o.Prompt=0]="Prompt",o[o.PromptApproved=1]="PromptApproved",o[o.Send=2]="Send",o[o.Sending=3]="Sending",o[o.Sent=4]="Sent",o[o.Failed=5]="Failed";let M={5:{2:"Send Back To Queue With Changes",3:"Send Back To Queue With Changes",4:"Sent Back To Queue With Changes",5:"Send Back To Queue With Changes Failed"},0:{0:"Submit Task",1:"Submit Task",2:"Submit Task",3:"Submitting",4:"Submitted",5:"Submit Failed"},1:{2:"Approve Task",3:"Approving",4:"Approved",5:"Approve Failed"},2:{2:"Reject Task",3:"Rejecting",4:"Rejected",5:"Reject Failed"},3:{2:"Approve With Changes",3:"Approving With Changes",4:"Approved With Changes",5:"Approve With Changes Failed"},4:{2:"Send Back To Queue",3:"Sending Back To Queue",4:"Sent Back To Queue",5:"Send Back To Queue Failed"},6:{2:"Continue",3:"Continue",4:"Continue",5:"Could Not Continue"}};function SubmitConfirmTaskPromptModal(e){let{onCancel:t,setSendStatus:n,sendStatus:i}=e,[o,a]=(0,u.Z)(!1),r="local-storage-never-ask-submit-confirmation",c=(0,l.useCallback)(()=>{o&&localStorage.setItem(r,"true"),n(1)},[n,o]);return(0,l.useEffect)(()=>{"true"===localStorage.getItem(r)&&c();let onKeyDown=e=>{"Enter"===e.key&&c()};return window.addEventListener("keydown",onKeyDown),()=>window.removeEventListener("keydown",onKeyDown)},[i,c]),(0,s.jsxs)(w.u_,{contentLabel:"ConfirmationPrompt",maxWidth:"500px",isOpen:!0,onRequestClose:t,children:[(0,s.jsx)(w.xB,{onRequestClose:t,children:"Are you sure you want to submit?"}),(0,s.jsxs)("div",{style:{paddingTop:16,paddingLeft:42,paddingRight:42,paddingBottom:32,fontSize:16,lineHeight:2},className:"jsx-dee23f3049835f8d",children:[(0,s.jsx)("div",{className:"jsx-dee23f3049835f8d submission-confirmation__checkbox",children:(0,s.jsxs)(A.__,{style:{display:"flex",alignItems:"center",height:"100%"},children:[(0,s.jsx)(A.o2,{checked:o,onChange:a}),(0,s.jsx)("span",{className:"jsx-dee23f3049835f8d submission-confirmation__guidelines",children:"Never ask me again"})]})}),(0,s.jsxs)("div",{className:"jsx-dee23f3049835f8d submission-confirmation__row",children:[(0,s.jsx)(k.Z,{type:"primary",onClick:()=>c(),children:"Yes"}),(0,s.jsx)(k.Z,{type:"primary",onClick:()=>null==t?void 0:t(),children:"No"})]})]}),(0,s.jsx)(d(),{id:"dee23f3049835f8d",children:".submission-confirmation__checkbox.jsx-dee23f3049835f8d{-webkit-box-flex:1;-webkit-flex:1 0 68%;-moz-box-flex:1;-ms-flex:1 0 68%;flex:1 0 68%;margin-right:2%}.submission-confirmation__guidelines.jsx-dee23f3049835f8d{margin-left:5px;display:inline-block}.submission-confirmation__row.jsx-dee23f3049835f8d{margin-top:16px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;gap:20px}"})]})}function SendTaskModal(e){var t,n,i,o,a,r,c;let{annotationCount:u=0,children:p,disableModal:m=!1,estimate:y=8e3,nextTaskHandler:b,preSendChecks:x,sendHandler:A,taskProjectId:B,getTimeSpent:L,setTimeSpent:F,taskType:D,taskUserId:U,type:G,lowAccuracyCorruptionTypes:z,improvedAccuracyCorruptionTypes:W,corruptionAccuracy:J,autoloadNextAssignment:Q=!1,isTestQuestion:Z,hideOnFail:Y,postCompletionFeedback:q,shortcutEnabled:H,attemptSubmittedAndGraded:K,setPostSubmissionGraph:V,taskId:X,assignmentId:$,reviewLevel:ee,shouldPreventSend:et=!1,userId:en}=e,[ei,eo]=(0,l.useState)(!1),[ea,er]=(0,l.useState)(0),[es,ec]=(0,l.useState)(2),ed=!!en&&FetchSmeStatus(en),el=(0,R.ZP)("show-submit-confirmation",{projectId:B},!1),eu=(0,R.ZP)("show-post-submission-graph",{projectId:B},!1),ep=(0,l.useCallback)(async()=>{var e,t,n;if(0===G&&1!==es&&!ed){ec(0);return}if(j.twoDTypes.includes(D)&&el&&(null!==(n=null==F?void 0:F())&&void 0!==n?n:(null!==(t=null==L?void 0:null===(e=L())||void 0===e?void 0:e.taskTimeSpent)&&void 0!==t?t:0)>6e3)||x&&!await x())return;let i=new Date().getTime();ec(3);let o=setInterval(()=>{let e=new Date().getTime(),t=Math.floor(100*Math.floor(e-i)/y);t<=99&&er(t)},50);try{await A(G),clearInterval(o),!0===et?ec(2):D!==_.TaskType.LidarAnnotation&&(er(100),await h().delay(200),m&&Q?(ec(4),eu?null==V||V(!0):null==b||b()):m?ec(2):ec(4))}catch(e){throw clearInterval(o),ec(5),Y&&!Z&&(await h().delay(3e3),eh()),m&&(await h().delay(3e3),ec(2)),(0,C.dO)(e,"approve-with-changes-failed",{extras:{taskUserId:U,taskProjectId:B}}),O.Z.error("Approve attempt failure.",{errorType:"approve-attempt-failed",error:e,errorMessage:e.message,errorStack:e.stack,taskUserId:U,taskProjectId:B,taskId:X,assignmentId:$,reviewLevel:ee}),e}},[x,y,A,m,Q,b,D,eu,X,$,ee,es,G]);(0,l.useEffect)(()=>{D===_.TaskType.LidarAnnotation&&K&&3===es&&(er(100),ec(4)),0===G&&1===es&&ep()},[es,K,D,G,ep]),(0,P.oB)(ep,G,!H||2!==es);let ef=(0,l.useCallback)(()=>{eo(!0)},[]),em=(0,l.useCallback)(()=>{if(Z)return eh();ef(),null==b||b()},[b,ef]),eh=(0,l.useCallback)(()=>{eo(!1),ec(2)},[]),{name:ey,emoji:eb}=(0,v.getLidarNickname)(U,B,D),eg=U||B||D,ex=function(e,t){switch(e){case _.TaskType.Annotation:case _.TaskType.VideoBoxAnnotation:if(1===t)return"box";return"boxes";case _.TaskType.AudioTranscription:if(1===t)return"word";return"words";case _.TaskType.Categorization:if(1===t)return"taxonomy";return"taxonomies";case _.TaskType.Comparison:case _.TaskType.DataCollection:if(1===t)return"field";return"fields";case _.TaskType.LaneAnnotation:if(1===t)return"lane";return"lanes";case _.TaskType.CuboidAnnotation:case _.TaskType.LidarAnnotation:case _.TaskType.LidarLinking:case _.TaskType.LidarStitching:case _.TaskType.VideoCuboidAnnotation:if(1===t)return"cuboid";return"cuboids";case _.TaskType.LineAnnotation:if(1===t)return"line";return"lines";case _.TaskType.PointAnnotation:if(1===t)return"point";return"points";case _.TaskType.PolygonAnnotation:if(1===t)return"polygon";return"polygons";case _.TaskType.Transcription:if(1===t)return"transcription";return"transcriptions";case _.TaskType.LidarSegmentation:case _.TaskType.SegmentAnnotation:if(1===t)return"point";return"points";case _.TaskType.FixAnnotation:case _.TaskType.NamedEntityRecognition:case _.TaskType.PhoneCall:default:return"annotations"}}(D,u),eS=!f().isUndefined(z)||!f().isUndefined(W)||!f().isUndefined(J),eT=S()(L?L().taskTimeSpent:0);return(0,s.jsxs)(l.Fragment,{children:[0===G&&0===es&&(0,s.jsx)(SubmitConfirmTaskPromptModal,{onCancel:()=>{ec(2)},setSendStatus:ec,sendStatus:es}),(0,s.jsxs)(w.u_,{isOpen:!m&&2!==es,maxWidth:480,top:"50%",transform:"translateY(-50%)",margin:"auto",children:[(0,s.jsxs)(E.kn,{children:[3===es&&(0,s.jsx)(E.pH,{icon:"sync-alt",color:"#008EFF"}),4===es&&(0,s.jsx)(E.pH,{icon:"check-circle",color:"#008EFF"}),5===es&&(0,s.jsx)(E.pH,{icon:"exclamation-triangle",color:"#008EFF"}),3===es&&"Your task is ".concat(null!==(a=null==M?void 0:null===(t=M[G])||void 0===t?void 0:t[3])&&void 0!==a?a:"",".toLowerCase()... please do not refresh or close this window"),4===es&&"Your task was successfully ".concat(null!==(r=null==M?void 0:null===(n=M[G])||void 0===n?void 0:n[4])&&void 0!==r?r:"",".toLowerCase()}!"),5===es&&(null==M?void 0:null===(i=M[G])||void 0===i?void 0:i[5])]}),(0,s.jsxs)(E.Ys,{children:[!!eg&&(0,s.jsxs)("div",{className:"jsx-b9f02d2a6f71af85 body__item",children:[(0,s.jsx)(T.Z,{emoji:eb})," ",ey]}),!!u&&!!ex&&(0,s.jsxs)("div",{className:"jsx-b9f02d2a6f71af85 body__item",children:[(0,s.jsx)(g.FontAwesomeIcon,{icon:"user-tag"})," ",u," ",ex]}),(0,s.jsxs)("div",{className:"jsx-b9f02d2a6f71af85 body__item",children:[(0,s.jsx)(g.FontAwesomeIcon,{icon:"clock"})," ",eT," taken"]})]}),eS&&(0,s.jsx)(E.Ys,{children:(0,s.jsx)(I.A,{lowAccuracyCorruptionTypes:z,improvedAccuracyCorruptionTypes:W,corruptionAccuracy:J,taskType:D})}),4===es&&q&&(0,s.jsx)(E.Ys,{children:(0,s.jsx)("div",{style:{fontWeight:"normal",color:"black"},className:"jsx-b9f02d2a6f71af85",children:(0,s.jsx)(N.Z,{text:q})})}),(0,s.jsxs)(E.tu,{children:[3===es&&(0,s.jsx)(l.Fragment,{children:(0,s.jsxs)("div",{className:"jsx-b9f02d2a6f71af85 progress",children:[(0,s.jsx)("div",{style:{width:"".concat(ea,"%")},className:"jsx-b9f02d2a6f71af85 progress__bar"}),(0,s.jsxs)("div",{className:"jsx-b9f02d2a6f71af85 progress__text",children:[ea,"%"]})]})}),4===es&&(0,s.jsx)("div",{className:"jsx-b9f02d2a6f71af85 footer__item",children:(0,s.jsx)(k.Z,{type:"button",onClick:em,primary:!0,style:{width:"100%"},disabled:ei,children:Z?"Review My Results":"Next Task"})}),5===es&&(0,s.jsx)("div",{className:"jsx-b9f02d2a6f71af85 footer__item",children:(0,s.jsx)(k.Z,{type:"button",onClick:eh,primary:!0,style:{width:"100%"},disabled:ei,children:"Close"})})]})]}),p({disabled:2!==es,onClick:ep,text:null!==(c=null==M?void 0:null===(o=M[G])||void 0===o?void 0:o[es])&&void 0!==c?c:"Next (error)"}),(0,s.jsx)(d(),{id:"b9f02d2a6f71af85",children:".body__item.jsx-b9f02d2a6f71af85:not(:last-child){margin-right:25px}.footer__item.jsx-b9f02d2a6f71af85{-webkit-box-flex:1;-webkit-flex:1 0 49%;-moz-box-flex:1;-ms-flex:1 0 49%;flex:1 0 49%}.footer__item.jsx-b9f02d2a6f71af85:not(:last-child){margin-right:2%}.progress.jsx-b9f02d2a6f71af85{background:rgba(0,142,255,.5);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;height:34px;overflow:hidden;position:relative;width:100%}.progress__bar.jsx-b9f02d2a6f71af85{background:#008eff;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;height:100%;left:0;position:absolute;top:0}.progress__text.jsx-b9f02d2a6f71af85{color:#fff;font-size:11px;font-weight:500;height:100%;line-height:34px;position:relative;text-align:center;width:100%;z-index:1}"})]})}function SendTaskButton(e){let{appearance:t="default",arrows:n=!1,disabled:i,hasMargin:o=!0,onClick:a,children:r,tooltip:c,type:d}=e,l={};return"default"===t&&(0===d||6===d)&&(l={style:{marginLeft:o?"15px":"0"},primary:!0,disabled:i,onClick:a,tooltip:c,type:"button"}),"lidar"===t&&0===d&&(l={primary:!0,disabled:i,onClick:a,tooltip:c,type:"button",arrows:n,size:"lg",className:"full"}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{"data-tip":c||"Submit task when complete","data-for":"submit-tooltip",children:(0,s.jsx)(k.Z,{...l,children:r})}),(0,s.jsx)(b(),{id:"submit-tooltip",delayShow:250})]})}},567230:function(e,t,n){n.d(t,{Ys:function(){return TaskerModalBody},kn:function(){return TaskerModalHeader},pH:function(){return TaskerModalHeaderIcon},tu:function(){return TaskerModalFooter}});var i=n(824246),o=n(674721),a=n.n(o);n(827378);var r=n(792739);function TaskerModalHeader(e){let{children:t}=e;return(0,i.jsxs)("div",{className:"jsx-2b1716236f75cef3 header",children:[t,(0,i.jsx)(a(),{id:"2b1716236f75cef3",children:".header.jsx-2b1716236f75cef3{-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;color:#000;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;font-size:20px;font-weight:600;padding:28.5px;text-align:left}"})]})}function TaskerModalHeaderIcon(e){let{icon:t,color:n="#008EFF"}=e;return(0,i.jsxs)("div",{className:"jsx-11272ab49c8a1413 header-icon",children:[(0,i.jsx)(r.FontAwesomeIcon,{icon:t,color:n}),(0,i.jsx)(a(),{id:"11272ab49c8a1413",children:".header-icon.jsx-11272ab49c8a1413{font-size:31px;line-height:31px;margin-right:20.5px}"})]})}function TaskerModalBody(e){let{children:t}=e;return(0,i.jsxs)("div",{className:"jsx-15f08a4afc80dd1 body",children:[t,(0,i.jsx)(a(),{id:"15f08a4afc80dd1",children:".body.jsx-15f08a4afc80dd1{border-top:1px solid#f1f1f1;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;padding:25px;color:#000;font-weight:500}"})]})}function TaskerModalFooter(e){let{children:t}=e;return(0,i.jsxs)("div",{className:"jsx-69f3c649b4d7be64 footer",children:[t,(0,i.jsx)(a(),{id:"69f3c649b4d7be64",children:".footer.jsx-69f3c649b4d7be64{border-top:1px solid#f1f1f1;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;padding:25px}"})]})}},481296:function(e,t,n){n.d(t,{oB:function(){return useSendModalShortcut},p7:function(){return useReviewActionShortcuts},ve:function(){return useSkipActionShortcut}});var i=n(513735),o=n(938644),a=n(716124),r=n(132821);function useReviewActionShortcuts(e,t,n){(0,i.ZP)({trigger:o.zd[o.PO.MakeChanges],action:e.action,disabled:e.disabled,description:"Make changes",type:o.PO.MakeChanges,group:o.Jl.ReviewButtons,forceNotEditable:!0}),(0,i.ZP)({trigger:o.zd[o.PO.RejectReview],action:t.action,disabled:t.disabled,description:"Send attempt back to queue",type:o.PO.RejectReview,group:o.Jl.ReviewButtons,forceNotEditable:!0}),(0,i.ZP)({trigger:o.zd[o.PO.CancelActionReview],action:n.action,disabled:n.disabled,description:"Cancel current action",type:o.PO.CancelActionReview,group:o.Jl.ReviewButtons,forceNotEditable:!0})}function useSkipActionShortcut(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,i.ZP)({trigger:o.zd[o.PO.SkipStudioTask],action:e.action,disabled:e.disabled,description:"Skip ".concat(t?"review":"attempt"," task"),type:o.PO.SkipStudioTask,group:t?o.Jl.ReviewButtons:o.Jl.AttemptButtons,forceNotEditable:!0})}function useSendModalShortcut(e,t,n){let s,c=o.$g,d="",l=o.Jl.ReviewButtons;switch(t){case r.a5.Submit:c=o.zd[o.PO.SubmitTask],d="Submit",s=o.PO.SubmitTask,l=o.Jl.AttemptButtons;break;case r.a5.Approve:case r.a5.ApproveWithChanges:c=o.zd[o.PO.ApproveReview],d="Approve",s=o.PO.ApproveReview;break;case r.a5.Reject:case r.a5.SendBackToQueue:case r.a5.SendBackToQueueWithChanges:c=o.zd[o.PO.RejectReview],d="Reject / send back to queue",s=o.PO.RejectReview}(0,i.ZP)({trigger:c,action:e,description:d,type:s,group:l,disabled:n,forceNotEditable:!a.IS_FEDERAL})}},242095:function(e,t,n){n.r(t),n.d(t,{AWAIT_CONFIRMATION_FOR_SKIP_TASK:function(){return z},AWAIT_CONFIRMATION_FOR_TASKING:function(){return G},COMPLETE_ASSIGNMENTS:function(){return _},COMPLETE_INSTRUCTIVE:function(){return L},CONFIRM_READY_FOR_NEXT_TASK:function(){return U},DISPLAY_NEW_BONUS:function(){return D},EXTEND_BATCH:function(){return j},FLAG_ASSIGNMENT:function(){return P},NEXT_ASSIGNMENT:function(){return O},REPORT_ASSIGNMENT:function(){return R},SET_BONUSES:function(){return F},SET_CURRENT_USER:function(){return C},SET_PRECALCULATED_PAY:function(){return W},SHOW_CORRUPTION_FEEDBACK:function(){return E},SHOW_POST_COMPLETION_FEEDBACK:function(){return I},SKIP_ASSIGNMENT:function(){return N},TRAINING_ACTIONS:function(){return Z},UPDATE_CLAIMS:function(){return B},UPDATE_PROJECT_BENCHMARK_METRICS:function(){return M},acceptProjectPricing:function(){return acceptProjectPricing},awaitConfirmationForNextTask:function(){return awaitConfirmationForNextTask},awaitConfirmationForSkipTask:function(){return awaitConfirmationForSkipTask},beginCourse:function(){return beginCourse},certificationTimeRemainingSecsSync:function(){return certificationTimeRemainingSecsSync},checkAssignmentClaim:function(){return checkAssignmentClaim},completeAttempt:function(){return completeAttempt},completeReviewAssignment:function(){return completeReviewAssignment},completeReviewAssignments:function(){return completeReviewAssignments},completeSupplementalCourse:function(){return completeSupplementalCourse},confirmReadyForNextTask:function(){return confirmReadyForNextTask},continueCourse:function(){return continueCourse},displayNewBonus:function(){return displayNewBonus},fetchApi:function(){return fetchApi},fetchBonuses:function(){return fetchBonuses},fetchCorp:function(){return fetchCorp},fetchCourse:function(){return fetchCourse},fetchCurrentUser:function(){return fetchCurrentUser},fetchNextAssignments:function(){return fetchNextAssignments},fetchNextAssignmentsOnSkip:function(){return fetchNextAssignmentsOnSkip},flagTask:function(){return flagTask},handleErrorsAndJsonify:function(){return handleErrorsAndJsonify},nextTask:function(){return nextTask},onExit:function(){return onExit},refreshAssignmentClaims:function(){return refreshAssignmentClaims},rejectProjectPricing:function(){return rejectProjectPricing},reportTask:function(){return reportTask},skipBatch:function(){return skipBatch},skipCourse:function(){return skipCourse},skipTask:function(){return skipTask},updateBenchmarkStats:function(){return updateBenchmarkStats}});var i=n(298784),o=n.n(i),a=n(252708),r=n.n(a),s=n(468891),c=n(959807),d=n.n(c),l=n(459025),u=n(352991),p=n(373689),f=n(626199),m=n(788230),h=n(255146),y=n(642830),b=n(791257),g=n(533064),x=n(599789),S=n(167469),T=n(350615),k=n(436878),A=n(761077),w=n(132821),v=n(271351);let C="SET_CURRENT_USER",j="EXTEND_BATCH",_="COMPLETE_ASSIGNMENTS",E="SHOW_CORRUPTION_FEEDBACK",I="SHOW_POST_COMPLETION_FEEDBACK",N="SKIP_ASSIGNMENT",R="REPORT_ASSIGNMENT",P="FLAG_ASSIGNMENT",O="NEXT_ASSIGNMENT",B="UPDATE_CLAIMS",M="UPDATE_PROJECT_BENCHMARK_METRICS",L="COMPLETE_INSTRUCTIVE",F="SET_BONUSES",D="DISPLAY_NEW_BONUS",U="CONFIRM_READY_FOR_NEXT_TASK",G="AWAIT_CONFIRMATION_FOR_TASKING",z="AWAIT_CONFIRMATION_FOR_SKIP_TASK",W="SET_PRECALCULATED_PAY";async function handleErrorsAndJsonify(e){if(!e.ok)throw new p.Z(e.statusText,await (0,m.u)(e));return e.json()}function fetch(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=e.slice();return n.returnRawResponse=!n.parseAndHandle,delete n.parseAndHandle,n.body&&(n.body=JSON.stringify(n.body),n.headers||(n.headers={"Content-Type":"application/json"})),n.query&&(i="".concat(i,"?").concat(s.stringify(n.query))),delete n.query,(0,u.ZP)(null,"".concat(t).concat(i),n)}function fetchCorp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,"corp-api",t)}function fetchApi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,"internal",t)}function fetchCurrentUser(e){return async t=>{t({type:C,user:e=e||await fetchApi("/logged_in_user").then(handleErrorsAndJsonify)})}}function updateBenchmarkStats(){return async(e,t)=>{let n=o().get(t(),"batch.assignments",[]),i=o().uniq(n.map(e=>o().get(e.project,"_id",e.project)).filter(e=>!!e)),a="?projects="+i.join("&projects="),r=i.length>0?await fetchApi("/scaler/work/project-benchmark-stats".concat(a)).then(handleErrorsAndJsonify):{};e({type:M,perProjectBenchmarkMetrics:r})}}function setIsFetchingQueue(e){let t=isFetchingQueue();if(e&&!t){let e=Date.now();localStorage.setItem("isFetchingQueueTimestamp",e.toString())}else localStorage.removeItem("isFetchingQueueTimestamp")}function isFetchingQueue(){let e=localStorage.getItem("isFetchingQueueTimestamp");if(!e)return!1;let t=parseInt(e,10),n=Date.now();return n-t<=1e4}async function debounceFetchQueue(e){try{for(;isFetchingQueue();)await d().delay(3e3);return setIsFetchingQueue(!0),await fetchApi(e).then(handleErrorsAndJsonify)}finally{setIsFetchingQueue(!1)}}async function fetchQueue(e){let t=await (0,v.O8)({feature:"fetch-queue-atomically"});return t?await debounceFetchQueue(e):await fetchApi(e).then(handleErrorsAndJsonify)}function fetchNextAssignments(e){var t;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;(0,k.r3)(window.navigator.userAgent)&&(e.mobileAgent=1);let a=o().omit(e,"review_mode","limit");e&&e.review_mode&&(a.kind="0"===(t=e.review_mode)?"task":"1"===t?"review":void 0);let s=o().map(a,(e,t)=>e?"&".concat(t,"=").concat(e):"").join("");return async(e,t)=>{let a=t();if(o().get(a,"batch.assignments.length",0)>2){updateBenchmarkStats()(e,t);return}try{let t="".concat("/v2/tasks/new_queue","?limit=").concat(null!=i?i:1).concat(s),n=await fetchQueue(t),a=o().uniqBy(n,e=>null==e?void 0:e._id),r=a[0];if((null==r?void 0:r.redirectLink)&&(null==r?void 0:r.assignmentType)===x.AssignmentType.Redirect){let e=r.redirectLink;e&&(window.location.href=e);return}try{{let e=(0,g.zY)(),t="scale-experimental"===l.get("branch")&&"scale-experimental"!==e,n=!l.get("branch")&&"scale-experimental"===e;(t||n)&&(y.Z.warn("Refreshing user because their deploy changed old=".concat(e," new=").concat(l.get("branch"))),window.location.reload())}}catch(e){y.Z.error("Got error trying to determine user's correct branch in queue logic")}let c=a.filter(e=>e.assignmentType===x.AssignmentType.Course)[0];c&&e({type:Z.SET_COURSE,course:c}),e({type:Z.SET_LOADING,isLoading:!1}),e({type:j,assignments:(0,f.WG)(a)}),e(updateBenchmarkStats())}catch(e){if(e.response&&403===e.response.status)e.response.error===T.F?window.location="/account":window.location="/forbidden";else if(e.response&&429===e.response.status)r().error("You have refreshed this page too quickly, or opened many windows at the same time. Please slow down, and don't refresh across multiple windows. You can retry after one minute.",{timeout:"none"});else if(r().error(e.message,{timeout:3e3}),n)throw e}}}function skipBatch(e,t,n,i){return async(o,a)=>{let r=await fetchApi("/batch/skip",{method:"POST",body:{batchId:t,info:{skipReason:n,skipExplanation:i}}}).then(handleErrorsAndJsonify);r.tooManySkips?alert("You have already reached the limit on skips for the day."):(fetchNextAssignments(e)(o,a),o({type:N,response:r}))}}function skipTask(e,t,n,i){let a,r,s;let c=(0,g.tQ)();y.Z.warn("Skipped Task",{assignmentId:t._id,attemptId:t.attemptId,skipReason:n,skipExplanation:i,pageLoadId:c});let d={skipReason:n,skipExplanation:i};return(0,b.isLegacyReviewAssignment)(t)?(r=[t.attemptId],t.childIds&&(r=r.concat(o().compact(t.childIds))),s="/attempts/unassign"):(a=[t._id],t.childIds&&(a=a.concat(o().compact(t.childIds))),s="/tasks/unassign"),async t=>{let n=await fetchApi(s,{method:"POST",body:{taskIds:a,attemptIds:r,isSkippedTask:!0,isSkipUserInitiated:!0,info:d}}).then(handleErrorsAndJsonify);return n.tooManySkips?alert("You have already reached the limit on skips for the day."):(t(fetchNextAssignments(e)),t({type:N,response:n})),n}}function reportTask(e,t,n,i){let o=(0,g.tQ)();return y.Z.warn("Reported Task",{assignmentId:t._id,attemptId:t.attemptId,reportReason:n,reportExplanation:i,pageLoadId:o}),async(a,r)=>{let s=await fetchApi("/tasks/report",{method:"POST",body:{taskId:t._id,reportReason:n,reportExplanation:i}}).then(handleErrorsAndJsonify);s.tooManySkips?(alert("You have already reached the limit on reports for the day."),y.Z.warn("Task Report Limit Reached",{assignmentId:t._id,attemptId:t.attemptId,reportReason:n,reportExplanation:i,pageLoadId:o})):(fetchNextAssignments(e)(a,r),a({type:R,response:s}))}}function flagTask(e,t,n,i){let o=(0,g.tQ)();return y.Z.warn("Flagged Task",{assignmentId:t._id,attemptId:t.attemptId,flagCategory:n,reason:i,pageLoadId:o}),async(o,a)=>{let r=await fetchApi("/tasks/flag",{method:"POST",body:{taskId:t._id,flagCategory:n,reason:i}}).then(handleErrorsAndJsonify);fetchNextAssignments(e)(o,a),o({type:P,response:r})}}function nextTask(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;return async(i,a)=>{try{if(t)window.location.href="/qa/audit";else{let t=a();o().get(t,"batch.forceFixAssignment")||(i({type:O}),await fetchNextAssignments(e,!0,n)(i,a))}}catch(e){window.location.reload()}}}let J=["task_id","timeSpentSecs","timeSpentLoadingSecs","oldTimeSpentSecs"],Q={annotation:[...J,"annotations"],audiotranscription:J,fixannotation:[...J,"annotation"],polygonannotation:[...J,"annotations"],lineannotation:[...J,"annotations"],laneannotation:[...J,"annotations"],pointannotation:[...J,"annotations"]},validateBody=e=>{let t=Q[e]||[];return e=>{o().each(t,t=>{if(!o().has(e,t))throw Error("".concat(t," is required in `completeAttempt`"))})}};function checkAssignmentClaim(e){let{stage:t,task:n,attempt:i,elapsedTime:a,force:r,multiReplicaIndex:c}=e;return async e=>{let{forceClaim:d}=s.parse(window.location.search),{tasks:l,attempts:u,stages:p,currentPageHasEditLock:f,otherUserHasLock:m,canOverride:h,hasForcePermission:y,needsRefresh:b}=await fetchApi("/tasks/check_claim",{method:"POST",body:{stage:t,task:n,attempt:i,elapsedTime:a,usingForceClaimLink:"1"===d,multiReplicaIndex:c}}).then(handleErrorsAndJsonify);if(y&&r)return;let g={};o().each(o().concat(l,u,p),e=>{var t,n,i;let o=new Date(e.claimedUntil);o.setSeconds(o.getSeconds()-x.pipelinev3NodeGracePeriodSeconds);let a=new Date(e.maxClaim||Date.now()+1e3);a.setSeconds(a.getSeconds()-x.pipelinev3NodeGracePeriodSeconds),g[e.id]={claimed:e.claimed,claimedUntil:o,maxClaim:a,idleMinutes:parseInt(e.idleMinutes),checkedAt:new Date(e.checkedAt),checkedAtClientTime:new Date,hasWarning:e.hasWarning,warningParams:e.warningParams,corruptionFeedback:e.corruptionFeedback,needsRefresh:!!e.needsRefresh,payableTime:{maxPayableMinutes:parseInt(null===(t=e.payableTime)||void 0===t?void 0:t.maxPayableMinutes),additionalMinutesPerTurn:parseInt(null===(n=e.payableTime)||void 0===n?void 0:n.additionalMinutesPerTurn),additionalMinutesPerRewrite:parseInt(null===(i=e.payableTime)||void 0===i?void 0:i.additionalMinutesPerRewrite)},claimMinutes:parseInt(e.claimMinutes)}}),e({type:B,claims:g,currentPageHasEditLock:f,otherUserHasLock:m,canOverride:h,needsRefresh:b})}}function refreshAssignmentClaims(e){let{stages:t,tasks:n,attempts:i,elapsedTime:a,force:r}=e;return async e=>{let s=await fetchApi("/tasks/check_claim",{method:"POST",body:{reclaim:{tasks:n,attempts:i,stages:t},elapsedTime:a}}).then(handleErrorsAndJsonify);if(s.hasForcePermission&&r)return;let c={};o().each(o().concat(s.tasks,s.attempts,s.stages),e=>{var t,n,i;let o=new Date(e.claimedUntil);o.setSeconds(o.getSeconds()-x.pipelinev3NodeGracePeriodSeconds);let a=new Date(e.maxClaim||Date.now()+1e3);a.setSeconds(a.getSeconds()-x.pipelinev3NodeGracePeriodSeconds),c[e.id]={claimed:e.claimed,claimedUntil:o,maxClaim:a,idleMinutes:parseInt(e.idleMinutes),checkedAt:new Date(e.checkedAt),checkedAtClientTime:new Date,hasWarning:e.hasWarning,warningParams:e.warningParams,corruptionFeedback:e.corruptionFeedback,payableTime:{maxPayableMinutes:parseInt(null===(t=e.payableTime)||void 0===t?void 0:t.maxPayableMinutes),additionalMinutesPerTurn:parseInt(null===(n=e.payableTime)||void 0===n?void 0:n.additionalMinutesPerTurn),additionalMinutesPerRewrite:parseInt(null===(i=e.payableTime)||void 0===i?void 0:i.additionalMinutesPerRewrite)},claimMinutes:parseInt(e.claimMinutes)}}),e({type:B,claims:c})}}function completeAttempt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.timeSpentLoadingSecs||(n.timeSpentLoadingSecs=-1),validateBody(t)(n),n.toolSource=A.xC.Classic,async(i,o)=>{let a;let r=t===S.TaskType.Categorization,s={body:n,method:"POST"};if(r){let attemptSubmitAsync=async()=>{a=await fetchApi("/complete/".concat(t),s).then(handleErrorsAndJsonify),fetchNextAssignments(e)(i,o)};await attemptSubmitAsync()}else if(!(a=await fetchApi("/complete/".concat(t),s).then(handleErrorsAndJsonify)))return;return a.trainingAttempt&&i({type:L,instructiveResponse:a.trainingAttempt}),a.precalculatedPay&&i({type:W,precalculatedPay:a.precalculatedPay}),a}}function completeSupplementalCourse(e){return async(t,n)=>{t({type:O}),t({type:Z.SET_COURSE_PROGRESS,courseProgress:{currentSection:-1}});let i=n(),o=i.batch.assignments.filter(e=>e.assignmentType===x.AssignmentType.Course)[0];t({type:Z.SET_COURSE,course:o}),o||fetchNextAssignments(e)(t,n)}}function completeReviewAssignment(e,t,n){let{isCorrect:i,timeSpentSecs:a,populateHypothesis:r,oldTimeSpentSecs:s,timeSpentLoadingSecs:c,trueReviewOutcome:d,reviewChanges:l,benchmark:u,comments:p,fullstorySession:f,extra:m,auditResult:b,categorizationResult:g,taskFeedback:x,sendType:S,linterMetrics:T,documentRotation:k,documentRotationPerPage:v,attemptBehaviourLog:C,enabledFeatures:j,multiViewNodes:_}=n,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};return async n=>{var R;let P={attemptId:t.attemptId,reviewTimeSecs:a,reviewOldTimeSecs:s,reviewTimeLoadingSecs:c,attemptVersion:t.attemptVersion,trueReviewOutcome:null!=d?d:void 0!==S?(0,w.I8)(S):void 0,reviewResult:i?"correct":"incorrect",populateHypothesis:r,reviewChanges:l,benchmark:u,comments:p,fullstorySession:f,extra:m,auditResult:b,categorizationResult:g,taskFeedback:x,toolSource:A.xC.Classic,sendType:void 0!==S?w.a5[S]:void 0,linterMetrics:T,documentRotation:k,documentRotationPerPage:v,attemptBehaviourLog:C,enabledFeatures:j,ontology:l&&(null===(R=t.params)||void 0===R?void 0:R.ontology),multiViewNodes:_},O=await fetchApi("/complete/review/".concat(t.type),{body:P,method:"POST"}).then(handleErrorsAndJsonify);if(!O)return;await N(),y.Z.log("Succesfully completed review: ".concat(t.attemptId," with taskFeedback ").concat(x));let B=o().get(O,"corruptionFeedback.corruptionAccuracy"),M=null==O?void 0:O.postCompletionFeedback;if(0===B||B)n({type:E,corruptionFeedback:O.corruptionFeedback,corruptionFeedbackAttempt:O.attempt,confidenceAction:O.confidenceAction,reviewTimeSecs:P.reviewTimeSecs});else{if(O.trainingAttempt&&n({type:L,instructiveResponse:O.trainingAttempt}),O.precalculatedPay&&n({type:W,precalculatedPay:O.precalculatedPay}),M&&n({type:I,postCompletionFeedback:M}),!1===o().get(O.trainingAttempt,"submitted"))return O;e=o().omit(e,"lidarId"),O.confidenceAction&&(0,h.ZP)(null,"/corrected_reviews?confidenceAction=".concat(O.confidenceAction))}return O}}function onExit(e,t){let exitTask=async(e,t,n)=>{let i=await fetchApi("/complete/exit/".concat(t),{body:{attemptId:e,numChildNodes:n},method:"POST"}).then(handleErrorsAndJsonify);return i};return async e=>{await d().map(t,async t=>{let n=t.id||t.attemptId||t.task;if(!n)return;let i=o().compact(t.childIds||[]),a=await exitTask(n,t.type,i.length);if(!a)return;a.precalculatedPay&&e({type:W,precalculatedPay:a.precalculatedPay});let r=[];for(let e of i)r.push(exitTask(e,t.type,i.length));let s=await Promise.all(r);for(let e of s)if(!e)return},{concurrency:3})}}let submitAssignment=async(e,t)=>{let{isCorrect:n,timeSpentSecs:i,populateHypothesis:o,oldTimeSpentSecs:a,timeSpentLoadingSecs:r,reviewChanges:s,benchmark:c,comments:d,fullstorySession:l,extra:u,auditResult:p,taskFeedback:f}=t,m={attemptId:e.attemptId,reviewTimeSecs:i,reviewOldTimeSecs:a,reviewTimeLoadingSecs:r,attemptVersion:e.attemptVersion,reviewResult:n?"correct":"incorrect",populateHypothesis:o,reviewChanges:s,benchmark:c,comments:d,fullstorySession:l,extra:u,auditResult:p,taskFeedback:f};await fetchApi("/complete/review/".concat(e.type),{body:m,method:"POST"}).then(handleErrorsAndJsonify)};function completeReviewAssignments(e,t,n){return async i=>{await d().map(t,async(e,t)=>{try{await submitAssignment(e,n[t])}catch(e){}},{concurrency:3}),i({type:_,assignments:t}),i(fetchNextAssignments(e=o().omit(e,"lidarId")))}}let Z={SET_LOADING:"TRAINING_ACTIONS/SET_LOADING",SET_COURSE:"TRAINING_ACTIONS/SET_COURSE",SET_COURSE_PROGRESS:"TRAINING_ACTIONS/SET_COURSE_PROGRESS",SET_COURSE_ERROR:"TRAINING_ACTIONS/SET_COURSE_ERROR"};function randomizedCertificationCourseSectionsIfNeeded(e,t){var n;let i=null==t?void 0:null===(n=t.certificationInfo)||void 0===n?void 0:n.randomizedSections;i&&i.length>0&&(e.sections=i)}function overrideCourseSectionsIfNeeded(e,t){let n=null==t?void 0:t.overridingSections;n&&n.length>0&&(e.sections=n)}function fetchCourse(e,t){return async n=>{n({type:Z.SET_LOADING,isLoading:!0});let i=!1,o="/courses/".concat(encodeURIComponent(e));t&&(o+="?tag=".concat(t));let a=await fetchApi(o,{}).then(handleErrorsAndJsonify).catch(e=>(i=!0,e.response));if(i){n({type:Z.SET_LOADING,isLoading:!1}),n({type:Z.SET_COURSE_ERROR,courseError:a.error||"There was an error loading the course"});return}let{course:r,courseProgress:s}=a;randomizedCertificationCourseSectionsIfNeeded(r,s),overrideCourseSectionsIfNeeded(r,s),n({type:Z.SET_COURSE,course:r}),n({type:Z.SET_COURSE_PROGRESS,courseProgress:s}),n({type:Z.SET_LOADING,isLoading:!1})}}function beginCourse(e,t){return async(n,i)=>{n({type:Z.SET_LOADING,isLoading:!0});let o=await fetchApi("/courses/".concat(e,"/begin"),{method:"POST",body:{permissionId:t}}).then(handleErrorsAndJsonify),a=i(),r=a.training.course,{courseProgress:s}=o;randomizedCertificationCourseSectionsIfNeeded(r,s),overrideCourseSectionsIfNeeded(r,s),n({type:Z.SET_COURSE,course:r}),n({type:Z.SET_COURSE_PROGRESS,courseProgress:s}),n({type:Z.SET_LOADING,isLoading:!1})}}function skipCourse(e,t){return async(n,i)=>{n({type:Z.SET_LOADING,isLoading:!0}),await fetchApi("/courses/".concat(t,"/skip"),{method:"POST"}).then(handleErrorsAndJsonify),n({type:Z.SET_LOADING,isLoading:!1}),n({type:O});let o=i(),a=o.batch.assignments.filter(e=>e.assignmentType===x.AssignmentType.Course)[0];n({type:Z.SET_COURSE,course:a}),a||fetchNextAssignments(e)(n,i)}}function continueCourse(e,t){return async n=>{n({type:Z.SET_LOADING,isLoading:!0});let i=await fetchApi("/courses/".concat(e,"/continue"),{method:"POST",body:t}).then(handleErrorsAndJsonify),{courseProgress:o}=i,a=o.course;overrideCourseSectionsIfNeeded(a,o),n({type:Z.SET_COURSE_PROGRESS,courseProgress:i.courseProgress}),n({type:Z.SET_LOADING,isLoading:!1})}}function certificationTimeRemainingSecsSync(e,t){return async n=>{let i=await fetchApi("/courses/".concat(e,"/certificationTimeRemainingSecsSync"),{method:"POST",body:{certificationTimeRemainingSecs:t}}).then(handleErrorsAndJsonify);n({type:Z.SET_COURSE_PROGRESS,courseProgress:i.courseProgress})}}function fetchBonuses(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return async t=>{let n=await fetchApi("/scaler/work/bonuses/current_and_completed",{method:"GET"}).then(handleErrorsAndJsonify);t({type:F,bonuses:n,first:e})}}function displayNewBonus(e){return async t=>{t({type:D,bonus:e})}}function acceptProjectPricing(e,t){return async()=>{await fetchApi("/rateconsent/accept",{method:"POST",body:{projectId:e,rate:t}}).then(handleErrorsAndJsonify),window.location.reload(),await d().delay(5e3)}}function rejectProjectPricing(e,t){return async()=>{await fetchApi("/rateconsent/reject",{method:"POST",body:{projectId:e,rate:t}}).then(handleErrorsAndJsonify),window.location.reload(),await d().delay(5e3)}}function awaitConfirmationForNextTask(){return async e=>{e({type:G})}}function awaitConfirmationForSkipTask(e,t,n,i){let a,r,s;let c=(0,g.tQ)();y.Z.warn("Skipped Task",{assignmentId:t._id,attemptId:t.attemptId,skipReason:n,skipExplanation:i,pageLoadId:c});let d={skipReason:n,skipExplanation:i};return(0,b.isLegacyReviewAssignment)(t)?(r=[t.attemptId],t.childIds&&(r=r.concat(o().compact(t.childIds))),s="/attempts/unassign"):(a=[t._id],t.childIds&&(a=a.concat(o().compact(t.childIds))),s="/tasks/unassign"),async e=>{let t=await fetchApi(s,{method:"POST",body:{taskIds:a,attemptIds:r,isSkippedTask:!0,isSkipUserInitiated:!0,info:d}}).then(handleErrorsAndJsonify);return t.tooManySkips?alert("You have already reached the limit on skips for the day."):e({type:z}),t}}function fetchNextAssignmentsOnSkip(e){return async t=>{t(fetchNextAssignments(e)),t({type:N})}}function confirmReadyForNextTask(){return async e=>{e({type:U})}}}}]);