"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12636],{172086:function(t,e){function onSegment(t,e,i){return!!(e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y))}function orientation(t,e,i){let n=(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y);return 0===n?0:n>0?1:2}Object.defineProperty(e,"__esModule",{value:!0}),e.isPointInsidePolygon=function(t,e){let i=t.length;if(i<3)return!1;let n={x:1e9,y:e.y},r=0,a=0;for(;;){let o=(a+1)%i;if(function(t,e,i,n){let r=orientation(t,e,i),a=orientation(t,e,n),o=orientation(i,n,t),s=orientation(i,n,e);return!!(r!==a&&o!==s||0===r&&onSegment(t,i,e)||0===a&&onSegment(t,n,e)||0===o&&onSegment(i,t,n)||0===s&&onSegment(i,e,n))}(t[a],t[o],e,n)){if(0===orientation(t[a],e,t[o]))return onSegment(t[a],e,t[o]);r+=1}if(0===(a=o))break}return r%2==1}},412636:function(t,e,i){e.SW=e.D0=void 0;var n,r=(n=i(298784))&&n.__esModule?n:{default:n},a=i(845851),o=i(130850),s=i(692600),l=i(169186),h=i(971599),f=i(167469);let u={[f.TaskType.Transcription]:a.lintTranscription,[f.TaskType.SegmentAnnotation]:o.lintSegmentAnnotation,[f.TaskType.VideoAnnotation]:s.lintVideoAnnotation,[f.TaskType.VideoBoxAnnotation]:s.lintVideoAnnotation,[f.TaskType.VideoCuboidAnnotation]:s.lintVideoAnnotation,[f.TaskType.VideoPolygonAnnotation]:s.lintVideoAnnotation,[f.TaskType.ImageAnnotation]:l.lintImageAnnotation},c=[f.TaskType.SegmentAnnotation,f.TaskType.TextCollection,f.TaskType.NamedEntityRecognition];e.D0=t=>!c.includes(t),e.SW=(t,e,i=h.LintSeverity.INFO)=>{let n=r.default.get(u,t,()=>[]),a=[h.LintSeverity.ERROR];i===h.LintSeverity.WARNING?a.push(h.LintSeverity.WARNING):i===h.LintSeverity.INFO&&(a.push(h.LintSeverity.WARNING),a.push(h.LintSeverity.INFO));let o=n(e);return r.default.filter(o,t=>r.default.includes(a,t.severity))}},339271:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.dataQualityLinters=void 0;var n,r=(n=i(298784))&&n.__esModule?n:{default:n},a=i(971599),o=i(599789),s=i(935866),l=i(101241);let polygonMinShape=(t,e)=>{let i=[];if(t.vertices.length<3){let t=new a.LintDiagnostic(e,a.LintSeverity.DISMISSABLE_ERROR,{message:`Annotation [${e}] must have at least 3 points in its polygon)`,type:l.DataQualityLinterEnum.NO_POLYGON_WITH_LESS_THAN_THREE_POINTS});i.push(t)}return i},polygonNoDuplicatedPoints=(t,e)=>{let i=[],n=new Set;return r.default.forEach(t.vertices,t=>{if(n.has(t)){let n=new a.LintDiagnostic(e,a.LintSeverity.DISMISSABLE_ERROR,{message:`Annotation [${e}] cannot have duplicated point (${t.x}, ${t.y})`,type:l.DataQualityLinterEnum.NO_DUPLICATE_POINTS});i.push(n)}else n.add(t)}),i},annotationChecks=(t,e)=>{let i=[o.ReviewLevel.Attempt],n=[];if(!i.includes(e))return n;let a=t.annotations;return r.default.forEach(a,t=>{s.isPolygonAnnotation(t)&&(n.push(...polygonMinShape(t,t.uuid)),n.push(...polygonNoDuplicatedPoints(t,t.uuid)))}),n};e.dataQualityLinters=(t,e)=>{let i=[];return i.push(...annotationChecks(t,e)),i}},408412:function(t,e){function validTrainingLinter(t){return t&&t.type&&t.params?.labels}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){let i=(t.trainingScenario?.params?.trainingLinters||[]).filter(validTrainingLinter),n=i.find(t=>t.type===e);if(n&&n.type===e)return n}},935866:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.getFinalPolygonArea=e.getPolygonArea=e.getPolygonsMap=e.getNodesMap=e.isPolygonAnnotation=void 0;var n,r=i(440169),a=i(172086),o=i(308408),s=(n=i(298784))&&n.__esModule?n:{default:n};e.isPolygonAnnotation=t=>!!t.geometry&&t.geometry===o.AnnotationGeometry.Polygon||!!t.type&&t.type===o.AnnotationGeometry.Polygon,e.getNodesMap=(t,e,i)=>{let n={[t]:i[t],[e]:i[e]},r=!0,a=new Set(s.default.keys(n));for(;r;){r=!1;let t=s.default.flattenDeep(s.default.values(n)).filter(t=>!a.has(t));s.default.forEach(t,t=>{t&&!n[t]&&(n[t]=i[t]||[],r=!0),a.add(t)})}return n},e.getPolygonsMap=(t,e)=>{let i=Array.from(new Set(s.default.flattenDeep([s.default.entries(t)]))),n={};return s.default.forEach(i,t=>{n[t]=e.find(e=>e.uuid===t)??{}}),n},e.getPolygonArea=t=>{let e=r.polygonFor(t);return e.getArea()},e.getFinalPolygonArea=t=>{let e=0,i=s.default.flattenDeep([...t].map(t=>t.vertices)),n=s.default.minBy(i,t=>t.x),r=s.default.minBy(i,t=>t.y),o=s.default.maxBy(i,t=>t.x),l=s.default.maxBy(i,t=>t.y),h=null;for(let i of s.default.range(n.x,o.x))for(let n of s.default.range(r.y,l.y)){let r={x:i,y:n};if(h){if(a.isPointInsidePolygon(h.vertices,r)){e++;continue}h=null}let o=t.find(t=>a.isPointInsidePolygon(t.vertices,r));o&&(e++,h=o)}return e}},169186:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.lintImageAnnotation=void 0;var n,r=i(599789),a=(n=i(298784))&&n.__esModule?n:{default:n},o=i(722715),s=i(101241),l=i(339271);let h=["62c2c8453447790033a739c6","61a7c74850120a002cafe687"],visibleMaskLinter=(t,e,i=[])=>{let n=i.find(t=>{if(t?.condition?.scriptName!==s.ScriptLinterName.VisibleMask||t.stage===s.LintStage.Backend)return!1;switch(e){case r.ReviewLevel.Attempt:return t.enableAttempt;case r.ReviewLevel.Normal:return t.enableL0;case r.ReviewLevel.Level1:return t.enableL1;case r.ReviewLevel.Corp:return t.enableL10;case r.ReviewLevel.CorpFlagged:return t.enableL11;case r.ReviewLevel.Deliverable:return t.enableL12;default:return!1}});if(!n)return[];let a=n.message,l=n.frontendSeverity,h=n?.condition?.config??{linkLabel:"Object Occlusion Links",labels:["Bin","Human","Robot","Hole","Object","Compartment Wall","Occluded Part"],coveredThreshold:.98};return o.executeVisibleMaskLinter(t,h,a,l)};e.lintImageAnnotation=t=>{let e=t.response,i=t.metadata;if(!i)return[];let n=i.reviewLevel??r.ReviewLevel.Attempt,o=t.runningFrontend,s=a.default.isString(i.projectId)?i.projectId:a.default.isNil(i.projectId)?null:i.projectId.toString(),f=[];return o&&s&&h.includes(s)&&f.push(...visibleMaskLinter(e,n,i.responseLintersRules)),o&&s&&f.push(...l.dataQualityLinters(e,n)),f}},130850:function(t,e,i){i(830816).Buffer,Object.defineProperty(e,"__esModule",{value:!0}),e.lintSegmentAnnotation=void 0;var n=_interopRequireDefault(i(298784)),r=i(971599);i(139788);var a=i(135277),o=_interopRequireDefault(i(408412));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}_interopRequireDefault(i(210918));let{ERROR:s,WARNING:l}=r.LintSeverity,checkCheckmarkWorkflow=({task:t,subtask:e,response:i,featureFlaggedLinters:l})=>{let h=[],f=l?.["checkmark-workflow-linter"],u=o.default(t,a.TrainingLinterType.CheckCheckmarkWorkflow);if(!f||!u)return h;let c=n.default.pick(i.labelMapping,u.params.labels),p=n.default.flatten(n.default.values(c));if(!n.default.every(p,t=>t.hasReviewed)){let t=n.default.findKey(c,t=>Array.isArray(t)?n.default.find(t,t=>!t.hasReviewed):!t.hasReviewed);h.push(new r.LintDiagnostic("checkmark-workflow",s,{message:`Please be sure to inspect every ${t?`instance of ${t}`:"label and instance"} in the sidebar and mark them all as reviewed using the checkmark (or by pressing the 'shift' and 'space' keys at the same time).`}))}return h},checkOpacityWorkflow=({task:t,subtask:e,response:i,featureFlaggedLinters:l})=>{let h=[],f=l?.["opacity-workflow-linter"],u=o.default(t,a.TrainingLinterType.CheckOpacityWorkflow);if(!f||!u)return h;let c=u.params.labels.length>0,p=c?n.default.pick(i.labelMapping,u.params.labels):i.labelMapping,d=n.default.flatten(n.default.values(p));if(c){if(n.default.every(d,t=>t.hasAdjustedOpacity))return h;let t=n.default.findKey(p,t=>Array.isArray(t)?n.default.find(t,t=>!t.hasAdjustedOpacity):!t.hasAdjustedOpacity);h.push(new r.LintDiagnostic("opacity-workflow",s,{message:`Be sure to adjust the opacity when reviewing every ${t||"labeled"} annotation to check for edge precission errors (shortcut is the '<' and '>' keys).`}))}else n.default.some(d,t=>t.hasAdjustedOpacity)||h.push(new r.LintDiagnostic("opacity-workflow",s,{message:"Be sure to adjust the opacity to get a clear view when checking label edges by using the '<' or '>' keys."}));return h},checkOutlineWorkflow=({task:t,subtask:e,response:i,featureFlaggedLinters:a})=>{let o=[],l=a?.["outline-workflow-linter"];if(!l)return o;let h=i.labelMapping,f=n.default.pickBy(h,t=>t.numPixels>0&&!t.hasViewedWithOutlineTool),u=n.default.keys(f);return n.default.isEmpty(u)||o.push(new r.LintDiagnostic("outline-workflow",s,{message:`You must use the outline tool to check for stray pixels on every label (use the 'o' key to enable) before submitting.
 Please use outline tool on the following labels: ${n.default.join(u)}`})),o};e.lintSegmentAnnotation=t=>{let{task:e,subtask:i,response:n,featureFlaggedLinters:r,fromMadeChanges:a=!1}=t,o=[];return a||(o.push(...checkOpacityWorkflow({task:e,subtask:i,response:n,featureFlaggedLinters:r})),o.push(...checkOutlineWorkflow({task:e,subtask:i,response:n,featureFlaggedLinters:r})),o.push(...checkCheckmarkWorkflow({task:e,subtask:i,response:n,featureFlaggedLinters:r}))),o}},845851:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.lintTranscription=void 0;var n,r=(n=i(298784))&&n.__esModule?n:{default:n},a=i(971599);let{ERROR:o}=a.LintSeverity,s="5b1059fea2a93f002e8e0b76",lintCategoryCount=({task:t,response:e})=>{if(t.user?.toString()!==s)return[];let i=r.default.get(e,"repeatable_fields",[]);return i.length>3?[new a.LintDiagnostic("too-many-categories",o,{message:"You labeled more than three room labels. Please only select up to three room labels."})]:[]},lintCategoryDuplicate=({task:t,response:e})=>{if(t.user?.toString()!==s)return[];let i=[],n=!1;for(let t of r.default.get(e,"repeatable_fields",[])){let e=r.default.get(t,"title",[]);i.includes(e)&&(n=!0),i.push(e)}return n?[new a.LintDiagnostic("category-label-repeat",o,{message:"You repeated the same room category label. Please use each room category label once."})]:[]};e.lintTranscription=({task:t,response:e})=>{let i=[];return i.push(...lintCategoryCount({task:t,response:e})),i.push(...lintCategoryDuplicate({task:t,response:e})),i}},692600:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.lintVideoAnnotation=void 0;var n,r=i(971599),a=(n=i(210918))&&n.__esModule?n:{default:n};let{ERROR:o}=r.LintSeverity,s=[a.default.Narwhal],checkCheckmarkWorkflow=({reviewedAnnotations:t,response:e,subtask:i,featureFlaggedLinters:n})=>{let a=[],l=n?.["checkmark-workflow-linter"];return l&&l&&s.includes(i?.user)&&e.paths.length>t.paths.length&&a.push(new r.LintDiagnostic("checkmark-workflow",o,{message:"Every annotation must be looked at and marked as Done (using the checkmark tool) before submitting this task."})),a},getAnnotationUuids=t=>{if(t.paths)return new Set(t.paths[0]?.frames?t.paths.filter(t=>t.frames.filter(t=>!!t).length).map(t=>t.annotationId||t.uuid):t.paths.filter(t=>t.props?.perFrame?.edges?.length||t.props?.perFrame?.x?.length||t.props?.perFrame?.vertices?.length||t.props?.perFrame?.width?.length).map(t=>t.annotationId||t.uuid));if(t.annotations){let e=t.annotations;if(!e.length)return null;let i=new Set;for(let{annotations:t}of e)if(t?.length)for(let e of t)e.uuid&&i.add(e.uuid);return i}return null},checkBaseAnnotations=({response:t,subtask:e})=>{let i=[];if(!e.params?.base_annotations||e.params?.can_edit_base_annotations&&e.params?.can_delete_base_annotations!==!1)return i;let n=getAnnotationUuids(e.params.base_annotations);if(null===n)return i;let a=t?getAnnotationUuids(t):new Set;if(null===a)return i;for(let t of n)a.has(t)||i.push(new r.LintDiagnostic("base-annotations",o,{message:`Response is missing an annotation from the base annotations (uuid ${t}).`}));return i};e.lintVideoAnnotation=t=>{let{subtask:e,response:i,reviewedAnnotations:n,featureFlaggedLinters:r,fromMadeChanges:a=!1}=t,o=[];return a||o.push(...checkCheckmarkWorkflow({subtask:e,reviewedAnnotations:n,response:i,featureFlaggedLinters:r,fromMadeChanges:a})),e.params?.can_delete_base_annotations===!1&&o.push(...checkBaseAnnotations({subtask:e,response:i})),o}},722715:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.executeVisibleMaskLinter=void 0;var n,r=(n=i(298784))&&n.__esModule?n:{default:n},a=i(808704),o=i(971599),s=i(10814),l=i(935866);let h="There is a missing visible mask in the image. Please check links.";e.executeVisibleMaskLinter=(t,e,i=h,n=o.LintSeverity.WARNING)=>{let{linkLabel:f,labels:u,coveredThreshold:c=.98}=e,p=t.annotations,d=t.links.filter(t=>t.label===f),_=p.filter(t=>l.isPolygonAnnotation(t)&&u.includes(t.label)),g=_.map(t=>t.uuid),y={};r.default.forEach(d,t=>{g.includes(t.from)&&g.includes(t.to)&&(y[t.from]||(y[t.from]=[]),y[t.from].push(t.to))});let m=[],v=0;for(;v<2;){v++;let t={},e={},h={},findBackEdge=()=>{let i=r.default.keys(y).filter(t=>!m.includes(t));for(let n of i){if(t[n])continue;let i=[n];for(;i.length;){let n=i[i.length-1];if(t[n])e[n]=!1,i.splice(i.length-1);else for(let r of(t[n]=!0,e[n]=!0,y[n]??[]))if(t[r]){if(e[r])return{startNode:r,endNode:n}}else i.push(r),h[r]=n}}return{}},{startNode:f,endNode:u}=findBackEdge();if(!f||!u)break;let p=l.getNodesMap(f,u,y),d=l.getPolygonsMap(p,_),g={},b=[];if(r.default.forEach(p,(t,e)=>{if(!t.length){g[e]=l.getPolygonArea(d[e]);return}let{path:i}=s._subtractOverlappingAreas(d[e],t.map(t=>d[t]));r.default.isNil(i)?b.push(a.getFriendlyAnnotationId(e)):g[e]=l.getPolygonArea(i)}),!r.default.isEmpty(b))return[new o.LintDiagnostic("visible-mask",n,{message:i,taskComponentAnnotations:[{id:f,display:`Not visible area for annotations ${b.join(", ")}`}]})];let w=r.default.flattenDeep(r.default.keys(p).map(t=>d[t])),k=l.getFinalPolygonArea(w),T=r.default.sum(r.default.values(g));if(T/k<c)return[new o.LintDiagnostic("visible-mask",n,{message:i,taskComponentAnnotations:[{id:f,display:`Unexpected cyclical linking between annotations ${[f,u].map(t=>a.getFriendlyAnnotationId(t)).join(" - ")}`}]})];m.push(...r.default.keys(p))}return[]}},135277:function(t,e){var i,n,r,a;Object.defineProperty(e,"__esModule",{value:!0}),e.TrainingLinterType=e.TutorialStep=void 0,e.TutorialStep=i,(r=i||(e.TutorialStep=i={})).SelectAnnotation="select_annotation",r.Shortcut="lidar_shortcut",r.LidarFeature="lidar_feature",r.LoadComplete="load_complete",r.Text="text",e.TrainingLinterType=n,(a=n||(e.TrainingLinterType=n={})).CheckCheckmarkWorkflow="CheckCheckmarkWorkflow",a.CheckOpacityWorkflow="CheckOpacityWorkflow"},10814:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e._subtractOverlappingAreas=function(t,e,i=!1){let n=r.default.cloneDeep(t);for(let r of e){if(r.fake)continue;let e=subtractOtherFromPath(n,r,i);if(!e)return{success:e,path:t}}return r.default.isEmpty(n.vertices)?{success:!0,path:t}:{success:!0,path:n}},e._subtractOverlappingAreasFromOthers=function(t,e,i=!1){let n=r.default.cloneDeep(e);for(let r of n){let n=subtractOtherFromPath(r,t,i);if(!n)return{success:n,otherPaths:e}}let a=n.filter(t=>!r.default.isEmpty(t.vertices));return{success:!0,otherPaths:a}},e.checkSelfIntersections=function(t,e){if(e.length<3||t.length<0)return!1;let i=e.map(t=>new a.geom.Coordinate(t.x,t.y)),n=t.map(t=>new a.geom.Coordinate(t.x,t.y));for(let t of n){let e=a.geometryFactory.createLineString(i.slice(0,-1)),n=a.geometryFactory.createLineString([t,r.default.last(i)]);if(n.intersects(e))return!0;i.push(t)}return!1},e.checkSelfIntersection=function(t,e){if(e.length<3)return!1;let i=r.default.map(e.slice(0,e.length-1),t=>new a.geom.Coordinate(t.x,t.y)),n=a.geometryFactory.createLineString(i),o=a.geometryFactory.createLineString([new a.geom.Coordinate(t.x,t.y),new a.geom.Coordinate(e[e.length-1].x,e[e.length-1].y)]);return o.intersects(n)},e.doPathsOverlap=e.pointsToSVG=e.isClockwise=e.getDistance=e.getCenter=void 0;var n,r=(n=i(298784))&&n.__esModule?n:{default:n},a=i(440169),o=i(311311);function subtractOtherFromPath(t,e,i){let n=o.splitPointsByFragment(e.vertices,e.multiple_polygon_vertices),s=o.splitPointsByFragment(t.vertices,t.multiple_polygon_vertices),l=function subtractOtherPathVerticesListFromPathVerticesLists(t,e,i){let n=[];return e.forEach(e=>{let o=function(t,e,i){let n=[t],[o,...s]=e;return o?(n=function(t,e,i){if(t.length<3)return null;if(e.length<3)return[t];let n=a.polygonFor({vertices:t}),o=a.polygonFor({vertices:e});try{let s=n.difference(o),l=r.default.map(r.default.range(s.getNumGeometries()),t=>s.getGeometryN(t)),h=n.covers(o);if(h)return[function(t,e){let i,n;if(t.length<3||e.length<3)throw Error("Polygon must have at least 3 vertices");let r=a.polygonFor({vertices:t}),o=a.polygonFor({vertices:e});if(!r.covers(o))throw Error("Polygon does not cover other polygon");let s=Number.MAX_VALUE;if(t.forEach(t=>{e.forEach(e=>{let r=getDistance(t,e);r<s&&(s=r,i=t,n=e)})}),!i||!n)throw Error("Could not find closest pair of points");let l=[...t.slice(t.indexOf(i)),...t.slice(0,t.indexOf(i))],h=[...e.slice(e.indexOf(n)+1),...e.slice(0,e.indexOf(n)+1)],f=function(t,e){let i={x:e.x-t.x,y:e.y-t.y},n={x:-i.y,y:i.x},r=Math.sqrt(n.x**2+n.y**2),a={x:n.x/r,y:n.y/r};return a}(i,n),u=movePoint(i,f,1e-5),c=movePoint(n,f,1e-5),p=movePoint(i,f,-.00001),d=movePoint(n,f,-.00001),_=[...l,u,c,...h];if(a.polygonFor({vertices:_}).isSimple())return _;let g=[...l,p,d,...h];if(a.polygonFor({vertices:g}).isSimple())return g;h.reverse();let y=[...h.slice(h.indexOf(n)+1),...h.slice(0,h.indexOf(n)+1)],m=[...l,u,c,...y];if(a.polygonFor({vertices:m}).isSimple())return m;let v=[...l,p,d,...y];return v}(t,e)];if(!i){let t=r.default.maxBy(l,t=>t.getArea());return[t.getCoordinates().slice(1).map(({x:t,y:e})=>({x:t,y:e}))]}let f=[];return l.forEach(t=>{f.push(t.getCoordinates().slice(1).map(({x:t,y:e})=>({x:t,y:e})))}),f}catch(t){return null}}(t,o,i),r.default.isNil(n))?null:subtractOtherPathVerticesListFromPathVerticesLists(s,n,i):n}(e,t,i);if(r.default.isNil(o))return null;n.push(...o)}),n}(n,s,i);if(r.default.isNil(l))return!1;let h=[];r.default.each(l,t=>{t&&h?.push({vertices:t})});let f=r.default.reduce(h,(t,e)=>[...t,...e.vertices],[]);return h.length<=1&&(h=void 0),t.vertices=f,h&&(t.multiple_polygon_vertices=h),!0}e.getCenter=(t=[])=>{let e=r.default.min(t.map(t=>t.x))||0,i=r.default.min(t.map(t=>t.y))||0,n=r.default.max(t.map(t=>t.x))||0,a=r.default.max(t.map(t=>t.y))||0;return{x:(e+n)/2,y:(i+a)/2}};let getDistance=(t,e)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function movePoint(t,e,i=0){let n={x:t.x+e.x*i,y:t.y+e.y*i};return n}e.getDistance=getDistance,e.isClockwise=t=>{let e=r.default.sum(r.default.zipWith(t,t.slice(1).concat(t[0]),({x:t,y:e},{x:i,y:n})=>(e+n)*(t-i)));return e<0},e.pointsToSVG=t=>r.default.map(t,({x:t,y:e})=>`${t},${e}`).join(" "),e.doPathsOverlap=(t,e)=>{let i=o.splitPointsByFragment(t.vertices,t.multiple_polygon_vertices),n=o.splitPointsByFragment(e.vertices,e.multiple_polygon_vertices),s=r.default.map(i,t=>a.polygonFor({vertices:t})),l=r.default.map(n,t=>a.polygonFor({vertices:t}));return r.default.some(s,t=>r.default.some(l,e=>t.intersects(e)))}},610648:function(t,e,i){var n=i(830816).Buffer,r=i(452364),a=[function(){},function(t,e,i,n){if(n===e.length)throw Error("Ran out of data");var r=e[n];t[i]=r,t[i+1]=r,t[i+2]=r,t[i+3]=255},function(t,e,i,n){if(n+1>=e.length)throw Error("Ran out of data");var r=e[n];t[i]=r,t[i+1]=r,t[i+2]=r,t[i+3]=e[n+1]},function(t,e,i,n){if(n+2>=e.length)throw Error("Ran out of data");t[i]=e[n],t[i+1]=e[n+1],t[i+2]=e[n+2],t[i+3]=255},function(t,e,i,n){if(n+3>=e.length)throw Error("Ran out of data");t[i]=e[n],t[i+1]=e[n+1],t[i+2]=e[n+2],t[i+3]=e[n+3]}],o=[function(){},function(t,e,i,n){var r=e[0];t[i]=r,t[i+1]=r,t[i+2]=r,t[i+3]=n},function(t,e,i){var n=e[0];t[i]=n,t[i+1]=n,t[i+2]=n,t[i+3]=e[1]},function(t,e,i,n){t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=n},function(t,e,i){t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3]}];e.dataToBitMap=function(t,e){var i,s,l,h=e.width,f=e.height,u=e.depth,c=e.bpp,p=e.interlace;if(8!==u)var d,_,g=(d=[],_=0,{get:function(e){for(;d.length<e;)!function(){if(_===t.length)throw Error("Ran out of data");var e,i,n,r,a,o,s,l,h=t[_];switch(_++,u){default:throw Error("unrecognised depth");case 16:s=t[_],_++,d.push((h<<8)+s);break;case 4:s=15&h,l=h>>4,d.push(l,s);break;case 2:a=3&h,o=h>>2&3,s=h>>4&3,l=h>>6&3,d.push(l,s,o,a);break;case 1:e=1&h,i=h>>1&1,n=h>>2&1,r=h>>3&1,a=h>>4&1,o=h>>5&1,s=h>>6&1,l=h>>7&1,d.push(l,s,o,a,r,n,i,e)}}();var i=d.slice(0,e);return d=d.slice(e),i},resetAfterLine:function(){d.length=0},end:function(){if(_!==t.length)throw Error("extra data found")}});i=u<=8?new n(h*f*4):new Uint16Array(h*f*4);var y=Math.pow(2,u)-1,m=0;if(p)s=r.getImagePasses(h,f),l=r.getInterlaceIterator(h,f);else{var v=0;l=function(){var t=v;return v+=4,t},s=[{width:h,height:f}]}for(var b=0;b<s.length;b++)8===u?m=function(t,e,i,n,r,o){for(var s=t.width,l=t.height,h=t.index,f=0;f<l;f++)for(var u=0;u<s;u++){var c=i(u,f,h);a[n](e,r,c,o),o+=n}return o}(s[b],i,l,c,t,m):function(t,e,i,n,r,a){for(var s=t.width,l=t.height,h=t.index,f=0;f<l;f++){for(var u=0;u<s;u++){var c=r.get(n),p=i(u,f,h);o[n](e,c,p,a)}r.resetAfterLine()}}(s[b],i,l,c,g,y);if(8===u){if(m!==t.length)throw Error("extra data found")}else g.end();return i}},408178:function(t,e,i){var n=i(830816).Buffer,r=i(926835);t.exports=function(t,e,i,a){var o=-1!==[r.COLORTYPE_COLOR_ALPHA,r.COLORTYPE_ALPHA].indexOf(a.colorType);if(a.colorType===a.inputColorType){var s,l=(s=new ArrayBuffer(2),new DataView(s).setInt16(0,256,!0),256!==new Int16Array(s)[0]);if(8===a.bitDepth||16===a.bitDepth&&l)return t}var h=16!==a.bitDepth?t:new Uint16Array(t.buffer),f=255,u=r.COLORTYPE_TO_BPP_MAP[a.inputColorType];4!==u||a.inputHasAlpha||(u=3);var c=r.COLORTYPE_TO_BPP_MAP[a.colorType];16===a.bitDepth&&(f=65535,c*=2);var p=new n(e*i*c),d=0,_=0,g=a.bgColor||{};void 0===g.red&&(g.red=f),void 0===g.green&&(g.green=f),void 0===g.blue&&(g.blue=f);for(var y=0;y<i;y++)for(var m=0;m<e;m++){var v=function(){var t,e,i,n=f;switch(a.inputColorType){case r.COLORTYPE_COLOR_ALPHA:n=h[d+3],t=h[d],e=h[d+1],i=h[d+2];break;case r.COLORTYPE_COLOR:t=h[d],e=h[d+1],i=h[d+2];break;case r.COLORTYPE_ALPHA:n=h[d+1],e=t=h[d],i=t;break;case r.COLORTYPE_GRAYSCALE:e=t=h[d],i=t;break;default:throw Error("input color type:"+a.inputColorType+" is not supported at present")}return a.inputHasAlpha&&!o&&(n/=f,t=Math.min(Math.max(Math.round((1-n)*g.red+n*t),0),f),e=Math.min(Math.max(Math.round((1-n)*g.green+n*e),0),f),i=Math.min(Math.max(Math.round((1-n)*g.blue+n*i),0),f)),{red:t,green:e,blue:i,alpha:n}}(h,d);switch(a.colorType){case r.COLORTYPE_COLOR_ALPHA:case r.COLORTYPE_COLOR:8===a.bitDepth?(p[_]=v.red,p[_+1]=v.green,p[_+2]=v.blue,o&&(p[_+3]=v.alpha)):(p.writeUInt16BE(v.red,_),p.writeUInt16BE(v.green,_+2),p.writeUInt16BE(v.blue,_+4),o&&p.writeUInt16BE(v.alpha,_+6));break;case r.COLORTYPE_ALPHA:case r.COLORTYPE_GRAYSCALE:var b=(v.red+v.green+v.blue)/3;8===a.bitDepth?(p[_]=b,o&&(p[_+1]=v.alpha)):(p.writeUInt16BE(b,_),o&&p.writeUInt16BE(v.alpha,_+2));break;default:throw Error("unrecognised color Type "+a.colorType)}d+=u,_+=c}return p}},983979:function(t,e,i){var n=i(127061),r=i(830816).Buffer,a=i(971323),o=i(504957),s=t.exports=function(){o.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};a.inherits(s,o),s.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e}),n.nextTick((function(){this._process(),this._paused&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}).bind(this))},s.prototype.write=function(t,e){var i;return this.writable?(i=r.isBuffer(t)?t:new r(t,e||this._encoding),this._buffers.push(i),this._buffered+=i.length,this._process(),this._reads&&0===this._reads.length&&(this._paused=!0),this.writable&&!this._paused):(this.emit("error",Error("Stream not writable")),!1)},s.prototype.end=function(t,e){t&&this.write(t,e),this.writable=!1,this._buffers&&(0===this._buffers.length?this._end():(this._buffers.push(null),this._process()))},s.prototype.destroySoon=s.prototype.end,s.prototype._end=function(){this._reads.length>0&&this.emit("error",Error("Unexpected end of input")),this.destroy()},s.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},s.prototype._processReadAllowingLess=function(t){this._reads.shift();var e=this._buffers[0];e.length>t.length?(this._buffered-=t.length,this._buffers[0]=e.slice(t.length),t.func.call(this,e.slice(0,t.length))):(this._buffered-=e.length,this._buffers.shift(),t.func.call(this,e))},s.prototype._processRead=function(t){this._reads.shift();for(var e=0,i=0,n=new r(t.length);e<t.length;){var a=this._buffers[i++],o=Math.min(a.length,t.length-e);a.copy(n,e,0,o),e+=o,o!==a.length&&(this._buffers[--i]=a.slice(o))}i>0&&this._buffers.splice(0,i),this._buffered-=t.length,t.func.call(this,n)},s.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){var t=this._reads[0];if(t.allowLess)this._processReadAllowingLess(t);else if(this._buffered>=t.length)this._processRead(t);else break}this._buffers&&!this.writable&&this._end()}catch(t){this.emit("error",t)}}},926835:function(t){t.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},614115:function(t){var e=[];!function(){for(var t=0;t<256;t++){for(var i=t,n=0;n<8;n++)1&i?i=3988292384^i>>>1:i>>>=1;e[t]=i}}();var i=t.exports=function(){this._crc=-1};i.prototype.write=function(t){for(var i=0;i<t.length;i++)this._crc=e[(this._crc^t[i])&255]^this._crc>>>8;return!0},i.prototype.crc32=function(){return -1^this._crc},i.crc32=function(t){for(var i=-1,n=0;n<t.length;n++)i=e[(i^t[n])&255]^i>>>8;return -1^i}},503854:function(t,e,i){var n=i(830816).Buffer,r=i(905023),a={0:function(t,e,i,n,r){for(var a=0;a<i;a++)n[r+a]=t[e+a]},1:function(t,e,i,n,r,a){for(var o=0;o<i;o++){var s=o>=a?t[e+o-a]:0,l=t[e+o]-s;n[r+o]=l}},2:function(t,e,i,n,r){for(var a=0;a<i;a++){var o=e>0?t[e+a-i]:0,s=t[e+a]-o;n[r+a]=s}},3:function(t,e,i,n,r,a){for(var o=0;o<i;o++){var s=o>=a?t[e+o-a]:0,l=e>0?t[e+o-i]:0,h=t[e+o]-(s+l>>1);n[r+o]=h}},4:function(t,e,i,n,a,o){for(var s=0;s<i;s++){var l=s>=o?t[e+s-o]:0,h=e>0?t[e+s-i]:0,f=e>0&&s>=o?t[e+s-(i+o)]:0,u=t[e+s]-r(l,h,f);n[a+s]=u}}},o={0:function(t,e,i){for(var n=0,r=e+i,a=e;a<r;a++)n+=Math.abs(t[a]);return n},1:function(t,e,i,n){for(var r=0,a=0;a<i;a++){var o=a>=n?t[e+a-n]:0;r+=Math.abs(t[e+a]-o)}return r},2:function(t,e,i){for(var n=0,r=e+i,a=e;a<r;a++){var o=e>0?t[a-i]:0;n+=Math.abs(t[a]-o)}return n},3:function(t,e,i,n){for(var r=0,a=0;a<i;a++){var o=a>=n?t[e+a-n]:0,s=e>0?t[e+a-i]:0;r+=Math.abs(t[e+a]-(o+s>>1))}return r},4:function(t,e,i,n){for(var a=0,o=0;o<i;o++){var s=o>=n?t[e+o-n]:0,l=e>0?t[e+o-i]:0,h=e>0&&o>=n?t[e+o-(i+n)]:0;a+=Math.abs(t[e+o]-r(s,l,h))}return a}};t.exports=function(t,e,i,r,s){if("filterType"in r&&-1!==r.filterType){if("number"==typeof r.filterType)l=[r.filterType];else throw Error("unrecognised filter types")}else l=[0,1,2,3,4];16===r.bitDepth&&(s*=2);for(var l,h=e*s,f=0,u=0,c=new n((h+1)*i),p=l[0],d=0;d<i;d++){if(l.length>1)for(var _=1/0,g=0;g<l.length;g++){var y=o[l[g]](t,u,h,s);y<_&&(p=l[g],_=y)}c[f]=p,f++,a[p](t,u,h,c,f,s),f+=h,u+=h}return c}},327287:function(t,e,i){var n=i(830816).Buffer,r=i(971323),a=i(983979),o=i(947279),s=t.exports=function(t){a.call(this);var e=[],i=this;this._filter=new o(t,{read:this.read.bind(this),write:function(t){e.push(t)},complete:function(){i.emit("complete",n.concat(e))}}),this._filter.start()};r.inherits(s,a)},955032:function(t,e,i){var n=i(830816).Buffer,r=i(694029),a=i(947279);e.process=function(t,e){var i=[],o=new r(t);return new a(e,{read:o.read.bind(o),write:function(t){i.push(t)},complete:function(){}}).start(),o.process(),n.concat(i)}},947279:function(t,e,i){var n=i(830816).Buffer,r=i(452364),a=i(905023);function getByteWidth(t,e,i){var n=t*e;return 8!==i&&(n=Math.ceil(n/(8/i))),n}var o=t.exports=function(t,e){var i=t.width,n=t.height,a=t.interlace,o=t.bpp,s=t.depth;if(this.read=e.read,this.write=e.write,this.complete=e.complete,this._imageIndex=0,this._images=[],a)for(var l=r.getImagePasses(i,n),h=0;h<l.length;h++)this._images.push({byteWidth:getByteWidth(l[h].width,o,s),height:l[h].height,lineIndex:0});else this._images.push({byteWidth:getByteWidth(i,o,s),height:n,lineIndex:0});8===s?this._xComparison=o:16===s?this._xComparison=2*o:this._xComparison=1};o.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},o.prototype._unFilterType1=function(t,e,i){for(var n=this._xComparison,r=n-1,a=0;a<i;a++){var o=t[1+a],s=a>r?e[a-n]:0;e[a]=o+s}},o.prototype._unFilterType2=function(t,e,i){for(var n=this._lastLine,r=0;r<i;r++){var a=t[1+r],o=n?n[r]:0;e[r]=a+o}},o.prototype._unFilterType3=function(t,e,i){for(var n=this._xComparison,r=n-1,a=this._lastLine,o=0;o<i;o++){var s=t[1+o],l=a?a[o]:0,h=Math.floor(((o>r?e[o-n]:0)+l)/2);e[o]=s+h}},o.prototype._unFilterType4=function(t,e,i){for(var n=this._xComparison,r=n-1,o=this._lastLine,s=0;s<i;s++){var l=t[1+s],h=o?o[s]:0,f=a(s>r?e[s-n]:0,h,s>r&&o?o[s-n]:0);e[s]=l+f}},o.prototype._reverseFilterLine=function(t){var e,i=t[0],r=this._images[this._imageIndex],a=r.byteWidth;if(0===i)e=t.slice(1,a+1);else switch(e=new n(a),i){case 1:this._unFilterType1(t,e,a);break;case 2:this._unFilterType2(t,e,a);break;case 3:this._unFilterType3(t,e,a);break;case 4:this._unFilterType4(t,e,a);break;default:throw Error("Unrecognised filter type - "+i)}this.write(e),r.lineIndex++,r.lineIndex>=r.height?(this._lastLine=null,this._imageIndex++,r=this._images[this._imageIndex]):this._lastLine=e,r?this.read(r.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}},404183:function(t,e,i){var n=i(830816).Buffer;t.exports=function(t,e){var i=e.depth,r=e.width,a=e.height,o=e.colorType,s=e.transColor,l=e.palette,h=t;return 3===o?function(t,e,i,n,r){for(var a=0,o=0;o<n;o++)for(var s=0;s<i;s++){var l=r[t[a]];if(!l)throw Error("index "+t[a]+" not in palette");for(var h=0;h<4;h++)e[a+h]=l[h];a+=4}}(t,h,r,a,l):(s&&function(t,e,i,n,r){for(var a=0,o=0;o<n;o++)for(var s=0;s<i;s++){var l=!1;if(1===r.length?r[0]===t[a]&&(l=!0):r[0]===t[a]&&r[1]===t[a+1]&&r[2]===t[a+2]&&(l=!0),l)for(var h=0;h<4;h++)e[a+h]=0;a+=4}}(t,h,r,a,s),8!==i&&(16===i&&(h=new n(r*a*4)),function(t,e,i,n,r){for(var a=Math.pow(2,r)-1,o=0,s=0;s<n;s++)for(var l=0;l<i;l++){for(var h=0;h<4;h++)e[o+h]=Math.floor(255*t[o+h]/a+.5);o+=4}}(t,h,r,a,i))),h}},452364:function(t,e){var i=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];e.getImagePasses=function(t,e){for(var n=[],r=t%8,a=e%8,o=(t-r)/8,s=(e-a)/8,l=0;l<i.length;l++){for(var h=i[l],f=o*h.x.length,u=s*h.y.length,c=0;c<h.x.length;c++)if(h.x[c]<r)f++;else break;for(c=0;c<h.y.length;c++)if(h.y[c]<a)u++;else break;f>0&&u>0&&n.push({width:f,height:u,index:l})}return n},e.getInterlaceIterator=function(t){return function(e,n,r){var a=e%i[r].x.length,o=(e-a)/i[r].x.length*8+i[r].x[a],s=n%i[r].y.length;return 4*o+((n-s)/i[r].y.length*8+i[r].y[s])*t*4}}},993171:function(t,e,i){var n=i(830816).Buffer,r=i(971323),a=i(504957),o=i(926835),s=i(298700),l=t.exports=function(t){a.call(this);var e=t||{};this._packer=new s(e),this._deflate=this._packer.createDeflate(),this.readable=!0};r.inherits(l,a),l.prototype.pack=function(t,e,i,r){this.emit("data",new n(o.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(e,i)),r&&this.emit("data",this._packer.packGAMA(r));var a=this._packer.filterData(t,e,i);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",(function(t){this.emit("data",this._packer.packIDAT(t))}).bind(this)),this._deflate.on("end",(function(){this.emit("data",this._packer.packIEND()),this.emit("end")}).bind(this)),this._deflate.end(a)}},35576:function(t,e,i){var n=i(830816).Buffer,r=!0,a=i(546864);a.deflateSync||(r=!1);var o=i(926835),s=i(298700);t.exports=function(t,e){if(!r)throw Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var i=new s(e||{}),l=[];l.push(new n(o.PNG_SIGNATURE)),l.push(i.packIHDR(t.width,t.height)),t.gamma&&l.push(i.packGAMA(t.gamma));var h=i.filterData(t.data,t.width,t.height),f=a.deflateSync(h,i.getDeflateOptions());if(h=null,!f||!f.length)throw Error("bad png - invalid compressed data response");return l.push(i.packIDAT(f)),l.push(i.packIEND()),n.concat(l)}},298700:function(t,e,i){var n=i(830816).Buffer,r=i(926835),a=i(614115),o=i(408178),s=i(503854),l=i(546864),h=t.exports=function(t){if(this._options=t,t.deflateChunkSize=t.deflateChunkSize||32768,t.deflateLevel=null!=t.deflateLevel?t.deflateLevel:9,t.deflateStrategy=null!=t.deflateStrategy?t.deflateStrategy:3,t.inputHasAlpha=null==t.inputHasAlpha||t.inputHasAlpha,t.deflateFactory=t.deflateFactory||l.createDeflate,t.bitDepth=t.bitDepth||8,t.colorType="number"==typeof t.colorType?t.colorType:r.COLORTYPE_COLOR_ALPHA,t.inputColorType="number"==typeof t.inputColorType?t.inputColorType:r.COLORTYPE_COLOR_ALPHA,-1===[r.COLORTYPE_GRAYSCALE,r.COLORTYPE_COLOR,r.COLORTYPE_COLOR_ALPHA,r.COLORTYPE_ALPHA].indexOf(t.colorType))throw Error("option color type:"+t.colorType+" is not supported at present");if(-1===[r.COLORTYPE_GRAYSCALE,r.COLORTYPE_COLOR,r.COLORTYPE_COLOR_ALPHA,r.COLORTYPE_ALPHA].indexOf(t.inputColorType))throw Error("option input color type:"+t.inputColorType+" is not supported at present");if(8!==t.bitDepth&&16!==t.bitDepth)throw Error("option bit depth:"+t.bitDepth+" is not supported at present")};h.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},h.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},h.prototype.filterData=function(t,e,i){var n=o(t,e,i,this._options),a=r.COLORTYPE_TO_BPP_MAP[this._options.colorType];return s(n,e,i,this._options,a)},h.prototype._packChunk=function(t,e){var i=e?e.length:0,r=new n(i+12);return r.writeUInt32BE(i,0),r.writeUInt32BE(t,4),e&&e.copy(r,8),r.writeInt32BE(a.crc32(r.slice(4,r.length-4)),r.length-4),r},h.prototype.packGAMA=function(t){var e=new n(4);return e.writeUInt32BE(Math.floor(t*r.GAMMA_DIVISION),0),this._packChunk(r.TYPE_gAMA,e)},h.prototype.packIHDR=function(t,e){var i=new n(13);return i.writeUInt32BE(t,0),i.writeUInt32BE(e,4),i[8]=this._options.bitDepth,i[9]=this._options.colorType,i[10]=0,i[11]=0,i[12]=0,this._packChunk(r.TYPE_IHDR,i)},h.prototype.packIDAT=function(t){return this._packChunk(r.TYPE_IDAT,t)},h.prototype.packIEND=function(){return this._packChunk(r.TYPE_IEND,null)}},905023:function(t){t.exports=function(t,e,i){var n=t+e-i,r=Math.abs(n-t),a=Math.abs(n-e),o=Math.abs(n-i);return r<=a&&r<=o?t:a<=o?e:i}},874409:function(t,e,i){var n=i(971323),r=i(546864),a=i(983979),o=i(327287),s=i(229713),l=i(610648),h=i(404183),f=t.exports=function(t){a.call(this),this._parser=new s(t,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=t,this.writable=!0,this._parser.start()};n.inherits(f,a),f.prototype._handleError=function(t){this.emit("error",t),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",function(){})),this.errord=!0},f.prototype._inflateData=function(t){if(!this._inflate){if(this._bitmapInfo.interlace)this._inflate=r.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{var e=((this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3)+1)*this._bitmapInfo.height,i=Math.max(e,r.Z_MIN_CHUNK);this._inflate=r.createInflate({chunkSize:i});var n=e,a=this.emit.bind(this,"error");this._inflate.on("error",function(t){n&&a(t)}),this._filter.on("complete",this._complete.bind(this));var o=this._filter.write.bind(this._filter);this._inflate.on("data",function(t){n&&(t.length>n&&(t=t.slice(0,n)),n-=t.length,o(t))}),this._inflate.on("end",this._filter.end.bind(this._filter))}}this._inflate.write(t)},f.prototype._handleMetaData=function(t){this._metaData=t,this._bitmapInfo=Object.create(t),this._filter=new o(this._bitmapInfo)},f.prototype._handleTransColor=function(t){this._bitmapInfo.transColor=t},f.prototype._handlePalette=function(t){this._bitmapInfo.palette=t},f.prototype._simpleTransparency=function(){this._metaData.alpha=!0},f.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},f.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"),this.destroySoon())},f.prototype._complete=function(t){if(!this.errord){try{var e=l.dataToBitMap(t,this._bitmapInfo),i=h(e,this._bitmapInfo);e=null}catch(t){this._handleError(t);return}this.emit("parsed",i)}}},873259:function(t,e,i){var n=i(830816).Buffer,r=!0,a=i(546864),o=i(368621);a.deflateSync||(r=!1);var s=i(694029),l=i(955032),h=i(229713),f=i(610648),u=i(404183);t.exports=function(t,e){if(!r)throw Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var i,c,p,d,_=[],g=new s(t);if(new h(e,{read:g.read.bind(g),error:function(t){i=t},metadata:function(t){c=t},gamma:function(t){p=t},palette:function(t){c.palette=t},transColor:function(t){c.transColor=t},inflateData:function(t){_.push(t)},simpleTransparency:function(){c.alpha=!0}}).start(),g.process(),i)throw i;var y=n.concat(_);if(_.length=0,c.interlace)d=a.inflateSync(y);else{var m=((c.width*c.bpp*c.depth+7>>3)+1)*c.height;d=o(y,{chunkSize:m,maxLength:m})}if(y=null,!d||!d.length)throw Error("bad png - invalid inflate data response");var v=l.process(d,c);y=null;var b=f.dataToBitMap(v,c);v=null;var w=u(b,c);return c.data=w,c.gamma=p||0,c}},229713:function(t,e,i){var n=i(830816).Buffer,r=i(926835),a=i(614115),o=t.exports=function(t,e){this._options=t,t.checkCRC=!1!==t.checkCRC,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[r.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[r.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[r.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[r.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[r.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[r.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=e.read,this.error=e.error,this.metadata=e.metadata,this.gamma=e.gamma,this.transColor=e.transColor,this.palette=e.palette,this.parsed=e.parsed,this.inflateData=e.inflateData,this.finished=e.finished,this.simpleTransparency=e.simpleTransparency,this.headersFinished=e.headersFinished||function(){}};o.prototype.start=function(){this.read(r.PNG_SIGNATURE.length,this._parseSignature.bind(this))},o.prototype._parseSignature=function(t){for(var e=r.PNG_SIGNATURE,i=0;i<e.length;i++)if(t[i]!==e[i]){this.error(Error("Invalid file signature"));return}this.read(8,this._parseChunkBegin.bind(this))},o.prototype._parseChunkBegin=function(t){for(var e=t.readUInt32BE(0),i=t.readUInt32BE(4),o="",s=4;s<8;s++)o+=String.fromCharCode(t[s]);var l=!!(32&t[4]);if(!this._hasIHDR&&i!==r.TYPE_IHDR){this.error(Error("Expected IHDR on beggining"));return}if(this._crc=new a,this._crc.write(new n(o)),this._chunks[i])return this._chunks[i](e);if(!l){this.error(Error("Unsupported critical chunk type "+o));return}this.read(e+4,this._skipChunk.bind(this))},o.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},o.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},o.prototype._parseChunkEnd=function(t){var e=t.readInt32BE(0),i=this._crc.crc32();if(this._options.checkCRC&&i!==e){this.error(Error("Crc error - "+e+" - "+i));return}this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},o.prototype._handleIHDR=function(t){this.read(t,this._parseIHDR.bind(this))},o.prototype._parseIHDR=function(t){this._crc.write(t);var e=t.readUInt32BE(0),i=t.readUInt32BE(4),n=t[8],a=t[9],o=t[10],s=t[11],l=t[12];if(8!==n&&4!==n&&2!==n&&1!==n&&16!==n){this.error(Error("Unsupported bit depth "+n));return}if(!(a in r.COLORTYPE_TO_BPP_MAP)){this.error(Error("Unsupported color type"));return}if(0!==o){this.error(Error("Unsupported compression method"));return}if(0!==s){this.error(Error("Unsupported filter method"));return}if(0!==l&&1!==l){this.error(Error("Unsupported interlace method"));return}this._colorType=a;var h=r.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:e,height:i,depth:n,interlace:!!l,palette:!!(a&r.COLORTYPE_PALETTE),color:!!(a&r.COLORTYPE_COLOR),alpha:!!(a&r.COLORTYPE_ALPHA),bpp:h,colorType:a}),this._handleChunkEnd()},o.prototype._handlePLTE=function(t){this.read(t,this._parsePLTE.bind(this))},o.prototype._parsePLTE=function(t){this._crc.write(t);for(var e=Math.floor(t.length/3),i=0;i<e;i++)this._palette.push([t[3*i],t[3*i+1],t[3*i+2],255]);this.palette(this._palette),this._handleChunkEnd()},o.prototype._handleTRNS=function(t){this.simpleTransparency(),this.read(t,this._parseTRNS.bind(this))},o.prototype._parseTRNS=function(t){if(this._crc.write(t),this._colorType===r.COLORTYPE_PALETTE_COLOR){if(0===this._palette.length){this.error(Error("Transparency chunk must be after palette"));return}if(t.length>this._palette.length){this.error(Error("More transparent colors than palette size"));return}for(var e=0;e<t.length;e++)this._palette[e][3]=t[e];this.palette(this._palette)}this._colorType===r.COLORTYPE_GRAYSCALE&&this.transColor([t.readUInt16BE(0)]),this._colorType===r.COLORTYPE_COLOR&&this.transColor([t.readUInt16BE(0),t.readUInt16BE(2),t.readUInt16BE(4)]),this._handleChunkEnd()},o.prototype._handleGAMA=function(t){this.read(t,this._parseGAMA.bind(this))},o.prototype._parseGAMA=function(t){this._crc.write(t),this.gamma(t.readUInt32BE(0)/r.GAMMA_DIVISION),this._handleChunkEnd()},o.prototype._handleIDAT=function(t){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-t,this._parseIDAT.bind(this,t))},o.prototype._parseIDAT=function(t,e){if(this._crc.write(e),this._colorType===r.COLORTYPE_PALETTE_COLOR&&0===this._palette.length)throw Error("Expected palette not found");this.inflateData(e);var i=t-e.length;i>0?this._handleIDAT(i):this._handleChunkEnd()},o.prototype._handleIEND=function(t){this.read(t,this._parseIEND.bind(this))},o.prototype._parseIEND=function(t){this._crc.write(t),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}},614083:function(t,e,i){var n=i(873259),r=i(35576);e.read=function(t,e){return n(t,e||{})},e.write=function(t,e){return r(t,e)}},139788:function(t,e,i){var n=i(830816).Buffer,r=i(127061),a=i(971323),o=i(504957),s=i(874409),l=i(993171),h=i(614083),f=e.PNG=function(t){o.call(this),t=t||{},this.width=0|t.width,this.height=0|t.height,this.data=this.width>0&&this.height>0?new n(4*this.width*this.height):null,t.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new s(t),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",(function(t){this.data=t,this.emit("parsed",t)}).bind(this)),this._packer=new l(t),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};a.inherits(f,o),f.sync=h,f.prototype.pack=function(){return this.data&&this.data.length?r.nextTick((function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}).bind(this)):this.emit("error","No data provided"),this},f.prototype.parse=function(t,e){if(e){var i,n;i=(function(t){this.removeListener("error",n),this.data=t,e(null,this)}).bind(this),n=(function(t){this.removeListener("parsed",i),e(t,null)}).bind(this),this.once("parsed",i),this.once("error",n)}return this.end(t),this},f.prototype.write=function(t){return this._parser.write(t),!0},f.prototype.end=function(t){this._parser.end(t)},f.prototype._metadata=function(t){this.width=t.width,this.height=t.height,this.emit("metadata",t)},f.prototype._gamma=function(t){this.gamma=t},f.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},f.bitblt=function(t,e,i,n,r,a,o,s){if(n|=0,r|=0,a|=0,o|=0,s|=0,(i|=0)>t.width||n>t.height||i+r>t.width||n+a>t.height)throw Error("bitblt reading outside image");if(o>e.width||s>e.height||o+r>e.width||s+a>e.height)throw Error("bitblt writing outside image");for(var l=0;l<a;l++)t.data.copy(e.data,(s+l)*e.width+o<<2,(n+l)*t.width+i<<2,(n+l)*t.width+i+r<<2)},f.prototype.bitblt=function(t,e,i,n,r,a,o){return f.bitblt(this,t,e,i,n,r,a,o),this},f.adjustGamma=function(t){if(t.gamma){for(var e=0;e<t.height;e++)for(var i=0;i<t.width;i++)for(var n=t.width*e+i<<2,r=0;r<3;r++){var a=t.data[n+r]/255;a=Math.pow(a,1/2.2/t.gamma),t.data[n+r]=Math.round(255*a)}t.gamma=0}},f.prototype.adjustGamma=function(){f.adjustGamma(this)}},368621:function(t,e,i){var n=i(127061),r=i(830816).Buffer,a=i(939619).ok,o=i(546864),s=i(971323),l=i(830816).kMaxLength;function Inflate(t){if(!(this instanceof Inflate))return new Inflate(t);t&&t.chunkSize<o.Z_MIN_CHUNK&&(t.chunkSize=o.Z_MIN_CHUNK),o.Inflate.call(this,t),this._offset=void 0===this._offset?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,t&&null!=t.maxLength&&(this._maxLength=t.maxLength)}function _close(t,e){e&&n.nextTick(e),t._handle&&(t._handle.close(),t._handle=null)}function inflateSync(t,e){return function(t,e){if("string"==typeof e&&(e=r.from(e)),!(e instanceof r))throw TypeError("Not a string or buffer");var i=t._finishFlushFlag;return null==i&&(i=o.Z_FINISH),t._processChunk(e,i)}(new Inflate(e),t)}Inflate.prototype._processChunk=function(t,e,i){if("function"==typeof i)return o.Inflate._processChunk.call(this,t,e,i);var n,s=this,h=t&&t.length,f=this._chunkSize-this._offset,u=this._maxLength,c=0,p=[],d=0;this.on("error",function(t){n=t}),a(this._handle,"zlib binding closed");do{var _=this._handle.writeSync(e,t,c,h,this._buffer,this._offset,f);_=_||this._writeState}while(!this._hadError&&function(t,e){if(!s._hadError){var i=f-e;if(a(i>=0,"have should not go down"),i>0){var n=s._buffer.slice(s._offset,s._offset+i);if(s._offset+=i,n.length>u&&(n=n.slice(0,u)),p.push(n),d+=n.length,0==(u-=n.length))return!1}return(0===e||s._offset>=s._chunkSize)&&(f=s._chunkSize,s._offset=0,s._buffer=r.allocUnsafe(s._chunkSize)),0===e&&(c+=h-t,h=t,!0)}}(_[0],_[1]));if(this._hadError)throw n;if(d>=l)throw _close(this),RangeError("Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes");var g=r.concat(p,d);return _close(this),g},s.inherits(Inflate,o.Inflate),t.exports=e=inflateSync,e.Inflate=Inflate,e.createInflate=function(t){return new Inflate(t)},e.inflateSync=inflateSync},694029:function(t){var e=t.exports=function(t){this._buffer=t,this._reads=[]};e.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e})},e.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){var t=this._reads[0];if(this._buffer.length&&(this._buffer.length>=t.length||t.allowLess)){this._reads.shift();var e=this._buffer;this._buffer=e.slice(t.length),t.func.call(this,e.slice(0,t.length))}else break}return this._reads.length>0?Error("There are some read requests waitng on finished stream"):this._buffer.length>0?Error("unrecognised content at end of stream"):void 0}}}]);