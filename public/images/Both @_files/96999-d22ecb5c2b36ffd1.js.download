"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[96999],{945914:function(e,t,n){var a=n(824246);n(827378);var i=n(60042),s=n.n(i),o=n(792739),l=n(433536);let r=(0,l.ZL)({container:{display:"flex",flexDirection:"column",justifyContent:"center",flexFlow:"column nowrap",flexWrap:"nowrap"},exampleTypeSelector:{display:"flex",justifyContent:"center",marginBottom:"12px"},exampleType:{margin:"8px",padding:"2px 8px 2px 8px",border:"1px solid #E6E6E6",borderRadius:"8px"},exampleTypeClickable:{cursor:"pointer"}});t.Z=e=>{let{exampleType:t,disabled:n,setExampleType:i,readOnly:l}=e,d=r();return(0,a.jsx)("div",{className:d.container,children:(0,a.jsxs)("div",{className:d.exampleTypeSelector,children:[(!l||"good"===t)&&(0,a.jsxs)("div",{className:s()(d.exampleType,{[d.exampleTypeClickable]:!n}),onClick:()=>!n&&i("good"),style:"good"===t?{border:"1px solid green"}:{},children:[(0,a.jsx)(o.FontAwesomeIcon,{icon:"check-circle",color:"green",style:{fontSize:"11px",lineHeight:"16px",marginRight:8,opacity:.5}}),"Well labeled example"]}),(!l||"bad"===t)&&(0,a.jsxs)("div",{className:s()(d.exampleType,{[d.exampleTypeClickable]:!n}),onClick:()=>!n&&i("bad"),style:"bad"===t?{border:"1px solid red"}:{},children:[(0,a.jsx)(o.FontAwesomeIcon,{icon:"times-circle",color:"red",style:{fontSize:"11px",lineHeight:"16px",marginRight:8,opacity:.3}}),"Poorly labeled example"]})]})})}},284614:function(e,t,n){n.d(t,{Q:function(){return C}});var a=n(824246),i=n(674721),s=n.n(i),o=n(827378),l=n(293030),r=n(320280),d=n(792739),c=n(433536),p=n(384077),h=n(513735),x=n(945914),m=n(275534),u=n(718755),g=n(585912),f=n(789018),b=n(629554),j=n(167469),y=n(235900),v=n(891298),w=n(657127),k=n(460754),I=n(298784),S=n.n(I);let C="What does this example illustrate? Click here to add a description.",T=(0,c.ZL)({container:{display:"flex",flexDirection:"column",justifyContent:"center",flexFlow:"column nowrap",flexWrap:"nowrap"},dialog:{width:"100%",overflow:"hidden",margin:"2% auto 20px"},dialogRoot:{zIndex:"110 !important"},exampleTypeSelector:{display:"flex",justifyContent:"center",marginBottom:"12px"},exampleType:{margin:"8px",padding:"2px 8px 2px 8px",border:"1px solid #E6E6E6",borderRadius:"8px",cursor:"pointer"},selectorControls:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"24px"},createButton:{display:"flex",width:"100%",alignItems:"center",justifyContent:"flex-end"}});t.Z=e=>{let{modalOpen:t,lastSelection:n,project:i,uploadedAssets:c,taxonomy:I,location:N,caption:A,setModalOpen:Z,handleSave:E,trayExamples:R,setTrayExamples:L}=e,F=T(),[M,D]=(0,o.useState)(0),[z]=(0,o.useState)({}),[P]=(0,o.useState)({}),[B,O]=(0,o.useState)("good"),[W,_]=(0,o.useState)(!1),[H,U]=(0,o.useState)(A),[Y,q]=(0,o.useState)(void 0),[V,G]=(0,o.useState)(""),[X,Q]=(0,o.useState)(R||N.examples||[]),[$,K]=(0,o.useState)(!1),[J,ee]=(0,o.useState)(!1),[et,en]=(0,o.useState)(-1),[ea,ei]=(0,o.useState)(!1),{fetchUnprocessedAttachments:es}=(0,k.Z)(),{taskType:eo}=(0,v.kc)(),el=(0,m.ui)(),fetchAsset=async e=>(z[e]||(z[e]=(await f.Z.selfserve.fetchAssetS3URL({assetId:e})).signedURL),z[e]),hasAnnotations=async()=>{if(!er.current)return!1;{let e=await er.current.getReviewChanges();return eo===j.TaskType.Categorization?e.taxonomies&&e.taxonomies.length>0:e.annotations&&e.annotations.length>0}},fetchAssetPages=async e=>(P[e]||(P[e]=(await f.Z.selfserve.fetchAssetPages({assetId:e})).pageURLs),P[e]),fetchAssetToTemplateAttachment=async(e,t)=>{let{attachment:n}=await f.Z.selfserve.fetchAssetToTemplateAttachment({assetId:e,project:t.id});return n};(0,o.useEffect)(()=>{t&&D(0)},[t]),(0,o.useEffect)(()=>{let e=!1;return async function(){if(c&&c.length>0){q(void 0);let n=await (0,b.kh)(null!=eo?eo:i.type,c[M],I,!0,fetchAsset,fetchAssetPages,i.useTextCollectionTemplate?fetchAssetToTemplateAttachment:void 0,i);if(n.attachments&&S().every(n.attachments,e=>"unprocessed"===e.type)){var t;n.attachments=await es(null!==(t=n.attachments)&&void 0!==t?t:[])}e||q({...u.sampleTask,type:null!=eo?eo:i.type,params:n,assignment:{projectId:i.id,params:n,type:null!=eo?eo:i.type,featureFlags:{showSidebar:(null!=eo?eo:i.type)===j.TaskType.NamedEntityRecognition||void 0}},timerDisabled:!0,shouldWarnOnExit:!1,readOnly:!1,editable:!0,canEdit:!0,isCustomer:!0,showHeader:!1,isTaxonomyDisplay:!0,showFooter:!1})}c&&c[M+1]&&(null!=eo?eo:i.type)===j.TaskType.DocumentTranscription&&f.Z.selfserve.fetchAssetPages({assetId:c[M+1]._id})}(),function(){e=!0}},[i,c,I,M]);let er=(0,o.useRef)(),onContinue=async()=>{if(_(!0),er.current&&i){let e=await er.current.getReviewChanges(),t=c[M]._id,n={project:i.id,type:null!=eo?eo:i.type,uploadedAsset:t,taxonomy:I,response:e};try{let{taskId:e,msg:t}=await f.Z.selfserve.setInstructionsExample(n);if(!t){let t={taskId:e,isGoodExample:"good"===B};t.caption=H,g.YR.setNodes(el,{examples:[...X,t]},{at:N.path}),Q([...X,t]),handleCreated(),L&&L([...X,t])}G("")}catch(e){G("verify that the response is valid")}_(!1)}},handleCreated=()=>{K(!0),ei(!0),setTimeout(()=>K(!1),2e3)},handleMove=e=>{en(e),ee(!0)};return(0,a.jsxs)(a.Fragment,{children:[J&&(0,a.jsx)(y.Z,{isOpen:J,message:"do you want to change images without saving the example?",onSubmit:()=>{D(et),en(-1),ei(!1),ee(!1)},onRequestClose:()=>ee(!1)}),(0,a.jsxs)(r.Vq,{classes:{root:F.dialogRoot,paper:F.dialog},maxWidth:"lg",open:t,onClose:e=>{((null==e?void 0:e.type)!=="keydown"||(null==e?void 0:e.keyCode)!==27)&&(!W&&n&&n.anchor&&g.YR.select(el,n),E&&E(),Z(!1))},children:[(0,a.jsx)(r.$N,{children:(0,a.jsx)("div",{style:{textAlign:"center",fontWeight:500,fontSize:"16px",lineHeight:"20px"},children:"Create both well labeled and poorly labeled examples"})}),(0,a.jsxs)(r.cZ,{children:[(!c||0===c.length)&&(0,a.jsx)("h6",{className:"jsx-8b0aa6d31560dfb1",children:"No assets to display..."}),c&&c.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{exampleType:B,setExampleType:O,disabled:W,readOnly:!1}),V.length>0&&(0,a.jsx)(r.bZ,{severity:"error",style:{marginTop:"2px",marginBottom:"12px"},children:V}),$&&(0,a.jsx)(r.bZ,{severity:"success",style:{marginTop:"2px",marginBottom:"12px"},children:"example created!"}),Y?(0,a.jsx)(w.Z,{children:(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)(l.Z,{style:{paddingBottom:"16px"}}),children:(0,a.jsx)("div",{className:"jsx-8b0aa6d31560dfb1 component",children:(0,a.jsx)(h.M5,{children:(0,a.jsx)(p.Z,{taskType:Y.type,taskProps:Y,taskRef:er,isTaxonomyDisplay:(null!=eo?eo:i.type)!=="categorization"})})})})}):(0,a.jsx)(l.Z,{style:{paddingBottom:"16px"}}),(0,a.jsx)("input",{value:H,placeholder:C,style:{opacity:.75,marginTop:12,textAlign:"center",border:0,fontSize:"14px",width:"100%"},onFocus:e=>e.target.placeholder="",onBlur:e=>e.target.placeholder=C,onChange:e=>{e.preventDefault(),U(e.target.value)},className:"jsx-8b0aa6d31560dfb1"}),(0,a.jsxs)("div",{className:"jsx-8b0aa6d31560dfb1 "+(F.selectorControls||""),children:[(0,a.jsx)(r.u,{arrow:!0,placement:"top",title:"jump to first asset",children:(0,a.jsx)("div",{className:"jsx-8b0aa6d31560dfb1",children:(0,a.jsx)("a",{onClick:async()=>{W||(!ea&&await hasAnnotations()?handleMove(0):(D(0),ei(!1)))},className:"jsx-8b0aa6d31560dfb1",children:(0,a.jsx)(d.FontAwesomeIcon,{icon:"angle-double-left",color:"black",style:{width:16,height:16,marginLeft:8,marginTop:4}})})})}),(0,a.jsx)(r.u,{arrow:!0,placement:"top",title:"view previous asset",children:(0,a.jsx)("div",{className:"jsx-8b0aa6d31560dfb1",children:(0,a.jsx)("a",{style:{marginLeft:"8px"},onClick:async()=>{let e=(M-1+c.length)%c.length;W||(!ea&&await hasAnnotations()?handleMove(e):(D(e),ei(!1)))},className:"jsx-8b0aa6d31560dfb1",children:(0,a.jsx)(d.FontAwesomeIcon,{icon:"angle-left",color:"black",style:{width:16,height:16,marginLeft:8,marginTop:4}})})})}),(0,a.jsxs)("p",{style:{margin:"0px 10px 0px 10px"},className:"jsx-8b0aa6d31560dfb1",children:[M+1," of ",c.length]}),(0,a.jsx)(r.u,{arrow:!0,placement:"top",title:"view next asset",children:(0,a.jsx)("div",{className:"jsx-8b0aa6d31560dfb1",children:(0,a.jsx)("a",{style:{marginRight:"8px"},onClick:async()=>{let e=(M+1)%c.length;W||(!ea&&await hasAnnotations()?handleMove(e):(D(e),ei(!1)))},className:"jsx-8b0aa6d31560dfb1",children:(0,a.jsx)(d.FontAwesomeIcon,{icon:"angle-right",color:"black",style:{width:16,height:16,marginLeft:8,marginTop:4}})})})}),(0,a.jsx)(r.u,{arrow:!0,placement:"top",title:"jump to last asset",children:(0,a.jsx)("div",{className:"jsx-8b0aa6d31560dfb1",children:(0,a.jsx)("a",{onClick:async()=>{let e=c.length-1;W||(!ea&&await hasAnnotations()?handleMove(e):(D(e),ei(!1)))},className:"jsx-8b0aa6d31560dfb1",children:(0,a.jsx)(d.FontAwesomeIcon,{icon:"angle-double-right",color:"black",style:{width:16,height:16,marginLeft:8,marginTop:4}})})})})]})]}),(0,a.jsx)(s(),{id:"8b0aa6d31560dfb1",children:".component{height:540px}.component,.component .task{-webkit-box-flex:1;-webkit-flex-grow:1;-moz-box-flex:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;min-height:0;min-width:0;width:100%;overflow:auto}.task__splitpane{position:relative;overflow:auto}"}),(0,a.jsx)("div",{className:"jsx-8b0aa6d31560dfb1 "+(F.createButton||""),children:(0,a.jsx)(r.zx,{type:"primary",onClick:onContinue,disabled:W,children:W?"Saving":"Save example"})})]})]})]})}},246127:function(e,t,n){n.d(t,{Z:function(){return useInstructionTaskData}});var a=n(789018),i=n(456552);let useInstructionTaskData=(e,t,n,s)=>{let o=(0,i.useQuery)(["use-instruction-task-data",e],()=>a.Z.selfserve.fetchInstructionExample({task:e,projectTemplateId:n,notRequiredInstructionExample:s}),t?{cacheTime:3e5}:{cacheTime:0});return o}},119875:function(e,t,n){n.d(t,{Z:function(){return Instructions}});var a=n(824246),i=n(827378),s=n(433536),o=n(335331),l=n(674721),r=n.n(l),d=n(789018),c=n(585912),p=n(505940),h=n(275534),x=n(318681),m=n(390547),u=n(792739),g=n(400070),f=n(298784),b=n.n(f),j=n(99562);let y=(0,s.ZL)({sectionButton:{outline:"none",background:"#F8F8F8",border:"none",padding:"4px 6px",marginLeft:6,borderRadius:4,fontSize:14,fontWeight:500,color:"#DD45D3",cursor:"pointer",transition:"background 120ms ease-out","&:hover":{background:j.ZP.colors.periwinkle25}},questionMenu:{position:"absolute",top:32,left:6,background:"white",padding:4,borderRadius:8,minWidth:200,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)"},menuItem:{display:"flex",alignItems:"center",fontSize:14,fontWeight:400,padding:8,borderRadius:4,cursor:"pointer","&:hover":{background:j.ZP.colors.periwinkle25}}}),AddSection=e=>{let{lastSelection:t,shouldShowLabeledExamples:n}=e,s=y(),[o,l]=(0,i.useState)(!1),r=(0,h.ui)(),handleSelect=e=>{let n;"iframe"===e?n={type:"iframe",url:"",children:[{text:""}]}:"exampleLabel"===e&&(n={type:"label-section",labelName:b().startCase(b().toLower("Label Name...")),examples:[],children:[{text:""}]}),n&&(c.YR.select(r,t),c.YR.insertNodes(r,n),c.YR.insertNodes(r,{type:"paragraph",children:[{text:" "}]})),l(!o)},uploadImages=async e=>{if(e&&e.length>0){let{assetId:n}=await d.Z.selfserve.uploadInstructionImage({file:e.item(0)});n&&(c.YR.select(r,t),c.YR.insertNodes(r,{type:"image",assetId:n,children:[{text:""}]}),c.YR.insertNodes(r,{type:"paragraph",children:[{text:" "}]}))}l(!o)};return(0,a.jsxs)("div",{style:{position:"relative",margin:"16px 0"},children:[(0,a.jsx)("button",{style:{color:j.ZP.colors.periwinkle100},className:s.sectionButton,onClick:e=>{e.preventDefault(),l(!o)},children:"Insert"}),o&&(0,a.jsxs)("div",{className:s.questionMenu,children:[(0,a.jsxs)("div",{className:s.menuItem,onClick:()=>handleSelect("iframe"),children:[(0,a.jsx)(u.FontAwesomeIcon,{icon:"anchor",color:"#555",style:{width:16,height:16,marginRight:12}}),"Iframe (embed URL)"]}),(0,a.jsx)("label",{htmlFor:"file-upload",children:(0,a.jsxs)("div",{className:s.menuItem,children:[(0,a.jsx)(u.FontAwesomeIcon,{icon:"image",color:"#555",style:{width:16,height:16,marginRight:12}}),"Image or PDF"]})}),(0,a.jsx)("input",{style:{display:"none",opacity:0},id:"file-upload",type:"file",accept:"image/*,application/pdf",onChange:e=>uploadImages(e.target.files)}),n&&(0,a.jsxs)("div",{className:s.menuItem,onClick:()=>handleSelect("exampleLabel"),children:[(0,a.jsx)(u.FontAwesomeIcon,{icon:"tag",color:"#555",style:{width:16,height:16,marginRight:12}}),"Labeled Examples"]})]})]})};var v=n(320280),w=n(995632),k=n(161320),I=n.n(k);let S=(0,s.ZL)({container:{display:"flex",flexDirection:"column",alignItems:"center"},dialog:{width:"500px",overflow:"hidden",margin:"2% auto 20px"},dialogRoot:{zIndex:"110 !important"},createButton:{paddingTop:"15px"}});var Instructions_DescriptionModal=e=>{let{modalOpen:t,setModalOpen:n,changeDescription:i,setChangeDescription:s}=e,o=S(),close=e=>{((null==e?void 0:e.type)!=="keydown"||(null==e?void 0:e.keyCode)!==27)&&n(!1)};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(v.Vq,{classes:{root:o.dialogRoot,paper:o.dialog},open:t,onClose:close,children:[(0,a.jsx)(v.$N,{children:(0,a.jsx)("div",{style:{textAlign:"center",fontWeight:500,fontSize:"16px",lineHeight:"20px"},children:"Provide a brief summary of changes for labelers (optional)"})}),(0,a.jsx)(v.cZ,{children:(0,a.jsxs)("div",{className:o.container,children:[(0,a.jsx)(v.oi,{size:"large",fullWidth:!0,placeholder:"Brief summary of changes",label:"Description",value:i,onChange:e=>{s(e.target.value)}}),(0,a.jsx)("div",{className:o.createButton,children:(0,a.jsx)(v.zx,{type:"primary",onClick:close,children:"Confirm"})})]})})]})})};let C=(0,j.ZL)(e=>({toolbar:{background:"#F8F8F8",zIndex:1,display:"flex",flexDirection:"row",alignItems:"center",padding:e.spacing(0,2),minWidth:600},menuButton:{marginRight:e.spacing(2)},activeIcon:{color:"".concat(e.colors.primary1," !important")},icon:{width:18,height:18},text:{fontSize:"16px",fontWeight:"normal"},actions:{display:"flex",marginLeft:"auto",justifyContent:"end",alignItems:"center"},updateActions:{width:"300px",display:"flex",marginRight:e.spacing(2),marginLeft:e.spacing(2)}}));var Instructions_EditorToolbar=e=>{let{toggleMark:t,toggleBlock:n,isBlockActive:s,isMarkActive:o,lastSelection:l,shouldShowLabeledExamples:r=!0,handleSave:d,updatedAt:c,isDirty:p=!0,isOnboardingComplete:f=!0}=e,b=C(),j=(0,h.ui)(),[y,k]=(0,w.Z)(!1),[S,T]=(0,w.Z)(!1),[N,A]=(0,w.Z)(!1),[Z,E]=(0,i.useState)(""),[R,L]=(0,w.Z)(!1),F=(0,i.useCallback)(()=>{S||A(!0),T()},[S,T,A]),handleMouseDown=function(e,a){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mark";e.preventDefault(),"mark"===i?t(j,a):"block"===i&&n(j,a)};return(0,a.jsxs)(x.Z,{className:b.toolbar,children:[[1,2,3,4].map((e,t)=>(0,a.jsx)(g.ZP,{placement:"bottom",title:"Header Level ".concat(t+1),children:(0,a.jsx)(m.Z,{edge:"start",color:"inherit",onMouseDown:e=>handleMouseDown(e,"heading-".concat(t+1),"block"),children:(0,a.jsx)("span",{className:"".concat(b.text," ").concat(s(j,"heading-".concat(t+1))?b.activeIcon:""," "),children:"H".concat(t+1)})})},t)),(0,a.jsx)(g.ZP,{placement:"bottom",title:"Bold",children:(0,a.jsx)(m.Z,{edge:"start",color:"inherit",onMouseDown:e=>handleMouseDown(e,"bold"),children:(0,a.jsx)(u.FontAwesomeIcon,{icon:"bold",className:"".concat(b.icon," ").concat(o(j,"bold")?b.activeIcon:"")})})}),(0,a.jsx)(g.ZP,{placement:"bottom",title:"Italic",children:(0,a.jsx)(m.Z,{edge:"start",color:"inherit",onMouseDown:e=>handleMouseDown(e,"italic"),children:(0,a.jsx)(u.FontAwesomeIcon,{icon:"italic",className:"".concat(b.icon," ").concat(o(j,"italic")?b.activeIcon:""," ")})})}),(0,a.jsx)(g.ZP,{placement:"bottom",title:"Underline",children:(0,a.jsx)(m.Z,{edge:"start",color:"inherit",onMouseDown:e=>handleMouseDown(e,"underline"),children:(0,a.jsx)(u.FontAwesomeIcon,{icon:"underline",className:"".concat(b.icon," ").concat(o(j,"underline")?b.activeIcon:""," ")})})}),(0,a.jsx)(g.ZP,{placement:"bottom",title:"Bulleted List",children:(0,a.jsx)(m.Z,{edge:"start",color:"inherit",onMouseDown:e=>handleMouseDown(e,"bulleted-list","block"),children:(0,a.jsx)(u.FontAwesomeIcon,{icon:"list",className:"".concat(b.icon," ").concat(s(j,"bulleted-list")?b.activeIcon:""," ")})})}),(0,a.jsx)(g.ZP,{placement:"bottom",title:"Numbered List",children:(0,a.jsx)(m.Z,{edge:"start",color:"inherit",onMouseDown:e=>handleMouseDown(e,"numbered-list","block"),children:(0,a.jsx)(u.FontAwesomeIcon,{icon:"list-ol",className:"".concat(b.icon," ").concat(s(j,"numbered-list")?b.activeIcon:""," ")})})}),(0,a.jsx)(AddSection,{lastSelection:l,shouldShowLabeledExamples:r}),c&&(0,a.jsxs)("div",{style:{marginLeft:8},children:["Updated: ",I()(c).format("MM/DD/YY hh:mmA")]}),(0,a.jsx)(a.Fragment,{children:d&&(0,a.jsxs)("div",{className:b.actions,children:[f&&(0,a.jsxs)("div",{className:b.updateActions,children:[N&&(0,a.jsx)(Instructions_DescriptionModal,{modalOpen:N,setModalOpen:A,changeDescription:Z,setChangeDescription:E}),(0,a.jsx)(v.XZ,{label:"update labelers",checked:S,onChange:F}),(0,a.jsx)(g.ZP,{title:"Force labelers to reread the new instructions.",placement:"top",children:(0,a.jsx)("div",{style:{paddingLeft:"4px",lineHeight:"32px",textAlign:"center"},children:(0,a.jsx)(u.FontAwesomeIcon,{icon:"question-circle",color:"gray"})})}),(0,a.jsx)(v.XZ,{label:"update tasks",checked:y,onChange:k}),(0,a.jsx)(g.ZP,{title:"Update existing pending tasks with new instructions.",placement:"top",children:(0,a.jsx)("div",{style:{paddingLeft:"4px",lineHeight:"32px",textAlign:"center"},children:(0,a.jsx)(u.FontAwesomeIcon,{icon:"question-circle",color:"gray"})})})]}),(0,a.jsxs)(v.zx,{type:"primary",disabled:!d||!p||R,onClick:async()=>{d&&(L(!0),await d(y,S,Z),E(""),L(!1))},children:["Save",!!R&&(0,a.jsx)(v.D8,{size:12,color:"primary",style:{marginLeft:8}})]})]})})]})};let XButton=e=>{let{onClick:t}=e;return(0,a.jsx)(m.Z,{edge:"start",color:"inherit",onMouseDown:()=>t(),children:(0,a.jsx)(u.FontAwesomeIcon,{style:{width:16,height:16,cursor:"pointer",opacity:.75},icon:"trash"})})},IframeSection=e=>{let{attributes:t,children:n,element:s,readOnly:o,setInfoMsg:l}=e,{url:r}=s,d=(0,h.ui)(),[p,x]=(0,i.useState)(r);return(0,a.jsxs)("div",{...t,style:{border:"1px solid #E6E6E6"},children:[!o&&(0,a.jsxs)("div",{style:{display:"flex"},children:[(0,a.jsx)("div",{style:{left:"96%",position:"relative",color:j.ZP.colors.primary1},children:(0,a.jsx)(XButton,{onClick:()=>{c.YR.delete(d,{at:h.F3.findPath(d,s)})}})}),(0,a.jsxs)("div",{contentEditable:!1,style:{width:"90%",display:"flex"},children:[(0,a.jsx)("div",{style:{opacity:.5,fontSize:"16px",paddingRight:"8px",paddingTop:"8px"},children:"url:"}),(0,a.jsx)("div",{style:{paddingTop:"4px",width:"100%"},children:(0,a.jsx)(v.oi,{placeholder:"Enter publicly accessible url to embed in this iframe",fullWidth:!0,autoFocus:!1,value:p,onChange:e=>{e.preventDefault(),x(e.target.value);let t=h.F3.findPath(d,s);c.YR.setNodes(d,{url:e.target.value},{at:t})},onBlur:e=>{l&&(l("Please make sure your url is publicly accessible!"),setTimeout(()=>l(""),5e3))}})})]})]}),(0,a.jsx)("div",{contentEditable:!1,children:(0,a.jsx)("div",{style:{padding:"75% 0 0 0",position:"relative"},children:(0,a.jsx)("iframe",{src:r,frameBorder:"0",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}})})}),n]})};var T=n(352991);let ImageSection=e=>{let{attributes:t,children:n,element:s}=e,{assetId:o}=s,[l,c]=(0,i.useState)(null);return(0,i.useEffect)(()=>{(async function(){try{let e=await d.Z.selfserve.fetchInstructionAssetS3URL({assetId:o});e&&c(e)}catch(e){(0,T.vj)(e,{handleHttp:!0})}})()},[o]),(0,a.jsxs)("div",{...t,className:"jsx-1779f09ba0f2df0 "+(t&&null!=t.className&&t.className||"imageContainer"),children:[(0,a.jsx)("div",{contentEditable:!1,style:{display:"flex"},className:"jsx-1779f09ba0f2df0",children:l?(0,a.jsx)(a.Fragment,{children:"application/pdf"===l.mimeType?(0,a.jsx)("object",{data:l.signedURL+"#toolbar=0",type:"application/pdf",width:"100%",height:"800",className:"jsx-1779f09ba0f2df0"}):(0,a.jsx)("img",{src:l.signedURL,className:"jsx-1779f09ba0f2df0"})}):(0,a.jsx)("div",{className:"jsx-1779f09ba0f2df0",children:"loading..."})}),n,(0,a.jsx)(r(),{id:"1779f09ba0f2df0",children:".button.jsx-1779f09ba0f2df0{opacity:0;position:relative;right:-33%;top:-12px}.imageContainer.jsx-1779f09ba0f2df0:hover .button.jsx-1779f09ba0f2df0{opacity:1}"})]})};var N=n(167469),A=n(293030),Z=n(945914),E=n(384077),R=n(513735),L=n(599789),F=n(891941),M=n(107873),D=n(718755),z=n(456552),P=n(284614),B=n(246127),O=n(657127),W=n(460754);let _=(0,j.ZL)({dialog:{width:"100%",overflow:"hidden",margin:"3% auto 20px"},zIndexHigh:{zIndex:"2000 !important"},zIndexLow:{zIndex:"110 !important"},title:{textAlign:"center"}});var Instructions_ExampleViewer=e=>{let{modalOpen:t,taskInfo:n,taskId:s,location:o,lastSelection:l,readOnly:p,setModalOpen:x,hasOpenedExample:m,projectTemplateId:u,handleUpdateExample:g}=e,f=_(),[j,y]=(0,i.useState)(!1),w=(0,i.useRef)(),k=(0,h.ui)(),[I,S]=(0,i.useState)(""),[C,T]=(0,i.useState)(""),[N,H]=(0,i.useState)(void 0),{data:U}=(0,B.Z)(s,p,u),{goodExample:Y,caption:q}=n,{params:V,response:G,type:X,projectId:Q,status:$}=U,[K,J]=(0,i.useState)(q),[ee,et]=(0,i.useState)(Y?"good":"bad"),en=(0,z.useQueryClient)(),{fetchUnprocessedAttachments:ea}=(0,W.Z)(),ei=!p&&N&&$===L.TaskStatus.Completed;(0,i.useEffect)(()=>{let e=!1;return async function(){if(!j&&V&&X&&Q){if(H(void 0),V&&V.attachments&&V.attachments.length>0&&b().every(V.attachments,e=>"unprocessed"===e.type)){var t;V.attachments=await ea(null!==(t=V.attachments)&&void 0!==t?t:[])}e||(m&&m(s,Y),H({...D.sampleTask,assignment:{params:V,projectId:Q,type:X},type:X,params:V,fixResponse:G,timerDisabled:!0,shouldWarnOnExit:!1,readOnly:!ei,editable:ei,isCustomer:!0,showHeader:!1,isTaxonomyDisplay:!0,showFooter:!1}))}}(),function(){e=!0}},[n]);let handleSuccess=()=>{T("Task updated"),setTimeout(()=>T(""),2e3)},handleError=()=>{S("Task update failed"),setTimeout(()=>S(""),2e3)},onUpdate=async()=>{if(T(""),S(""),y(!0),o&&o.examples){let e=[...o.examples],t=b().map(e,e=>{if(e.taskId===s){let t={isGoodExample:"good"===ee};return t.caption=K,Object.assign({},e,t)}return e});c.YR.setNodes(k,{examples:t},{at:o.path})}if(w.current)try{let e=await w.current.getReviewChanges(),t=await d.Z.selfserve.updateInstructionsExample({task:s,response:e});en.invalidateQueries(["use-instruction-task-data",s]),t.success?(H({...N,fixResponse:e}),handleSuccess()):handleError()}catch(e){handleError()}y(!1),g&&g({taskId:s,caption:K,isGoodExample:"good"===ee})};return(0,a.jsxs)(v.Vq,{classes:{root:p?f.zIndexHigh:f.zIndexLow,paper:f.dialog},maxWidth:"lg",open:t,onClose:e=>{((null==e?void 0:e.type)!=="keydown"||(null==e?void 0:e.keyCode)!==27)&&(l&&l.anchor&&c.YR.select(k,l),x(!1))},children:[(0,a.jsx)(v.$N,{children:(0,a.jsx)("div",{className:f.title,children:"Example"})}),(0,a.jsxs)(v.cZ,{children:[!N&&(0,a.jsx)("h6",{className:"jsx-78deb52573c15da2",children:"No Images to display..."}),N&&$!==L.TaskStatus.Completed&&(0,a.jsx)(F.Z,{severity:"info",style:{marginTop:"16px"},children:"Annotations are still being processed"}),I.length>0&&(0,a.jsx)(F.Z,{severity:"error",style:{marginTop:"2px",marginBottom:"12px"},children:I}),C.length>0&&(0,a.jsx)(F.Z,{severity:"success",style:{marginTop:"2px",marginBottom:"12px"},children:C}),N&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{exampleType:ee,setExampleType:e=>{p||et(e)},disabled:p,readOnly:p}),(0,a.jsx)(O.Z,{children:(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)(A.Z,{style:{paddingBottom:"16px"}}),children:(0,a.jsx)("div",{className:"jsx-78deb52573c15da2 component",children:(0,a.jsx)(R.M5,{children:(0,a.jsx)(E.Z,{taskType:N.type,taskProps:N,taskRef:w,isTaxonomyDisplay:!0})})})})})]}),(0,a.jsx)(r(),{id:"78deb52573c15da2",children:".component{height:540px}.component,.component .task{-webkit-box-flex:1;-webkit-flex-grow:1;-moz-box-flex:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;min-height:0;min-width:0;width:100%;overflow:auto}.task__splitpane{position:relative;overflow:auto}"}),ei&&(0,a.jsx)("input",{value:K,placeholder:P.Q,style:{opacity:.75,marginTop:12,textAlign:"center",border:0,fontSize:"14px",width:"100%"},onFocus:e=>e.target.placeholder="",onBlur:e=>e.target.placeholder=P.Q,onChange:e=>{e.preventDefault(),J(e.target.value)},className:"jsx-78deb52573c15da2"}),q&&!ei&&(0,a.jsx)("div",{style:{marginTop:12,textAlign:"center",background:"white",border:0,fontSize:"14px",width:"100%"},className:"jsx-78deb52573c15da2",children:q})]}),ei?(0,a.jsx)(v.kX,{children:(0,a.jsx)(M.zx,{onClick:()=>onUpdate(),disabled:j||!ei,type:"primary",children:"Update"})}):(0,a.jsx)(a.Fragment,{})]})};let getAttachmentInfo=e=>{let t,n;if(!e)return{attachmentType:null,attachment:null};let a=e.type;return a===N.TaskType.TextCollection?(t=e.params.attachments[0].type,n=e.params.attachments[0].content):a===N.TaskType.NamedEntityRecognition?(t="text",n=e.params.text):a===N.TaskType.DocumentTranscription?(t="image",n=e.params.attachments[0]):(t=e.params.attachment_type,n=e.params.attachment),{attachmentType:t,attachment:n}},ExampleLabelPreview=e=>{var t,n;let{taskId:s,isGoodExample:o,location:l,index:r,caption:d,readOnly:c,onDelete:p,hasOpenedExample:x,projectTemplateId:m,onUpdate:g}=e,f=H(),b=(0,h.ui)(),[j,y]=(0,i.useState)(!1),[v,w]=(0,i.useState)(null),{isLoading:k,data:I}=(0,B.Z)(s,c,m);if(k)return(0,a.jsx)("div",{children:"Loading..."});let{attachmentType:S,attachment:C}=getAttachmentInfo(I);return(0,a.jsxs)("div",{className:f.label,children:[j&&(0,a.jsx)(Instructions_ExampleViewer,{modalOpen:j,lastSelection:v,setModalOpen:e=>y(e),taskId:s,location:l,taskInfo:{...I,goodExample:o,caption:d},readOnly:c,hasOpenedExample:x,projectTemplateId:m,handleUpdateExample:g}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{onClick:async e=>{e.preventDefault(),w(b.selection),y(!0)},children:[(0,a.jsx)("div",{children:(e=>{let t=!c&&(0,a.jsx)(XButton,{onClick:()=>p()}),n=null;return"pdf"===S?n=(0,a.jsx)(u.FontAwesomeIcon,{icon:["far","file-pdf"]}):"image"===S?n=(0,a.jsx)(u.FontAwesomeIcon,{icon:["far","file-image"]}):"audio"===S?n=(0,a.jsx)(u.FontAwesomeIcon,{icon:["far","file-audio"]}):"website"===S?n=(0,a.jsx)(u.FontAwesomeIcon,{icon:["far","globe"]}):"text"===S?n=(0,a.jsx)(u.FontAwesomeIcon,{icon:["far","file-alt"]}):"video"===S&&(n=(0,a.jsx)(u.FontAwesomeIcon,{icon:["far","video"]})),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[n," ",(0,a.jsxs)("span",{style:{padding:"4px"},children:["Example ",e]})," ",t]})})(r+1)}),(0,a.jsx)("div",{className:f.preview,style:{border:"2px solid ".concat(o?"green":"red")},children:(t=C,n=S,t&&n?"image"===n||"unprocessed"===n?(0,a.jsx)("img",{className:f.img,src:t,crossOrigin:"anonymous"}):"text"===n?(0,a.jsx)("div",{className:f.text,children:t}):"pdf"===n?(0,a.jsx)("object",{className:f.pdf,data:t}):"audio"===n||"transcription_audio"===n?(0,a.jsx)("audio",{className:f.audio,src:t,controls:!0}):"website"===n?(0,a.jsx)("div",{className:f.website,children:t}):"video"===n?(0,a.jsx)("video",{className:f.video,src:t}):null:(0,a.jsx)("div",{className:f.text,children:"Error loading example."}))})]})})]})},H=(0,s.ZL)({label:{"&:hover $button":{opacity:1},position:"relative"},button:{opacity:"0",top:"-6px",right:"-6px",position:"absolute",zIndex:1,color:"gray"},preview:{width:"120px",height:"120px",position:"relative",overflow:"hidden"},img:{objectFit:"cover",width:"120px",height:"120px"},pdf:{width:"100%",height:"100%",overflow:"hidden",pointerEvents:"none"},audio:{width:"100%",height:"100%",background:"#dddddd"},video:{width:"100%",height:"100%",background:"#dddddd",padding:"2px",boxSizing:"border-box"},website:{background:"#dddddd",fontSize:"10px",overflow:"hidden",width:"100%",height:"100%",boxSizing:"border-box",padding:"4px"},text:{background:"#dddddd",fontSize:"10px",overflow:"hidden",width:"100%",height:"100%",boxSizing:"border-box",padding:"4px",maxHeight:"120px"}}),U=(0,v.ZL)({loadingIconContainer:{display:"flex",justifyContent:"center",alignItems:"center"},container:{scrollbarWidth:"none",display:"flex",flexWrap:"wrap",flexDirection:"row",gap:j.ZP.spacing(3),borderRadius:"8px",marginTop:"8px",overflowX:"auto",overflowY:"hidden",padding:"4px",msOverflowStyle:"none","&::-webkit-scrollbar":{display:"none"}},example:{border:"1px dashed #CCCCCC",borderRadius:"4px",height:"64px",textAlign:"center",verticalAlign:"middle",lineHeight:"64px"},descriptionText:{opacity:.5},addMoreBtn:{color:j.ZP.colors.periwinkle100}});var Instructions_ExampleLabelPreviewContainer=e=>{let{examples:t,element:n,location:i,setLocation:s,readOnly:o,handleDeleteExample:l,setExampleModalOpen:r,setExampleSelectionGridOpen:d,hasOpenedExample:c,projectTemplateId:p,isMigration:x}=e,m=U(),u=(0,h.ui)();return(0,a.jsx)("div",{children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:m.descriptionText,children:"Green border indicates well annotated example and red border indicates poorly annotated example"}),(0,a.jsx)("div",{className:m.container,children:t.map((e,r)=>(0,a.jsx)("div",{onClick:()=>{s({examples:t,path:h.F3.findPath(u,n)})},children:(0,a.jsx)(ExampleLabelPreview,{taskId:e.taskId,isGoodExample:e.isGoodExample,location:i,onDelete:()=>l(e.taskId),readOnly:o,index:r,caption:e.caption,hasOpenedExample:c,projectTemplateId:p,isMigration:x})},r))}),0===t.length&&!o&&(0,a.jsx)("div",{className:m.example,children:(0,a.jsx)("a",{onClick:()=>{s({examples:t,path:h.F3.findPath(u,n)}),d?d(!0):r(!0)},children:"+ Add examples"})}),t.length>0&&!o&&(0,a.jsx)("a",{onClick:()=>{s({examples:t,path:h.F3.findPath(u,n)}),d?d(!0):r(!0)},className:m.addMoreBtn,children:"Add more examples"})]})})};let LabelSection=e=>{let{attributes:t,children:n,element:s,readOnly:o,location:l,setLocation:r,setExampleModalOpen:d,setExampleSelectionGridOpen:p,hasOpenedExample:x,projectTemplateId:m,isMigration:u}=e,g=Y(),f=(0,h.ui)(),{labelName:b,examples:j}=s,[y,v]=(0,i.useState)(j.length<10),[w,k]=(0,i.useState)(b);return(0,a.jsxs)("div",{...t,contentEditable:!1,className:g.labelBlock,children:[(0,a.jsxs)("div",{className:g.labelHeader,children:[(0,a.jsx)("div",{className:g.labelNameContainer,children:(0,a.jsx)("input",{className:g.labelName,value:w,disabled:o,onChange:e=>{e.preventDefault(),k(e.target.value)},onBlur:e=>{e.preventDefault();let t=h.F3.findPath(f,s);c.YR.setNodes(f,{labelName:w},{at:t})}})}),(0,a.jsxs)("button",{className:g.toggleButton,onClick:()=>{r({examples:j,path:h.F3.findPath(f,s)}),v(!y)},children:[y?"Hide":"Show"," examples (",j.length,")"]})]}),j&&y&&(0,a.jsx)(Instructions_ExampleLabelPreviewContainer,{readOnly:o,examples:j,element:s,location:l,setLocation:r,setExampleModalOpen:d,setExampleSelectionGridOpen:p,handleDeleteExample:e=>{if(o)return;let t=h.F3.findPath(f,s),n=j.filter(t=>t.taskId!==e);c.YR.setNodes(f,{examples:n},{at:t})},hasOpenedExample:x,projectTemplateId:m,isMigration:u}),(0,a.jsx)("div",{children:n})]})},Y=(0,s.ZL)({labelBlock:{background:"#f2f2f2",borderRadius:8,margin:"16px 12px",padding:16},labelHeader:{display:"flex"},labelNameContainer:{width:"40%",flexShrink:0,fontWeight:500},labelName:{border:0,background:"#f2f2f2",fontWeight:500,fontSize:"16px",width:"100%"},toggleButton:{color:j.ZP.colors.periwinkle100,outline:"none",position:"relative",marginLeft:"auto",border:"none",padding:"0 8px",height:20,flexShrink:0,borderRadius:50,background:"transparent",fontSize:12,fontWeight:500,cursor:"pointer",transition:"background 120ms ease-out","&:hover":{background:"white"},"&:disabled":{opacity:.5}}}),q=["numbered-list","bulleted-list"],V=["label-section","iframe"],withEditableVoids=e=>{let{isVoid:t}=e;return e.isVoid=e=>!!V.includes(e.type)||t(e),e},Element=e=>{let{attributes:t,children:n,element:i}=e;switch(i.type){case"block-quote":return(0,a.jsx)("blockquote",{...t,style:{borderLeft:"2px solid #ddd",marginLeft:0,marginRight:0,paddingLeft:"10px",color:"#666",fontStyle:"italic"},children:n});case"bulleted-list":return(0,a.jsx)("ul",{...t,children:n});case"heading-1":if(n&&n.props&&n.props.node&&n.props.node.children.length>0)return(0,a.jsx)("section",{id:"#"+n.props.node.children[0].text.split(" ").join("_")+"-h1",...t,children:(0,a.jsx)("h1",{children:n})});return(0,a.jsx)("h1",{...t,children:n});case"heading-2":return(0,a.jsx)("h2",{...t,children:n});case"heading-3":return(0,a.jsx)("h3",{...t,children:n});case"heading-4":return(0,a.jsx)("h4",{...t,children:n});case"list-item":return(0,a.jsx)("li",{...t,children:n});case"numbered-list":return(0,a.jsx)("ol",{...t,children:n});case"label-section":return(0,a.jsx)(LabelSection,{...e,children:n});case"image":return(0,a.jsx)(ImageSection,{...e,children:n});case"iframe":return(0,a.jsx)(IframeSection,{...e,children:n});default:return(0,a.jsx)("p",{...t,children:n})}},Leaf=e=>{let{attributes:t,children:n,leaf:i}=e;return i.bold&&(n=(0,a.jsx)("strong",{children:n})),i.code&&(n=(0,a.jsx)("code",{children:n})),i.italic&&(n=(0,a.jsx)("em",{children:n})),i.underline&&(n=(0,a.jsx)("u",{children:n})),(0,a.jsx)("span",{...t,children:n})},toggleMark=(e,t)=>{isMarkActive(e,t)?c.ML.removeMark(e,t):c.ML.addMark(e,t,!0)},isMarkActive=(e,t)=>{let n=c.ML.marks(e);return!!n&&!0===n[t]},isBlockActive=(e,t)=>{let[n]=c.ML.nodes(e,{match:e=>!c.ML.isEditor(e)&&c.W_.isElement(e)&&e.type===t});return!!n},toggleBlock=(e,t)=>{let n=isBlockActive(e,t),a=q.includes(t);c.YR.unwrapNodes(e,{match:e=>q.includes(!c.ML.isEditor(e)&&c.W_.isElement(e)&&e.type),split:!0}),c.YR.setNodes(e,{type:n?"paragraph":a?"list-item":t}),!n&&a&&c.YR.wrapNodes(e,{type:t,children:[]})};var Instructions_SelfServeInstructions=e=>{var t;let{blocks:n,setBlocks:s,project:l,uploadedAssets:x,taxonomy:m,readOnly:u,hasSensitiveContent:g=!1,handleSave:f,isDirty:b=!1,isEdgeCase:j=!1,setInfoMsg:y,updatedAt:v,hasOpenedExample:w,projectTemplateId:k}=e,[I,S]=(0,i.useState)(null),[C,T]=(0,i.useState)(null),[N,A]=(0,i.useState)(!1),Z=(0,i.useMemo)(()=>withEditableVoids((0,p.VC)((0,h.BU)((0,c.Jh)()))),[]),E=(0,i.useCallback)(e=>(0,a.jsx)(Element,{...e,setInfoMsg:y,readOnly:u,location:I,setLocation:S,setExampleModalOpen:A,hasOpenedExample:w,projectTemplateId:k}),[u,I]),disableAdultContent=async()=>{let{isWorker:e}=await d.Z.selfserve.adultContentToggle({blockAdultContent:!0});e&&(window.location.href="/")},R=(0,i.useCallback)(e=>(0,a.jsx)(Leaf,{...e}),[]);return(0,a.jsxs)("div",{className:"jsx-d9c381bd5a1ff838 slate",children:[!!(null==l?void 0:null===(t=l.taxonomy)||void 0===t?void 0:t.param_chunks)&&(0,a.jsx)("h1",{style:{color:"blue"},className:"jsx-d9c381bd5a1ff838",children:"This project contains different types of tasks. Please refer to the relevant instruction sections for the questions and annotations you are given."}),j&&(0,a.jsx)("h1",{style:{color:"orange"},className:"jsx-d9c381bd5a1ff838",children:'This is an edge case detection task. The primary goal is to determine whether the following instructions are detailed and specific enough to complete the task WITHOUT AMBIGUITY. Please provide your feedback in the "edge case feedback" modal at the bottom of the task page.'}),g&&(0,a.jsxs)("h1",{style:{color:"red"},className:"jsx-d9c381bd5a1ff838",children:["WARNING: this project may contain sensitive content. If you're not comfortable with this, please ",(0,a.jsx)("a",{onClick:disableAdultContent,className:"jsx-d9c381bd5a1ff838",children:"exit now"})," to work on other projects."]}),!u&&(0,a.jsx)(o.NL,{when:b,message:"Are you sure you want to leave? Your changes have not been saved."}),(0,a.jsxs)(h.mH,{editor:Z,value:n,onChange:e=>s(e),children:[N&&(0,a.jsx)(P.Z,{modalOpen:N,setModalOpen:e=>A(e),project:l,uploadedAssets:x,taxonomy:m,location:I,lastSelection:Z.selection,handleSave:b?f:void 0}),!u&&(0,a.jsx)(Instructions_EditorToolbar,{isMarkActive:isMarkActive,isBlockActive:isBlockActive,toggleMark:toggleMark,toggleBlock:toggleBlock,lastSelection:C,handleSave:f,shouldShowLabeledExamples:m&&x,updatedAt:v}),(0,a.jsx)("div",{style:{overflowY:"auto",overflowX:"hidden"},className:"jsx-d9c381bd5a1ff838",children:(0,a.jsx)(h.CX,{renderElement:E,renderLeaf:R,placeholder:"Type here...",spellCheck:!0,autoFocus:!0,readOnly:u,onBlur:()=>{T(Z.selection)}})})]}),(0,a.jsx)(r(),{id:"d9c381bd5a1ff838",children:".slate section{-webkit-border-top-right-radius:0px!important;-moz-border-radius-topright:0px!important;border-top-right-radius:0px!important;width:100%;height:100%;-webkit-border-bottom-right-radius:0px!important;-moz-border-radius-bottomright:0px!important;border-bottom-right-radius:0px!important;border:0px!important;border-left:0;border-top:0;margin-top:0px!important}.slate{color:black}"})]})},G=n(879815),X=n(608139),Q=n.n(X),$=n(629554),K=n(910912),J=n(837553),ee=n(222868),et=n(571085);let en=new z.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1}}}),ea=(0,s.ZL)({buttons:{marginTop:"10px",flexShrink:0,padding:5,display:"flex",gap:10},outerContainer:{height:"85vh",display:"flex",flexDirection:"column",alignItems:"center",overflow:"hidden"},documentContainer:{overflow:"auto",marginLeft:24},documentWrapper:{maxWidth:"68%",height:"75vh",borderRadius:12,marginTop:24,border:"1px solid #E6E6E6",textAlign:"left",paddingTop:32,paddingLeft:32,paddingRight:32,overflow:"auto",background:"white"},instructionWrapper:{width:"1000px !important",overflow:"auto",padding:32,background:"white"},banner:{textAlign:"center",width:"100%",height:"50px",background:"green",color:"white",fontSize:"16px",padding:"15px",fontWeight:600}});var Instructions=e=>{let{user:t,project:n,instructionObjectId:s,onSave:l,isEdgeCase:r,isPreviewImg:c=!1,startTasks:p,startButtonText:h,isReviewMode:x}=e,m=!!s||!n,g=ea(),[f,y]=(0,i.useState)([{type:"heading-2",children:[{text:"Loading..."}]}]),[v,w]=(0,i.useState)(void 0),[k,I]=(0,i.useState)(!0),[S,C]=(0,i.useState)(!1),[T,A]=(0,i.useState)(null),[Z,E]=(0,i.useState)(""),[R,L]=(0,i.useState)(""),[M,D]=(0,i.useState)(!1),[P,B]=(0,i.useState)(!1),[O,W]=(0,i.useState)(null),[_,H]=(0,i.useState)(void 0),[U,Y]=(0,i.useState)(void 0),q=(0,i.useRef)(null),V=p&&!!h,X=(null==t?void 0:t.spoofed)||(null==t?void 0:t.email)&&(null==t?void 0:t.email.endsWith("scale.com")),[ei,es]=(0,i.useState)(!1),[eo,el]=(0,i.useState)(!1),[er,ed]=(0,i.useState)(!1),ec=(0,J.ZP)("use-rapid-instruction-limits",{},!1),[ep,eh]=(0,i.useState)(0),[ex,em]=(0,i.useState)(0),[eu,eg]=(0,i.useState)(0),[ef,eb]=(0,i.useState)([]),[ej,ey]=(0,i.useState)([]),[ev,ew]=(0,i.useState)(0),ek=(0,i.useMemo)(()=>!ec||ei&&eo&&er,[ec,ei,eo,er]),[eI,eS]=(0,i.useState)(null),eC=(0,o.k6)();(0,i.useEffect)(()=>{eh(new Date().getTime())},[eh]),(0,i.useEffect)(()=>{if(!eo&&V){let e=20,t=setInterval(function(){0===e&&(clearInterval(t),el(!0)),e-=1},1e3);return()=>{clearInterval(t)}}},[V,eo,s]),(0,i.useEffect)(()=>{(async function(){let e;if(I(!0),s){try{if((e=await d.Z.selfserve.fetchProjectInstructions({instructionObjectId:s,showChangeDescriptions:V})).instructions){if(V){let e=await d.Z.selfserve.fetchUserHasSeenInstructions({instructionObjectId:s});e&&(el(e),es(!0),ed(!0))}let t=x&&e.reviewInstructions?e.reviewInstructions:e.instructions;y(t),w(t),B(e.hasSensitiveContent),eT();let n=0,a=0;e.instructions.map(e=>b().has(e,"examples")&&e.examples.map(e=>e.isGoodExample?n++:a++)),em(n),eg(a),n+a===0&&ed(!0),I(!1),e.updatedAt&&H(e.updatedAt)}else y([{type:"heading-2",children:[{text:"ERROR: no instructions exist for ID ".concat(s)}]}]),I(!1)}catch(e){E("failed to find the instructions"),I(!1)}ew(ev+1);return}if(!n){alert("ERROR: component must be provided ID of either a Project or InstructionObject");return}try{e=await d.Z.selfserve.fetchProjectInstructions({project:n.id})}catch(e){E("failed to find the instructions"),I(!1)}let{taxonomy:t}=await d.Z.selfserve.fetchProjectTaxonomy({project:n.id});eS(t),e.instructions?(y(e.instructions),w(e.instructions),B(e.hasSensitiveContent),e.updatedAt&&H(e.updatedAt)):y((0,G.y$)(t,n.name,n.type)),I(!1);let a=(await d.Z.selfserve.fetchProjectAssets({project:n.id})).uploadedAssets,i=a.filter(e=>!!e.usedForLabeledExample);A(i.length>0?i:a),a.length>0&&n.type===N.TaskType.DocumentTranscription&&d.Z.selfserve.fetchAssetPages({assetId:a[0]._id}),ew(ev+1)})()},[n,s]),(0,i.useEffect)(()=>{(async function(){if(n){let{feedback:e,score:t,instructionFeedbackSummary:a}=await d.Z.selfserve.fetchInstructionPageFeedback({project:n.id});e.length>0&&W({feedback:e,score:t}),a&&a.length>0&&Y(a)}})()},[n]);let handleSave=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;C(!0);try{let i={project:n.id,instructions:f,updateTasks:e,updateLabelers:t,...a&&{changeDescription:a}};await d.Z.selfserve.setProjectInstructions(i),w(f),H(void 0),l&&l(),D(!0),setTimeout(()=>D(!1),5e3)}catch(e){E("failed to save")}C(!1)},eT=b().debounce(()=>{if(ei)return;let e=q.current;if(!e||e.scrollHeight<1e3){es(!0);return}if(V&&!ek){let t=e.scrollHeight-e.scrollTop-500<=e.clientHeight;t&&es(!0)}},10),eN=!b().isEqual(f,v),eA=U||(null==O?void 0:O.feedback)||[];return(0,a.jsx)(z.QueryClientProvider,{client:en,children:(0,a.jsxs)("div",{className:g.outerContainer,children:[V&&(0,a.jsx)("div",{className:g.banner,children:"Read all instructions and view examples to continue!"}),(0,a.jsx)("div",{className:g.documentContainer,ref:q,onScroll:eT,children:(0,a.jsxs)("div",{style:{display:c?"block":"flex"},children:[(0,a.jsxs)("div",{className:m?g.instructionWrapper:g.documentWrapper,children:[R&&(0,a.jsx)(F.Z,{severity:"warning",style:{marginTop:"6px",marginBottom:"6px"},children:R}),Z.length>0&&(0,a.jsx)(F.Z,{severity:"error",style:{marginTop:"6px",marginBottom:"6px"},children:Z}),M&&(0,a.jsxs)(F.Z,{severity:"success",style:{marginTop:"6px",marginBottom:"6px"},children:["Successfully saved! If applicable, please"," ",(0,a.jsx)("a",{onClick:()=>{eC.push("/".concat((0,$.MT)(eC.location.pathname),"/quality?")+Q().stringify({project:n.id,spoof:(null==t?void 0:t.spoofed)?t._id:void 0}))},children:"update your quality tasks"}),"!"]}),(0,a.jsx)(Instructions_SelfServeInstructions,{readOnly:m,blocks:f,setBlocks:y,project:n,taxonomy:eI,uploadedAssets:T,hasSensitiveContent:P,isDirty:eN,handleSave:!S&&(eN||(0,ee.bd)(n))&&!k?handleSave:void 0,isEdgeCase:r,setInfoMsg:L,updatedAt:_,hasOpenedExample:(e,t)=>{if(V){let n=t?ef:ej;(t?eb:ey)([...n,e]);let a=n.length+1>=Math.min(3,t?ex:eu),i=(t?ej:ef).length>=Math.min(3,t?eu:ex);a&&i&&ed(!0)}}},ev)]}),!m&&(0,a.jsx)("div",{style:{background:"white",borderRadius:12,width:"21%",marginLeft:12,paddingTop:32,paddingLeft:32,paddingRight:32,marginTop:24},children:O&&O.feedback?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{color:j.ZP.colors.periwinkle100},children:"Feedback from recent calibration batch"}),O.score>-1&&(0,a.jsxs)("div",{style:{marginTop:12},children:[(0,a.jsx)("div",{style:{fontWeight:"bold",marginBottom:8},children:"Overall Calibration Score:"}),Array.from(Array(Math.round(5*O.score/100))).map(e=>(0,a.jsx)(u.FontAwesomeIcon,{icon:"star",color:"gold"},e)),Array.from(Array(5-Math.round(5*O.score/100))).map(e=>(0,a.jsx)(u.FontAwesomeIcon,{icon:"star",color:"gray"},e)),(0,a.jsxs)("span",{style:{marginLeft:12,fontWeight:"bold"},children:[Math.round(O.score),"%"]})]}),(0,a.jsx)("div",{style:{marginTop:16,fontWeight:"bold"},children:"Feedback:"}),(0,a.jsx)("div",{style:{height:"60vh",overflowY:"scroll"},children:eA.map(e=>(0,a.jsx)("li",{style:{marginLeft:16,paddingBottom:4,lineHeight:1.5},children:e},e))})]}):(0,a.jsxs)("p",{style:{opacity:.75},children:[(0,a.jsx)("strong",{children:"Write guidelines for completing your tasks."})," ",(0,a.jsx)("br",{}),"To host the instructions for collaborative editing, you can use this\xa0",(0,a.jsx)("a",{href:"https://docs.google.com/document/d/1fjgRSni7PNzMCSKw7NqVfGAp29phcf3NzrAojUhpVUY/edit",target:"_blank",rel:"noopener noreferrer",children:"template"})," ","and then embed it as an iframe."]})})]})}),V&&(0,a.jsxs)("div",{className:g.buttons,children:[(0,a.jsx)(K.Z,{disabled:!ek,size:"lg",primary:!0,arrows:!0,onClick:()=>{async function updateUser(){if(s){let e=Math.round((new Date().getTime()-ep)/1e3);await d.Z.selfserve.setUserHasSeenInstructions({instructionObjectId:s,timeSpentSecs:e,usingInstructionRestrictions:ec});let t={isNewInstruction:!1,isOnboardingFlow:!1,isDuringTasking:!1,openTabButtonClicked:!1,startTime:ep,closeTime:new Date().getTime()};await (0,et.Kz)(et.ju.InstructionRenderRecord,t)}}p&&(p(),updateUser())},children:ek?h:eo?ei?ef.length<Math.min(ex,3)?"View more well-labeled examples":"View more poorly labeled examples":"Read the entire page":"Take more time to read the instructions"}),X&&(0,a.jsx)(K.Z,{size:"lg",arrows:!0,onClick:p,children:"Force Start (corp user)"})]})]})})}},657127:function(e,t,n){var a=n(824246),i=n(827378),s=n(433536),o=n(792739),l=n(5575);let ErrorPlaceholder=e=>{let{errorId:t,errorMessage:n,_errorInfo:i,componentDisplayName:s,hint:l}=e,d=r();return(0,a.jsxs)("div",{className:d.errorContainer,children:[(0,a.jsx)("div",{className:d.errorIcon,children:(0,a.jsx)(o.FontAwesomeIcon,{className:d.icon,icon:"exclamation-triangle"})}),(0,a.jsxs)("div",{className:d.errorContent,children:[(0,a.jsx)("h2",{children:"An unexpected error has occurred"}),l?(0,a.jsx)("div",{children:l}):(0,a.jsx)("div",{children:"Hint: either the task's taxonomy is malformed or the asset has failed to load."}),t&&(0,a.jsxs)("div",{children:["Error ID: ",t]}),n&&(0,a.jsxs)("div",{children:["Error Message: ",n]})]},s)]})},r=(0,s.ZL)(e=>({errorContainer:{display:"flex",flexDirection:"row",justifyContent:"flex-start"},errorIcon:{display:"flex",alignItems:"flex-start",justifyContent:"flex-start",margin:e.spacing(2)},icon:{fontSize:32,color:e.palette.warning.main},errorContent:{display:"flex",flexDirection:"column",gap:e.spacing(1)}}));let ErrorBoundary=class ErrorBoundary extends i.Component{componentDidCatch(e,t){let n=(0,l.dO)(e,"generic",t);this.setState({errorId:n,error:!0,errorInfo:t,errorMessage:e&&e.message})}render(){return this.state.error?(0,a.jsx)(ErrorPlaceholder,{errorId:this.state.errorId,errorMessage:this.state.errorMessage,_errorInfo:this.state.errorInfo,componentDisplayName:"unknown",hint:this.props.hint}):this.props.children}constructor(...e){super(...e),this.state={}}};t.Z=ErrorBoundary},235900:function(e,t,n){var a=n(824246),i=n(674721),s=n.n(i);n(827378);var o=n(165168),l=n(99562),r=n(747063);t.Z=e=>{let{isOpen:t,canSubmit:n=!0,message:i,onSubmit:d,onRequestClose:c,marginAmount:p}=e;return(0,a.jsxs)(o.u_,{maxWidth:600,isOpen:t,onRequestClose:c,contentLabel:"Confirmation",margin:p,children:[(0,a.jsx)(o.xB,{onRequestClose:c,children:"Confirmation"}),(0,a.jsx)(o.fe,{children:i}),(0,a.jsx)(o.mz,{children:(0,a.jsxs)("div",{className:"jsx-186b16cd0a3c6117 actions",children:[(0,a.jsx)(r.Z,{secondary:!0,onClick:c,children:"Cancel"}),(0,a.jsx)(r.Z,{disabled:!n,onClick:d,style:{color:"white",background:l.ZP.colors.primary1,marginLeft:12},children:"Confirm"})]})}),(0,a.jsx)(s(),{id:"186b16cd0a3c6117",children:".actions.jsx-186b16cd0a3c6117{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}"})]})}},460754:function(e,t,n){var a=n(827378),i=n(599789),s=n(271351);t.Z=()=>{let[e,t]=(0,a.useState)([]),[n,o]=(0,a.useState)(!1),l=(0,a.useCallback)(async e=>{if(!e.length)return;o(!0);let n=new AbortController,a=setTimeout(()=>n.abort(),5e3),l=await (0,s.V3)({feature:"studio-privacy-mode-assume-image"}),r=await Promise.all(e.map(e=>{let t=fetch(e.content,{method:"HEAD",signal:n.signal}).catch(e=>{});return t}));clearTimeout(a);let getHeaders=e=>{let t={},n=e.keys(),a=n.next();for(;a.value;)t[a.value]=e.get(a.value),a=n.next();return t},d=e.map((e,t)=>{let n=i.AttachmentType.Unprocessed;if(l)return n=i.AttachmentType.Image,{...e,type:n};let a=r[t];if(!a)return{...e};let s=getHeaders(a.headers)["content-type"];return s.match("image/*")?n=i.AttachmentType.Image:s.match("text/*")?n=i.AttachmentType.Text:s.match("video/*")?n=i.AttachmentType.Video:"application/pdf"===s?n=i.AttachmentType.PDF:s.match("audio/*")&&(n=i.AttachmentType.Audio),{...e,type:n}});return t(d),o(!1),d},[]);return{attachments:e,isLoading:n,fetchUnprocessedAttachments:l}}}}]);